{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Home","text":"<p>En esta web encontrar\u00e1s todas nuestras pr\u00e1cticas.</p> <p>Los miembros del grupo somos:</p> <ul> <li>Antonio March\u00e1n Posada</li> <li>Adri\u00e1n Jaramillo Rodr\u00edguez</li> <li>Jos\u00e9 Juan Herv\u00e1s Carrasco</li> <li>Arantxa Fern\u00e1ndez Morat\u00f3</li> </ul> <p>Puedes empezar a navegar por las pr\u00e1cticas utilizando el men\u00fa de arriba.</p>"},{"location":"p1-servidores-clientes/intro/","title":"Introducci\u00f3n","text":"<p>En esta pr\u00e1ctica se instalan y configuran distintos servidores y clientes de bases de datos.</p> <p>Este trabajo ha sido realizado por:</p> <ul> <li>Adri\u00e1n Jaramillo Rodr\u00edguez (capit\u00e1n)</li> <li>Jos\u00e9 Juan Herv\u00e1s Carrasco (secretario)</li> <li>Arantxa Fern\u00e1ndez Morat\u00f3 (facilitadora)</li> <li>Antonio March\u00e1n Posada (portavoz)</li> </ul> <p>Puedes empezar a navegar por la documentaci\u00f3n utilizando el navbar a tu izquierda.</p> <p>Esperamos que esta documentaci\u00f3n sea clara, y de utilidad.</p> <p></p>"},{"location":"p1-servidores-clientes/rg/herramienta-mongodb/","title":"Herramienta web MongoDB","text":""},{"location":"p1-servidores-clientes/rg/herramienta-mongodb/#mongodb-php-gui","title":"MongoDB-PHP-GUI","text":"<p>https://github.com/SamuelTallet/MongoDB-PHP-GUI</p>"},{"location":"p1-servidores-clientes/rg/herramienta-mongodb/#1-configuracion-previa","title":"1. Configuraci\u00f3n previa","text":"<p>Antes de instalar el contenedor vamos a instalar docker con los siguientes pasos.</p> <pre><code>curl -fsSL https://download.docker.com/linux/debian/gpg | sudo gpg --dearmor -o /usr/share/keyrings/docker-archive-keyring.gpg\n</code></pre> <pre><code>echo \"deb [arch=amd64 signed-by=/usr/share/keyrings/docker-archive-keyring.gpg] https://download.docker.com/linux/debian $(lsb_release -cs) stable\" | sudo tee /etc/apt/sources.list.d/docker.list &gt; /dev/null\n</code></pre> <p>Actualizar los repositorios e instalar docker.</p> <p><code>sudo apt update</code></p> <p><code>sudo apt install docker-ce docker-ce-cli containerd.io</code></p> <p>Comprobar si est\u00e1n activados los servicios.</p> <p><code>systemctl status docker containerd</code></p>"},{"location":"p1-servidores-clientes/rg/herramienta-mongodb/#2-instalacion-mongodb-php-gui","title":"2. Instalaci\u00f3n MongoDB-PHP-GUI","text":"<p>Descargamos el contenedor docker.</p> <p><code>sudo docker pull samueltallet/mongodb-php-gui</code></p>"},{"location":"p1-servidores-clientes/rg/herramienta-mongodb/#3-conexion","title":"3. Conexi\u00f3n","text":"<p>Correr el docker con el siguiente comando:</p> <p><code>sudo docker run --add-host localhost:192.168.122.98 --publish 5000:5000 --rm samueltallet/mongodb-php-gui</code></p> <p>Nos aparece una direcci\u00f3n que tendremos que escribir en el navegador. En mi caso es \"http://0.0.0.0:5000/\".</p> <p></p> <p></p> <p>Escribimos \"mongodb://admin:admin@192.168.122.98:27017\" y hacemos click en \"Login\".</p> <p></p> <p>Nos aparecer\u00e1n las bases de datos que tenemos en MongoDB.</p> <p></p> <p>Seleccionamos la base de datos maravilla y se nos abre un desplegable con las colecciones. Selecciono la colecci\u00f3n pel\u00edcula.</p> <p></p> <p>Tenemos opciones para insertar, borrar, contar o buscar por filtro, y las opciones limit, sort y order.</p> <p></p> <p>Tambi\u00e9n tenemos arriba pesta\u00f1as con diferentes opciones. Entre ellas, tenemos la posibilidad de administrar los usuarios de las bases de datos.</p> <p></p>"},{"location":"p1-servidores-clientes/rg/herramienta-mongodb/#4-conexion-remota","title":"4. Conexi\u00f3n remota","text":"<p>Para conectarnos desde un cliente remotamente solo tendremos que seguir los pasos anteriores y podremos acceder sin ning\u00fan problema.</p> <p></p> <p>En la siguiente captura vemos la ip del cliente desde el que estamos accediendo y al correr docker nos conectamos a la ip del servidor MongoDB.</p> <p></p> <p>Copiamos la direcci\u00f3n en el navegador.</p> <p></p> <p>Hacemos \"Login\" y ya habremos entrado de forma remota al servidor MongoDB.</p> <p></p>"},{"location":"p1-servidores-clientes/rg/herramienta-postgresql/","title":"Herramienta web PostgreSQL","text":"<p>La herramienta web que he elegido para configurar postgres se llama phpPgAdmin.</p> <p>Para poder instalar phpPgAdmin primero debemos realizar la instalaci\u00f3n y configuraci\u00f3n postgres al igual que la instalaci\u00f3n y configuraci\u00f3n de apache2.</p>"},{"location":"p1-servidores-clientes/rg/herramienta-postgresql/#instalacion-phppgadmin-y-configuracion","title":"Instalacion phpPgAdmin y configuraci\u00f3n","text":"<ul> <li>Primero Instalamos apache2</li> </ul> <pre><code>sudo apt install apache2\n</code></pre> <ul> <li>Seguidamente, instalamos phppgadmin:</li> </ul> <pre><code>sudo apt install phppgadmin php-pgsql\n</code></pre> <ul> <li>Una vez instalado, editamos el fichero de configuraci\u00f3n phppgadmin.conf y comentamos la l\u00ednea Require local:</li> </ul> <ul> <li>Ahora en el fichero de configuraci\u00f3n de config.inc.php, cambiamos el valor true por false en la siguiente l\u00ednea:</li> </ul> <ul> <li>Ahora definimos las siguientes l\u00edneas dentro de config.inc.php:</li> </ul> <ul> <li>Reiniciamos apache y accedemos a phppgmyadmin:</li> </ul> <ul> <li> <p>Introducimos nuestras credenciales que configuramos en la instalaci\u00f3n y configuraci\u00f3n de postgres y accedemos a la configuraci\u00f3n web:</p> </li> <li> <p>Introduzco los datos:</p> </li> </ul> <p></p> <ul> <li>Accedo al sistema:</li> </ul> <p></p>"},{"location":"p1-servidores-clientes/rg/oracle-enterprise-manager/","title":"Oracle Enterprise Manager","text":"<p>Primero comenzaremos mirando el puerto por el cual podremos acceder a Oracle Enterprise, para ello tenemos que conectarnos a trav\u00e9s de sys:</p> <p></p> <p>Puede ocurrir que no tengamos el puerto activo, lo cual se mostrar\u00eda con un 0, ingresaremos el siguiente comando: <code>exec dbms_xdb_config.sethttpsport(5500)</code></p> <p>Ahora vamos a sqlplus y vamos a especificar una contrase\u00f1a al usuario sys, de lo contrario no podremos conectarnos:</p> <p><code>alter user sys identified by sys;</code></p> <p></p> <p>Ahora especificando la ip y el puerto https://192.168.122.20:5500/em, podemos acceder al login.</p> <p></p> <p>Tenemos acceso a Oracle Enterprise y podremos ver todos los recursos que se est\u00e1n utilizando en el sistema.</p> <p>El enlace es en la red local con lo cual podemos acceder a Oracle enterprise desde cualquier web de nuestr \u00e1rea local.</p>"},{"location":"p1-servidores-clientes/rg/phpmyadmin/","title":"phpMyAdmin","text":""},{"location":"p1-servidores-clientes/rg/phpmyadmin/#apache","title":"Apache","text":"<p>Instalo:</p> <pre><code>sudo apt install apache2\n</code></pre> <p>Compruebo que funciona:</p> <pre><code>vagrant@servidormariadb:~$ sudo systemctl status apache2\n\u25cf apache2.service - The Apache HTTP Server\n     Loaded: loaded (/lib/systemd/system/apache2.service; enabled; vendor preset: enabled)\nActive: active (running) since Mon 2022-10-24 12:17:52 UTC; 16s ago\n       Docs: https://httpd.apache.org/docs/2.4/\n   Main PID: 1584 (apache2)\nTasks: 55 (limit: 1128)\nMemory: 8.8M\n        CPU: 23ms\n     CGroup: /system.slice/apache2.service\n             \u251c\u25001584 /usr/sbin/apache2 -k start\n             \u251c\u25001586 /usr/sbin/apache2 -k start\n             \u2514\u25001587 /usr/sbin/apache2 -k start\n\nOct 24 12:17:52 servidormariadb systemd[1]: Starting The Apache HTTP Server...\nOct 24 12:17:52 servidormariadb apachectl[1583]: AH00558: apache2: Could not reliably determine the server's fully qualified domain name, using 127.0.1.1. Set the 'ServerNam&gt;\nOct 24 12:17:52 servidormariadb systemd[1]: Started The Apache HTTP Server.\n</code></pre>"},{"location":"p1-servidores-clientes/rg/phpmyadmin/#php","title":"PHP","text":"<p>Instalo los paquetes que necesitaremos:</p> <pre><code>sudo apt install wget php php-cgi php-mysqli php-pear php-mbstring libapache2-mod-php php-common php-phpseclib php-mysql\n</code></pre>"},{"location":"p1-servidores-clientes/rg/phpmyadmin/#en-mariadb","title":"En MariaDB","text":"<p>Login como root:</p> <pre><code>sudo mariadb\n</code></pre> <p>Creo el usuario:</p> <pre><code>CREATE USER 'pma-admin'@localhost IDENTIFIED BY '1234';\n</code></pre> <p>Le doy privilegios:</p> <pre><code>GRANT ALL PRIVILEGES ON *.* TO 'pma-admin'@localhost IDENTIFIED BY '1234';\nFLUSH PRIVILEGES;\n</code></pre>"},{"location":"p1-servidores-clientes/rg/phpmyadmin/#descarga","title":"Descarga","text":"<pre><code>wget https://www.phpmyadmin.net/downloads/phpMyAdmin-latest-all-languages.tar.gz\ntar xvf phpMyAdmin-latest-all-languages.tar.gz\n</code></pre>"},{"location":"p1-servidores-clientes/rg/phpmyadmin/#instalacion","title":"Instalaci\u00f3n","text":"<p>Paso la aplicaci\u00f3n al DocumentRoot por defecto:</p> <pre><code>sudo mv phpMyAdmin-5.2.0-all-languages /var/www/html/phpmyadmin\n</code></pre> <p>Creo el fichero de configuraci\u00f3n:</p> <pre><code>cd /var/www/html\ncp phpmyadmin/config.sample.inc.php phpmyadmin/config.inc.php\n</code></pre> <p>Creo el directorio tmp:</p> <pre><code>mkdir /var/www/html/phpmyadmin/tmp\n</code></pre> <p>Genero la clave que usaremos para phpMyadmin:</p> <pre><code>vagrant@servidormariadb:/var/www/html$ openssl rand -base64 32\nknLvNBNeqZDIoJxYS4v+RnLqj8mzNxmZWdJSr1aClPk=\n</code></pre> <p>Modifico la siguiente l\u00ednea en <code>/var/www/html/phpmyadmin/config.inc.php</code> con la clave generada, recortada por el final para que sea exactamente de 32 caracteres:</p> <pre><code>$cfg['blowfish_secret'] = 'knLvNBNeqZDIoJxYS4v+RnLqj8mzNxmZ'; /* YOU MUST FILL IN THIS FOR COOKIE AUTH! */\n</code></pre> <p>A\u00f1ado tambi\u00e9n la siguiente l\u00ednea en <code>/var/www/html/phpmyadmin/config.inc.php</code>:</p> <pre><code>$cfg['TempDir'] = '/var/www/html/phpmyadmin/tmp';\n</code></pre> <p>Cambio los propietarios:</p> <pre><code>sudo chown -R www-data:www-data /var/www/html/phpmyadmin\n</code></pre> <p>Creo el siguiente fichero conf:</p> <pre><code>sudo touch /etc/apache2/conf-available/phpmyadmin.conf\n</code></pre> <p>Le a\u00f1ado el siguiente contenido:</p> <pre><code>Alias /phpmyadmin /var/www/html/phpmyadmin\n\n&lt;Directory /var/www/html/phpmyadmin/&gt;\n   AddDefaultCharset UTF-8\n   &lt;IfModule mod_authz_core.c&gt;\n          &lt;RequireAny&gt;\n      Require all granted\n     &lt;/RequireAny&gt;\n   &lt;/IfModule&gt;\n&lt;/Directory&gt;\n\n&lt;Directory /var/www/html/phpmyadmin/setup/&gt;\n   &lt;IfModule mod_authz_core.c&gt;\n     &lt;RequireAny&gt;\n       Require all granted\n     &lt;/RequireAny&gt;\n   &lt;/IfModule&gt;\n&lt;/Directory&gt;\n</code></pre> <p>Lo habilito:</p> <pre><code>sudo a2enconf phpmyadmin.conf\n</code></pre> <p>Reinicio Apache:</p> <pre><code>sudo systemctl restart apache2\n</code></pre>"},{"location":"p1-servidores-clientes/rg/phpmyadmin/#acceso","title":"Acceso","text":"<p>Entro y accedo con el usuario que creamos anteriormente:</p> <p></p> <p>Al principio tendremos este warning, clicamos en \"Find out why\":</p> <p></p> <p>Tenemos que clicar \"Create\" para crear la base de datos que necesita phpMyAdmin:</p> <p></p> <p>Vemos que todas las salidas son \"OK\" y que la base de datos se ha creado:</p> <p></p>"},{"location":"p1-servidores-clientes/rg/phpmyadmin/#uso","title":"Uso","text":"<p>A partir de ahora ya podr\u00edamos administrar nuestras bases de datos con esta herramienta.</p> <p>Por ejemplo, podemos ver las tablas que tiene <code>bibliofilos</code>:</p> <p></p> <p>Podemos ver tambi\u00e9n todos los registros que tiene cada tabla:</p> <p></p> <p></p> <p></p> <p>Y como es l\u00f3gico, a partir de ahora podr\u00edamos hacer todas las operaciones de administraci\u00f3n sobre MariaDB que quisi\u00e9ramos.</p>"},{"location":"p1-servidores-clientes/rg/phpmyadmin/#prueba-desde-clientemariadb","title":"Prueba desde <code>clientemariadb</code>","text":""},{"location":"p1-servidores-clientes/rg/phpmyadmin/#bibliografia","title":"Bibliograf\u00eda","text":"<p>https://www.how2shout.com/linux/how-to-install-phpmyadmin-on-debian-11-bullseye-apache/</p>"},{"location":"p1-servidores-clientes/rg/sql-developer/","title":"SQL Developer","text":""},{"location":"p1-servidores-clientes/rg/sql-developer/#1-instalacion","title":"1. Instalaci\u00f3n","text":"<p>En mi m\u00e1quina Windows 10 descargo SQL Developer de la p\u00e1gina oficial de Oracle.</p> <p>https://www.oracle.com/database/sqldeveloper/technologies/download/</p> <p>Una vez descargado, se descomprime el .zip y en la carpeta creada hacemos click en sqldeveloper.</p> <p></p> <p>Nos aparecer\u00e1 el siguiente recuadro, en el que se nos preguntar\u00e1 si queremos importar las preferencias de una instalaci\u00f3n anterior. Como en nuestro caso no ten\u00edamos instalaci\u00f3n hacemos click en \"No\".</p> <p></p> <p>Podemos crear un acceso directo en el escritorio para que nos sea m\u00e1s f\u00e1cil acceder a sqldeveloper la pr\u00f3xima vez que encendamos el ordenador.</p> <p>Ya nos aparecer\u00e1 la ventana del programa.</p> <p></p>"},{"location":"p1-servidores-clientes/rg/sql-developer/#2-conexion-a-base-de-datos","title":"2. Conexi\u00f3n a base de datos","text":"<p>La conexi\u00f3n a la base de datos se puede hacer de dos formas, de forma manual o cargando un archivo TNS Names.</p> <p>Con TNS Names habr\u00eda que dejar el contenido de tnsnames.ora de la siguiente manera, para que se conecte a nuestro servidor Oracle:</p> <pre><code>ORCLCDB=\n  (DESCRIPTION =\n    (ADDRESS_LIST =\n      (ADDRESS = (PROTOCOL = TCP)(HOST = 192.168.122.98)(PORT = 1521))\n    )\n    (CONNECT_DATA =\n      (SERVICE_NAME = ORCLCDB)\n    )\n  )\n</code></pre> <p>Nosotros lo vamos a hacer de forma manual. En SQL Developer presionamos en \"Crear una conexi\u00f3n manualmente\" o le damos al s\u00edmbolo de +.</p> <p></p> <p>Nos aparecer\u00e1 una ventana para crear nuevas conexiones. En esta ventana habr\u00e1n diferentes valores que tendremos que rellenar. </p> <ul> <li>Name: escribiremos el nombre que le queremos dar a la conexi\u00f3n creada. Nosotros la hemos llamado \"Conexion-Oracle19c-Debian\".</li> <li>Usuario: escribimos el nombre de usuario de la base de datos con el que nos conectaremos, en mi caso \"admin\".</li> <li>Contrase\u00f1a: la contrase\u00f1a del usuario con el que accederemos. </li> <li>Rol: esta opci\u00f3n la dejamos por defecto si vamos a entrar con un usuario normal.</li> <li>Tipo de conexi\u00f3n: dejamos la opci\u00f3n b\u00e1sica.</li> <li>Nombre del Host: escribimos la ip del servidor de base de datos. En nuestro caso es \"192.168.122.98\".</li> <li>Puerto: ponemos el puerto del servidor. Por defecto suele ser 1521, si en el servidor se ha cambiado el puerto habr\u00e1 que tenerlo en cuenta. </li> <li>SID: escribimos nuestro SID, que en nuestro caso es \"ORCLCDB\".</li> </ul> <p>Quedar\u00eda de la siguiente manera.</p> <p></p> <p>Clickamos en la opci\u00f3n Probar y en Estado debr\u00eda poner \"Correcto\". Si aparece error ser\u00e1 porque no tenemos bien configurado algo en el servidor o nos hemos equivocado en alg\u00fan dato.</p> <p></p> <p>Le damos a Conectar y ya nos aparecer\u00e1 a la izquierda la base de datos con sus tablas. Si seleccionamos una tabla podremos ver sus columnas.</p> <p></p> <p>Con SQL Developer podremos modificar todos los valores de la base de datos, crear nuevas tablas, modificar columnas, a\u00f1adir o borrar datos, etc. de una forma gr\u00e1fica.</p> <p></p>"},{"location":"p1-servidores-clientes/ri/alumno1/","title":"Alumno 1","text":""},{"location":"p1-servidores-clientes/ri/alumno1/#escenario","title":"Escenario","text":"<pre><code>Vagrant.configure(\"2\") do |config|\nconfig.vm.synced_folder \".\", \"/vagrant\", disabled: true\nconfig.vm.provider :libvirt do |libvirt|\nlibvirt.cpus = 2\nlibvirt.memory = 1024\nend\n\nconfig.vm.define :servidororacle do |servidororacle|\nservidororacle.vm.box = \"debian/bullseye64\"\nservidororacle.vm.provider :libvirt do |servidororacle|\nservidororacle.memory = 4096\nservidororacle.cpus = 6\nend\n    servidororacle.vm.hostname = \"servidororacle\"\nservidororacle.vm.network :private_network,\n      :libvirt__network_name =&gt; \"red-oracle\",\n      :libvirt__dhcp_enabled =&gt; false,\n      :ip =&gt; \"10.0.0.2\",\n      :libvirt__netmask =&gt; '255.255.255.0',\n      :libvirt__forward_mode =&gt; \"veryisolated\"\nend\n\nconfig.vm.define :clienteoracle do |clienteoracle|\nclienteoracle.vm.box = \"debian/bullseye64\"\nclienteoracle.vm.hostname = \"clienteoracle\"\nclienteoracle.vm.network :private_network,\n      :libvirt__network_name =&gt; \"red-oracle\",\n      :libvirt__dhcp_enabled =&gt; false,\n      :ip =&gt; \"10.0.0.3\",\n      :libvirt__netmask =&gt; '255.255.255.0',\n      :libvirt__forward_mode =&gt; \"veryisolated\"\nend\n\nconfig.vm.define :servidorpostgresql do |servidorpostgresql|\nservidorpostgresql.vm.box = \"debian/bullseye64\"\nservidorpostgresql.vm.hostname = \"servidorpostgresql\"\nservidorpostgresql.vm.network :private_network,\n      :libvirt__network_name =&gt; \"red-postgresql\",\n      :libvirt__dhcp_enabled =&gt; false,\n      :ip =&gt; \"10.0.1.2\",\n      :libvirt__netmask =&gt; '255.255.255.0',\n      :libvirt__forward_mode =&gt; \"veryisolated\"\nend\n\nconfig.vm.define :clientepostgresql do |clientepostgresql|\nclientepostgresql.vm.box = \"debian/bullseye64\"\nclientepostgresql.vm.hostname = \"clientepostgresql\"\nclientepostgresql.vm.network :private_network,\n      :libvirt__network_name =&gt; \"red-postgresql\",\n      :libvirt__dhcp_enabled =&gt; false,\n      :ip =&gt; \"10.0.1.3\",\n      :libvirt__netmask =&gt; '255.255.255.0',\n      :libvirt__forward_mode =&gt; \"veryisolated\"\nend\n\nconfig.vm.define :servidormariadb do |servidormariadb|\nservidormariadb.vm.box = \"debian/bullseye64\"\nservidormariadb.vm.hostname = \"servidormariadb\"\nservidormariadb.vm.network :private_network,\n      :libvirt__network_name =&gt; \"red-mariadb\",\n      :libvirt__dhcp_enabled =&gt; false,\n      :ip =&gt; \"10.0.2.2\",\n      :libvirt__netmask =&gt; '255.255.255.0',\n      :libvirt__forward_mode =&gt; \"veryisolated\"\nend\n\nconfig.vm.define :clientemariadb do |clientemariadb|\nclientemariadb.vm.box = \"debian/bullseye64\"\nclientemariadb.vm.hostname = \"clientemariadb\"\nclientemariadb.vm.network :private_network,\n      :libvirt__network_name =&gt; \"red-mariadb\",\n      :libvirt__dhcp_enabled =&gt; false,\n      :ip =&gt; \"10.0.2.3\",\n      :libvirt__netmask =&gt; '255.255.255.0',\n      :libvirt__forward_mode =&gt; \"veryisolated\"\nend\n\nconfig.vm.define :servidormongodb do |servidormongodb|\nservidormongodb.vm.box = \"debian/bullseye64\"\nservidormongodb.vm.hostname = \"servidormongodb\"\nservidormongodb.vm.network :private_network,\n      :libvirt__network_name =&gt; \"red-mongodb\",\n      :libvirt__dhcp_enabled =&gt; false,\n      :ip =&gt; \"10.0.3.2\",\n      :libvirt__netmask =&gt; '255.255.255.0',\n      :libvirt__forward_mode =&gt; \"veryisolated\"\nend\n\nconfig.vm.define :clientemongodb do |clientemongodb|\nclientemongodb.vm.box = \"debian/bullseye64\"\nclientemongodb.vm.hostname = \"clientemongodb\"\nclientemongodb.vm.network :private_network,\n      :libvirt__network_name =&gt; \"red-mongodb\",\n      :libvirt__dhcp_enabled =&gt; false,\n      :ip =&gt; \"10.0.3.3\",\n      :libvirt__netmask =&gt; '255.255.255.0',\n      :libvirt__forward_mode =&gt; \"veryisolated\"\nend\n\nend\n</code></pre>"},{"location":"p1-servidores-clientes/ri/alumno1/#1-oracle-19c","title":"1. Oracle 19c","text":""},{"location":"p1-servidores-clientes/ri/alumno1/#11-redimension-de-disco","title":"1.1 Redimensi\u00f3n de disco","text":"<p>Tenemos que tener suficiente espacio para instalar Oracle</p> <p>Paro la VM:</p> <pre><code>vagrant halt servidororacle\n</code></pre> <p>Redimensiono el fichero de disco:</p> <pre><code>virsh -c qemu:///system vol-resize p1-bd-alumno1_servidororacle.img 50G --pool default\n</code></pre> <p>Dentro de la VM redimensiono la partici\u00f3n y el sistema de ficheros:</p> <pre><code>echo \", +\" | sudo sfdisk -N 1 /dev/vda --no-reread\nsudo apt update\nsudo apt install parted\nsudo partprobe\nsudo resize2fs /dev/vda1\n</code></pre>"},{"location":"p1-servidores-clientes/ri/alumno1/#12-instalacion-del-servidor","title":"1.2 Instalaci\u00f3n del servidor","text":""},{"location":"p1-servidores-clientes/ri/alumno1/#121","title":"1.2.1","text":"<p>Descargo el rpm en mi host desde la p\u00e1gina oficial de Oracle:</p> <p></p>"},{"location":"p1-servidores-clientes/ri/alumno1/#122","title":"1.2.2","text":"<p>Lo paso a la VM <code>servidororacle</code>:</p> <pre><code>scp Downloads/oracle-database-ee-19c-1.0-1.x86_64.rpm vagrant@192.168.121.159:/home/vagrant\n</code></pre>"},{"location":"p1-servidores-clientes/ri/alumno1/#123","title":"1.2.3","text":"<p>Instalo los paquetes requeridos:</p> <pre><code>sudo apt install alien libaio1 unixodbc net-tools\n</code></pre>"},{"location":"p1-servidores-clientes/ri/alumno1/#124","title":"1.2.4","text":"<p>Convierto el rpm a deb:</p> <pre><code>sudo alien --scripts -d oracle-database-ee-19c-1.0-1.x86_64.rpm\n</code></pre> <p>Como resultado tendremos el paquete <code>oracle-database-ee-19c_1.0-2_amd64.deb</code></p>"},{"location":"p1-servidores-clientes/ri/alumno1/#125","title":"1.2.5","text":"<p>Creo el siguiente script:</p> <pre><code>sudo pico /sbin/chkconfig\n</code></pre> <p>Con el siguiente contenido:</p> <pre><code>#!/bin/bash\n# Oracle 19c installer chkconfig hack\nfile=/etc/init.d/oracle-19c\nif [[ ! `tail -n1 $file | grep INIT` ]]; then\necho &gt;&gt; $file\necho '### BEGIN INIT INFO' &gt;&gt; $file\necho '# Provides: Oracle 19c' &gt;&gt; $file\necho '# Required-Start: $remote_fs $syslog' &gt;&gt; $file\necho '# Required-Stop: $remote_fs $syslog' &gt;&gt; $file\necho '# Default-Start: 2 3 4 5' &gt;&gt; $file\necho '# Default-Stop: 0 1 6' &gt;&gt; $file\necho '# Short-Description: Oracle 19c' &gt;&gt; $file\necho '### END INIT INFO' &gt;&gt; $file\nfi\nupdate-rc.d oracle-19c defaults 80 01\n</code></pre> <p>Le doy permisos:</p> <pre><code>sudo chmod 777 /sbin/chkconfig  </code></pre>"},{"location":"p1-servidores-clientes/ri/alumno1/#126","title":"1.2.6","text":"<p>Creo el siguiente fichero para los par\u00e1metros de Kernel de Oracle:</p> <pre><code>sudo touch /etc/sysctl.d/60-oracle.conf\n</code></pre> <p>Con el siguiente contenido:</p> <pre><code># Oracle 19c kernel parameters\nfs.file-max=6815744\nnet.ipv4.ip_local_port_range=9000 65000\nkernel.sem=250 32000 100 128\nkernel.shmmax=536870912\n</code></pre>"},{"location":"p1-servidores-clientes/ri/alumno1/#127","title":"1.2.7","text":"<p>Arranco el siguiente servicio:</p> <pre><code>sudo systemctl start procps\n</code></pre>"},{"location":"p1-servidores-clientes/ri/alumno1/#128","title":"1.2.8","text":"<p>Creo el siguiente fichero para configurar el punto de montaje <code>/dev/shm</code> de Oracle:</p> <pre><code>sudo touch /etc/rc2.d/S01shm_load\n</code></pre> <p>Con el siguiente contenido:</p> <pre><code>#!/bin/sh\ncase \"$1\" in\nstart) mkdir /var/lock/subsys 2&gt;/dev/null\n       touch /var/lock/subsys/listener\n       rm /dev/shm 2&gt;/dev/null\n       mkdir /dev/shm 2&gt;/dev/null\n       mount -t tmpfs shmfs -o size=2048m /dev/shm ;;\n*) echo error\n   exit 1 ;;\nesac\n</code></pre> <p>Le doy permisos:</p> <pre><code>sudo chmod 777 /etc/rc2.d/S01shm_load\n</code></pre> <p>Hago un reinicio:</p> <pre><code>sudo reboot\n</code></pre>"},{"location":"p1-servidores-clientes/ri/alumno1/#129","title":"1.2.9","text":"<p>Instalo el paquete:</p> <pre><code>sudo dpkg --install oracle-database-ee-19c_1.0-2_amd64.deb\n</code></pre>"},{"location":"p1-servidores-clientes/ri/alumno1/#1210","title":"1.2.10","text":"<p>A\u00f1ado el par\u00e1metro <code>-J-Doracle.assistants.dbca.validate.ConfigurationParams=false</code> al final de la siguiente l\u00ednea en <code>/etc/init.d/oracledb_ORCLCDB-19c</code>:</p> <p></p> <p>Quedar\u00eda de la siguiente manera la l\u00ednea al modificarla:</p> <pre><code>$SU -s /bin/bash  $ORACLE_OWNER -c \"$DBCA -silent -createDatabase -gdbName $ORACLE_SID -templateName $TEMPLATE_NAME -characterSet $CHARSET -createAsContainerDatabase $CREATE_AS_CDB -numberOfPDBs $NUMBER_OF_PDBS -pdbName $PDB_NAME -createListener $LISTENER_NAME:$LISTENER_PORT -datafileDestination $ORACLE_DATA_LOCATION -sid $ORACLE_SID -autoGeneratePasswords -emConfiguration DBEXPRESS -emExpressPort $EM_EXPRESS_PORT -J-Doracle.assistants.dbca.validate.ConfigurationParams=false\"\n</code></pre>"},{"location":"p1-servidores-clientes/ri/alumno1/#1211","title":"1.2.11","text":"<p>A\u00f1ado la siguiente l\u00ednea a <code>/etc/hosts</code>:</p> <pre><code>192.168.121.159 servidororacle servidororacle\n</code></pre>"},{"location":"p1-servidores-clientes/ri/alumno1/#1212","title":"1.2.12","text":"<p>Ejecuto el script de configuraci\u00f3n de Oracle:</p> <pre><code>sudo /etc/init.d/oracledb_ORCLCDB-19c configure\n</code></pre>"},{"location":"p1-servidores-clientes/ri/alumno1/#1213","title":"1.2.13","text":"<p>Edito el siguiente fichero:</p> <pre><code>pico ~/.bashrc\n</code></pre> <p>A\u00f1ado las siguientes variables de entorno al final del fichero:</p> <pre><code># Oracle environment variables\nexport ORACLE_HOME=/opt/oracle/product/19c/dbhome_1\nexport ORACLE_SID=ORCLCDB\nexport NLS_LANG=`$ORACLE_HOME/bin/nls_lang.sh`\nexport ORACLE_BASE=/opt/oracle\nexport LD_LIBRARY_PATH=$ORACLE_HOME/lib:$LD_LIBRARY_PATH\nexport PATH=$ORACLE_HOME/bin:$PATH\n</code></pre> <p>Aplico los cambios:</p> <pre><code>. ~/.profile\n</code></pre> <p>Hago un reinicio:</p> <pre><code>sudo reboot\n</code></pre>"},{"location":"p1-servidores-clientes/ri/alumno1/#1214","title":"1.2.14","text":"<p>Inicio el servicio de Oracle:</p> <pre><code>sudo systemctl start oracledb_ORCLCDB-19c\n</code></pre>"},{"location":"p1-servidores-clientes/ri/alumno1/#1215","title":"1.2.15","text":"<p>A\u00f1ado la contrase\u00f1a <code>oracle</code> al usuario <code>oracle</code>:</p> <pre><code>sudo passwd oracle\n</code></pre> <p>Cambio su shell:</p> <pre><code>sudo usermod --shell /bin/bash oracle\n</code></pre> <p>Creo su home:</p> <pre><code>sudo mkdir /home/oracle\n</code></pre> <p>Cambio los propietarios:</p> <pre><code>sudo chown -R oracle:oinstall /home/oracle\n</code></pre> <p>A\u00f1ado el siguiente fichero:</p> <pre><code>touch ~/.profile\n</code></pre> <p>Con el siguiente contenido:</p> <pre><code># ~/.profile: executed by the command interpreter for login shells.\n# This file is not read by bash(1), if ~/.bash_profile or ~/.bash_login\n# exists.\n# see /usr/share/doc/bash/examples/startup-files for examples.\n# the files are located in the bash-doc package.\n# the default umask is set in /etc/profile; for setting the umask\n# for ssh logins, install and configure the libpam-umask package.\n#umask 022\n# if running bash\nif [ -n \"$BASH_VERSION\" ]; then\n# include .bashrc if it exists\nif [ -f \"$HOME/.bashrc\" ]; then\n. \"$HOME/.bashrc\"\nfi\nfi\n# set PATH so it includes user's private bin if it exists\nif [ -d \"$HOME/bin\" ] ; then\nPATH=\"$HOME/bin:$PATH\"\nfi\n# set PATH so it includes user's private bin if it exists\nif [ -d \"$HOME/.local/bin\" ] ; then\nPATH=\"$HOME/.local/bin:$PATH\"\nfi\n</code></pre> <p>Le a\u00f1ado a este usuario tambi\u00e9n las variables de entorno:</p> <pre><code>pico ~/.bashrc\n</code></pre> <pre><code># Oracle environment variables\nexport ORACLE_HOME=/opt/oracle/product/19c/dbhome_1\nexport ORACLE_SID=ORCLCDB\nexport NLS_LANG=`$ORACLE_HOME/bin/nls_lang.sh`\nexport ORACLE_BASE=/opt/oracle\nexport LD_LIBRARY_PATH=$ORACLE_HOME/lib:$LD_LIBRARY_PATH\nexport PATH=$ORACLE_HOME/bin:$PATH\n</code></pre> <p>Aplico los cambios:</p> <pre><code>. ~/.profile\n</code></pre> <p>Le hago admin:</p> <pre><code>sudo usermod -aG sudo oracle\n</code></pre> <p>A partir de ahora, para controlar Oracle correctamente, tendremos que estar logeados siempre con este usuario.</p>"},{"location":"p1-servidores-clientes/ri/alumno1/#1216","title":"1.2.16","text":"<p>A\u00f1ado el usuario <code>vagrant</code> al grupo <code>dba</code> por si en alg\u00fan momento quiero acceder a sqlplus de manera r\u00e1pida:</p> <pre><code>sudo usermod -a -G dba vagrant\n</code></pre>"},{"location":"p1-servidores-clientes/ri/alumno1/#13-acceso-local-privilegiado","title":"1.3 Acceso local privilegiado","text":"<pre><code>oracle@servidororacle:~$ sqlplus / as sysdba\n\nSQL*Plus: Release 19.0.0.0.0 - Production on Fri Oct 28 14:13:53 2022\nVersion 19.3.0.0.0\n\nCopyright (c) 1982, 2019, Oracle.  All rights reserved.\n\nConnected to:\nOracle Database 19c Enterprise Edition Release 19.0.0.0.0 - Production\nVersion 19.3.0.0.0\n\nSELECT banner FROM v$version;\nBANNER\n--------------------------------------------------------------------------------\nOracle Database 19c Enterprise Edition Release 19.0.0.0.0 - Production\n</code></pre> <p>Cuando en futuras ocasiones al conectarnos a Oracle nos aparezca el mensaje <code>Connected to an idle instance</code>, tenemos que ejecutar en <code>sqlplus</code> el comando <code>startup</code>.</p>"},{"location":"p1-servidores-clientes/ri/alumno1/#14-creacion-de-usuario","title":"1.4 Creaci\u00f3n de usuario","text":"<pre><code>alter session set \"_ORACLE_SCRIPT\"=true;\ncreate user bibliofilos_admin identified by 1234;\ngrant all privileges to bibliofilos_admin;\n</code></pre> <p>Pruebo que funciona el acceso:</p> <pre><code>oracle@servidororacle:~$ sqlplus bibliofilos_admin/1234\n\nSQL*Plus: Release 19.0.0.0.0 - Production on Fri Oct 28 14:18:26 2022\nVersion 19.3.0.0.0\n\nCopyright (c) 1982, 2019, Oracle.  All rights reserved.\n\nLast Successful login time: Fri Oct 28 2022 13:52:49 +00:00\n\nConnected to:\nOracle Database 19c Enterprise Edition Release 19.0.0.0.0 - Production\nVersion 19.3.0.0.0\n\nSQL&gt;\n</code></pre> <p>Pruebo que los privilegios se han aplicado correctamente con la siguiente consulta:</p> <pre><code>select * from dba_sys_privs where grantee = 'BIBLIOFILOS_ADMIN';\n</code></pre> <p>El output de esta consulta es demasiado largo, as\u00ed que entra en este gist para verlo.</p>"},{"location":"p1-servidores-clientes/ri/alumno1/#15-creacion-de-tablas","title":"1.5 Creaci\u00f3n de tablas","text":"<pre><code>CREATE TABLE bibliotecas (\nid NUMBER(10) NOT NULL,\nciudad VARCHAR2(50) NOT NULL,\ncalle VARCHAR2(50) NOT NULL,\nCONSTRAINT bibliotecas_pk PRIMARY KEY (id)\n);\nCREATE TABLE libros (\nid NUMBER(10) NOT NULL,\nid_biblioteca NUMBER(10) NOT NULL,\nn_paginas NUMBER(10) NOT NULL,\nautor VARCHAR2(50) NOT NULL,\nCONSTRAINT libros_pk PRIMARY KEY (id),\nCONSTRAINT id_biblioteca_fk_libros FOREIGN KEY (id_biblioteca)\nREFERENCES bibliotecas (id)\n);\nCREATE TABLE trabajadores (\nid NUMBER(10) NOT NULL,\nid_biblioteca NUMBER(10) NOT NULL,\nnombre VARCHAR2(50) NOT NULL,\napellido VARCHAR2(50) NOT NULL,\nCONSTRAINT trabajadores_pk PRIMARY KEY (id),\nCONSTRAINT id_biblioteca_fk_trabajadores FOREIGN KEY (id_biblioteca)\nREFERENCES bibliotecas (id)\n);\n</code></pre> <p>Compruebo que se han creado con la siguiente consulta:</p> <pre><code>SELECT\ntable_name, owner\nFROM\nall_tables\nWHERE\nowner='BIBLIOFILOS_ADMIN'\nORDER BY\nowner, table_name;\n</code></pre> <p>Devuelve lo siguiente:</p> <pre><code>TABLE_NAME                                                                                                                                               OWNER\n-------------------------------------------------------------------------------------------------------------------------------- --------------------------------------------------------------------------------------------------------------------------------\nBIBLIOTECAS                                                                                                                                              BIBLIOFILOS_ADMIN\nLIBROS                                                                                                                                                       BIBLIOFILOS_ADMIN\nTRABAJADORES                                                                                                                                                 BIBLIOFILOS_ADMIN\n</code></pre>"},{"location":"p1-servidores-clientes/ri/alumno1/#16-insercion-de-registros","title":"1.6 Inserci\u00f3n de registros","text":"<pre><code>INSERT INTO bibliotecas (id, ciudad, calle) VALUES (1, 'Utrera', 'Alvarez Quintero');\nINSERT INTO bibliotecas (id, ciudad, calle) VALUES (2, 'Dos Hermanas', 'Plaza Huerta Palacios');\nINSERT INTO libros (id, id_biblioteca, n_paginas, autor) VALUES (1, 1, 320, 'Dale Carnegie');\nINSERT INTO libros (id, id_biblioteca, n_paginas, autor) VALUES (2, 2, 714, 'Anne Frank');\nINSERT INTO trabajadores (id, id_biblioteca, nombre, apellido) VALUES (1, 1, 'Pepe', 'Pepito');\nINSERT INTO trabajadores (id, id_biblioteca, nombre, apellido) VALUES (2, 2, 'Jose', 'Joselito');\n</code></pre> <p>Compruebo que se han a\u00f1adido:</p> <pre><code>select * from bibliotecas;\nID CIUDAD                                                 CALLE\n---------- -------------------------------------------------- --------------------------------------------------\n1 Utrera                                                 Alvarez Quintero\n2 Dos Hermanas                                       Plaza Huerta Palacios\nselect * from libros;\nID ID_BIBLIOTECA  N_PAGINAS AUTOR\n---------- ------------- ---------- --------------------------------------------------\n1         1    320 Dale Carnegie\n2         2    714 Anne Frank\nselect * from trabajadores;\nID ID_BIBLIOTECA NOMBRE                                                 APELLIDO\n---------- ------------- -------------------------------------------------- --------------------------------------------------\n1         1 Pepe                                                       Pepito\n2         2 Jose                                                       Joselito\n</code></pre>"},{"location":"p1-servidores-clientes/ri/alumno1/#17-configuracion-del-acceso-remoto","title":"1.7 Configuraci\u00f3n del acceso remoto","text":"<p>Dejo <code>/opt/oracle/product/19c/dbhome_1/network/admin/listener.ora</code> de la siguiente manera:</p> <pre><code># listener.ora Network Configuration File: /opt/oracle/product/19c/dbhome_1/network/admin/listener.ora\n# Generated by Oracle configuration tools.\nLISTENER =\n(DESCRIPTION_LIST =\n(DESCRIPTION =\n(ADDRESS = (PROTOCOL = TCP)(HOST = 0.0.0.0)(PORT = 1521))\n(ADDRESS = (PROTOCOL = IPC)(KEY = EXTPROC1521))\n)\n)\nSID_LIST_LISTENER =\n(SID_LIST =\n(SID_DESC =\n(GLOBAL_DBNAME = ORCLCDB)\n(ORACLE_HOME = /opt/oracle/product/19c/dbhome_1)\n(SID_NAME = ORCLCDB)\n)\n)\n</code></pre> <p>Dejo <code>/opt/oracle/product/19c/dbhome_1/network/admin/tnsnames.ora</code> de la siguiente manera:</p> <pre><code># tnsnames.ora Network Configuration File: /opt/oracle/product/19c/dbhome_1/network/admin/tnsnames.ora\n# Generated by Oracle configuration tools.\nORCLCDB=\n(DESCRIPTION =\n(ADDRESS_LIST =\n(ADDRESS = (PROTOCOL = TCP)(HOST = servidororacle)(PORT = 1521))\n)\n(CONNECT_DATA =\n(SERVICE_NAME = ORCLCDB)\n)\n)\nLISTENER_ORCLCDB =\n(ADDRESS = (PROTOCOL = TCP)(HOST = servidororacle)(PORT = 1521))\n</code></pre> <p>Muestro el estado del listener:</p> <pre><code>oracle@servidororacle:~$ lsnrctl status\n\nLSNRCTL for Linux: Version 19.0.0.0.0 - Production on 28-OCT-2022 13:43:38\n\nCopyright (c) 1991, 2019, Oracle.  All rights reserved.\n\nConnecting to (DESCRIPTION=(ADDRESS=(PROTOCOL=TCP)(HOST=0.0.0.0)(PORT=1521)))\nTNS-12541: TNS:no listener\n TNS-12560: TNS:protocol adapter error\n  TNS-00511: No listener\n   Linux Error: 111: Connection refused\nConnecting to (DESCRIPTION=(ADDRESS=(PROTOCOL=IPC)(KEY=EXTPROC1521)))\nTNS-12541: TNS:no listener\n TNS-12560: TNS:protocol adapter error\n  TNS-00511: No listener\n   Linux Error: 2: No such file or directory\n</code></pre> <p>Estos errores significan que est\u00e1 parado, y adem\u00e1s podemos comprobar que efectivamente no tenemos procesos esperando peticiones en el puerto 1521:</p> <pre><code>oracle@servidororacle:~$ sudo ss -tulpn\nNetid      State        Recv-Q       Send-Q             Local Address:Port              Peer Address:Port      Process\nudp        UNCONN       0            0                        0.0.0.0:68                     0.0.0.0:*          users:((\"dhclient\",pid=314,fd=9))\nudp        UNCONN       0            0                      127.0.0.1:323                    0.0.0.0:*          users:((\"chronyd\",pid=413,fd=5))\nudp        UNCONN       0            0                          [::1]:21455                     [::]:*          users:((\"ora_lreg_orclcd\",pid=774,fd=10))\nudp        UNCONN       0            0                          [::1]:48386                     [::]:*          users:((\"ora_d000_orclcd\",pid=786,fd=7))\nudp        UNCONN       0            0                          [::1]:323                       [::]:*          users:((\"chronyd\",pid=413,fd=6))\nudp        UNCONN       0            0                          [::1]:51821                     [::]:*          users:((\"ora_s000_orclcd\",pid=788,fd=7))\ntcp        LISTEN       0            128                      0.0.0.0:22                     0.0.0.0:*          users:((\"sshd\",pid=411,fd=3))\ntcp        LISTEN       0            128                            *:19393                        *:*          users:((\"ora_d000_orclcd\",pid=786,fd=8))\ntcp        LISTEN       0            128                         [::]:22                        [::]:*          users:((\"sshd\",pid=411,fd=4))\n</code></pre> <p>Inicio el listener:</p> <pre><code>oracle@servidororacle:~$ lsnrctl start\n\nLSNRCTL for Linux: Version 19.0.0.0.0 - Production on 28-OCT-2022 13:48:46\n\nCopyright (c) 1991, 2019, Oracle.  All rights reserved.\n\nStarting /opt/oracle/product/19c/dbhome_1/bin/tnslsnr: please wait...\n\nTNSLSNR for Linux: Version 19.0.0.0.0 - Production\nSystem parameter file is /opt/oracle/product/19c/dbhome_1/network/admin/listener.ora\nLog messages written to /opt/oracle/diag/tnslsnr/servidororacle/listener/alert/log.xml\nListening on: (DESCRIPTION=(ADDRESS=(PROTOCOL=tcp)(HOST=0.0.0.0)(PORT=1521)))\nListening on: (DESCRIPTION=(ADDRESS=(PROTOCOL=ipc)(KEY=EXTPROC1521)))\nConnecting to (DESCRIPTION=(ADDRESS=(PROTOCOL=TCP)(HOST=0.0.0.0)(PORT=1521)))\nSTATUS of the LISTENER\n------------------------\nAlias                     LISTENER\nVersion                   TNSLSNR for Linux: Version 19.0.0.0.0 - Production\nStart Date                28-OCT-2022 13:48:46\nUptime                    0 days 0 hr. 0 min. 0 sec\nTrace Level               off\nSecurity                  ON: Local OS Authentication\nSNMP                      OFF\nListener Parameter File   /opt/oracle/product/19c/dbhome_1/network/admin/listener.ora\nListener Log File         /opt/oracle/diag/tnslsnr/servidororacle/listener/alert/log.xml\nListening Endpoints Summary...\n  (DESCRIPTION=(ADDRESS=(PROTOCOL=tcp)(HOST=0.0.0.0)(PORT=1521)))\n(DESCRIPTION=(ADDRESS=(PROTOCOL=ipc)(KEY=EXTPROC1521)))\nServices Summary...\nService \"ORCLCDB\" has 1 instance(s).\n  Instance \"ORCLCDB\", status UNKNOWN, has 1 handler(s) for this service...\nThe command completed successfully\n</code></pre> <p>Muestro que ahora s\u00ed tenemos un proceso esperando peticiones en el puerto 1521:</p> <p></p> <p>Pruebo a hacer un acceso usando tnsnames localmente para comprobar que funciona:</p> <p></p> <p>Cuando usamos el @ estamos forzando las conexiones por tnsnames aunque sean locales.</p>"},{"location":"p1-servidores-clientes/ri/alumno1/#18-instalacion-del-cliente","title":"1.8 Instalaci\u00f3n del cliente","text":"<p>Se har\u00e1 sobre <code>clienteoracle</code>.</p> <p>Descargo estos 2 archivos:</p> <pre><code>wget https://download.oracle.com/otn_software/linux/instantclient/218000/instantclient-basic-linux.x64-21.8.0.0.0dbru.zip\nwget https://download.oracle.com/otn_software/linux/instantclient/218000/instantclient-sqlplus-linux.x64-21.8.0.0.0dbru.zip\n</code></pre> <p>Creo el siguiente directorio:</p> <pre><code>sudo mkdir /opt/oracle\n</code></pre> <p>Descargo <code>unzip</code>:</p> <pre><code>sudo apt update\nsudo apt install unzip\n</code></pre> <p>Descomprimo:</p> <pre><code>sudo unzip -d /opt/oracle instantclient-basic-linux.x64-21.8.0.0.0dbru.zip\nsudo unzip -d /opt/oracle instantclient-sqlplus-linux.x64-21.8.0.0.0dbru.zip\n</code></pre> <p>A\u00f1ado las siguientes variables de entorno a <code>.bashrc</code>:</p> <pre><code>export LD_LIBRARY_PATH=/opt/oracle/instantclient_21_8:$LD_LIBRARY_PATH\nexport PATH=$LD_LIBRARY_PATH:$PATH\n</code></pre> <p>Aplico los cambios:</p> <pre><code>source ~/.bashrc\n</code></pre> <p>Compruebo que ya funciona <code>sqlplus</code>:</p> <pre><code>vagrant@clienteoracle:~$ sqlplus -V\n\nSQL*Plus: Release 21.0.0.0.0 - Production\nVersion 21.8.0.0.0\n</code></pre> <p>Creo el fichero <code>/opt/oracle/instantclient_21_8/network/admin/tnsnames.ora</code>:</p> <pre><code>sudo touch /opt/oracle/instantclient_21_8/network/admin/tnsnames.ora\n</code></pre> <p>Con el siguiente contenido:</p> <pre><code>ORCLCDB=\n(DESCRIPTION =\n(ADDRESS_LIST =\n(ADDRESS = (PROTOCOL = TCP)(HOST = 10.0.0.2)(PORT = 1521))\n)\n(CONNECT_DATA =\n(SERVICE_NAME = ORCLCDB)\n)\n)\n</code></pre>"},{"location":"p1-servidores-clientes/ri/alumno1/#19-prueba-de-acceso-remoto","title":"1.9 Prueba de acceso remoto","text":"<pre><code>vagrant@clienteoracle:~$ sqlplus bibliofilos_admin/1234@ORCLCDB\n\nSQL*Plus: Release 21.0.0.0.0 - Production on Fri Oct 28 12:23:58 2022\nVersion 21.8.0.0.0\n\nCopyright (c) 1982, 2022, Oracle.  All rights reserved.\n\nLast Successful login time: Fri Oct 28 2022 12:23:47 +00:00\n\nConnected to:\nOracle Database 19c Enterprise Edition Release 19.0.0.0.0 - Production\nVersion 19.3.0.0.0\n\nSQL&gt; set linesize 32000\nSQL&gt; set pagesize 400\nSQL&gt; select * from bibliotecas;\nID CIUDAD                                                 CALLE\n---------- -------------------------------------------------- --------------------------------------------------\n     1 Utrera                                                 Alvarez Quintero\n     2 Dos Hermanas                                       Plaza Huerta Palacios\n</code></pre>"},{"location":"p1-servidores-clientes/ri/alumno1/#110-mejoras-de-sqlplus","title":"1.10 Mejoras de sqlplus","text":""},{"location":"p1-servidores-clientes/ri/alumno1/#1101","title":"1.10.1","text":"<p>Para tener un formateado correcto del output permanente, tenemos que editar el fichero <code>/opt/oracle/product/19c/dbhome_1/sqlplus/admin/glogin.sql</code>.</p> <p>Lo podemos definir como queramos, en mi caso lo dejar\u00e9 de la siguiente manera:</p> <pre><code>--\n-- Copyright (c) 1988, 2005, Oracle.  All Rights Reserved.\n--\n-- NAME\n--   glogin.sql\n--\n-- DESCRIPTION\n--   SQL*Plus global login \"site profile\" file\n--\n--   Add any SQL*Plus commands here that are to be executed when a\n--   user starts SQL*Plus, or uses the SQL*Plus CONNECT command.\n--\n-- USAGE\n--   This script is automatically run\n--\nset linesize 32000\nset pagesize 400\n</code></pre> <p>Me conecto y hago una select para comprobar que funciona:</p> <pre><code>oracle@servidororacle:~$ sqlplus bibliofilos_admin/1234@ORCLCDB\n\nSQL*Plus: Release 19.0.0.0.0 - Production on Fri Oct 28 12:39:06 2022\nVersion 19.3.0.0.0\n\nCopyright (c) 1982, 2019, Oracle.  All rights reserved.\n\nLast Successful login time: Fri Oct 28 2022 12:23:58 +00:00\n\nConnected to:\nOracle Database 19c Enterprise Edition Release 19.0.0.0.0 - Production\nVersion 19.3.0.0.0\n\nSQL&gt; select * from bibliotecas;\nID CIUDAD                                                 CALLE\n---------- -------------------------------------------------- --------------------------------------------------\n     1 Utrera                                                 Alvarez Quintero\n     2 Dos Hermanas                                       Plaza Huerta Palacios\n</code></pre>"},{"location":"p1-servidores-clientes/ri/alumno1/#1102","title":"1.10.2","text":"<p>Por defecto sqlplus no trae la funcionalidad de historial de comandos y uso de las flechas para mover el cursor en los comandos.</p> <p>Si lo intentamos, nos sucede lo siguiente:</p> <p></p> <p>Para arreglarlo, tenemos que instalar:</p> <pre><code>sudo apt install rlwrap\n</code></pre> <p>A partir de ahora, tenemos que ejecutar sqlplus de la siguiente manera:</p> <pre><code>rlwrap sqlplus bibliofilos_admin/1234@ORCLCDB\n</code></pre> <p>B\u00e1sicamente a\u00f1adiendo <code>rlwrap</code> al principio de cualquier comando de conexi\u00f3n sqlplus que queramos hacer.</p> <p>Hacer esto siempre es tedioso, as\u00ed que podemos crear un alias en <code>~/.bashrc</code>:</p> <pre><code>alias sqlplus='rlwrap sqlplus'\n</code></pre> <p>Aplico los cambios:</p> <pre><code>source ~/.bashrc\n</code></pre> <p>Muestro el funcionamiento correcto:</p> <p></p>"},{"location":"p1-servidores-clientes/ri/alumno1/#2-postgresql","title":"2. PostgreSQL","text":""},{"location":"p1-servidores-clientes/ri/alumno1/#21-instalacion-del-servidor","title":"2.1 Instalaci\u00f3n del servidor","text":"<pre><code>sudo apt update\nsudo apt install postgresql postgresql-contrib\n</code></pre> <p>Compruebo que funciona:</p> <pre><code>vagrant@servidorpostgresql:~$ sudo systemctl status postgresql\n\u25cf postgresql.service - PostgreSQL RDBMS\n     Loaded: loaded (/lib/systemd/system/postgresql.service; enabled; vendor preset: enabled)\nActive: active (exited) since Tue 2022-10-18 10:12:46 UTC; 2min 50s ago\n   Main PID: 2772 (code=exited, status=0/SUCCESS)\nTasks: 0 (limit: 527)\nMemory: 0B\n        CPU: 0\nCGroup: /system.slice/postgresql.service\n\nOct 18 10:12:46 servidorpostgresql systemd[1]: Starting PostgreSQL RDBMS...\nOct 18 10:12:46 servidorpostgresql systemd[1]: Finished PostgreSQL RDBMS.\n</code></pre>"},{"location":"p1-servidores-clientes/ri/alumno1/#22-acceso-local-privilegiado","title":"2.2 Acceso local privilegiado","text":"<p>A\u00f1ado la contrase\u00f1a <code>1234</code> a <code>postgres</code> para habilitarlo:</p> <pre><code>sudo passwd postgres\n</code></pre> <p>Pruebo el acceso con <code>postgres</code>:</p> <pre><code>vagrant@servidorpostgresql:~$ su - postgres\nPassword:\npostgres@servidorpostgresql:~$ psql\npsql (13.8 (Debian 13.8-0+deb11u1))\nType \"help\" for help.\n\npostgres=#\n</code></pre>"},{"location":"p1-servidores-clientes/ri/alumno1/#23-creacion-de-la-base-de-datos","title":"2.3 Creaci\u00f3n de la base de datos","text":"<pre><code>CREATE DATABASE bibliofilos;\n</code></pre> <p>Compruebo que se ha creado:</p> <pre><code>postgres=# \\l\nList of databases\n    Name     |  Owner   | Encoding | Collate |  Ctype  |   Access privileges\n-------------+----------+----------+---------+---------+-----------------------\n bibliofilos | postgres | UTF8     | C.UTF-8 | C.UTF-8 |\npostgres    | postgres | UTF8     | C.UTF-8 | C.UTF-8 |\ntemplate0   | postgres | UTF8     | C.UTF-8 | C.UTF-8 | =c/postgres          +\n             |          |          |         |         | postgres=CTc/postgres\n template1   | postgres | UTF8     | C.UTF-8 | C.UTF-8 | =c/postgres          +\n             |          |          |         |         | postgres=CTc/postgres\n(4 rows)\n</code></pre> <p>Me conecto:</p> <pre><code>postgres=# \\connect bibliofilos\nYou are now connected to database \"bibliofilos\" as user \"postgres\".\nbibliofilos=#\n</code></pre>"},{"location":"p1-servidores-clientes/ri/alumno1/#24-creacion-de-tablas","title":"2.4 Creaci\u00f3n de tablas","text":"<pre><code>CREATE TABLE bibliotecas (\nid serial PRIMARY KEY,\n  ciudad VARCHAR ( 50 ) NOT NULL,\n  calle VARCHAR ( 50 ) NOT NULL\n);\nCREATE TABLE libros (\nid serial PRIMARY KEY,\n  id_biblioteca serial NOT NULL,\n  n_paginas int NOT NULL,\n  autor VARCHAR ( 50 ) NOT NULL,\n  FOREIGN KEY (id_biblioteca)\nREFERENCES Bibliotecas (id)\n);\nCREATE TABLE trabajadores (\nid serial PRIMARY KEY,\n  id_biblioteca serial NOT NULL,\n  nombre VARCHAR ( 50 ) NOT NULL,\n  apellido VARCHAR ( 50 ) NOT NULL,\n  FOREIGN KEY (id_biblioteca)\nREFERENCES Bibliotecas (id)\n);\n</code></pre> <p>Compruebo que se han creado:</p> <pre><code>bibliofilos=# \\dt\nList of relations\n Schema |     Name     | Type  |  Owner\n--------+--------------+-------+----------\n public | bibliotecas  | table | postgres\n public | libros       | table | postgres\n public | trabajadores | table | postgres\n(3 rows)\n</code></pre>"},{"location":"p1-servidores-clientes/ri/alumno1/#25-insercion-de-registros","title":"2.5 Inserci\u00f3n de registros","text":"<pre><code>INSERT INTO bibliotecas (ciudad, calle) VALUES('Utrera', 'Alvarez Quintero');\nINSERT INTO bibliotecas (ciudad, calle) VALUES('Dos Hermanas', 'Plaza Huerta Palacios');\nINSERT INTO libros (id_biblioteca, n_paginas, autor) VALUES(1, 320, 'Dale Carnegie');\nINSERT INTO libros (id_biblioteca, n_paginas, autor) VALUES(2, 714, 'Anne Frank');\nINSERT INTO trabajadores (id_biblioteca, nombre, apellido) VALUES(1, 'Pepe', 'Pepito');\nINSERT INTO trabajadores (id_biblioteca, nombre, apellido) VALUES(2, 'Jose', 'Joselito');\n</code></pre> <p>Compruebo que se han a\u00f1adido:</p> <pre><code>bibliofilos=# select * from bibliotecas;\nid |    ciudad    |         calle\n----+--------------+-----------------------\n  1 | Utrera       | Alvarez Quintero\n  2 | Dos Hermanas | Plaza Huerta Palacios\n(2 rows)\nbibliofilos=# select * from libros;\nid | id_biblioteca | n_paginas |     autor\n----+---------------+-----------+---------------\n  1 |             1 |       320 | Dale Carnegie\n  2 |             2 |       714 | Anne Frank\n(2 rows)\nbibliofilos=# select * from trabajadores;\nid | id_biblioteca | nombre | apellido\n----+---------------+--------+----------\n  1 |             1 | Pepe   | Pepito\n  2 |             2 | Jose   | Joselito\n(2 rows)\n</code></pre>"},{"location":"p1-servidores-clientes/ri/alumno1/#26-creacion-de-usuarios","title":"2.6 Creaci\u00f3n de usuarios","text":"<p>En debian:</p> <pre><code>sudo adduser bibliofilos_admin\n</code></pre> <p>En PostgreSQL:</p> <pre><code>create user bibliofilos_admin with encrypted password '1234';\n</code></pre> <p>Compruebo que se ha creado:</p> <pre><code>postgres=# \\du\nList of roles\n     Role name     |                         Attributes                         | Member of\n-------------------+------------------------------------------------------------+-----------\n bibliofilos_admin |                                                            | {}\npostgres          | Superuser, Create role, Create DB, Replication, Bypass RLS | {}\n</code></pre> <p>Le doy privilegios sobre la base de datos:</p> <pre><code>GRANT all privileges ON DATABASE bibliofilos TO bibliofilos_admin;\n</code></pre> <p>Al listar las bases de datos podemos ver los privilegios de acceso:</p> <pre><code>postgres=# \\l\nList of databases\n    Name     |  Owner   | Encoding | Collate |  Ctype  |       Access privileges\n-------------+----------+----------+---------+---------+--------------------------------\n bibliofilos | postgres | UTF8     | C.UTF-8 | C.UTF-8 | =Tc/postgres                  +\n             |          |          |         |         | postgres=CTc/postgres         +\n             |          |          |         |         | bibliofilos_admin=CTc/postgres\n postgres    | postgres | UTF8     | C.UTF-8 | C.UTF-8 |\ntemplate0   | postgres | UTF8     | C.UTF-8 | C.UTF-8 | =c/postgres                   +\n             |          |          |         |         | postgres=CTc/postgres\n template1   | postgres | UTF8     | C.UTF-8 | C.UTF-8 | =c/postgres                   +\n             |          |          |         |         | postgres=CTc/postgres\n(4 rows)\n</code></pre> <p>Le doy privilegios sobre las tablas:</p> <pre><code>GRANT ALL PRIVILEGES ON ALL TABLES IN SCHEMA public TO bibliofilos_admin;\n</code></pre> <p>Muestro que se han aplicado los privilegios:</p> <pre><code>bibliofilos=# SELECT * from information_schema.table_privileges WHERE grantee = 'bibliofilos_admin';\ngrantor  |      grantee      | table_catalog | table_schema |  table_name  | privilege_type | is_grantable | with_hierarchy\n----------+-------------------+---------------+--------------+--------------+----------------+--------------+----------------\npostgres | bibliofilos_admin | bibliofilos   | public       | bibliotecas  | INSERT         | NO           | NO\npostgres | bibliofilos_admin | bibliofilos   | public       | bibliotecas  | SELECT         | NO           | YES\npostgres | bibliofilos_admin | bibliofilos   | public       | bibliotecas  | UPDATE         | NO           | NO\npostgres | bibliofilos_admin | bibliofilos   | public       | bibliotecas  | DELETE         | NO           | NO\npostgres | bibliofilos_admin | bibliofilos   | public       | bibliotecas  | TRUNCATE       | NO           | NO\npostgres | bibliofilos_admin | bibliofilos   | public       | bibliotecas  | REFERENCES     | NO           | NO\npostgres | bibliofilos_admin | bibliofilos   | public       | bibliotecas  | TRIGGER        | NO           | NO\npostgres | bibliofilos_admin | bibliofilos   | public       | libros       | INSERT         | NO           | NO\npostgres | bibliofilos_admin | bibliofilos   | public       | libros       | SELECT         | NO           | YES\npostgres | bibliofilos_admin | bibliofilos   | public       | libros       | UPDATE         | NO           | NO\npostgres | bibliofilos_admin | bibliofilos   | public       | libros       | DELETE         | NO           | NO\npostgres | bibliofilos_admin | bibliofilos   | public       | libros       | TRUNCATE       | NO           | NO\npostgres | bibliofilos_admin | bibliofilos   | public       | libros       | REFERENCES     | NO           | NO\npostgres | bibliofilos_admin | bibliofilos   | public       | libros       | TRIGGER        | NO           | NO\npostgres | bibliofilos_admin | bibliofilos   | public       | trabajadores | INSERT         | NO           | NO\npostgres | bibliofilos_admin | bibliofilos   | public       | trabajadores | SELECT         | NO           | YES\npostgres | bibliofilos_admin | bibliofilos   | public       | trabajadores | UPDATE         | NO           | NO\npostgres | bibliofilos_admin | bibliofilos   | public       | trabajadores | DELETE         | NO           | NO\npostgres | bibliofilos_admin | bibliofilos   | public       | trabajadores | TRUNCATE       | NO           | NO\npostgres | bibliofilos_admin | bibliofilos   | public       | trabajadores | REFERENCES     | NO           | NO\npostgres | bibliofilos_admin | bibliofilos   | public       | trabajadores | TRIGGER        | NO           | NO\n(21 rows)\n</code></pre>"},{"location":"p1-servidores-clientes/ri/alumno1/#27-configuracion-del-acceso-remoto","title":"2.7 Configuraci\u00f3n del acceso remoto","text":"<p>Modifico la siguiente l\u00ednea en <code>/etc/postgresql/13/main/postgresql.conf</code>:</p> <pre><code>listen_addresses = '*'\n</code></pre> <p>A\u00f1ado las siguientes l\u00edneas a <code>/etc/postgresql/13/main/pg_hba.conf</code>:</p> <pre><code># Remote connections\nhost    all             all             0.0.0.0/0               md5\n</code></pre> <p>Reinicio:</p> <pre><code>sudo systemctl restart postgresql </code></pre>"},{"location":"p1-servidores-clientes/ri/alumno1/#28-instalacion-del-cliente","title":"2.8 Instalaci\u00f3n del cliente","text":"<p>Se har\u00e1 sobre <code>clientepostgresql</code>.</p> <pre><code>sudo apt update\nsudo apt install postgresql-client\n</code></pre>"},{"location":"p1-servidores-clientes/ri/alumno1/#29-prueba-de-acceso-remoto","title":"2.9 Prueba de acceso remoto","text":"<pre><code>vagrant@clientepostgresql:~$ psql -U bibliofilos_admin -h 10.0.1.2 -p 5432 bibliofilos\nPassword for user bibliofilos_admin:\npsql (13.8 (Debian 13.8-0+deb11u1))\nSSL connection (protocol: TLSv1.3, cipher: TLS_AES_256_GCM_SHA384, bits: 256, compression: off)\nType \"help\" for help.\n\nbibliofilos=&gt; \\l\nList of databases\n    Name     |  Owner   | Encoding | Collate |  Ctype  |       Access privileges\n-------------+----------+----------+---------+---------+--------------------------------\n bibliofilos | postgres | UTF8     | C.UTF-8 | C.UTF-8 | =Tc/postgres                  +\n             |          |          |         |         | postgres=CTc/postgres         +\n             |          |          |         |         | bibliofilos_admin=CTc/postgres\n postgres    | postgres | UTF8     | C.UTF-8 | C.UTF-8 |\ntemplate0   | postgres | UTF8     | C.UTF-8 | C.UTF-8 | =c/postgres                   +\n             |          |          |         |         | postgres=CTc/postgres\n template1   | postgres | UTF8     | C.UTF-8 | C.UTF-8 | =c/postgres                   +\n             |          |          |         |         | postgres=CTc/postgres\n(4 rows)\nbibliofilos=&gt; \\dt\n            List of relations\n Schema |     Name     | Type  |  Owner\n--------+--------------+-------+----------\n public | bibliotecas  | table | postgres\n public | libros       | table | postgres\n public | trabajadores | table | postgres\n(3 rows)\nbibliofilos=&gt; select * from bibliotecas;\nid |    ciudad    |         calle\n----+--------------+-----------------------\n  1 | Utrera       | Alvarez Quintero\n  2 | Dos Hermanas | Plaza Huerta Palacios\n(2 rows)\n</code></pre>"},{"location":"p1-servidores-clientes/ri/alumno1/#3-mariadb","title":"3. MariaDB","text":""},{"location":"p1-servidores-clientes/ri/alumno1/#31-instalacion-del-servidor","title":"3.1 Instalaci\u00f3n del servidor","text":"<pre><code>sudo apt update\nsudo apt install mariadb-server\n</code></pre> <p>Compruebo que funciona:</p> <pre><code>vagrant@servidormariadb:~$ sudo systemctl status mariadb\n\u25cf mariadb.service - MariaDB 10.5.15 database server\n     Loaded: loaded (/lib/systemd/system/mariadb.service; enabled; vendor preset: enabled)\nActive: active (running) since Wed 2022-10-19 11:01:36 UTC; 11min ago\n       Docs: man:mariadbd(8)\nhttps://mariadb.com/kb/en/library/systemd/\n    Process: 2111 ExecStartPre=/usr/bin/install -m 755 -o mysql -g root -d /var/run/mysqld (code=exited, status=0/SUCCESS)\nProcess: 2112 ExecStartPre=/bin/sh -c systemctl unset-environment _WSREP_START_POSITION (code=exited, status=0/SUCCESS)\nProcess: 2114 ExecStartPre=/bin/sh -c [ ! -e /usr/bin/galera_recovery ] &amp;&amp; VAR= ||   VAR=`cd /usr/bin/..; /usr/bin/galera_recovery`; [ $? -eq 0 ]   &amp;&amp; systemctl set-envi&gt;\n    Process: 2174 ExecStartPost=/bin/sh -c systemctl unset-environment _WSREP_START_POSITION (code=exited, status=0/SUCCESS)\nProcess: 2176 ExecStartPost=/etc/mysql/debian-start (code=exited, status=0/SUCCESS)\nMain PID: 2161 (mariadbd)\nStatus: \"Taking your SQL requests now...\"\nTasks: 8 (limit: 527)\nMemory: 61.7M\n        CPU: 425ms\n     CGroup: /system.slice/mariadb.service\n             \u2514\u25002161 /usr/sbin/mariadbd\n\nOct 19 11:01:36 servidormariadb mariadbd[2161]: 2022-10-19 11:01:36 0 [Note] Server socket created on IP: '127.0.0.1'.\nOct 19 11:01:36 servidormariadb mariadbd[2161]: 2022-10-19 11:01:36 0 [Note] InnoDB: Buffer pool(s) load completed at 221019 11:01:36\nOct 19 11:01:36 servidormariadb mariadbd[2161]: 2022-10-19 11:01:36 0 [Note] Reading of all Master_info entries succeeded\nOct 19 11:01:36 servidormariadb mariadbd[2161]: 2022-10-19 11:01:36 0 [Note] Added new Master_info '' to hash table\nOct 19 11:01:36 servidormariadb mariadbd[2161]: 2022-10-19 11:01:36 0 [Note] /usr/sbin/mariadbd: ready for connections.\nOct 19 11:01:36 servidormariadb mariadbd[2161]: Version: '10.5.15-MariaDB-0+deb11u1'  socket: '/run/mysqld/mysqld.sock'  port: 3306  Debian 11\nOct 19 11:01:36 servidormariadb systemd[1]: Started MariaDB 10.5.15 database server.\nOct 19 11:01:36 servidormariadb /etc/mysql/debian-start[2178]: Upgrading MySQL tables if necessary.\nOct 19 11:01:36 servidormariadb /etc/mysql/debian-start[2189]: Checking for insecure root accounts.\nOct 19 11:01:36 servidormariadb /etc/mysql/debian-start[2193]: Triggering myisam-recover for all MyISAM tables and aria-recover for all Aria tables\n</code></pre>"},{"location":"p1-servidores-clientes/ri/alumno1/#32-acceso-local-privilegiado","title":"3.2 Acceso local privilegiado","text":"<pre><code>vagrant@servidormariadb:~$ sudo mariadb\nWelcome to the MariaDB monitor.  Commands end with ; or \\g.\nYour MariaDB connection id is 31\nServer version: 10.5.15-MariaDB-0+deb11u1 Debian 11\nCopyright (c) 2000, 2018, Oracle, MariaDB Corporation Ab and others.\n\nType 'help;' or '\\h' for help. Type '\\c' to clear the current input statement.\n\nMariaDB [(none)]&gt;\n</code></pre>"},{"location":"p1-servidores-clientes/ri/alumno1/#33-creacion-de-la-base-de-datos","title":"3.3 Creaci\u00f3n de la base de datos","text":"<pre><code>create database bibliofilos;\n</code></pre> <p>Compruebo que se ha creado:</p> <pre><code>MariaDB [(none)]&gt; show databases;\n+--------------------+\n| Database           |\n+--------------------+\n| bibliofilos        |\n| information_schema |\n| mysql              |\n| performance_schema |\n+--------------------+\n4 rows in set (0.000 sec)\n</code></pre> <p>Me conecto:</p> <pre><code>MariaDB [(none)]&gt; use bibliofilos;\nDatabase changed\nMariaDB [bibliofilos]&gt;\n</code></pre>"},{"location":"p1-servidores-clientes/ri/alumno1/#34-creacion-de-tablas","title":"3.4 Creaci\u00f3n de tablas","text":"<pre><code>create table bibliotecas(\nid int auto_increment,\nciudad varchar(50) not null,\ncalle varchar(50) not null,\nprimary key(id)\n);\ncreate table libros(\nid int auto_increment,\nid_biblioteca int not null,\nn_paginas int not null,\nautor varchar(50) not null,\nprimary key(id),\nforeign key(id_biblioteca)\nreferences bibliotecas(id)\n);\ncreate table trabajadores(\nid int auto_increment,\nid_biblioteca int not null,\nnombre varchar(50) not null,\napellido varchar(50) not null,\nprimary key(id),\nforeign key(id_biblioteca)\nreferences bibliotecas(id)\n);\n</code></pre> <p>Compruebo que se han creado:</p> <pre><code>MariaDB [bibliofilos]&gt; show tables;\n+-----------------------+\n| Tables_in_bibliofilos |\n+-----------------------+\n| bibliotecas           |\n| libros                |\n| trabajadores          |\n+-----------------------+\n3 rows in set (0.001 sec)\n</code></pre>"},{"location":"p1-servidores-clientes/ri/alumno1/#35-insercion-de-registros","title":"3.5 Inserci\u00f3n de registros","text":"<pre><code>INSERT INTO bibliotecas (ciudad, calle) VALUES ('Utrera', 'Alvarez Quintero');\nINSERT INTO bibliotecas (ciudad, calle) VALUES ('Dos Hermanas', 'Plaza Huerta Palacios');\nINSERT INTO libros (id_biblioteca, n_paginas, autor) VALUES (1, 320, 'Dale Carnegie');\nINSERT INTO libros (id_biblioteca, n_paginas, autor) VALUES (2, 714, 'Anne Frank');\nINSERT INTO trabajadores (id_biblioteca, nombre, apellido) VALUES (1, 'Pepe', 'Pepito');\nINSERT INTO trabajadores (id_biblioteca, nombre, apellido) VALUES (2, 'Jose', 'Joselito');\n</code></pre> <p>Compruebo que se han a\u00f1adido:</p> <pre><code>MariaDB [bibliofilos]&gt; select * from bibliotecas;\n+----+--------------+-----------------------+\n| id | ciudad       | calle                 |\n+----+--------------+-----------------------+\n|  1 | Utrera       | Alvarez Quintero      |\n|  2 | Dos Hermanas | Plaza Huerta Palacios |\n+----+--------------+-----------------------+\n2 rows in set (0.001 sec)\nMariaDB [bibliofilos]&gt; select * from libros;\n+----+---------------+-----------+---------------+\n| id | id_biblioteca | n_paginas | autor         |\n+----+---------------+-----------+---------------+\n|  1 |             1 |       320 | Dale Carnegie |\n|  2 |             2 |       714 | Anne Frank    |\n+----+---------------+-----------+---------------+\n2 rows in set (0.001 sec)\nMariaDB [bibliofilos]&gt; select * from trabajadores;\n+----+---------------+--------+----------+\n| id | id_biblioteca | nombre | apellido |\n+----+---------------+--------+----------+\n|  1 |             1 | Pepe   | Pepito   |\n|  2 |             2 | Jose   | Joselito |\n+----+---------------+--------+----------+\n2 rows in set (0.001 sec)\n</code></pre>"},{"location":"p1-servidores-clientes/ri/alumno1/#36-creacion-de-usuarios","title":"3.6 Creaci\u00f3n de usuarios","text":"<pre><code>CREATE USER 'bibliofilos_admin'@'localhost' IDENTIFIED BY '1234';\nCREATE USER 'bibliofilos_admin'@'%' IDENTIFIED BY '1234';\n</code></pre> <p>Compruebo que se han creado:</p> <pre><code>MariaDB [(none)]&gt; SELECT user, host FROM mysql.user;\n+-------------------+-----------+\n| User              | Host      |\n+-------------------+-----------+\n| bibliofilos_admin | %         |\n| bibliofilos_admin | localhost |\n| mariadb.sys       | localhost |\n| mysql             | localhost |\n| root              | localhost |\n+-------------------+-----------+\n5 rows in set (0.002 sec)\n</code></pre> <p>Les doy privilegios:</p> <pre><code>GRANT ALL ON bibliofilos.* TO 'bibliofilos_admin'@'localhost';\nGRANT ALL ON bibliofilos.* TO 'bibliofilos_admin'@'%';\nFLUSH PRIVILEGES;\n</code></pre> <p>Muestro que se han aplicado:</p> <pre><code>MariaDB [(none)]&gt; SHOW GRANTS FOR 'bibliofilos_admin';\n+------------------------------------------------------------------------------------------------------------------+\n| Grants for bibliofilos_admin@%                                                                                   |\n+------------------------------------------------------------------------------------------------------------------+\n| GRANT USAGE ON *.* TO `bibliofilos_admin`@`%` IDENTIFIED BY PASSWORD '*A4B6157319038724E3560894F7F932C8886EBFCF' |\n| GRANT ALL PRIVILEGES ON `bibliofilos`.* TO `bibliofilos_admin`@`%`                                               |\n+------------------------------------------------------------------------------------------------------------------+\n2 rows in set (0.000 sec)\nMariaDB [(none)]&gt; SHOW GRANTS FOR 'bibliofilos_admin'@'localhost';\n+--------------------------------------------------------------------------------------------------------------------------+\n| Grants for bibliofilos_admin@localhost                                                                                   |\n+--------------------------------------------------------------------------------------------------------------------------+\n| GRANT USAGE ON *.* TO `bibliofilos_admin`@`localhost` IDENTIFIED BY PASSWORD '*A4B6157319038724E3560894F7F932C8886EBFCF' |\n| GRANT ALL PRIVILEGES ON `bibliofilos`.* TO `bibliofilos_admin`@`localhost`                                               |\n+--------------------------------------------------------------------------------------------------------------------------+\n2 rows in set (0.000 sec)\n</code></pre>"},{"location":"p1-servidores-clientes/ri/alumno1/#37-configuracion-del-acceso-remoto","title":"3.7 Configuraci\u00f3n del acceso remoto","text":"<p>Modifico la siguiente l\u00ednea en <code>/etc/mysql/mariadb.conf.d/50-server.cnf</code>:</p> <pre><code>bind-address            = 0.0.0.0\n</code></pre> <p>Reinicio:</p> <pre><code>sudo systemctl restart mariadb\n</code></pre> <p>Pruebo que el cambio se aplic\u00f3:</p> <pre><code>vagrant@servidormariadb:~$ netstat -ant | grep 3306\ntcp        0      0 0.0.0.0:3306            0.0.0.0:*               LISTEN\n</code></pre>"},{"location":"p1-servidores-clientes/ri/alumno1/#38-instalacion-del-cliente","title":"3.8 Instalaci\u00f3n del cliente","text":"<p>Se har\u00e1 sobre <code>clientemariadb</code>.</p> <pre><code>sudo apt update\nsudo apt install mariadb-client\n</code></pre>"},{"location":"p1-servidores-clientes/ri/alumno1/#39-prueba-de-acceso-remoto","title":"3.9 Prueba de acceso remoto","text":"<pre><code>vagrant@clientemariadb:~$ mariadb -u bibliofilos_admin -h 10.0.2.2 -p bibliofilos\nEnter password:\nReading table information for completion of table and column names\nYou can turn off this feature to get a quicker startup with -A\n\nWelcome to the MariaDB monitor.  Commands end with ; or \\g.\nYour MariaDB connection id is 35\nServer version: 10.5.15-MariaDB-0+deb11u1 Debian 11\nCopyright (c) 2000, 2018, Oracle, MariaDB Corporation Ab and others.\n\nType 'help;' or '\\h' for help. Type '\\c' to clear the current input statement.\n\nMariaDB [bibliofilos]&gt; show databases;\n+--------------------+\n| Database           |\n+--------------------+\n| bibliofilos        |\n| information_schema |\n+--------------------+\n2 rows in set (0.002 sec)\nMariaDB [bibliofilos]&gt; show tables;\n+-----------------------+\n| Tables_in_bibliofilos |\n+-----------------------+\n| bibliotecas           |\n| libros                |\n| trabajadores          |\n+-----------------------+\n3 rows in set (0.001 sec)\nMariaDB [bibliofilos]&gt; select * from bibliotecas;\n+----+--------------+-----------------------+\n| id | ciudad       | calle                 |\n+----+--------------+-----------------------+\n|  1 | Utrera       | Alvarez Quintero      |\n|  2 | Dos Hermanas | Plaza Huerta Palacios |\n+----+--------------+-----------------------+\n2 rows in set (0.002 sec)\n</code></pre>"},{"location":"p1-servidores-clientes/ri/alumno1/#4-mongodb","title":"4. MongoDB","text":""},{"location":"p1-servidores-clientes/ri/alumno1/#41-instalacion-del-servidor","title":"4.1 Instalaci\u00f3n del servidor","text":"<p>A\u00f1ado el repositorio:</p> <pre><code>echo \"deb http://repo.mongodb.org/apt/debian bullseye/mongodb-org/5.0 main\" | sudo tee /etc/apt/sources.list.d/mongodb-org-5.0.list\n</code></pre> <p>A\u00f1ado la clave GPG:</p> <pre><code>curl -sSL https://www.mongodb.org/static/pgp/server-5.0.asc  -o mongoserver.asc\ngpg --no-default-keyring --keyring ./mongo_key_temp.gpg --import ./mongoserver.asc\ngpg --no-default-keyring --keyring ./mongo_key_temp.gpg --export &gt; ./mongoserver_key.gpg\nsudo mv mongoserver_key.gpg /etc/apt/trusted.gpg.d/\n</code></pre> <p>Actualizo:</p> <pre><code>sudo apt update\n</code></pre> <p>Instalo:</p> <pre><code>sudo apt install mongodb-org\n</code></pre> <p>Inicio el servidor:</p> <pre><code>sudo systemctl enable --now mongod\n</code></pre> <p>Compruebo que funciona:</p> <pre><code>vagrant@servidormongodb:~$ sudo systemctl status mongod\n\u25cf mongod.service - MongoDB Database Server\n     Loaded: loaded (/lib/systemd/system/mongod.service; enabled; vendor preset: enabled)\nActive: active (running) since Thu 2022-10-20 08:20:59 UTC; 2min 26s ago\n       Docs: https://docs.mongodb.org/manual\n   Main PID: 2695 (mongod)\nMemory: 120.9M\n        CPU: 1.866s\n     CGroup: /system.slice/mongod.service\n             \u2514\u25002695 /usr/bin/mongod --config /etc/mongod.conf\n\nOct 20 08:20:59 servidormongodb systemd[1]: Started MongoDB Database Server.\n</code></pre>"},{"location":"p1-servidores-clientes/ri/alumno1/#42-acceso-local-privilegiado","title":"4.2 Acceso local privilegiado","text":"<pre><code>vagrant@servidormongodb:~$ mongosh\nCurrent Mongosh Log ID:63510a480bb54d2af15cd761\nConnecting to:          mongodb://127.0.0.1:27017/?directConnection=true&amp;serverSelectionTimeoutMS=2000&amp;appName=mongosh+1.6.0\nUsing MongoDB:          5.0.13\nUsing Mongosh:          1.6.0\n\nFor mongosh info see: https://docs.mongodb.com/mongodb-shell/\n\n------\n   The server generated these startup warnings when booting\n   2022-10-20T08:21:00.034+00:00: Using the XFS filesystem is strongly recommended with the WiredTiger storage engine. See http://dochub.mongodb.org/core/prodnotes-filesystem\n   2022-10-20T08:21:00.617+00:00: Access control is not enabled for the database. Read and write access to data and configuration is unrestricted\n------\n\n------\n   Enable MongoDB's free cloud-based monitoring service, which will then receive and display\n   metrics about your deployment (disk utilization, CPU, operation statistics, etc).\n\nThe monitoring data will be available on a MongoDB website with a unique URL accessible to you\n   and anyone you share the URL with. MongoDB may use this information to make product\n   improvements and to suggest MongoDB products and deployment options to you.\n\nTo enable free monitoring, run the following command: db.enableFreeMonitoring()\nTo permanently disable this reminder, run the following command: db.disableFreeMonitoring()\n------\n\nWarning: Found ~/.mongorc.js, but not ~/.mongoshrc.js. ~/.mongorc.js will not be loaded.\n  You may want to copy or rename ~/.mongorc.js to ~/.mongoshrc.js.\ntest&gt;\n</code></pre>"},{"location":"p1-servidores-clientes/ri/alumno1/#43-creacion-de-la-base-de-datos","title":"4.3 Creaci\u00f3n de la base de datos","text":"<p>Si no existe la bd con el nombre que le digamos, la crear\u00e1:</p> <pre><code>test&gt; use bibliofilos\nswitched to db bibliofilos\nbibliofilos&gt;\n</code></pre> <p>Compruebo que se ha creado:</p> <pre><code>bibliofilos&gt; show dbs\nadmin    40.00 KiB\nconfig  108.00 KiB\nlocal    40.00 KiB\n</code></pre> <p>La bd no aparece listada por ahora porque necesita contener datos para aparecer.</p>"},{"location":"p1-servidores-clientes/ri/alumno1/#44-creacion-de-colecciones","title":"4.4 Creaci\u00f3n de colecciones","text":"<pre><code>db.createCollection(\"bibliotecas\")\ndb.createCollection(\"libros\")\ndb.createCollection(\"trabajadores\")\n</code></pre> <p>Compruebo que se han creado:</p> <pre><code>bibliofilos&gt; show collections\nbibliotecas\nlibros\ntrabajadores\n</code></pre>"},{"location":"p1-servidores-clientes/ri/alumno1/#45-insercion-de-documentos","title":"4.5 Inserci\u00f3n de documentos","text":"<pre><code>db.bibliotecas.insertMany( [\n{ ciudad: \"Utrera\", calle: \"Alvarez Quintero\" },\n{ ciudad: \"Dos Hermanas\", calle: \"Plaza Huerta Palacios\" }\n] )\ndb.libros.insertMany( [\n{ n_paginas: 320, autor: \"Dale Carnegie\" },\n{ n_paginas: 714, autor: \"Anne Frank\" }\n] )\ndb.trabajadores.insertMany( [\n{ nombre: \"Pepe\", apellido: \"Pepito\" },\n{ nombre: \"Jose\", apellido: \"Joselito\" }\n] )\n</code></pre> <p>Compruebo que se han insertado:</p> <pre><code>bibliofilos&gt; db.bibliotecas.find()\n[\n{\n_id: ObjectId(\"635126caf4c5855bf45547d3\"),\n    ciudad: 'Utrera',\n    calle: 'Alvarez Quintero'\n},\n  {\n_id: ObjectId(\"635126caf4c5855bf45547d4\"),\n    ciudad: 'Dos Hermanas',\n    calle: 'Plaza Huerta Palacios'\n}\n]\nbibliofilos&gt; db.libros.find()\n[\n{\n_id: ObjectId(\"63512712f4c5855bf45547d5\"),\n    n_paginas: 320,\n    autor: 'Dale Carnegie'\n},\n  {\n_id: ObjectId(\"63512712f4c5855bf45547d6\"),\n    n_paginas: 714,\n    autor: 'Anne Frank'\n}\n]\nbibliofilos&gt; db.trabajadores.find()\n[\n{\n_id: ObjectId(\"6351271cf4c5855bf45547d7\"),\n    nombre: 'Pepe',\n    apellido: 'Pepito'\n},\n  {\n_id: ObjectId(\"6351271cf4c5855bf45547d8\"),\n    nombre: 'Jose',\n    apellido: 'Joselito'\n}\n]\n</code></pre>"},{"location":"p1-servidores-clientes/ri/alumno1/#46-creacion-de-usuarios","title":"4.6 Creaci\u00f3n de usuarios","text":"<p>Usuario con permisos sobre <code>bibliofilos</code>:</p> <pre><code>use bibliofilos\ndb.createUser(\n{\nuser: \"bibliofilos_admin\",\npwd: \"1234\",\nroles: [ \"dbOwner\" ]\n}\n)\n</code></pre> <p>Compruebo que se ha creado:</p> <pre><code>bibliofilos&gt; db.getUsers()\n{\nusers: [\n{\n_id: 'bibliofilos.bibliofilos_admin',\n      userId: new UUID(\"e420bea0-b85f-4914-a395-2f2b20b3aa48\"),\n      user: 'bibliofilos_admin',\n      db: 'bibliofilos',\n      roles: [ { role: 'dbOwner', db: 'bibliofilos' } ],\n      mechanisms: [ 'SCRAM-SHA-1', 'SCRAM-SHA-256' ]\n}\n],\n  ok: 1\n}\n</code></pre> <p>Usuario administrador:</p> <pre><code>use admin\ndb.createUser(\n{\nuser: \"admin\",\npwd: \"1234\",\nroles: [\n{ role: \"userAdminAnyDatabase\", db: \"admin\" },\n{ role: \"readWriteAnyDatabase\", db: \"admin\" }\n]\n}\n)\n</code></pre> <p>Compruebo que se ha creado:</p> <pre><code>admin&gt; db.getUsers()\n{\nusers: [\n{\n_id: 'admin.admin',\n      userId: new UUID(\"022fafb9-953b-4e5e-985f-6634d0ed954c\"),\n      user: 'admin',\n      db: 'admin',\n      roles: [\n{ role: 'userAdminAnyDatabase', db: 'admin' },\n        { role: 'readWriteAnyDatabase', db: 'admin' }\n],\n      mechanisms: [ 'SCRAM-SHA-1', 'SCRAM-SHA-256' ]\n}\n],\n  ok: 1\n}\n</code></pre>"},{"location":"p1-servidores-clientes/ri/alumno1/#47-configuracion-del-acceso-remoto","title":"4.7 Configuraci\u00f3n del acceso remoto","text":"<p>Modifico la siguiente l\u00ednea en <code>/etc/mongod.conf</code>:</p> <pre><code>bindIp: 0.0.0.0\n</code></pre> <p>A\u00f1ado las siguientes l\u00edneas en <code>/etc/mongod.conf</code>:</p> <pre><code>security:\n  authorization: enabled\n</code></pre> <p>Reinicio:</p> <pre><code>sudo systemctl restart mongod\n</code></pre> <p>Pruebo que el cambio se aplic\u00f3:</p> <pre><code>vagrant@servidormongodb:~$ netstat -ant | grep 27017\ntcp        0      0 0.0.0.0:27017           0.0.0.0:*               LISTEN\n</code></pre>"},{"location":"p1-servidores-clientes/ri/alumno1/#48-instalacion-del-cliente","title":"4.8 Instalaci\u00f3n del cliente","text":"<p>Se har\u00e1 sobre <code>clientemongodb</code>.</p> <p>A\u00f1ado el repositorio:</p> <pre><code>echo \"deb http://repo.mongodb.org/apt/debian bullseye/mongodb-org/5.0 main\" | sudo tee /etc/apt/sources.list.d/mongodb-org-5.0.list\n</code></pre> <p>A\u00f1ado la clave GPG:</p> <pre><code>curl -sSL https://www.mongodb.org/static/pgp/server-5.0.asc  -o mongoserver.asc\ngpg --no-default-keyring --keyring ./mongo_key_temp.gpg --import ./mongoserver.asc\ngpg --no-default-keyring --keyring ./mongo_key_temp.gpg --export &gt; ./mongoserver_key.gpg\nsudo mv mongoserver_key.gpg /etc/apt/trusted.gpg.d/\n</code></pre> <p>Actualizo:</p> <pre><code>sudo apt update\n</code></pre> <p>Instalo:</p> <pre><code>sudo apt install mongodb-org-shell mongodb-mongosh\n</code></pre>"},{"location":"p1-servidores-clientes/ri/alumno1/#49-prueba-de-acceso-remoto","title":"4.9 Prueba de acceso remoto","text":"<pre><code>vagrant@clientemongodb:~$ mongosh -u bibliofilos_admin -p 1234 10.0.3.2/bibliofilos\nCurrent Mongosh Log ID:6351bcb93f3b38d91c3c973b\nConnecting to:          mongodb://&lt;credentials&gt;@10.0.3.2:27017/bibliofilos?directConnection=true&amp;appName=mongosh+1.6.0\nUsing MongoDB:          5.0.13\nUsing Mongosh:          1.6.0\n\nFor mongosh info see: https://docs.mongodb.com/mongodb-shell/\n\nWarning: Found ~/.mongorc.js, but not ~/.mongoshrc.js. ~/.mongorc.js will not be loaded.\n  You may want to copy or rename ~/.mongorc.js to ~/.mongoshrc.js.\nbibliofilos&gt; show dbs\nbibliofilos  120.00 KiB\nbibliofilos&gt; show collections\nbibliotecas\nlibros\ntrabajadores\nbibliofilos&gt; db.bibliotecas.find()\n[\n{\n_id: ObjectId(\"635126caf4c5855bf45547d3\"),\n    ciudad: 'Utrera',\n    calle: 'Alvarez Quintero'\n},\n  {\n_id: ObjectId(\"635126caf4c5855bf45547d4\"),\n    ciudad: 'Dos Hermanas',\n    calle: 'Plaza Huerta Palacios'\n}\n]\n</code></pre>"},{"location":"p1-servidores-clientes/ri/alumno1/#5-app-flask-con-mongodb","title":"5. App Flask con MongoDB","text":"<p>En este repositorio se encuentran tanto el c\u00f3digo de la aplicaci\u00f3n como su gu\u00eda de uso y pruebas de funcionamiento.</p>"},{"location":"p1-servidores-clientes/ri/alumno2/","title":"Alumno 2","text":""},{"location":"p1-servidores-clientes/ri/alumno2/#oracle-19c","title":"Oracle 19c","text":""},{"location":"p1-servidores-clientes/ri/alumno2/#instalacion","title":"Instalaci\u00f3n","text":"<p>Lo primero que debemos hacer es descargarnos desde la p\u00e1gina oficial de oracle el paquete .rpm y subirlo por scp a nuestro servidor, y una vez hecho eso, haremos lo siguiente:</p> <ul> <li>Instalamos alien y paquetes necesarios:</li> </ul> <pre><code>apt install alien libaio1 unixodbc\n</code></pre> <ul> <li>Ahora con alien, reconvertimos el fichero .rpm a dpkg, esto tardar\u00e1 un buen rato, depende del rendimiento que tengas en el sistema:</li> </ul> <pre><code>alien --scripts -d oracle-database-ee-19c-1.0-1.x86_64.rpm\n</code></pre> <ul> <li>Una vez ha terminado la reconversi\u00f3n, dentro del fichero /sbin/chkconfig, a\u00f1adimos lo siguiente:</li> </ul> <pre><code>#!/bin/bash\n# Oracle 19c installer chkconfig hack\nfile=/etc/init.d/oracle-19c\nif [[ ! `tail -n1 $file | grep INIT` ]]; then\necho &gt;&gt; $file\necho '### BEGIN INIT INFO' &gt;&gt; $file\necho '# Provides: Oracle 19c' &gt;&gt; $file\necho '# Required-Start: $remote_fs $syslog' &gt;&gt; $file\necho '# Required-Stop: $remote_fs $syslog' &gt;&gt; $file\necho '# Default-Start: 2 3 4 5' &gt;&gt; $file\necho '# Default-Stop: 0 1 6' &gt;&gt; $file\necho '# Short-Description: Oracle 19c' &gt;&gt; $file\necho '### END INIT INFO' &gt;&gt; $file\nfi\nupdate-rc.d oracle-19c defaults 80 01\n</code></pre> <ul> <li>Ahora le damos permisos al fichero:</li> </ul> <pre><code>chmod 777 /sbin/chkconfig </code></pre> <ul> <li>A\u00f1adimos lo siguiente al fichero /etc/sysctl.d/60-oracle.conf para configurar los par\u00e1metros del kernel:</li> </ul> <pre><code># Oracle 19c kernel parameters\nfs.file-max=6815744\nnet.ipv4.ip_local_port_range=9000 65000\nkernel.sem=250 32000 100 128\nkernel.shmmax=536870912\n</code></pre> <ul> <li>Arrancamos el servicio procps:</li> </ul> <pre><code>systemctl start procps\n</code></pre> <ul> <li>A\u00f1adimos el siguiente contenido al fichero /etc/rc2.d/S01shm_load: </li> </ul> <pre><code>#!/bin/sh\ncase \"$1\" in\nstart) mkdir /var/lock/subsys 2&gt;/dev/null\n       touch /var/lock/subsys/listener\n       rm /dev/shm 2&gt;/dev/null\n       mkdir /dev/shm 2&gt;/dev/null\n       mount -t tmpfs shmfs -o size=2048m /dev/shm ;;\n*) echo error\n   exit 1 ;;\nesac\n</code></pre> <ul> <li>Le damos permisos:</li> </ul> <pre><code>chmod 777 /etc/rc2.d/S01shm_load\n</code></pre> <ul> <li>Reiniciamos el sistema:</li> </ul> <pre><code>reboot\n</code></pre> <ul> <li>Instalamos el paquete .deb que reconvertimos anteriormente:</li> </ul> <pre><code>dpkg --install oracle-database-ee-19c_1.0-2_amd64.deb\n</code></pre> <ul> <li>Una vez instalado, a\u00f1adimos el par\u00e1metro -J-Doracle.assistants.dbca.validate.ConfigurationParams=false dentro de /etc/init.d/oracledb_ORCLCDB-19c:</li> </ul> <p></p> <ul> <li>Ahora, ejecutamos el siguiente comando para configurar oracle:</li> </ul> <pre><code>root@escenario:~# /etc/init.d/oracledb_ORCLCDB-19c configure\n</code></pre> <p></p> <ul> <li>Dentro de bashrc a\u00f1ado las siguientes variables de entorno:</li> </ul> <pre><code># Oracle environment variables\nexport ORACLE_HOME=/opt/oracle/product/19c/dbhome_1\nexport ORACLE_SID=ORCLCDB\nexport NLS_LANG=`$ORACLE_HOME/bin/nls_lang.sh`\nexport ORACLE_BASE=/opt/oracle\nexport LD_LIBRARY_PATH=$ORACLE_HOME/lib:$LD_LIBRARY_PATH\nexport PATH=$ORACLE_HOME/bin:$PATH\n</code></pre> <ul> <li>Reinciamos la m\u00e1quina:</li> </ul> <pre><code>reboot\n</code></pre> <ul> <li>Iniciamos el servicio de oracle:</li> </ul> <pre><code>sudo systemctl start oracledb_ORCLCDB-19c\n</code></pre> <ul> <li>Finalmente accedemos a oracle:</li> </ul> <pre><code>oracle@oracle:~$ sqlplus / as sysdba\nSQL*Plus: Release 19.0.0.0.0 - Production on Sun Oct 30 19:26:55 2022\nVersion 19.3.0.0.0\nCopyright (c) 1982, 2019, Oracle.  All rights reserved.\nConectado a:\nOracle Database 19c Enterprise Edition Release 19.0.0.0.0 - Production\nVersion 19.3.0.0.0\nSQL&gt; </code></pre>"},{"location":"p1-servidores-clientes/ri/alumno2/#creacion-de-usuarios","title":"Creaci\u00f3n de usuarios","text":"<p>Para crear un usuario hacemos lo siguiente:</p> <ul> <li>Creamos el usuario con contrase\u00f1a y le damos permisos:</li> </ul> <pre><code>SQL&gt; create user joseju identified by lolazo25;\nUsuario creado.\nSQL&gt; grant all privileges to joseju;\nConcesion terminada correctamente.\n</code></pre> <ul> <li>Accedemos a oracle con el usuario que hemos creado para comprobar que todo funciona correctamente:</li> </ul> <pre><code>oracle@oracle:~$ sqlplus joseju\nSQL*Plus: Release 19.0.0.0.0 - Production on Sun Oct 30 19:32:38 2022\nVersion 19.3.0.0.0\nCopyright (c) 1982, 2019, Oracle.  All rights reserved.\nEnter password: Conectado a:\nOracle Database 19c Enterprise Edition Release 19.0.0.0.0 - Production\nVersion 19.3.0.0.0\nSQL&gt; </code></pre>"},{"location":"p1-servidores-clientes/ri/alumno2/#creacion-base-de-datos","title":"Creaci\u00f3n Base de datos","text":"<p>Creamos las siguientes tablas:</p> <pre><code>SQL&gt; CREATE TABLE usuarios (\nid NUMBER(3) NOT NULL,\nnombre VARCHAR2(20) NOT NULL,\npassword char(102) NOT NULL,\nfullname VARCHAR2(50),\nCONSTRAINT usuarios_pk PRIMARY KEY (id)\n);\nTabla creada.\nSQL&gt; CREATE TABLE autores (\nid NUMBER(3) NOT NULL,\nnombre VARCHAR2(20) NOT NULL,\napellidos VARCHAR2(50) NOT NULL,\nCONSTRAINT autor_pk PRIMARY KEY (id)\n);  Tabla creada.\nSQL&gt; CREATE TABLE libros (\nid NUMBER(3) NOT NULL,\nid_autor NUMBER(3) NOT NULL,\nnombre VARCHAR2(20) NOT NULL,\nCONSTRAINT libros_pk PRIMARY KEY (id),\nCONSTRAINT id_autor_fk FOREIGN KEY (id_autor)\nREFERENCES autores (id)\n);\nTabla creada.\nSQL&gt; CREATE TABLE compralibro (\nid_usuario NUMBER(3) NOT NULL,\nid_libro NUMBER(3) NOT NULL,\nCONSTRAINT libro_usuario_pk PRIMARY KEY (id_usuario,id_libro),\nCONSTRAINT id_usuario_fk FOREIGN KEY (id_usuario)\nREFERENCES usuarios (id),\nCONSTRAINT id_libro_fk FOREIGN KEY (id_libro)\nREFERENCES libros (id)\n);\nTabla creada.\n</code></pre> <p>Mostramos las tablas que acabamos de crear:</p> <pre><code>SQL&gt; select table_name from user_tables order by table_name;\nTABLE_NAME\n--------------------------------------------------------------------------------\nAUTORES\nCOMPRALIBRO\nLIBROS\nUSUARIOS\n</code></pre>"},{"location":"p1-servidores-clientes/ri/alumno2/#configuracion-acceso-remoto","title":"Configuracion Acceso remoto","text":"<p>Para configurar el acceso remoto haremos lo siguiente:</p> <ul> <li>Modifico el fichero de configuraci\u00f3n /opt/oracle/product/19c/dbhome_1/network/admin/listener.ora y lo dejamos asi:</li> </ul> <p></p> <ul> <li>Iniciamos lsnrctl:</li> </ul> <pre><code>oracle@oracle:~$ lsnrctl start\nLSNRCTL for Linux: Version 19.0.0.0.0 - Production on 30-OCT-2022 19:49:06\nCopyright (c) 1991, 2019, Oracle.  All rights reserved.\nTNS-01106: Listener using listener name LISTENER has already been started\n</code></pre> <p>Reiniciamos el servicio y en el apartado de prueba conexion servidor oracle comprobamos que funciona.</p>"},{"location":"p1-servidores-clientes/ri/alumno2/#mariadb","title":"MariaDB","text":""},{"location":"p1-servidores-clientes/ri/alumno2/#instalacion_1","title":"Instalaci\u00f3n","text":"<ul> <li>Primero actualizamos el sistema:</li> </ul> <pre><code>sudo apt update -y &amp;&amp; sudo apt upgrade -y\n</code></pre> <ul> <li>Instalamos el paquete mariadb-server:</li> </ul> <pre><code>sudo apt install -y mariadb-server\n</code></pre> <ul> <li>Comprobamos el estado del servicio postgres para comprobar que funciona:</li> </ul>"},{"location":"p1-servidores-clientes/ri/alumno2/#creacion-de-usuarios_1","title":"Creaci\u00f3n de usuarios","text":"<ul> <li>Crearemos el usuario joseju:</li> </ul> <pre><code>MariaDB [(none)]&gt; CREATE USER 'joseju'@'localhost' IDENTIFIED BY 'lolazo25';\nQuery OK, 0 rows affected (0.006 sec)\n</code></pre>"},{"location":"p1-servidores-clientes/ri/alumno2/#creacion-base-de-datos_1","title":"Creaci\u00f3n Base de datos","text":"<p>Ahora que hemos creado el usuario, procederemos a crear la base de datos. Haremos lo siguiente:</p> <ul> <li>Creamos la base de datos:</li> </ul> <pre><code>MariaDB [(none)]&gt; create database flask_login;\nQuery OK, 1 row affected (0.000 sec)\n</code></pre> <ul> <li>Le damos los privilegios al usuario que creamos anteriormente:</li> </ul> <p><pre><code>MariaDB [(none)]&gt; GRANT ALL ON flask_login.* TO 'joseju'@'localhost';\nQuery OK, 0 rows affected (0.006 sec)\nMariaDB [(none)]&gt; FLUSH PRIVILEGES;\nQuery OK, 0 rows affected (0.001 sec)\n</code></pre> - Accedemos a la base de datos a trav\u00e9s de nuestro usuario:</p> <pre><code>root@escenario:~# mysql -u joseju -p\nEnter password: Welcome to the MariaDB monitor.  Commands end with ; or \\g.\nYour MariaDB connection id is 31\nServer version: 10.5.15-MariaDB-0+deb11u1 Debian 11\nCopyright (c) 2000, 2018, Oracle, MariaDB Corporation Ab and others.\n\nType 'help;' or '\\h' for help. Type '\\c' to clear the current input statement.\n\nMariaDB [(none)]&gt; use flask_login;\nDatabase changed\nMariaDB [flask_login]&gt; </code></pre> <ul> <li>Creamos las siguientes tablas:</li> </ul> <p><pre><code>MariaDB [flask_login]&gt; CREATE TABLE `user` (\n-&gt;   `id` smallint(3) UNSIGNED NOT NULL,\n-&gt;   `username` varchar(20) COLLATE utf8_unicode_ci NOT NULL,\n-&gt;   `password` char(102) COLLATE utf8_unicode_ci NOT NULL,\n-&gt;   `fullname` varchar(50) COLLATE utf8_unicode_ci NOT NULL,\n-&gt;   CONSTRAINT pk_id PRIMARY KEY (id)\n-&gt; ) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci COMMENT='Stores the user''s data.';\nQuery OK, 0 rows affected, 1 warning (0.041 sec)\nMariaDB [flask_login]&gt; CREATE TABLE `autor` (\n-&gt;   `id` smallint(3) UNSIGNED NOT NULL,\n-&gt;   `nombre` varchar(20) COLLATE utf8_unicode_ci NOT NULL,\n-&gt;   `apellidos` varchar(20) COLLATE utf8_unicode_ci NOT NULL,\n-&gt;   CONSTRAINT pk_id_autor PRIMARY KEY (id)\n-&gt; ) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci COMMENT='Stores the author''s data.';\nQuery OK, 0 rows affected, 1 warning (0.040 sec)\nMariaDB [flask_login]&gt; CREATE TABLE `libro` (\n-&gt;   `id` smallint(3) UNSIGNED NOT NULL,\n-&gt;   `idautor` smallint(3) UNSIGNED NOT NULL,\n-&gt;   `nombre` varchar(20) COLLATE utf8_unicode_ci NOT NULL,\n-&gt;   CONSTRAINT pk_id_libro PRIMARY KEY (id),\n-&gt;   FOREIGN KEY (idautor) REFERENCES autor(id)\n-&gt; ) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci COMMENT='Stores the book''s data.';\nQuery OK, 0 rows affected, 1 warning (0.049 sec)\nMariaDB [flask_login]&gt; CREATE TABLE `compralibro` (\n-&gt;   `idcliente` smallint(3) UNSIGNED NOT NULL,\n-&gt;   `idlibro` smallint(3) UNSIGNED NOT NULL,\n-&gt;   CONSTRAINT pk_ids PRIMARY KEY (idcliente,idlibro),\n-&gt;   FOREIGN KEY (idcliente) REFERENCES user(id),\n-&gt;   FOREIGN KEY (idlibro) REFERENCES libro(id)\n-&gt; ) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci COMMENT='Regitra la compras de los libros.';\nQuery OK, 0 rows affected, 1 warning (0.062 sec)\n</code></pre> - Mostramos las tablas que acabamos de crear:</p> <pre><code>MariaDB [flask_login]&gt; show tables;\n+-----------------------+\n| Tables_in_flask_login |\n+-----------------------+\n| autor                 |\n| compralibro           |\n| libro                 |\n| user                  |\n+-----------------------+\n4 rows in set (0.001 sec)\n</code></pre>"},{"location":"p1-servidores-clientes/ri/alumno2/#configuracion-acceso-remoto_1","title":"Configuracion Acceso remoto","text":"<p>En este apartado configuraremos el acceso remoto al servidor mariadb, para ello haremos lo siguiente:</p> <ul> <li>Dentro del fichero /etc/mysql/mariadb.conf.d/50-server.cnf modifico la siguiente l\u00ednea:</li> </ul> <p></p> <p>Reiniciamos el servicio y en el apartado de prueba conexion servidor mariadb comprobamos que funciona.</p>"},{"location":"p1-servidores-clientes/ri/alumno2/#postgres","title":"Postgres","text":""},{"location":"p1-servidores-clientes/ri/alumno2/#instalacion_2","title":"Instalaci\u00f3n","text":"<ul> <li>Primero actualizamos el sistema:</li> </ul> <pre><code>sudo apt update -y &amp;&amp; sudo apt upgrade -y\n</code></pre> <ul> <li>Instalamos el paquete postgresql-13:</li> </ul> <pre><code>sudo apt install -y postgresql-13\n</code></pre> <ul> <li>Comprobamos el estado del servicio postgres para comprobar que funciona:</li> </ul>"},{"location":"p1-servidores-clientes/ri/alumno2/#creacion-de-usuarios_2","title":"Creaci\u00f3n de usuarios","text":"<ul> <li>Con el siguiente comando creamos al usuario joseju como un superusuario:</li> </ul> <pre><code>sudo -u postgres createuser joseju --interactive -P\n</code></pre> <p>Una vez hemos creado el usuario, habilitaremos el uso de contrase\u00f1a para poder acceder a mongo con autenticaci\u00f3n:</p> <ul> <li>Para activar el uso de contrase\u00f1a, cambiamos dentro del fichero de configuraci\u00f3n pg_hba.conf la siguiente directiva y cambiamos la palabra peer por md5:</li> </ul> <p></p> <ul> <li>Una vez modificado, reiniciamos el servicio:</li> </ul> <pre><code>systemctl reload postgresql\n</code></pre> <ul> <li>Iniciamos postgres para ver si nos pide la contrase\u00f1a:</li> </ul> <p></p>"},{"location":"p1-servidores-clientes/ri/alumno2/#creacion-base-de-datos_2","title":"Creaci\u00f3n Base de datos","text":"<ul> <li>Ahora creamos una base de datos llamada libreria:</li> </ul> <ul> <li>Cambiamos a la base de datos recien creada:</li> </ul> <pre><code>joseju=# \\c libreria\nYou are now connected to database \"libreria\" as user \"joseju\".\n</code></pre> <ul> <li>A continuaci\u00f3n crearemos las tablas de esta base de datos:</li> </ul> <pre><code>libreria=# CREATE TABLE usuarios (\nID SERIAL PRIMARY KEY,\nNOMBRE varchar(20),\nPASSWORD char(102),\nFULLNAME varchar(50)\n);\nCREATE TABLE\nlibreria=# CREATE TABLE autor (\nid SERIAL PRIMARY KEY,\nnombre varchar(20),\napellidos varchar(20)\n);\nCREATE TABLE\nlibreria=# CREATE TABLE libros (\nid SERIAL PRIMARY KEY,\nidautor SERIAL,\nnombre varchar(20),\nconstraint FK_autor foreign key (idautor) references autor(id)\n);\nCREATE TABLE\nlibreria=# CREATE TABLE compralibro (\nidcliente SERIAL,\nidlibro SERIAL,\nprimary key(idcliente,idlibro),\nconstraint FK_cliente foreign key (idcliente) references usuarios(id),\nconstraint FK_libro foreign key (idlibro) references libros(id)\n);\nCREATE TABLE\n</code></pre> <ul> <li>Mostramos las tablas que acabamos de crear:</li> </ul> <pre><code>libreria=# \\dt\nList of relations\nSchema |    Name     | Type  | Owner  --------+-------------+-------+--------\npublic | autor       | table | joseju\npublic | compralibro | table | joseju\npublic | libros      | table | joseju\npublic | usuarios    | table | joseju\n(4 rows)\n</code></pre>"},{"location":"p1-servidores-clientes/ri/alumno2/#configuracion-acceso-remoto_2","title":"Configuraci\u00f3n Acceso remoto","text":"<p>Para configurar el acceso remoto, debemos modificar dos ficheros, postgresql.conf y pg_hba.conf y modificar las siguientes l\u00edneas:</p> <ul> <li>En el fichero postgresql.conf indicamos la direcci\u00f3n IP de nuestro servidor:</li> </ul> <p></p> <ul> <li>En el fichero ph_hba.conf_ habilitaremos el uso de contrase\u00f1a:</li> </ul> <p></p> <p>Reiniciamos el servicio y en el apartado de prueba conexion servidor postgres comprobamos que funciona.</p>"},{"location":"p1-servidores-clientes/ri/alumno2/#mongodb","title":"MongoDB","text":""},{"location":"p1-servidores-clientes/ri/alumno2/#instalacion_3","title":"Instalaci\u00f3n","text":"<ul> <li>En primer lugar instalamos las dependencias necesarias:</li> </ul> <pre><code>apt-get install curl apt-transport-https software-properties-common gnupg2 -y\n</code></pre> <ul> <li>Seguidamente, a\u00f1adimos la clave GPG y tambi\u00e9n a\u00f1adimos el repositorio de mongodb:</li> </ul> <pre><code>wget -qO - https://www.mongodb.org/static/pgp/server-4.4.asc | apt-key add -\n</code></pre> <pre><code>echo \"deb http://repo.mongodb.org/apt/debian buster/mongodb-org/4.4 main\" | tee /etc/apt/sources.list.d/mongodb-org.list\n</code></pre> <ul> <li>A continuaci\u00f3n, actualizamos el sistema e instalamos el paquete mongodb-org:</li> </ul> <pre><code>sudo apt update -y &amp;&amp; sudo apt install mongodb-org -y\n</code></pre> <ul> <li>Ahora, iniciamos el servicio de mongo:</li> </ul> <pre><code>sudo systemctl start mongod &amp;&amp; sudo systemctl enable mongod\n</code></pre> <ul> <li>Finalmente verificamos la version de mongo que hemos instalado:</li> </ul> <pre><code>mongod --version\n</code></pre>"},{"location":"p1-servidores-clientes/ri/alumno2/#creacion-de-usuarios_3","title":"Creaci\u00f3n de usuarios","text":"<p>Por defecto, la autenticaci\u00f3n en mongodb no esta habilitada, as\u00ed que por razones de seguridad, habilitaremos la autentiaci\u00f3n. Para ello haremos lo siguiente:</p> <ul> <li>Primero iniciamos la shell de mongo:</li> </ul> <pre><code>mongo\n</code></pre> <ul> <li>Seguidamente modificamos una base de datos llamada admin:</li> </ul> <pre><code>use admin\n</code></pre> <ul> <li>Ahora, creamos nuestro usuario e introducimos una contrase\u00f1a:</li> </ul> <pre><code>db.createUser(\n{\nuser: \"joseju\",\npwd: \"lolazo25\",\nroles: [ { role: \"root\", db: \"admin\" } ]\n}\n)\n</code></pre> <p></p> <ul> <li>A continuaci\u00f3n, pulsamos ctrl+D para salir de mongo, y editamos el archivo de configuraci\u00f3n /etc/mongo.conf a\u00f1adiendo las siguientes l\u00edneas para activar la autenticaci\u00f3n:</li> </ul> <p></p> <ul> <li>Reiniciamos mongo e intentamos acceder para ver si no pide las credenciales:</li> </ul> <p></p>"},{"location":"p1-servidores-clientes/ri/alumno2/#creacion-base-de-datos_3","title":"Creaci\u00f3n Base de datos","text":"<p>Procederemos a crear una base de datos llamada libreria con tres colecciones y con informaci\u00f3n variada, las colecciones que crearemos ser\u00e1n:</p> <ul> <li> <p>usuario</p> </li> <li> <p>libro</p> </li> <li> <p>autor</p> </li> </ul> <p>Dentro de la colecci\u00f3n usuario, almacenaremos los datos del usuario, su contrase\u00f1a para acceder al sistema, su nombre y su id.</p> <p>Dentro de la colecci\u00f3n libros, almacenaremos los datos de los libros, el nombre del libro, el autor que escribio el libro y su id.</p> <p>Dentro de la colecci\u00f3n autores, almacenaremos los datos de los autores, el nombre y apellidos del autor y su id.</p> <p>En mongo, las bases de datos que se crean son de tipo no relacionales, es decir, no se crean mediante tablas, claves... Sino mediante json.</p> <p>Lo primero que haremos para crear las colecciones:</p> <pre><code>&gt; use libreria;\nswitched to db libreria\n&gt; db.createCollection(\"usuarios\")\n{ ok: 1 }\n&gt; db.createCollection(\"libros\")\n{ ok: 1 }\n&gt; db.createCollection(\"autores\")\n{ ok: 1 }\n</code></pre> <p>Comprobamos que hemos creado los documentos:</p> <pre><code>&gt; show collections\nusuarios\nlibros\nautores\n</code></pre> <p>Insertamos los siguientes documentos:</p> <pre><code>db.usuarios.insertMany( [\n{id: 1, usuario: \"joseju\", password: \"pbkdf2:sha256:260000$FHhIsLue8dRwFAIM$ef37e5b262fb3d687112e232cd47abf1ec83f4c653b7bcbf95fa3993298fb5df\", fullname: \"Jose Juan\"} ] )\ndb.libros.insertMany( [\n{ id: 100,\nnombre: \"El Quijote\",\nautor: \"Cervantes\"}\n] )\ndb.autores.insertMany( [\n{id: 1000,\nautname: \"Cervantes\",\nnombre: \"Miguel\",\napellidos: \"Cervantes Saavedra\"}\n] )\n</code></pre> <p>Compruebo que se ha a\u00f1adido todo correctamente:</p> <pre><code>&gt; db.usuarios.find()\n[\n{\n_id: ObjectId(\"635e7fe5024ab00ff3a1377c\"),\n    id: 1,\n    usuario: 'joseju',\n    password: 'pbkdf2:sha256:260000$FHhIsLue8dRwFAIM$ef37e5b262fb3d687112e232cd47abf1ec83f4c653b7bcbf95fa3993298fb5df',\n    fullname: 'Jose Juan'\n}\n]\n&gt; db.libros.find()\n[\n{\n_id: ObjectId(\"635e838d024ab00ff3a1377d\"),\n    id: 100,\n    nombre: 'El Quijote',\n    autor: 'Cervantes'\n}\n]\n&gt; db.autores.find()\n[\n{\n_id: ObjectId(\"635e8399024ab00ff3a1377e\"),\n    id: 1000,\n    autname: 'Cervantes',\n    nombre: 'Miguel',\n    apellidos: 'Cervantes Saavedra'\n}\n]\n</code></pre>"},{"location":"p1-servidores-clientes/ri/alumno2/#configuracion-acceso-remoto_3","title":"Configuraci\u00f3n Acceso remoto","text":"<p>Para la configuraci\u00f3n del acceso remoto haremos lo siguiente:</p> <ul> <li>Modificaremos el fichero de configuraci\u00f3n /etc/mongod.conf y en el par\u00e1metro e bindIp dentro del apartado net, establecemo el valor 0.0.0.0:</li> </ul> <p></p> <p>Reiniciamos el servicio de mongo y comprobamos que funciona en el apartado de cliente remoto mongodb. </p>"},{"location":"p1-servidores-clientes/ri/alumno2/#prueba-cliente-remoto-mongodb","title":"Prueba Cliente Remoto MongoDB","text":"<ul> <li>Dentro del cliente, a\u00f1adimos la clave gpg y repositorio de mongo, actualizamos los repositorios e instalamos el cliente remoto de mongodb, que en nuestro caso se llama mongosh:</li> </ul> <pre><code>wget -qO - https://www.mongodb.org/static/pgp/server-4.4.asc | apt-key add -\n</code></pre> <pre><code>echo \"deb http://repo.mongodb.org/apt/debian buster/mongodb-org/4.4 main\" | tee /etc/apt/sources.list.d/mongodb-org.list\n</code></pre> <pre><code>sudo apt update &amp;&amp; sudo apt install mongosh\n</code></pre> <ul> <li>Una vez hemos instalado el cliente de mongo, ejecutamos el siguiente comando para conectarnos al servidor de mongo:</li> </ul> <pre><code>mongosh --host 192.168.1.42 -u joseju\n</code></pre>"},{"location":"p1-servidores-clientes/ri/alumno2/#realizacion-de-aplicacion-web","title":"Realizaci\u00f3n de Aplicacion Web","text":"<p>Realizaremos una aplicaci\u00f3n web escrita en python donde accederemos a la p\u00e1gina a trav\u00e9s de un usuario y una contrase\u00f1a almacenados en la base de datos que creamos anteriormente en mysql. Para ello vamos a hacer lo siguiente.</p> <ul> <li>Primero, creamos un entorno virtual donde realizaremos nuestra aplicaci\u00f3n web:</li> </ul> <pre><code>python3 -m venv mysql\n</code></pre> <ul> <li>Luego instalamos todos los paquetes necesarios para que la aplicaci\u00f3n funcione:</li> </ul> <pre><code>pip install flask flask-login flask-mysqldb flask-WTF\n</code></pre> <ul> <li>Despu\u00e9s, de haber instalado los paquetes, escribimos el c\u00f3digo que dejare en este repsoritorio de git:</li> </ul> <p>https://github.com/joseju10/app-bbdd</p> <ul> <li>Iniciamos el servicio mediante el siguiente comando:</li> </ul> <pre><code>python3 app.py\n</code></pre> <ul> <li>Accedemos a la p\u00e1gina e iniciamos sesi\u00f3n con el usuario y la contrase\u00f1a que a\u00f1adimos en la base de datos mariadb:</li> </ul> <p></p> <p></p>"},{"location":"p1-servidores-clientes/ri/alumno3/","title":"Alumno 3. Arantxa Fern\u00e1ndez Morat\u00f3","text":"<p>Antes de empezar comentar que la m\u00e1quina servidor de todas las bases de datos ser\u00e1 siempre la misma, una m\u00e1quina con Debian 11 llamada \"debian-oracle\". Y la  maquina cliente se llama \"debianprueba\". Durante las conexiones remotas se puede apreciar en las capturas el nombre de las m\u00e1quinas. </p>"},{"location":"p1-servidores-clientes/ri/alumno3/#1-mysql","title":"1. MySQL","text":""},{"location":"p1-servidores-clientes/ri/alumno3/#11-instalacion","title":"1.1 Instalaci\u00f3n","text":"<p>En el servidor actualizamos los repositorios e instalamos gnupg y wget, si no estuvieran ya instalados.</p> <p><code>sudo apt update</code></p> <p><code>sudo apt install -y gnupg wget</code></p> <p>Utilizando wget descargamos el paquete de mysql del repositorio oficial.</p> <p><code>wget https://dev.mysql.com/get/mysql-apt-config_0.8.22-1_all.deb</code></p> <p>Procedemmos a instalar el paquete descargado.</p> <p><code>sudo dpkg -i mysql-apt-config_0.8.22-1_all.deb</code></p> <p>Nos aparecer\u00e1 una ventana que nos muestra la versi\u00f3n de MySQL que se instalar\u00e1, nos informa de que las herramientas y conectores est\u00e1n activados y la opci\u00f3n de software de prueba est\u00e1 desactivada. Presionamos Aceptar para continuar.</p> <p></p> <p>Volvemos a actualizar los repositorios.</p> <p><code>sudo apt update</code></p> <p>Ya podremos instalar MySQL server en Debian 11.</p> <p><code>sudo apt install -y mysql-server</code></p> <p>Durante la instalaci\u00f3n nos preguntar\u00e1 la contrase\u00f1a del usuario administrador root.</p> <p></p> <p>Nos aparece un menje de disponibilidad de un nuevo plugin de autenticaci\u00f3n. Presionamos Acepta.</p> <p></p> <p>Dejamos seleccionado el plugin de autenticaci\u00f3n recomendado.</p> <p></p> <p>Terminada la instalaci\u00f3n pasaremos a entrar con el usuario root.</p> <p><code>mysql -u root -p</code></p> <p></p>"},{"location":"p1-servidores-clientes/ri/alumno3/#12-creacion-usuario","title":"1.2 Creaci\u00f3n usuario","text":"<p>Creamos un usuario y contrase\u00f1a para el administrador de las bases de datos que se creen.</p> <p><code>create user 'admin'@'%' identified by 'admin';</code></p> <p>Le damos todos los privilegios.</p> <p><code>grant all privileges on *.* to admin with grant option;</code></p> <p><code>flush privileges;</code></p>"},{"location":"p1-servidores-clientes/ri/alumno3/#13-creacion-base-de-datos","title":"1.3 Creaci\u00f3n base de datos","text":"<p><code>create database maravilla;</code></p> <p>Me conecto a la base de datos con el usuario creado anteriormente.</p> <p><code>use maravilla</code></p> <p></p>"},{"location":"p1-servidores-clientes/ri/alumno3/#14-creacion-tablas-e-insercion-de-datos","title":"1.4 Creaci\u00f3n tablas e inserci\u00f3n de datos","text":"<p>He creado las tablas 'pelicula', 'actor' y 'pelicula_actor'.</p> <pre><code>create table actor\n(\ncodigo varchar (5),\nnombre varchar (15),\napellido varchar (15),\nfechanac date,\nconstraint pk_actor primary key (codigo)\n);\n\ncreate table pelicula\n(\ncodigo varchar (5),\ntitulo varchar (30),\nfecha_estreno date,\npuntuacion decimal (3,1),\nlengua_original varchar (3),\nconstraint pk_pelicula primary key (codigo),\nconstraint puntuacion_ck check (puntuacion between 0 and 10)\n);\n\ncreate table pelicula_actor\n(\ncodigo_actor varchar (5),\ncodigo_pelicula varchar (5),\ntipo_personaje enum ('Principal','Secundario'),\nconstraint pk_pelicula_actor primary key (codigo_actor,codigo_pelicula),\nconstraint fk_codigo_actor foreign key (codigo_actor) references actor (codigo),\nconstraint fk_codigo_pelicula foreign key (codigo_pelicula) references pelicula (codigo)\n);\n</code></pre> <p>Y he a\u00f1adido los siguientes inserts:</p> <pre><code>insert into pelicula values ('MA001', 'Iron Man', '2008-05-02', 7.9, 'EN');\ninsert into pelicula values ('MA002', 'Thor', '2011-05-06', 7.0, 'EN');\ninsert into pelicula values ('MA003', 'Captain America: the first avenger', '2011-07-22', 6.9, 'EN');\ninsert into pelicula values ('MA004', 'The Avengers', '2012-05-04', 8, 'EN');\ninsert into pelicula values ('MA005', 'Guardians of the Galaxy', '2014-08-01', 8, 'EN');\ninsert into pelicula values ('MA006', 'Avengers: Age of Ultron', '2015-05-01', 7.3, 'EN');\ninsert into pelicula values ('MA007', 'Doctor Strange', '2016-11-04', 7.5, 'EN');\ninsert into pelicula values ('MA008', 'Spider-Man: Homecoming', '2017-07-07', 7.4, 'EN');\ninsert into pelicula values ('MA009', 'Black Panther', '2018-02-16', 7.3, 'EN');\ninsert into pelicula values ('MA010', 'Avengers: Infinity War', '2018-04-27', 8.4, 'EN');\ninsert into pelicula values ('MA011', 'Avengers: Endgame', '2019-04-26', 8.4, 'EN');\n\ninsert into actor values ('001','Robert', 'Downey', '1965-04-04');\ninsert into actor values ('002','Jon', 'Favreau', '1966-10-19');\ninsert into actor values ('003','Chris', 'Hemsworth', '1983-08-11');\ninsert into actor values ('004','Tom', 'Hiddleston', '1981-02-09');\ninsert into actor values ('005','Natalie', 'Portman', '1981-06-09');\ninsert into actor values ('006','Chris', 'Evans', '1981-06-13');\ninsert into actor values ('007','Sebastian', 'Stan', '1982-08-13');\ninsert into actor values ('008','Jeremy', 'Renner', '1971-01-07');\ninsert into actor values ('009','Scarlett', 'Johansson', '1984-11-22');\ninsert into actor values ('010','Mark', 'Ruffalo', '1967-11-22');\ninsert into actor values ('011','Clark', 'Gregg', '1962-04-02');\ninsert into actor values ('012','Samuel L.', 'Jackson', '1948-12-21');\ninsert into actor values ('013','Chris', 'Pratt', '1979-06-21');\ninsert into actor values ('014','Zoe', 'Salda\u00f1a', '1978-06-19');\ninsert into actor values ('015','Dave', 'Bautista', '1969-01-18');\ninsert into actor values ('016','Vin', 'Diesel', '1967-07-18');\ninsert into actor values ('017','Bradley', 'Cooper', '1975-01-05');\ninsert into actor values ('018','Michael', 'Rooker', '1955-04-06');\ninsert into actor values ('019','Elisabeth', 'Olsen', '1989-02-16');\ninsert into actor values ('020','Paul', 'Bettany', '1971-05-27');\ninsert into actor values ('021','Anthony', 'Mackie', '1978-09-23');\ninsert into actor values ('022','Bennedict', 'Cumberbatch', '1976-07-19');\ninsert into actor values ('023','Rachel', 'McAdams', '1978-11-17');\ninsert into actor values ('024','Tom', 'Holland', '1996-06-01');\ninsert into actor values ('025','Zendaya', 'Coleman', '1996-09-01');\ninsert into actor values ('026','Chadwick', 'Boseman', '1976-11-29');\ninsert into actor values ('027','Josh', 'Brolin', '1968-02-12');\ninsert into actor values ('028','Brie', 'Larson', '1989-10-01');\n\ninsert into pelicula_actor values ('001', 'MA001', 'Principal');\ninsert into pelicula_actor values ('002', 'MA001', 'Secundario');\ninsert into pelicula_actor values ('003', 'MA002', 'Principal');\ninsert into pelicula_actor values ('004', 'MA002', 'Principal');\ninsert into pelicula_actor values ('005', 'MA002', 'Principal');\ninsert into pelicula_actor values ('006', 'MA003', 'Principal');\ninsert into pelicula_actor values ('007', 'MA003', 'Secundario');\ninsert into pelicula_actor values ('001', 'MA004', 'Principal');\ninsert into pelicula_actor values ('002', 'MA004', 'Secundario');\ninsert into pelicula_actor values ('003', 'MA004', 'Principal');\ninsert into pelicula_actor values ('004', 'MA004', 'Principal');\ninsert into pelicula_actor values ('006', 'MA004', 'Principal');\ninsert into pelicula_actor values ('008', 'MA004', 'Principal');\ninsert into pelicula_actor values ('009', 'MA004', 'Principal');\ninsert into pelicula_actor values ('010', 'MA004', 'Principal');\ninsert into pelicula_actor values ('011', 'MA004', 'Secundario');\ninsert into pelicula_actor values ('012', 'MA004', 'Principal');\ninsert into pelicula_actor values ('013', 'MA005', 'Principal');\ninsert into pelicula_actor values ('014', 'MA005', 'Principal');\ninsert into pelicula_actor values ('015', 'MA005', 'Principal');\ninsert into pelicula_actor values ('016', 'MA005', 'Principal');\ninsert into pelicula_actor values ('017', 'MA005', 'Principal');\ninsert into pelicula_actor values ('018', 'MA005', 'Secundario');\ninsert into pelicula_actor values ('001', 'MA006', 'Principal');\ninsert into pelicula_actor values ('003', 'MA006', 'Principal');\ninsert into pelicula_actor values ('006', 'MA006', 'Principal');\ninsert into pelicula_actor values ('008', 'MA006', 'Principal');\ninsert into pelicula_actor values ('009', 'MA006', 'Principal');\ninsert into pelicula_actor values ('010', 'MA006', 'Principal');\ninsert into pelicula_actor values ('019', 'MA006', 'Principal');\ninsert into pelicula_actor values ('020', 'MA006', 'Principal');\ninsert into pelicula_actor values ('022', 'MA007', 'Principal');\ninsert into pelicula_actor values ('023', 'MA007', 'Secundario');\ninsert into pelicula_actor values ('024', 'MA008', 'Principal');\ninsert into pelicula_actor values ('025', 'MA008', 'Principal');\ninsert into pelicula_actor values ('001', 'MA008', 'Secundario');\ninsert into pelicula_actor values ('002', 'MA008', 'Secundario');\ninsert into pelicula_actor values ('026', 'MA009', 'Principal');\ninsert into pelicula_actor values ('027', 'MA010', 'Principal');\ninsert into pelicula_actor values ('001', 'MA010', 'Principal');\ninsert into pelicula_actor values ('003', 'MA010', 'Principal');\ninsert into pelicula_actor values ('004', 'MA010', 'Secundario');\ninsert into pelicula_actor values ('006', 'MA010', 'Principal');\ninsert into pelicula_actor values ('007', 'MA010', 'Secundario');\ninsert into pelicula_actor values ('009', 'MA010', 'Principal');\ninsert into pelicula_actor values ('010', 'MA010', 'Principal');\ninsert into pelicula_actor values ('012', 'MA010', 'Secundario');\ninsert into pelicula_actor values ('013', 'MA010', 'Principal');\ninsert into pelicula_actor values ('014', 'MA010', 'Principal');\ninsert into pelicula_actor values ('015', 'MA010', 'Principal');\ninsert into pelicula_actor values ('016', 'MA010', 'Principal');\ninsert into pelicula_actor values ('017', 'MA010', 'Principal');\ninsert into pelicula_actor values ('019', 'MA010', 'Principal');\ninsert into pelicula_actor values ('020', 'MA010', 'Principal');\ninsert into pelicula_actor values ('021', 'MA010', 'Secundario');\ninsert into pelicula_actor values ('022', 'MA010', 'Principal');\ninsert into pelicula_actor values ('024', 'MA010', 'Principal');\ninsert into pelicula_actor values ('026', 'MA010', 'Principal');\ninsert into pelicula_actor values ('001', 'MA011', 'Principal');\ninsert into pelicula_actor values ('003', 'MA011', 'Principal');\ninsert into pelicula_actor values ('006', 'MA011', 'Principal');\ninsert into pelicula_actor values ('008', 'MA011', 'Principal');\ninsert into pelicula_actor values ('009', 'MA011', 'Principal');\ninsert into pelicula_actor values ('010', 'MA011', 'Principal');\ninsert into pelicula_actor values ('027', 'MA011', 'Principal');\ninsert into pelicula_actor values ('007', 'MA011', 'Secundario');\ninsert into pelicula_actor values ('013', 'MA011', 'Secundario');\ninsert into pelicula_actor values ('014', 'MA011', 'Secundario');\ninsert into pelicula_actor values ('015', 'MA011', 'Secundario');\ninsert into pelicula_actor values ('016', 'MA011', 'Secundario');\ninsert into pelicula_actor values ('017', 'MA011', 'Secundario');\ninsert into pelicula_actor values ('019', 'MA011', 'Secundario');\ninsert into pelicula_actor values ('021', 'MA011', 'Secundario');\ninsert into pelicula_actor values ('022', 'MA011', 'Secundario');\ninsert into pelicula_actor values ('024', 'MA011', 'Secundario');\ninsert into pelicula_actor values ('026', 'MA011', 'Secundario');\ninsert into pelicula_actor values ('028', 'MA011', 'Secundario');\n</code></pre> <p>Se puede comprobar las tablas creadas con show tables;.</p> <p></p> <p>Y los datos a\u00f1adidos a cada tabla con select.</p> <p></p> <p></p> <p></p>"},{"location":"p1-servidores-clientes/ri/alumno3/#15-acceso-remoto","title":"1.5 Acceso remoto","text":"<p>El puerto 3306 es en el que trabaja MySQL por defecto. Para especificar al firewall qu\u00e9 ip puede acceder al servidor de base de datos hacemos lo siguiente:</p> <p><code>sudo ufw allow from ip_cliente to any port 3306</code></p> <p>Pero en mi caso, teniendo en cuenta que estamos en un entorno de prueba, permitir\u00e9 que se pueda acceder desde cualquier ip.</p> <p><code>sudo ufw allow 3306</code></p> <p>Para verificar la conexi\u00f3n remota accedemos desde otra m\u00e1quina al servidor de la siguiente forma. Accederemos con el usuario admin, y en mi caso he utilizado una m\u00e1quina virtual en la que ya ten\u00eda instalado mariadb.</p> <p><code>mysql -u admin -h ip_servidor -p</code></p> <p></p>"},{"location":"p1-servidores-clientes/ri/alumno3/#2-postgresql","title":"2. PostgreSQL","text":""},{"location":"p1-servidores-clientes/ri/alumno3/#21-instalacion","title":"2.1 Instalaci\u00f3n","text":"<p>Instalamos PostgreSQL en Debian 11 directamente con apt.</p> <p><code>sudo apt install postgresql</code></p> <p>Para entrar con el usuario postgres.</p> <p><code>sudo su postgres</code></p> <p><code>psql</code></p> <p>Tambi\u00e9n se puede usar:</p> <p><code>sudo -u postgres psql</code></p>"},{"location":"p1-servidores-clientes/ri/alumno3/#22-creacion-usuario","title":"2.2 Creaci\u00f3n usuario","text":"<p>Se puede hacer de dos formas:</p>"},{"location":"p1-servidores-clientes/ri/alumno3/#opcion-1","title":"Opci\u00f3n 1:","text":"<p>Hacemos 'sudo su postgres' y seguidamente creamos el nuevo usuario con createuser.</p> <p><code>createuser admin</code></p> <p>Entramos en psql y se le asigna una contrase\u00f1a cifrada.</p> <p><code>alter user admin with encrypted password 'admin';</code></p>"},{"location":"p1-servidores-clientes/ri/alumno3/#opcion-2","title":"Opci\u00f3n 2:","text":"<p>Entramos directamente a psql y usamos el siguiente comando:</p> <p><code>create user admin with encrypted password 'admin';</code></p> <p>Para borrar un usuario:</p> <p><code>drop user admin;</code></p> <p>En psql con \\du podemos ver los usuarios creados.</p> <p></p>"},{"location":"p1-servidores-clientes/ri/alumno3/#23-creacion-base-de-datos","title":"2.3 Creaci\u00f3n base de datos","text":"<p>Para crear la base de datos tambi\u00e9n se puede hacer de dos formas:</p>"},{"location":"p1-servidores-clientes/ri/alumno3/#opcion-1_1","title":"Opci\u00f3n 1:","text":"<p>Desde el usuario postgres:</p> <p><code>sudo su postgres</code></p> <p><code>createdb maravilla</code></p>"},{"location":"p1-servidores-clientes/ri/alumno3/#opcion-2_1","title":"Opci\u00f3n 2:","text":"<p>Directamente desde psql:</p> <p><code>create database maravilla;</code></p> <p>Podemos ver las bases de datos creadas con:</p> <p><code>\\l</code></p> <p>Le damos permisos al usuario admin sobre la base de datos creada.</p> <p><code>grant all privileges on database maravilla to admin;</code></p> <p></p>"},{"location":"p1-servidores-clientes/ri/alumno3/#24-creacion-tablas-e-insercion-de-datos","title":"2.4 Creaci\u00f3n tablas e inserci\u00f3n de datos","text":"<p>Nos conectamos a la base de datos maravilla:</p> <p><code>\\c maravilla</code></p> <p>Creo las tablas.</p> <pre><code>create table actor\n(\ncodigo varchar (5),\nnombre varchar (15),\napellido varchar (15),\nfechanac date,\nconstraint pk_actor primary key (codigo)\n);\n\ncreate table pelicula\n(\ncodigo varchar (5),\ntitulo varchar (30),\nfecha_estreno date,\npuntuacion decimal (3,1),\nlengua_original varchar (3),\nconstraint pk_pelicula primary key (codigo),\nconstraint puntuacion_ck check (puntuacion between 0 and 10)\n);\n\ncreate table pelicula_actor\n(\ncodigo_actor varchar (5),\ncodigo_pelicula varchar (5),\ntipo_personaje varchar (15),\nconstraint pk_pelicula_actor primary key (codigo_actor,codigo_pelicula),\nconstraint fk_codigo_actor foreign key (codigo_actor) references actor (codigo),\nconstraint fk_codigo_pelicula foreign key (codigo_pelicula) references pelicula (codigo),\nconstraint tipo_ck check (tipo_personaje in ('Principal','Secundario'))\n);\n</code></pre> <p>Inserto los datos.</p> <pre><code>insert into pelicula values ('MA001', 'Iron Man', '2008-05-02', 7.9, 'EN');\ninsert into pelicula values ('MA002', 'Thor', '2011-05-06', 7.0, 'EN');\ninsert into pelicula values ('MA003', 'Captain America:first avenger', '2011-07-22', 6.9, 'EN');\ninsert into pelicula values ('MA004', 'The Avengers', '2012-05-04', 8, 'EN');\ninsert into pelicula values ('MA005', 'Guardians of the Galaxy', '2014-08-01', 8, 'EN');\ninsert into pelicula values ('MA006', 'Avengers: Age of Ultron', '2015-05-01', 7.3, 'EN');\ninsert into pelicula values ('MA007', 'Doctor Strange', '2016-11-04', 7.5, 'EN');\ninsert into pelicula values ('MA008', 'Spider-Man: Homecoming', '2017-07-07', 7.4, 'EN');\ninsert into pelicula values ('MA009', 'Black Panther', '2018-02-16', 7.3, 'EN');\ninsert into pelicula values ('MA010', 'Avengers: Infinity War', '2018-04-27', 8.4, 'EN');\ninsert into pelicula values ('MA011', 'Avengers: Endgame', '2019-04-26', 8.4, 'EN');\n\ninsert into actor values ('001','Robert', 'Downey', '1965-04-04');\ninsert into actor values ('002','Jon', 'Favreau', '1966-10-19');\ninsert into actor values ('003','Chris', 'Hemsworth', '1983-08-11');\ninsert into actor values ('004','Tom', 'Hiddleston', '1981-02-09');\ninsert into actor values ('005','Natalie', 'Portman', '1981-06-09');\ninsert into actor values ('006','Chris', 'Evans', '1981-06-13');\ninsert into actor values ('007','Sebastian', 'Stan', '1982-08-13');\ninsert into actor values ('008','Jeremy', 'Renner', '1971-01-07');\ninsert into actor values ('009','Scarlett', 'Johansson', '1984-11-22');\ninsert into actor values ('010','Mark', 'Ruffalo', '1967-11-22');\ninsert into actor values ('011','Clark', 'Gregg', '1962-04-02');\ninsert into actor values ('012','Samuel L.', 'Jackson', '1948-12-21');\ninsert into actor values ('013','Chris', 'Pratt', '1979-06-21');\ninsert into actor values ('014','Zoe', 'Salda\u00f1a', '1978-06-19');\ninsert into actor values ('015','Dave', 'Bautista', '1969-01-18');\ninsert into actor values ('016','Vin', 'Diesel', '1967-07-18');\ninsert into actor values ('017','Bradley', 'Cooper', '1975-01-05');\ninsert into actor values ('018','Michael', 'Rooker', '1955-04-06');\ninsert into actor values ('019','Elisabeth', 'Olsen', '1989-02-16');\ninsert into actor values ('020','Paul', 'Bettany', '1971-05-27');\ninsert into actor values ('021','Anthony', 'Mackie', '1978-09-23');\ninsert into actor values ('022','Bennedict', 'Cumberbatch', '1976-07-19');\ninsert into actor values ('023','Rachel', 'McAdams', '1978-11-17');\ninsert into actor values ('024','Tom', 'Holland', '1996-06-01');\ninsert into actor values ('025','Zendaya', 'Coleman', '1996-09-01');\ninsert into actor values ('026','Chadwick', 'Boseman', '1976-11-29');\ninsert into actor values ('027','Josh', 'Brolin', '1968-02-12');\ninsert into actor values ('028','Brie', 'Larson', '1989-10-01');\n\ninsert into pelicula_actor values ('001', 'MA001', 'Principal');\ninsert into pelicula_actor values ('002', 'MA001', 'Secundario');\ninsert into pelicula_actor values ('003', 'MA002', 'Principal');\ninsert into pelicula_actor values ('004', 'MA002', 'Principal');\ninsert into pelicula_actor values ('005', 'MA002', 'Principal');\ninsert into pelicula_actor values ('006', 'MA003', 'Principal');\ninsert into pelicula_actor values ('007', 'MA003', 'Secundario');\ninsert into pelicula_actor values ('001', 'MA004', 'Principal');\ninsert into pelicula_actor values ('002', 'MA004', 'Secundario');\ninsert into pelicula_actor values ('003', 'MA004', 'Principal');\ninsert into pelicula_actor values ('004', 'MA004', 'Principal');\ninsert into pelicula_actor values ('006', 'MA004', 'Principal');\ninsert into pelicula_actor values ('008', 'MA004', 'Principal');\ninsert into pelicula_actor values ('009', 'MA004', 'Principal');\ninsert into pelicula_actor values ('010', 'MA004', 'Principal');\ninsert into pelicula_actor values ('011', 'MA004', 'Secundario');\ninsert into pelicula_actor values ('012', 'MA004', 'Principal');\ninsert into pelicula_actor values ('013', 'MA005', 'Principal');\ninsert into pelicula_actor values ('014', 'MA005', 'Principal');\ninsert into pelicula_actor values ('015', 'MA005', 'Principal');\ninsert into pelicula_actor values ('016', 'MA005', 'Principal');\ninsert into pelicula_actor values ('017', 'MA005', 'Principal');\ninsert into pelicula_actor values ('018', 'MA005', 'Secundario');\ninsert into pelicula_actor values ('001', 'MA006', 'Principal');\ninsert into pelicula_actor values ('003', 'MA006', 'Principal');\ninsert into pelicula_actor values ('006', 'MA006', 'Principal');\ninsert into pelicula_actor values ('008', 'MA006', 'Principal');\ninsert into pelicula_actor values ('009', 'MA006', 'Principal');\ninsert into pelicula_actor values ('010', 'MA006', 'Principal');\ninsert into pelicula_actor values ('019', 'MA006', 'Principal');\ninsert into pelicula_actor values ('020', 'MA006', 'Principal');\ninsert into pelicula_actor values ('022', 'MA007', 'Principal');\ninsert into pelicula_actor values ('023', 'MA007', 'Secundario');\ninsert into pelicula_actor values ('024', 'MA008', 'Principal');\ninsert into pelicula_actor values ('025', 'MA008', 'Principal');\ninsert into pelicula_actor values ('001', 'MA008', 'Secundario');\ninsert into pelicula_actor values ('002', 'MA008', 'Secundario');\ninsert into pelicula_actor values ('026', 'MA009', 'Principal');\ninsert into pelicula_actor values ('027', 'MA010', 'Principal');\ninsert into pelicula_actor values ('001', 'MA010', 'Principal');\ninsert into pelicula_actor values ('003', 'MA010', 'Principal');\ninsert into pelicula_actor values ('004', 'MA010', 'Secundario');\ninsert into pelicula_actor values ('006', 'MA010', 'Principal');\ninsert into pelicula_actor values ('007', 'MA010', 'Secundario');\ninsert into pelicula_actor values ('009', 'MA010', 'Principal');\ninsert into pelicula_actor values ('010', 'MA010', 'Principal');\ninsert into pelicula_actor values ('012', 'MA010', 'Secundario');\ninsert into pelicula_actor values ('013', 'MA010', 'Principal');\ninsert into pelicula_actor values ('014', 'MA010', 'Principal');\ninsert into pelicula_actor values ('015', 'MA010', 'Principal');\ninsert into pelicula_actor values ('016', 'MA010', 'Principal');\ninsert into pelicula_actor values ('017', 'MA010', 'Principal');\ninsert into pelicula_actor values ('019', 'MA010', 'Principal');\ninsert into pelicula_actor values ('020', 'MA010', 'Principal');\ninsert into pelicula_actor values ('021', 'MA010', 'Secundario');\ninsert into pelicula_actor values ('022', 'MA010', 'Principal');\ninsert into pelicula_actor values ('024', 'MA010', 'Principal');\ninsert into pelicula_actor values ('026', 'MA010', 'Principal');\ninsert into pelicula_actor values ('001', 'MA011', 'Principal');\ninsert into pelicula_actor values ('003', 'MA011', 'Principal');\ninsert into pelicula_actor values ('006', 'MA011', 'Principal');\ninsert into pelicula_actor values ('008', 'MA011', 'Principal');\ninsert into pelicula_actor values ('009', 'MA011', 'Principal');\ninsert into pelicula_actor values ('010', 'MA011', 'Principal');\ninsert into pelicula_actor values ('027', 'MA011', 'Principal');\ninsert into pelicula_actor values ('007', 'MA011', 'Secundario');\ninsert into pelicula_actor values ('013', 'MA011', 'Secundario');\ninsert into pelicula_actor values ('014', 'MA011', 'Secundario');\ninsert into pelicula_actor values ('015', 'MA011', 'Secundario');\ninsert into pelicula_actor values ('016', 'MA011', 'Secundario');\ninsert into pelicula_actor values ('017', 'MA011', 'Secundario');\ninsert into pelicula_actor values ('019', 'MA011', 'Secundario');\ninsert into pelicula_actor values ('021', 'MA011', 'Secundario');\ninsert into pelicula_actor values ('022', 'MA011', 'Secundario');\ninsert into pelicula_actor values ('024', 'MA011', 'Secundario');\ninsert into pelicula_actor values ('026', 'MA011', 'Secundario');\ninsert into pelicula_actor values ('028', 'MA011', 'Secundario');\n</code></pre> <p></p> <p></p>"},{"location":"p1-servidores-clientes/ri/alumno3/#25-acceso-remoto","title":"2.5 Acceso remoto","text":"<p>Modificamos el fichero de configuraci\u00f3n de PostgreSQL que se encuentra en la ruta /etc/postgresql/13/main/postgresql.conf. Descomentamos la opci\u00f3n listen_addresses y donde pone localhost ponemos un asterisco.</p> <p></p> <p>A continuaci\u00f3n modificamos el fichero pg_hba.conf, en el mismo directorio de la anterior. Buscamos la l\u00ednea que pone \"# IPv4 local connections\", y donde pone \"127.0.0.1/32\" lo modificamos por \"all\".</p> <p></p> <p>Guardamos los cambios y reiniciamos el servicio de PostgreSQL.</p> <p><code>sudo systemctl restart postgresql</code></p> <p>En la maquina cliente instalamos postgresql-client.</p> <p><code>sudo apt install postgresql-client</code></p> <p>Nos conectamos a la base de datos maravilla con el cliente admin del siguiente modo (indicar la ip del servidor de base de datos):</p> <p><code>psql -h 192.168.122.98 -U admin -d maravilla</code></p> <p></p>"},{"location":"p1-servidores-clientes/ri/alumno3/#3-oracle","title":"3. Oracle","text":""},{"location":"p1-servidores-clientes/ri/alumno3/#31-instalacion","title":"3.1 Instalaci\u00f3n","text":"<p>Descargamos Oracle 19c desde su p\u00e1gina oficial. Si se hac con wget nos dar\u00e1 error a la hora de pasarlo a formato deb con alien. Vamos a su p\u00e1gina y lo descargamos.</p> <p>https://www.oracle.com/database/technologies/oracle19c-linux-downloads.html</p> <p>Vemos que est\u00e1 en formato rpm, as\u00ed que utilizaremos la herramienta alien para pasarlo a formato deb.</p> <p>\u00a1OJO! Si ya tienes Oracle pasado a .deb debes instalar los paquetes libaio1 y unixodbc, que son librer\u00edas para Oracle. Si no lo instalas dar\u00e1 error cuando hagas configure.</p> <p><code>sudo apt install alien libaio1 unixodbc</code></p> <p>Usamos alien para convertir el paquete a deb. Este proceso puede ser un poco lento.</p> <p><code>sudo alien --scripts -d oracle-database-ee-19c-1.0-1.x86_64.rpm</code></p> <p>Ahora vamos a crear un script en sbin que tendr\u00e1 el siguiente contenido.</p> <p><code>sudo nano /sbin/chkconfig</code></p> <pre><code>#!/bin/bash\n# Oracle XE Installer chkconfig for Debian 11\nfile=/etc/init.d/oracle-xe\nif [[ ! `tail -n1 $file | grep INIT` ]]; then\necho &gt;&gt; $file\necho '### BEGIN INIT INFO' &gt;&gt; $file\necho '# Provides: OracleXE' &gt;&gt; $file\necho '# Required-Start: $remote_fs $syslog' &gt;&gt; $file\necho '# Required-Stop: $remote_fs $syslog' &gt;&gt; $file\necho '# Default-Start: 2 3 4 5' &gt;&gt; $file\necho '# Default-Stop: 0 1 6' &gt;&gt; $file\necho '# Short-Description: Oracle 19c Express Edition' &gt;&gt; $file\necho '### END INIT INFO' &gt;&gt; $file\nfi\nupdate-rc.d oracle-xe defaults 80 01\n</code></pre> <p></p> <p>Damos los permisos al fichero creado.</p> <p><code>sudo chmod 777 /sbin/chkconfig</code></p> <p>Para que Oracle funcione se debe configurar el kernel por lo que a\u00f1adiremos lo siguiente:</p> <p><code>sudo nano /etc/sysctl.d/60-oracle.conf</code></p> <pre><code># Oracle 19c XE kernel parameters  \nfs.file-max=6815744  \nnet.ipv4.ip_local_port_range=9000 65000  \nkernel.sem=250 32000 100 128\nkernel.shmmax=536870912\n</code></pre> <p></p> <p>Cargamos los par\u00e1metros sin tener que reiniciar el sistema.</p> <p><code>sudo systemctl start procps.service</code></p> <p>Y ya podremos instalar Oracle 19c.</p> <p><code>sudo dpkg -i oracle-database-ee-19c_1.0-2_amd64.deb</code></p> <p></p>"},{"location":"p1-servidores-clientes/ri/alumno3/#32-configuracion","title":"3.2 Configuraci\u00f3n","text":"<p>Creaci\u00f3n de la base de datos y configuraci\u00f3n de la contrase\u00f1a del administrador.</p> <p><code>sudo /etc/init.d/oracledb_ORCLCDB-19c configure</code></p>"},{"location":"p1-servidores-clientes/ri/alumno3/#321-posibles-errores-al-hacer-configure","title":"3.2.1 Posibles errores al hacer configure","text":""},{"location":"p1-servidores-clientes/ri/alumno3/#error-1-fallo-en-la-comprobacion-de-la-memoria","title":"ERROR 1. Fallo en la comprobaci\u00f3n de la memoria","text":"<p>A mi me aparece el siguiente error.</p> <p></p> <p>Para solucionarlo configuramos el fichero /etc/init.d/oracledb_ORCLCDB-19c. Donde pone configure_perform a\u00f1adimos lo siguiente a la l\u00ednea $SU, como se ve en la captura.</p> <p><code>-J-Doracle.assistants.dbca.validate.ConfigurationParams=false</code></p> <p></p> <p></p>"},{"location":"p1-servidores-clientes/ri/alumno3/#error-2-fallo-en-la-configuracion-de-la-red","title":"ERROR 2. Fallo en la configuraci\u00f3n de la red","text":"<p>Tambi\u00e9n me apareci\u00f3 el siguiente problema.</p> <p></p> <p>Para solucionarlo hay que instalar las net-tools.</p> <p><code>sudo apt install net-tools</code></p> <p>Y para terminar a\u00f1adir a /etc/hosts nuestra ip, en mi caso 192.168.122.98 para debian-oracle. Quedar\u00eda de la siguiente forma.</p> <p><code>sudo nano /etc/hosts</code></p> <pre><code>127.0.0.1 localhost\n192.168.122.98 debian-oracle\n</code></pre> <p></p> <p>Ya deber\u00edamos poder realizar la configuraci\u00f3n.</p> <p></p>"},{"location":"p1-servidores-clientes/ri/alumno3/#33-terminar-configuracion","title":"3.3 Terminar configuraci\u00f3n","text":"<p>A\u00f1adimos las variables de entorno bash.</p> <p><code>sudo nano ~/.bashrc</code></p> <p>Al final del fichero, en la \u00faltima l\u00ednea a\u00f1adir lo siguiente:</p> <pre><code>export ORACLE_HOME=/opt/oracle/product/19c/dbhome_1\nexport ORACLE_SID=XE\nexport ORACLE_BASE=/opt/oracle\nexport LD_LIBRARY_PATH=$ORACLE_HOME/lib:$LD_LIBRARY_PATH\nexport PATH=$ORACLE_HOME/bin:$PATH\n</code></pre> <p></p> <p>Iniciamos las variables de entorno.</p> <p><code>. ~/.profile</code></p> <p>Arrancamos el servicio Oracle.</p> <p><code>sudo systemctl start oracledb_ORCLCDB-19c</code></p> <p>Si no conocemos el nombre exacto del servicio buscarlo con:</p> <p><code>sudo systemctl list-unit-files --type service | grep oracle</code></p> <p></p> <p>Podremos entrar a Oracle usando el siguiente comando:</p> <p><code>sqlplus / as sysdba</code></p> <p>Pero nuestro usuario local deber\u00e1 estar en el grupo dba.</p> <p><code>sudo nano /etc/group</code></p> <p></p> <p></p>"},{"location":"p1-servidores-clientes/ri/alumno3/#34-iniciar-la-base-de-datos","title":"3.4 Iniciar la base de datos","text":"<p>Si al inicializar la base de datos aparece el siguiente error es porque no le hemos dado el nombre correcto a la base de datos.</p> <p></p> <p>Cambiamos el nombre ORACLE_SID, al nombre de nuestra base de datos, en este caso ORCLCDB.</p> <p><code>export ORACLE_SID=ORCLCDB</code></p> <p>Volvemos a iniciar las variables de entorno y reiniciamos el proceso.</p> <p><code>. ~/.profile</code></p> <p><code>sudo systemctl start oracledb_ORCLCDB-19c</code></p> <p>Adem\u00e1s si nos aparece error de que no encuentra los directorios deberemos crear las siguientes carpetas en el directorio base de Oracle, en mi caso /opt/oracle/product/19c/dbhome_1.</p> <p><code>sudo mkdir fast_recovery_area</code></p> <p><code>sudo mkdir adump</code></p> <p><code>sudo chown -R oracle:oinstall fast_recovery_area</code></p> <p><code>sudo chown -R oracle:oinstall adump</code></p> <p>Entramos de nuevo como \"sqlplus / as sysdba\" e iniciamos la base de datos con startup.</p> <p></p>"},{"location":"p1-servidores-clientes/ri/alumno3/#error-1-ora-65096-nombre-de-usuario-o-rol-comun-no-valido","title":"ERROR 1. ORA-65096 nombre de usuario o rol comun no valido","text":"<p>Al entrar a sqlplus e intentar hacer cualquier cosa nos aparece el siguiente error.</p> <p></p> <p>Para solucionarlo tenemos que utilizar el siguiente comando:</p> <p><code>alter session set \"_ORACLE_SCRIPT\"=true;</code></p>"},{"location":"p1-servidores-clientes/ri/alumno3/#error-2-teclas-de-flechas-no-funcionan","title":"ERROR 2. Teclas de flechas no funcionan","text":"<p>Otro error com\u00fan es que al intentar recuperar un comando con la flecha arriba en sqlplus no te reconoce la tecla. As\u00ed como cuando le das a flecha izquierda no funciona para volver atr\u00e1s y corregir errores, tienes que borrar toda la l\u00ednea.  Esto se soluciona instalando rlwrap e iniciando sqlplus con \u00e9ste.</p> <p><code>sudo apt install rlwrap</code></p> <p><code>rlwrap sqlplus / as sysdba</code></p> <p></p>"},{"location":"p1-servidores-clientes/ri/alumno3/#35-creacion-usuario","title":"3.5 Creaci\u00f3n usuario","text":"<p>Creamos un usuario llamado admin y le damos todos los privilegios.</p> <p><code>create user admin identified by admin;</code></p> <p><code>grant all privileges to admin;</code></p> <p>Nos conectamos con el usuario admin.</p> <p><code>conn admin</code></p> <p></p>"},{"location":"p1-servidores-clientes/ri/alumno3/#36-creacion-tablas-e-insercion-de-datos","title":"3.6 Creaci\u00f3n tablas e inserci\u00f3n de datos","text":"<p>Creo las tablas:</p> <pre><code>create table actor\n(\ncodigo varchar2 (5),\nnombre varchar2 (15),\napellido varchar2 (15),\nfechanac date,\nconstraint pk_actor primary key (codigo),\nconstraint nombreactor_notnull check(nombre is not null),\nconstraint apellidoactor_notnull check(apellido is not null),\nconstraint nombreactor_mayus check(nombre=initcap(nombre)),\nconstraint apellidoactor_mayus check(apellido=initcap(apellido))\n);\n\ncreate table pelicula\n(\ncodigo varchar2 (5),\ntitulo varchar2 (30),\nfecha_estreno date,\npuntuacion number (3,1),\nlengua_original varchar2 (3) default 'EN',\nconstraint pk_pelicula primary key (codigo),\nconstraint puntuacion_ck check (puntuacion between 0 and 10),\nconstraint fecha_ck check(fecha_estreno&gt;to_date('01/01/2000', 'DD/MM/YYYY')),\nconstraint titulo_unico unique(titulo),\nconstraint cod_exp check(regexp_like (codigo, '^MA[0-9]{3}$'))\n);\n\ncreate table pelicula_actor\n(\ncodigo_actor varchar2 (5),\ncodigo_pelicula varchar2 (5),\ntipo_personaje varchar2 (15),\nconstraint pk_pelicula_actor primary key (codigo_actor,codigo_pelicula),\nconstraint fk_codigo_actor foreign key (codigo_actor) references actor (codigo),\nconstraint fk_codigo_pelicula foreign key (codigo_pelicula) references pelicula (codigo),\nconstraint tipo_ck check (tipo_personaje in ('Principal','Secundario'))\n);\n</code></pre> <p>Hago los inserts.</p> <pre><code>insert into pelicula values ('MA001', 'Iron Man', to_date('2008-05-02', 'YYYY-MM-DD'), 7.9, 'EN');\ninsert into pelicula values ('MA002', 'Thor', to_date('2011-05-06', 'YYYY-MM-DD'), 7.0, 'EN');\ninsert into pelicula values ('MA003', 'Captain America: first avenger', to_date('2011-07-22', 'YYYY-MM-DD'), 6.9, 'EN');\ninsert into pelicula values ('MA004', 'The Avengers', to_date('2012-05-04', 'YYYY-MM-DD'), 8, 'EN');\ninsert into pelicula values ('MA005', 'Guardians of the Galaxy', to_date('2014-08-01', 'YYYY-MM-DD'), 8, 'EN');\ninsert into pelicula values ('MA006', 'Avengers: Age of Ultron', to_date('2015-05-01', 'YYYY-MM-DD'), 7.3, 'EN');\ninsert into pelicula values ('MA007', 'Doctor Strange', to_date('2016-11-04', \u2018YYYY-MM-DD\u2019), 7.5, 'EN');\ninsert into pelicula values ('MA008', 'Spider-Man: Homecoming', to_date('2017-07-07', 'YYYY-MM-DD'), 7.4, 'EN');\ninsert into pelicula values ('MA009', 'Black Panther', to_date('2018-02-16', 'YYYY-MM-DD'), 7.3, 'EN');\ninsert into pelicula values ('MA010', 'Avengers: Infinity War', to_date('2018-04-27', 'YYYY-MM-DD'), 8.4, 'EN');\ninsert into pelicula values ('MA011', 'Avengers: Endgame', to_date('2019-04-26', 'YYYY-MM-DD'), 8.4, 'EN');\n\ninsert into actor values ('001','Robert', 'Downey', to_date('1965-04-04', 'YYYY-MM-DD'));\ninsert into actor values ('002','Jon', 'Favreau', to_date('1966-10-19', 'YYYY-MM-DD'));\ninsert into actor values ('003','Chris', 'Hemsworth', to_date('1983-08-11', 'YYYY-MM-DD'));\ninsert into actor values ('004','Tom', 'Hiddleston', to_date('1981-02-09', 'YYYY-MM-DD'));\ninsert into actor values ('005','Natalie', 'Portman', to_date('1981-06-09', 'YYYY-MM-DD'));\ninsert into actor values ('006','Chris', 'Evans', to_date('1981-06-13', 'YYYY-MM-DD'));\ninsert into actor values ('007','Sebastian', 'Stan', to_date('1982-08-13', 'YYYY-MM-DD'));\ninsert into actor values ('008','Jeremy', 'Renner', to_date('1971-01-07', 'YYYY-MM-DD'));\ninsert into actor values ('009','Scarlett', 'Johansson', to_date('1984-11-22', 'YYYY-MM-DD'));\ninsert into actor values ('010','Mark', 'Ruffalo', to_date('1967-11-22', 'YYYY-MM-DD'));\ninsert into actor values ('011','Clark', 'Gregg', to_date('1962-04-02', 'YYYY-MM-DD'));\ninsert into actor values ('012','Samuel L.', 'Jackson', to_date('1948-12-21', 'YYYY-MM-DD'));\ninsert into actor values ('013','Chris', 'Pratt', to_date('1979-06-21', 'YYYY-MM-DD'));\ninsert into actor values ('014','Zoe', 'Saldana', to_date('1978-06-19', 'YYYY-MM-DD'));\ninsert into actor values ('015','Dave', 'Bautista', to_date('1969-01-18', 'YYYY-MM-DD'));\ninsert into actor values ('016','Vin', 'Diesel', to_date('1967-07-18', 'YYYY-MM-DD'));\ninsert into actor values ('017','Bradley', 'Cooper', to_date('1975-01-05', 'YYYY-MM-DD'));\ninsert into actor values ('018','Michael', 'Rooker', to_date('1955-04-06', 'YYYY-MM-DD'));\ninsert into actor values ('019','Elisabeth', 'Olsen', to_date('1989-02-16', 'YYYY-MM-DD'));\ninsert into actor values ('020','Paul', 'Bettany', to_date('1971-05-27', 'YYYY-MM-DD'));\ninsert into actor values ('021','Anthony', 'Mackie', to_date('1978-09-23', 'YYYY-MM-DD'));\ninsert into actor values ('022','Bennedict', 'Cumberbatch', to_date('1976-07-19', 'YYYY-MM-DD'));\ninsert into actor values ('023','Rachel', 'Mcadams', to_date('1978-11-17', 'YYYY-MM-DD'));\ninsert into actor values ('024','Tom', 'Holland', to_date('1996-06-01', 'YYYY-MM-DD'));\ninsert into actor values ('025','Zendaya', 'Coleman', to_date('1996-09-01', 'YYYY-MM-DD'));\ninsert into actor values ('026','Chadwick', 'Boseman', to_date('1976-11-29', 'YYYY-MM-DD'));\ninsert into actor values ('027','Josh', 'Brolin', to_date('1968-02-12', 'YYYY-MM-DD'));\ninsert into actor values ('028','Brie', 'Larson', to_date('1989-10-01', 'YYYY-MM-DD'));\n\ninsert into pelicula_actor values ('001', 'MA001', 'Principal');\ninsert into pelicula_actor values ('002', 'MA001', 'Secundario');\ninsert into pelicula_actor values ('003', 'MA002', 'Principal');\ninsert into pelicula_actor values ('004', 'MA002', 'Principal');\ninsert into pelicula_actor values ('005', 'MA002', 'Principal');\ninsert into pelicula_actor values ('006', 'MA003', 'Principal');\ninsert into pelicula_actor values ('007', 'MA003', 'Secundario');\ninsert into pelicula_actor values ('001', 'MA004', 'Principal');\ninsert into pelicula_actor values ('002', 'MA004', 'Secundario');\ninsert into pelicula_actor values ('003', 'MA004', 'Principal');\ninsert into pelicula_actor values ('004', 'MA004', 'Principal');\ninsert into pelicula_actor values ('006', 'MA004', 'Principal');\ninsert into pelicula_actor values ('008', 'MA004', 'Principal');\ninsert into pelicula_actor values ('009', 'MA004', 'Principal');\ninsert into pelicula_actor values ('010', 'MA004', 'Principal');\ninsert into pelicula_actor values ('011', 'MA004', 'Secundario');\ninsert into pelicula_actor values ('012', 'MA004', 'Principal');\ninsert into pelicula_actor values ('013', 'MA005', 'Principal');\ninsert into pelicula_actor values ('014', 'MA005', 'Principal');\ninsert into pelicula_actor values ('015', 'MA005', 'Principal');\ninsert into pelicula_actor values ('016', 'MA005', 'Principal');\ninsert into pelicula_actor values ('017', 'MA005', 'Principal');\ninsert into pelicula_actor values ('018', 'MA005', 'Secundario');\ninsert into pelicula_actor values ('001', 'MA006', 'Principal');\ninsert into pelicula_actor values ('003', 'MA006', 'Principal');\ninsert into pelicula_actor values ('006', 'MA006', 'Principal');\ninsert into pelicula_actor values ('008', 'MA006', 'Principal');\ninsert into pelicula_actor values ('009', 'MA006', 'Principal');\ninsert into pelicula_actor values ('010', 'MA006', 'Principal');\ninsert into pelicula_actor values ('019', 'MA006', 'Principal');\ninsert into pelicula_actor values ('020', 'MA006', 'Principal');\ninsert into pelicula_actor values ('022', 'MA007', 'Principal');\ninsert into pelicula_actor values ('024', 'MA008', 'Principal');\ninsert into pelicula_actor values ('025', 'MA008', 'Principal');\ninsert into pelicula_actor values ('001', 'MA008', 'Secundario');\ninsert into pelicula_actor values ('002', 'MA008', 'Secundario');\ninsert into pelicula_actor values ('026', 'MA009', 'Principal');\ninsert into pelicula_actor values ('027', 'MA010', 'Principal');\ninsert into pelicula_actor values ('001', 'MA010', 'Principal');\ninsert into pelicula_actor values ('003', 'MA010', 'Principal');\ninsert into pelicula_actor values ('004', 'MA010', 'Secundario');\ninsert into pelicula_actor values ('006', 'MA010', 'Principal');\ninsert into pelicula_actor values ('007', 'MA010', 'Secundario');\ninsert into pelicula_actor values ('009', 'MA010', 'Principal');\ninsert into pelicula_actor values ('010', 'MA010', 'Principal');\ninsert into pelicula_actor values ('012', 'MA010', 'Secundario');\ninsert into pelicula_actor values ('013', 'MA010', 'Principal');\ninsert into pelicula_actor values ('014', 'MA010', 'Principal');\ninsert into pelicula_actor values ('015', 'MA010', 'Principal');\ninsert into pelicula_actor values ('016', 'MA010', 'Principal');\ninsert into pelicula_actor values ('017', 'MA010', 'Principal');\ninsert into pelicula_actor values ('019', 'MA010', 'Principal');\ninsert into pelicula_actor values ('020', 'MA010', 'Principal');\ninsert into pelicula_actor values ('021', 'MA010', 'Secundario');\ninsert into pelicula_actor values ('022', 'MA010', 'Principal');\ninsert into pelicula_actor values ('024', 'MA010', 'Principal');\ninsert into pelicula_actor values ('026', 'MA010', 'Principal');\ninsert into pelicula_actor values ('001', 'MA011', 'Principal');\ninsert into pelicula_actor values ('003', 'MA011', 'Principal');\ninsert into pelicula_actor values ('006', 'MA011', 'Principal');\ninsert into pelicula_actor values ('008', 'MA011', 'Principal');\ninsert into pelicula_actor values ('009', 'MA011', 'Principal');\ninsert into pelicula_actor values ('010', 'MA011', 'Principal');\ninsert into pelicula_actor values ('027', 'MA011', 'Principal');\ninsert into pelicula_actor values ('007', 'MA011', 'Secundario');\ninsert into pelicula_actor values ('013', 'MA011', 'Secundario');\ninsert into pelicula_actor values ('014', 'MA011', 'Secundario');\ninsert into pelicula_actor values ('015', 'MA011', 'Secundario');\ninsert into pelicula_actor values ('016', 'MA011', 'Secundario');\ninsert into pelicula_actor values ('017', 'MA011', 'Secundario');\ninsert into pelicula_actor values ('019', 'MA011', 'Secundario');\ninsert into pelicula_actor values ('021', 'MA011', 'Secundario');\ninsert into pelicula_actor values ('022', 'MA011', 'Secundario');\ninsert into pelicula_actor values ('024', 'MA011', 'Secundario');\ninsert into pelicula_actor values ('026', 'MA011', 'Secundario');\ninsert into pelicula_actor values ('028', 'MA011', 'Secundario');\n</code></pre> <p></p> <p></p>"},{"location":"p1-servidores-clientes/ri/alumno3/#37-acceso-remoto","title":"3.7 Acceso remoto","text":"<p>Vamos a la ruta \"/opt/oracle/product/19c/dbhome_1/network/admin/\". Aqu\u00ed configuraremos los ficheros de configuraci\u00f3n listener.ora y tnsnames.ora.</p> <p>En listener.ora cambiamos \"GLOBAL_DBNAME\" y \"SID_NAME\" por \"ORCLCDB\". Y en \"HOST\" ponemos \"0.0.0.0\".</p> <p></p> <p>En tnsnames.ora no he tenido que cambiar nada. Se quedar\u00eda como se ve en la captura.</p> <p></p> <p>Entramos con el usuario oracle.</p> <p><code>su oracle</code></p> <p>Comprobamos el status de listener.</p> <p><code>lsnrctl status</code></p> <p></p> <p>Vemos que no est\u00e1 funcionando, as\u00ed que lo iniciamos.</p> <p><code>lsnrctl start</code></p> <p></p>"},{"location":"p1-servidores-clientes/ri/alumno3/#38-configuracion-cliente","title":"3.8 Configuraci\u00f3n cliente","text":"<p>En un cliente Debian11 descargo Sql*Plus InstantClient desde la p\u00e1gina oficial de Oracle con wget.</p> <pre><code>wget https://download.oracle.com/otn_software/linux/instantclient/218000/instantclient-basic-linux.x64-21.8.0.0.0dbru.zip\nwget https://download.oracle.com/otn_software/linux/instantclient/218000/instantclient-sqlplus-linux.x64-21.8.0.0.0dbru.zip\n</code></pre> <p>Descomprimo con unzip.</p> <pre><code>sudo unzip -d /opt/oracle instantclient-basic-linux.x64-21.8.0.0.0dbru.zip\nsudo unzip -d /opt/oracle instantclient-sqlplus-linux.x64-21.8.0.0.0dbru.zip\n</code></pre> <p>A\u00f1adimos las variables de entorno y aplicamos los cambios.</p> <pre><code>export LD_LIBRARY_PATH=/opt/oracle/instantclient_21_8:$LD_LIBRARY_PATH\nexport PATH=$LD_LIBRARY_PATH:$PATH\n. ~/.bashrc\n</code></pre> <p>En \"/opt/oracle/instantclient_21_8/network/admin/\" creamos el fichero tnsnames.ora con el siguiente contenido.</p> <pre><code>ORCLCDB=\n  (DESCRIPTION =\n    (ADDRESS_LIST =\n      (ADDRESS = (PROTOCOL = TCP)(HOST = 192.168.122.98)(PORT = 1521))\n    )\n    (CONNECT_DATA =\n      (SERVICE_NAME = ORCLCDB)\n    )\n  )\n</code></pre>"},{"location":"p1-servidores-clientes/ri/alumno3/#381-prueba-de-conexion","title":"3.8.1 Prueba de conexi\u00f3n","text":"<p><code>sqlplus admin/admin@ORCLCDB</code></p> <p></p> <p>Podemos instalar e iniciar sqlplus con rlwrap para poder hacer un mejor manejo de la base de datos con las teclas de las flechas.</p>"},{"location":"p1-servidores-clientes/ri/alumno3/#4-mongodb","title":"4. MongoDB","text":""},{"location":"p1-servidores-clientes/ri/alumno3/#41-instalacion","title":"4.1 Instalaci\u00f3n","text":"<p>Por defecto los paquetes de MongoDB no est\u00e1n incluidos en los repositorios de Debian, por lo que necesitaremos a\u00f1adirlos antes de instalarlo.</p> <p><code>sudo apt install curl apt-transport-https software-properties-common gnupg2</code></p> <p><code>wget -qO - https://www.mongodb.org/static/pgp/server-5.0.asc | sudo apt-key add -</code></p> <p><code>echo \"deb http://repo.mongodb.org/apt/debian buster/mongodb-org/5.0 main\" | sudo tee /etc/apt/sources.list.d/mongodb-org-5.0.list</code></p> <p>Actualizamos los repositorios e instalamos MongoDB:</p> <p><code>sudo apt update</code></p> <p><code>sudo apt install mongodb-org</code></p> <p>Activamos el servicio mongod.</p> <p><code>sudo systemctl start mongod</code></p>"},{"location":"p1-servidores-clientes/ri/alumno3/#42-creacion-base-de-datos-y-usuario","title":"4.2 Creaci\u00f3n base de datos y usuario","text":"<p>Entramos a MongoDB:</p> <p><code>mongosh</code></p> <p>Creamos la base de datos maravilla.</p> <p><code>use maravilla</code></p> <p>Y creamos un usuario llamado admin con permisos sobre la base de datos.</p> <pre><code>db.createUser(\n   {\n     user: \"admin\", \n     pwd: \"admin\", \n     roles: [ { role: \"dbOwner\", db: \"maravilla\" } ]\n   }\n )\n</code></pre>"},{"location":"p1-servidores-clientes/ri/alumno3/#44-creacion-de-colecciones-e-insercion-de-datos","title":"4.4 Creaci\u00f3n de colecciones e inserci\u00f3n de datos","text":"<p>Creo las colecciones.</p> <p><code>db.createCollection(\"pelicula\")</code></p> <p><code>db.createCollection(\"actor\")</code></p> <p><code>db.createCollection(\"pelicula_actor\")</code></p> <p>Comprobamos con \"show collections\".</p> <p></p> <p>Inserto los datos en cada colecci\u00f3n.</p> <pre><code>db.pelicula.insertMany ([\n    {titulo: \"Iron Man\", fecha_estreno: 2008-05-02, puntuacion: 7.9},\n    {titulo: \"Thor\", fecha_estreno: 2011-05-06, puntuacion: 7},\n    {titulo: \"The avengers\", fecha_estreno: 2012-05-04, puntuacion: 8},\n    {titulo: \"Guarian pf the Galaxy\", fecha_estreno: 2014-08-01, puntuacion: 8},\n    {titulo: \"Avengers: Age of Ultron\", fecha_estreno: 2015-05-01, puntuacion: 7.3},\n    {titulo: \"Doctor Strange\", fecha_estreno: 2016-11-04, puntuacion: 7.4},\n    {titulo: \"Avengers: Infinity War\", fecha_estreno: 2018-02-16, puntuacion: 8.4}\n])\n\ndb.actor.insertMany ([\n    {nombre: \"Robert\", apellido: \"Downey\", fechanac: 1965-04-04},\n    {nombre: \"Chris\", apellido: \"Hemsworth\", fechanac: 1983-08-11},\n    {nombre: \"Chris\", apellido: \"Evans\", fechanac: 1981-06-13},\n    {nombre: \"Chris\", apellido: \"Pratt\", fechanac: 1979-06-21},\n    {nombre: \"Bennedict\", apellido: \"Cumberbatch\", fechanac: 1976-07-19},\n    {nombre: \"Scarlett\", apellido: \"Johansson\", fechanac: 1984-11-22},\n    {nombre: \"Zoe\", apellido: \"Saldana\", fechanac: 1978-06-19},\n    {nombre: \"Elisabeth\", apellido: \"Olsen\", fechanac: 1989-02-16}\n])\n\ndb.genero.insertMany ([\n    {tipo: \"drama\"},\n    {tipo: \"accion\"},\n    {tipo: \"aventura\"},\n    {tipo: \"superheroes\"}\n])\n</code></pre> <p>Comprobamos con find.</p> <p><code>db.pelicula.find()</code></p> <p><code>db.actor.find()</code></p> <p><code>db.genero.find()</code></p> <p></p> <p></p> <p></p>"},{"location":"p1-servidores-clientes/ri/alumno3/#45-acceso-remoto","title":"4.5 Acceso remoto","text":"<p>Para poder acceder remotamente habr\u00e1 que configurar \"mongod.conf\" que se encuentra en /etc/. Los siguientes valores deben quedar de la siguiente manera:</p> <pre><code>bindIp: 127.0.0.1,192.168.122.98\nsecurity:\n  authorization: enabled\n</code></pre> <p></p> <p>Reiniciar el servicio.</p> <p><code>sudo systemctl restart mongod</code></p> <p>En la m\u00e1quina cliente a\u00f1adimos los repositorios de MongoDB como se explic\u00f3 arriba e instalamos.</p> <p><code>sudo apt install mongodb-org-shell mongodb-mongosh</code></p> <p>Probamos el acceso remoto con el siguiente comando. Se especifica el nombre de usuario, la contrase\u00f1a, la ip del servidor y la base de datos a la que nos conectaremos.</p> <p><code>mongosh -u admin -p admin 192.168.122.98/maravilla</code></p> <p></p>"},{"location":"p1-servidores-clientes/ri/alumno3/#5-aplicacion-postgresql","title":"5. Aplicaci\u00f3n PostgreSQL","text":"<p>El repositorio en el que he trabajado es este: https://github.com/afermor8/app-postgresql</p> <p>He utilizado como base un proyecto anterior que cre\u00e9 en flask. Copio el contenido de este proyecto en un nuevo repositorio y clono el repositorio en la m\u00e1quina que trabajar\u00e9.</p> <p><code>git clone git@github.com:afermor8/app-postgresql.git</code></p> <p>Instalamos y creamos un entorno virtual.</p> <p><code>sudo apt install python3-venv</code></p> <p><code>python3 -m venv entorno_prueba</code></p> <p>Entramos en el entorno creado.</p> <p><code>source entorno_prueba/bin/activate</code></p> <p>Entramos en el repositorio.</p> <p><code>cd app-postgresql</code></p> <p>En el entorno de prueba voy a instalar los paquetes necesarios que se pueden ver en el fichero requirements.txt del repositorio clonado. Usamos el comando <code>pip install -r requirements.txt</code>.</p> <p>En el repositorio app-postgresql encontramos la carpeta static, templates y la aplicaci\u00f3n app.py.</p> <ul> <li>Static: donde est\u00e1 el contenido est\u00e1tico (css, im\u00e1genes, js).</li> <li>Templates: donde est\u00e1n las plantillas html5.</li> <li>app.py: la aplicaci\u00f3n creada en python con flask.</li> </ul> <p>Lanzamos la aplicaci\u00f3n para ver lo que hay actualmente y los cambios que tendremos que realizar.</p> <p><code>python3 app.py</code></p> <p></p> <p>Tenemos que instalar adem\u00e1s psycopg2.</p> <p><code>pip install psycopg2-binary</code></p> <p>He actualizado requirements.txt en el repositorio.</p> <p>Los cambios realizados en en la aplicaci\u00f3n se puede ver a trav\u00e9s de los commits del repositorio app-postgresql.</p> <p>https://github.com/afermor8/app-postgresql</p> <p>A continuaci\u00f3n muestro algunas capturas del funcionamiento de la aplicaci\u00f3n.</p> <p></p> <p></p> <p></p> <p></p>"},{"location":"p1-servidores-clientes/ri/alumno4/","title":"Alumno 4","text":""},{"location":"p1-servidores-clientes/ri/alumno4/#instalacion-de-un-servidor-postgresql-y-su-posterior-acceso","title":"Instalaci\u00f3n de un servidor Postgresql y su posterior acceso","text":"<p>Comenzaremos actualizando el sistema e instalando postgresql con derechos de privilegio <pre><code>root@debian:/home/usuario# apt update &amp;&amp; apt install postgresql -y\n</code></pre></p> <p>Comprobamos si el servicio est\u00e1 activo, si no es as\u00ed lo iniciamos con <code>sudo systemctl start postgresql</code></p> <p></p> <p>Tras esto, comprobaremos que el usuario postrgres existe, ya que es el que nos dar\u00e1 el acceso a la base de datos, lo podemos comprobar con el siguiente comando:</p> <p><code>cat /etc/passwd | egrep \"postgres\"</code></p> <p>Si no tenemos el usuario creado, lo haremos con <code>sudo useradd postgres</code></p> <p>Con el comando groups podemos ver que ese usuario tiene certificaci\u00f3n SSL, con lo cual podr\u00e1 conectarse a la base de datos ya que su usuario tiene esos derechos:</p> <p></p> <pre><code>postgres@debian:/home/usuario$ createdb dark-souls\npostgres@debian:/home/usuario$ psql\n</code></pre> <p>con \\c dark-souls ingresamos en la base de datos Ahora procedemos a ingresar las tablas, he escogido las de mi proyecto del a\u00f1o pasado ya que le dediqu\u00e9 mucho tiempo con lo cual le tengo un especial cari\u00f1o. https://github.com/Evanticks/BBDD/blob/main/Proyecto_Tercer_Trimestre/Dark_Souls_Postgres.sql</p> <p>tras esto ingresamos los datos que van en las tablas, el cual se hayan en mi repositorio</p> <p>Comprobamos los datos con una consulta simple: <pre><code>dark-souls=# select * from armas;\n codarma |      nombre      | fuerza | destreza | inteligencia | rareza | nivel \n---------+------------------+--------+----------+--------------+--------+-------\n 001     | Espada Corta     |      8 |       10 |            0 | D      |     5\n 002     | Espada Larga     |     10 |       10 |            0 | C      |     8\n 003     | Espada Artorias  |     24 |       18 |           20 | S      |    30\n 004     | Hacha de Mano    |      8 |        8 |            0 | D      |     6\n 005     | Hacha de G\u00e1rgola |     14 |       14 |            0 | A      |    15\n 006     | Hacha de Demonio |     46 |        0 |            0 | S      |    40\n(6 filas)\n</code></pre></p> <p><code>sudo nano /etc/postgresql/13/main/postgresql.conf</code></p> <p>listen_addresses = '*' Con esto podr\u00e9 conectarme desde un cliente a un servidor postgres</p> <p>A continuaci\u00f3n a trav\u00e9s del fichero pg_hba.conf podemos decir qu\u00e9 m\u00e1quina va a entrar a nuestro servidor, sirve de filtro de conexiones.</p> <p></p> <p>Nos vamos a la m\u00e1quina cliente y hacemos lo siguiete:</p> <p><pre><code>sudo apt update &amp;&amp; sudo apt install postgresql-client -y\n</code></pre> Ahora nos faltar\u00eda saber por qu\u00e9 puerto est\u00e1 escuchando: </p> <p>luego creamos el usuario en el cual pondremos como par\u00e1metro en el cliente: createuser -s antonio -P</p> <p>Con el siguiente comando estamos diciendo que se conecte al siguiente host, con el puerto 5432 con  el usuario antonio y la base de datos a la que queremos conectarnos:</p> <p>psql -h 192.168.122.188 -p 5432 -U antonio -d dark-souls</p> <p></p>"},{"location":"p1-servidores-clientes/ri/alumno4/#instalacion-de-un-servidor-mariadb-y-su-posterior-acceso","title":"Instalaci\u00f3n de un servidor Mariadb y su posterior acceso","text":"<p>Procedemos con la instalaci\u00f3n con el siguiente comando:</p> <pre><code>sudo apt update &amp;&amp; sudo apt install mariadb-server -y\n</code></pre> <p>sudo nano /etc/mysql/mariadb.conf.d/50-server.cnf procedemos a comentar la l\u00ednea que nos bloquea el uso al exterior del loopback.</p> <p><code>#bind-address            = 192.168.122.0</code></p> <p><pre><code>sudo service mariadb restart\nsudo mysql -u root -p\n</code></pre> Le otorgamos al siguiente usuario los privilegios sobre la base de datos:</p> <pre><code>create database souls;\nGRANT ALL PRIVILEGES ON souls.* TO 'antonio'@'192.168.122.146' IDENTIFIED BY 'antonio' WITH GRANT OPTION;\nuse souls;\n</code></pre> <p>Insertamos las tablas y los insert que se hayan en mi github:</p> <p>https://github.com/Evanticks/BBDD/blob/main/Proyecto_Tercer_Trimestre/Dark_Souls_Mariadb.sql</p> <p>Ahora procedemos a instalar el cliente en nuestra m\u00e1quina: <pre><code>sudo apt install mariadb-client\n</code></pre> </p>"},{"location":"p1-servidores-clientes/ri/alumno4/#instalacion-de-un-servidor-mongodb-y-su-posterior-acceso","title":"Instalaci\u00f3n de un servidor Mongodb y su posterior acceso","text":"<p>Comenzaremos ejecutando el siguiente comando:</p> <p><code>sudo apt-get install gnupg -y</code></p> <p><code>wget -qO - https://www.mongodb.org/static/pgp/server-4.4.asc | apt-key add -</code></p> <p>Estos pasos debemos realizarlo para poder tener en el repositorio la base de datos que se ir\u00e1 actualizando, adem\u00e1s de poder instalar mongo por apt.</p> <p><code>echo \"deb http://repo.mongodb.org/apt/debian buster/mongodb-org/4.4 main\" | tee /etc/apt/sources.list.d/mongodb-org.list</code></p> <p>Tras hacer un update, procedemos a instalarlo:</p> <p><code>apt-get install mongodb-org -y</code></p> <pre><code>systemctl start mongod\nsystemctl enable mongod\n</code></pre> <p>Para entrar en la base de datos de mongo: <code>mongo</code></p> <p>Accederemos al administrador que tiene los privilegios: <code>use admin</code></p> <pre><code>db.createUser(\n...   {\n...     user: \"AMP\",\n...     pwd: \"AMP\",\n...     roles: [ { role: \"userAdminAnyDatabase\", db: \"admin\" }, \"readWriteAnyDatabase\" ]\n...   }\n... )\n</code></pre> <p>Ahora vamos a entrar en /etc/mongod.conf y especificaremos lo siguiente:</p> <p><pre><code>security:\nauthorization: enabled\n</code></pre> </p> <p>Ahora procedemos a importar nuestra base de datos guardada en JSON, ya que es el sistema de ficheros con el que trabaja Mongo, as\u00ed podremos transformarlo en colecciones dentro de la base de datos SOULS que se especifica en el siguiente comando:</p> <pre><code>usuario@debian:~$ mongoimport --db SOULS --collection SOULSWEAPONS --file DarkSoulsWeapons.json --jsonArray --authenticationDatabase admin -u AMP -p AMP\n2022-10-29T15:55:57.757+0200    connected to: mongodb://localhost/\n2022-10-29T15:55:57.813+0200    140 document(s) imported successfully. 0 document(s) failed to import.\n</code></pre> <p>Creamos la base de datos SOULS, la colecci\u00f3n SOULSWAPONS y dentro los documentos que habr\u00e1 en la colecci\u00f3n.</p> <p><code>mongo -u AMP -p</code></p> <p>Accederemos a la base de datos creada anteriormente con el siguiente comando:</p> <p><code>use SOULS</code></p> <p></p> <p>Ahora salimos y volvemos a entrar en el archivo de configuraci\u00f3n de mongo /etc/mongod.conf</p> <pre><code>net:\n  port: 27017\n  bindIp: 0.0.0.0\n</code></pre> <p><code>systemctl restart mongod</code></p> <p>Ahora procedemos a instalar mongo en el cliente y una vez hecho ese paso procedemos a conectarnos especificando el usuario y la ip del host:</p> <p><code>mongo --host 192.168.122.168 -u AMP</code></p> <p></p>"},{"location":"p1-servidores-clientes/ri/alumno4/#conexion-de-aplicacion-web-a-traves-de-oracle-pyhton3-y-flask","title":"Conexi\u00f3n de aplicaci\u00f3n web a trav\u00e9s de Oracle, Pyhton3 y Flask","text":"<p>En los documentos que se hayan en el siguiente repositorio: https://github.com/Evanticks/Oracle_cx</p> <p>Podremos acceder a crear la aplicaci\u00f3n web a trav\u00e9s de python y flask, para realizar esto creamos un entorno de trabajo llamado /env, luego dentro de este podremo instalar con pip los siguientes paquetes: <pre><code>pip install flask\npip install cx_Oracle\n</code></pre></p> <p>Tras esto podemos aplicar el siguiente c\u00f3digo que realizar\u00e1 lo siguiente:</p> <pre><code>@app.route('/login',methods=[\"GET\",\"POST\"])\ndef login():\n    if request.method==\"POST\":\n        texto=request.form.get(\"user\")\n        print ('texto=',texto)\n        texto2=request.form.get(\"pass\")\n        print ('texto2=',texto2)\n        if texto=='antonio' and texto2=='antonio':\n            connection=cx_Oracle.connect(\n            user='antonio',\n            password='antonio',\n            dsn='192.168.122.20:1521/ORCLCDB',\n            encoding='UTF-8')\n            cursor = connection.cursor()\n            cursor.execute(\"select * from personaje\")\n            resultado = cursor.fetchall()\n            cursor.execute(\"select nombre from armas\")\n            resultado2 = cursor.fetchall()\n            cursor.execute(\"select nombre from tesoro\")\n        else:\n            return redirect(url_for('login'))\n    else:\n        return render_template(\"login.html\")\n</code></pre> <p>Con esto entraremos en la pantalla de login, si ingresamos nuestro usuario y contrase\u00f1a de Oracle el cual ser\u00e1 antonio, accederemos a la base de datos y mostr\u00e1r\u00e1 dos select, uno para listar los datos de la tabla personaje y otro para listar los nombres de las armas, en el html podremos ingresar el resultado generado de la consulta a trav\u00e9s de Jinja2.</p> <p>Ejecutaremos python3 app.py para arrancar el servidor flask que nos dar\u00e1 el acceso a la web</p> <p>IMPORTANTE: Para realizar esto debemos previamente activar el listener y hacer un startup para levantar la base de datos, podemos comprobarlo antes accediendo desde un cliente remoto por consola.</p> <p></p> <p>Aqu\u00ed podemos ver que al entrar a trav\u00e9s del login, podemos ver las tablas de la base de datos.</p> <p></p>"},{"location":"p4-grupal-plsql/ejercicio1/","title":"Ejercicio 1","text":"<p>Realiza una funci\u00f3n que reciba como par\u00e1metros un c\u00f3digo de carrera y un c\u00f3digo de caballo y devuelva el importe total que tendr\u00e1 que pagar el hip\u00f3dromo a los apostantes suponiendo que dicha carrera sea ganada por el caballo recibido como par\u00e1metro. Se deben contemplar las siguientes excepciones: Carrera inexistente, Caballo inexistente, Caballo no participante en esa carrera.</p> <pre><code>CREATE OR REPLACE FUNCTION importetotal (\np_codcarrera apuestas.codigocarrera%type,\np_codcaballo apuestas.codigocaballo%type\n) RETURN NUMBER IS\nv_mult NUMBER;\nBEGIN\ncomprobarvacias(p_codcarrera, p_codcaballo);\nSELECT importeapostado * tantoauno INTO v_mult\nFROM apuestas\nWHERE codigocarrera = p_codcarrera AND codigocaballo = p_codcaballo;\ndbms_output.put_line('Hay que pagar al ganador un total de ' || v_mult || 'euros');\nRETURN v_mult;\nEND;\n/\nCREATE OR REPLACE PROCEDURE comprobarvacias (\np_codcarrera apuestas.codigocarrera%type,\np_codcaballo apuestas.codigocaballo%type\n) IS\nv_carrera        NUMBER;\nv_caballo        NUMBER;\nv_caballocarrera NUMBER;\nBEGIN\nSELECT COUNT (*) INTO v_carrera\nFROM apuestas\nWHERE codigocarrera = p_codcarrera;\nIF v_carrera = 0 THEN\nraise_application_error(-20112, 'No existe la carrera');\nEND IF;\nSELECT COUNT (*) INTO v_caballo\nFROM apuestas\nWHERE codigocaballo = p_codcaballo;\nIF v_caballo = 0 THEN\nraise_application_error(-20110, 'No se ha encontrado el caballo');\nEND IF;\nSELECT COUNT (*) INTO v_caballocarrera\nFROM participaciones\nWHERE codigocarrera = p_codcarrera AND codigocaballo = p_codcaballo;\nIF v_caballocarrera = 0 THEN\nraise_application_error(-20103, 'No existen caballos en esas en esas carreras');\nEND IF;\nEND;\n/\n</code></pre> <p>Ejercicio de prueba</p> <p>Este ejercicio est\u00e1 hecho para ser probado antes de utilizar la funci\u00f3n.</p> <pre><code>CREATE OR REPLACE PROCEDURE importetotal2 (\np_codcarrera apuestas.codigocarrera%type,\np_codcaballo apuestas.codigocaballo%type\n) IS\nv_mult NUMBER;\nBEGIN\ncomprobarvacias(p_codcarrera, p_codcaballo);\nSELECT importeapostado*tantoauno INTO v_mult\nFROM apuestas\nWHERE codigocarrera = p_codcarrera AND codigocaballo = p_codcaballo;\ndbms_output.put_line('Hay que pagar al ganador un total de ' || v_mult || 'euros');\nEND;\n/\nCREATE OR REPLACE PROCEDURE comprobarvacias (\np_codcarrera apuestas.codigocarrera%type,\np_codcaballo apuestas.codigocaballo%type\n) IS\nv_carrera        NUMBER;\nv_caballo        NUMBER;\nv_caballocarrera NUMBER;\nBEGIN\nSELECT COUNT (*) INTO v_carrera\nFROM apuestas\nWHERE codigocarrera = p_codcarrera;\nIF v_carrera = 0 THEN\nraise_application_error(-20112, 'No existe la carrera');\nEND IF;\nSELECT COUNT (*) INTO v_caballo\nFROM apuestas\nWHERE codigocaballo = p_codcaballo;\nIF v_caballo = 0 THEN\nraise_application_error(-20110, 'No se ha encontrado el caballo');\nEND IF;\nSELECT COUNT (*) INTO v_caballocarrera\nFROM participaciones\nWHERE codigocarrera = p_codcarrera AND codigocaballo = p_codcaballo;\nIF v_caballocarrera = 0 THEN\nraise_application_error(-20103, 'No existen caballos en esas en esas carreras');\nEND IF;\nEND;\n/\n</code></pre>"},{"location":"p4-grupal-plsql/ejercicio2/","title":"Ejercicio 2","text":"<p>Realizar un procedimiento llamado MostrarInformes que recibir\u00e1 tres par\u00e1metros. El primero determinar\u00e1 el tipo de informe que queremos obtener y los otros dos depender\u00e1n del tipo de informe.</p>"},{"location":"p4-grupal-plsql/ejercicio2/#codigo","title":"C\u00f3digo","text":"<ul> <li> <p>Mostrar Informes:</p> <pre><code>CREATE OR REPLACE PROCEDURE mostrarinformes(\np_tipoinforme VARCHAR2,\np_segundo carrerasprofesionales.fechahora%type,\np_tercero carrerasprofesionales.codigocarrera%type\n) IS\nBEGIN\nIF p_tipoinforme = 'tipo1' THEN\ninformetipo1(p_segundo);\nELSIF p_tipoinforme = 'tipo2' THEN\ninformetipo2(p_tercero);\nELSIF p_tipoinforme = 'tipo3' THEN\ninforme_tipo3(p_tercero);\nEND IF;\nEND mostrarinformes;\n/\n</code></pre> </li> <li> <p>Informe tipo1:</p> <pre><code>CREATE OR REPLACE PROCEDURE informetipo1 (\np_segundo carrerasprofesionales.fechahora%type\n) IS\nBEGIN\ndbms_output.put_line('Fecha: ' || p_segundo );\nmostrar_horas(p_segundo);\nEND informetipo1;\n/\nCREATE OR REPLACE PROCEDURE mostrar_horas(\np_segundo carrerasprofesionales.fechahora%type\n) IS\nCURSOR c_horas IS\nSELECT to_char(fechahora, 'HH24:MI') AS hora, importepremio\nFROM carrerasprofesionales\nWHERE to_char(fechahora, 'DD-MM-YYYY')=p_segundo;\nv_posicion participaciones.posicionfinal%type;\nv_ncaballo caballos.nombre%type;\nv_njockey  jockeys.nombre%type;\nBEGIN\nFOR i IN c_horas LOOP\nSELECT posicionfinal INTO v_posicion\nFROM participaciones\nWHERE codigocarrera IN (\nSELECT codigocarrera\nFROM carrerasprofesionales\nWHERE to_char(fechahora, 'DD-MM-YYYY')=p_segundo AND to_char(fechahora, 'HH24:MI') = i.hora\n);\nSELECT nombre INTO v_ncaballo\nFROM caballos\nWHERE codigocaballo IN (\nSELECT codigocaballo\nFROM participaciones\nWHERE posicionfinal=v_posicion AND codigocarrera IN (\nSELECT codigocarrera\nFROM carrerasprofesionales\nWHERE to_char(fechahora, 'DD-MM-YYYY')=p_segundo AND to_char(fechahora, 'HH24:MI') = i.hora\n)\n);\nSELECT nombre INTO v_njockey\nFROM jockeys\nWHERE dni IN (\nSELECT dnijockey\nFROM participaciones\nWHERE posicionfinal=v_posicion AND codigocarrera IN (\nSELECT codigocarrera\nFROM carrerasprofesionales\nWHERE to_char(fechahora, 'DD-MM-YYYY')=p_segundo AND to_char(fechahora, 'HH24:MI') = i.hora\n)\n);\ndbms_output.put_line('Hora: ' || i.hora || ' Importe Premio: ' || i.importepremio );\ndbms_output.put_line( 'Clasificaci\u00f3n: ' );\ndbms_output.put_line( v_posicion || ' ' || v_ncaballo || ' ' || v_njockey );\nEND LOOP;\nEND mostrar_horas;\n/\n</code></pre> </li> <li> <p>Informe tipo2:</p> <pre><code>CREATE OR REPLACE PROCEDURE informetipo2 (\np_tercero carrerasprofesionales.codigocarrera%type\n) IS\nBEGIN\ndbms_output.put_line('C\u00f3digo Carrera: ' || p_tercero );\nmostrar_fecha(p_tercero);\nmostrar_horas2(p_tercero);\nimporte_premio(p_tercero);\ncaballos_nacidos(p_tercero);\nmostrar_clasificacion(p_tercero);\nEND informetipo2;\n/\nCREATE OR REPLACE PROCEDURE mostrar_fecha (\np_tercero carrerasprofesionales.codigocarrera%type\n) IS\nv_fecha carrerasprofesionales.fechahora%type;\nBEGIN\nSELECT fechahora INTO v_fecha\nFROM carrerasprofesionales\nWHERE codigocarrera=p_tercero;\ndbms_output.put_line('Fecha: ' || v_fecha );\nEND mostrar_fecha;\n/\nCREATE OR REPLACE PROCEDURE mostrar_horas2(\np_tercero carrerasprofesionales.codigocarrera%type\n) IS\nv_hora caballos.nombre%type;\nBEGIN\nSELECT to_char(fechahora, 'HH24:MM') INTO v_hora\nFROM carrerasprofesionales\nWHERE codigocarrera=p_tercero;\ndbms_output.put_line('Hora: ' || v_hora );\nEND mostrar_horas2;\n/\nCREATE OR REPLACE PROCEDURE importe_premio(\np_tercero carrerasprofesionales.codigocarrera%type\n) IS\nv_importe carrerasprofesionales.importepremio%type;\nv_limite  carrerasprofesionales.limiteapuesta%type;\nBEGIN\nSELECT importepremio INTO v_importe\nFROM carrerasprofesionales\nWHERE codigocarrera=p_tercero;\nSELECT limiteapuesta INTO v_limite\nFROM carrerasprofesionales\nWHERE codigocarrera=p_tercero;\ndbms_output.put_line('Importe Premio: ' || v_importe || '       ' || 'L\u00edmite apuesta: ' || v_limite);\nEND importe_premio;\n/\nCREATE OR REPLACE PROCEDURE caballos_nacidos(\np_tercero carrerasprofesionales.codigocarrera%type\n) IS\nv_min carrerasprofesionales.fechanacmin%type;\nv_mac carrerasprofesionales.fechanacmac%type;\nBEGIN\nSELECT fechanacmin INTO v_min\nFROM carrerasprofesionales\nWHERE codigocarrera=p_tercero;\nSELECT fechanacmac INTO v_mac\nFROM carrerasprofesionales\nWHERE codigocarrera=p_tercero;\ndbms_output.put_line('Caballos nacidos de : ' || v_min || ' a ' || v_mac);\nEND caballos_nacidos;\n/\nCREATE OR REPLACE PROCEDURE mostrar_clasificacion(\np_tercero carrerasprofesionales.codigocarrera%type\n) IS\nCURSOR c_posiciones IS\nSELECT posicionfinal\nFROM participaciones\nWHERE codigocarrera=p_tercero;\nv_ncaballo caballos.nombre%type;\nv_njockey  jockeys.nombre%type;\nBEGIN\nFOR i IN c_posiciones LOOP\nSELECT nombre INTO v_ncaballo\nFROM caballos\nWHERE codigocaballo IN (\nSELECT codigocaballo\nFROM participaciones\nWHERE posicionfinal=i.posicionfinal AND codigocarrera IN (\nSELECT codigocarrera\nFROM carrerasprofesionales\nWHERE codigocarrera=p_tercero\n)\n);\nSELECT nombre INTO v_njockey\nFROM jockeys\nWHERE dni IN (\nSELECT dnijockey\nFROM participaciones\nWHERE posicionfinal=i.posicionfinal AND codigocarrera IN (\nSELECT codigocarrera\nFROM carrerasprofesionales\nWHERE codigocarrera=p_tercero\n)\n);\ndbms_output.put_line( i.posicionfinal || ' \u00ba ' || v_ncaballo || ' ' || v_njockey );\nEND LOOP;\nEND mostrar_clasificacion;\n/\n</code></pre> </li> <li> <p>Informe tipo3:</p> <pre><code>CREATE OR REPLACE PROCEDURE informe_tipo3(\np_tercero carrerasprofesionales.codigocarrera%type\n) IS\nBEGIN\ncomprobar_fecha(p_tercero);\ndbms_output.put_line('C\u00f3digo Carrera: ' || p_tercero );\nmostrar_fecha(p_tercero);\nmostrar_horas3(p_tercero);\ncaballos_participantes(p_tercero);\nEND informe_tipo3;\n/\nCREATE OR REPLACE PROCEDURE mostrar_horas3(\np_tercero carrerasprofesionales.codigocarrera%type\n) IS\nv_hora   date;\nv_limite carrerasprofesionales.limiteapuesta%type;\nBEGIN\nSELECT to_char(fechahora, 'HH24:MM') INTO v_hora\nFROM carrerasprofesionales\nWHERE codigocarrera=p_tercero;\nSELECT limiteapuesta INTO v_limite\nFROM carrerasprofesionales\nWHERE codigocarrera=p_tercero;\ndbms_output.put_line('Hora: ' || v_hora || ' Limite apuesta: ' || v_limite );\nEND mostrar_horas3;\n/\nCREATE OR REPLACE PROCEDURE caballos_participantes(\np_tercero carrerasprofesionales.codigocarrera%type\n) IS\nCURSOR c_caballos IS\nSELECT nombre\nFROM caballos\nWHERE codigocaballo IN (\nSELECT codigocaballo\nFROM participaciones\nWHERE codigocarrera IN (\nSELECT codigocarrera\nFROM carrerasprofesionales\nWHERE codigocarrera=p_tercero\n)\n);\nv_jockey      jockeys.nombre%type;\nv_tantoauno   apuestas.tantoauno%type;\nn_victorias   NUMBER;\nn_fechaultima carrerasprofesionales.fechahora%type;\nn_posicion    participaciones.posicionfinal%type;\nBEGIN\ndbms_output.put_line( 'Caballos Participantes: ' );\nFOR i IN c_caballos LOOP\nSELECT nombre INTO v_jockey\nFROM jockeys\nWHERE dni IN (\nSELECT dnijockey\nFROM participaciones\nWHERE codigocaballo IN (\nSELECT codigocaballo\nFROM caballos\nWHERE nombre=i.nombre\n)\n);\nSELECT COUNT(posicionfinal) INTO n_victorias\nFROM participaciones\nWHERE posicionfinal=1 AND codigocaballo IN (\nSELECT codigocaballo\nFROM caballos\nWHERE nombre=i.nombre\n);\nSELECT MAX(fechahora) INTO n_fechaultima\nFROM carrerasprofesionales\nWHERE codigocarrera IN (\nSELECT codigocarrera\nFROM participaciones\nWHERE codigocaballo IN (\nSELECT codigocaballo\nFROM caballos\nWHERE nombre=i.nombre\n)\n);\nSELECT tantoauno\nFROM apuestas\nWHERE codigocarrera IN (\nSELECT codigocarrera\nFROM carrerasprofesionales\nWHERE codigocarrera=p_tercero AND codigocaballo IN (\nSELECT codigocaballo\nFROM caballos\nWHERE nombre=i.nombre\n)\n);\nSELECT posicionfinal INTO n_posicion\nFROM participaciones\nWHERE codigocarrera IN (\nSELECT codigocarrera\nFROM carrerasprofesionales\nWHERE fechahora=n_fechaultima AND codigocaballo IN (\nSELECT codigocaballo\nFROM caballos\nWHERE nombre=i.nombre\n)\n);\ndbms_output.put_line( 'Nombre: ' || i.nombre || ' Jockey: ' || v_jockey || ' Tanto a uno: ' || v_tantoauno || ' NumVictorias: ' || n_victorias || ' Ultima Participacion: ' || n_fechaultima || ' Posicion: ' || n_posicion );\nEND LOOP;\nEND caballos_participantes;\n/\n</code></pre> </li> <li> <p>Excepci\u00f3n de errores:</p> <pre><code>CREATE OR REPLACE PROCEDURE comprobar_fecha (\np_tercero carrerasprofesionales.codigocarrera%type\n) IS\nv_fecha carrerasprofesionales.fechahora%type;\nBEGIN\nSELECT fechahora INTO v_fecha\nFROM carrerasprofesionales\nWHERE codigocarrera=p_tercero;\nIF v_fecha &lt; '01-01-2017' THEN\nraise_application_error(-20001, 'La carrera ya se ha celebrado');\nEND IF;\nEND;\n/\n</code></pre> </li> </ul>"},{"location":"p4-grupal-plsql/ejercicio2/#prueba-de-funcionamiento","title":"Prueba de funcionamiento","text":"<ul> <li> <p>Tipo 1:</p> <pre><code>SQL&gt; exec MostrarInformes('tipo1',08-01-2017,1);\nFecha: 08-JAN-17\nHora: 09:00      Importe Premio: 8750\nClasificaci\u00f3n:  1 \u00ba Dagoberto N. de Julian\n4 \u00ba Mayo J.Gelabert\n7 \u00ba Daniela B.Fayos\n</code></pre> </li> <li> <p>Tipo 2:</p> <pre><code>SQL&gt; exec MostrarInformes('tipo2',08-01-2017,1);\nC\u00f3digo Carrera: 1\nFecha: 08-JAN-17\nHora: 09:01\nImporte Premio: 8750       L\u00edmite apuesta: 650\nCaballos nacidos de : 01-JAN-10 a 31-DEC-12\n1 \u00ba Dagoberto N. de Julian\n4 \u00ba Mayo J.Gelabert\n7 \u00ba Daniela B.Fayos\nPL/SQL procedure successfully completed.\n</code></pre> </li> <li> <p>Tipo 3:</p> <pre><code>SQL&gt; exec MostrarInformes('tipo3',1);\nC\u00f3digo Carrera: 1\nFecha: 08-JAN-17\nHora: 09:01 Limite apuesta: 650\nCaballos Participantes:\nNombre: Dagoberto Jockey: N. de Julian Tanto a uno: 6.8  NumVictorias: 1 Ultima Participacion: 13-NOV-16 Posicion: 8\nNombre: Mayo Jockey: J.Gelabert Tanto a uno: 4.3  NumVictorias: 1 Ultima Participacion: 13-NOV-16 Posicion: 7\nNombre: Daniela Jockey: B.Fayos Tanto a uno: 2.1 NumVictorias: 0 Ultima Participacion: 13-NOV-16 Posicion: 5\nPL/SQL procedure successfully completed.\n</code></pre> </li> </ul>"},{"location":"p4-grupal-plsql/ejercicio3-postgres/","title":"Ejercicio 3 PostgreSQL","text":"<p>Realiza un trigger que controle que solo participan en una carrera caballos en el rango de edades permitido. Si es necesario, cambia el modelo de datos</p> <pre><code>CREATE OR REPLACE FUNCTION fn_comprobar_edad(p_codigocarrera participaciones.codigocarrera%TYPE, p_codigocaballo participaciones.codigocaballo%TYPE)\nRETURNS boolean\nAS $$\nDECLARE\nv_fechanac_caballo caballos.fechanac%TYPE;\nv_fechanacmin_carreras carrerasprofesionales.fechanacmin%TYPE;\nv_fechanacmax_carreras carrerasprofesionales.fechanacmax%TYPE;\nBEGIN\nSELECT fechanac\nINTO v_fechanac_caballo\nFROM caballos\nWHERE codigocaballo = p_codigocaballo;\nSELECT fechanacmin, fechanacmax\nINTO v_fechanacmin_carreras, v_fechanacmax_carreras\nFROM carrerasprofesionales\nWHERE codigocarrera = p_codigocarrera;\nIF v_fechanac_caballo &lt;= v_fechanacmax_carreras AND v_fechanac_caballo &gt;= v_fechanacmin_carreras THEN\nRETURN TRUE;\nELSE\nRETURN FALSE;\nEND IF;\nEND;\n$$ LANGUAGE plpgsql;\n-- (1)!\n</code></pre> <ol> <li>Esta es la funci\u00f3n que comprueba que la edad de un caballo sea permitida seg\u00fan la carrera. Si la edad del caballo est\u00e1 en el rango permitido se devuelve <code>TRUE</code>, sino <code>FALSE</code>.</li> </ol> <pre><code>CREATE OR REPLACE FUNCTION fn_monitorizar_participaciones()\nRETURNS TRIGGER AS $$\nBEGIN\nIF fn_comprobar_edad(NEW.codigocarrera, NEW.codigocaballo) = FALSE THEN\nRAISE EXCEPTION 'El caballo con codigo % no esta en el rango de edades permitido para la carrera %', NEW.codigocaballo, NEW.codigocarrera;\nEND IF;\nRETURN NEW;\nEND;\n$$ LANGUAGE plpgsql;\n-- (1)!\n</code></pre> <ol> <li>Esta es la funci\u00f3n que saltar\u00e1 cuando se ejecute el trigger. Desde aqu\u00ed se llama a la funci\u00f3n anterior.</li> </ol> <pre><code>CREATE TRIGGER tr_monitorizar_participaciones\nBEFORE INSERT OR UPDATE ON participaciones\nFOR EACH ROW\nEXECUTE FUNCTION fn_monitorizar_participaciones();\n-- (1)!\n</code></pre> <ol> <li>Este es el bloque de c\u00f3digo principal, el trigger que monitoriza las participaciones. Desde aqu\u00ed se llama a la funci\u00f3n anterior.</li> </ol> <p>Muestro la tabla <code>carrerasprofesionales</code>:</p> <pre><code>hipodromo=&gt; select * from carrerasprofesionales;\ncodigocarrera |      fechahora      | importepremio | limiteapuesta | fechanacmin | fechanacmax\n---------------+---------------------+---------------+---------------+-------------+-------------\n1 | 2017-01-08 09:30:00 |       8750.00 |        650.00 | 2010-01-01  | 2012-12-31\n2 | 2017-01-08 10:00:00 |      11156.00 |        800.00 | 2010-01-01  | 2012-12-31\n3 | 2017-01-15 11:00:00 |       6125.00 |        450.00 | 2010-01-01  | 2012-12-31\n4 | 2017-01-15 12:00:00 |       7857.00 |        520.00 | 2010-01-01  | 2012-12-31\n5 | 2017-01-22 13:00:00 |       7000.00 |        470.00 | 2009-06-01  | 2012-12-31\n6 | 2017-01-22 14:00:00 |       6125.00 |        450.00 | 2009-06-01  | 2012-12-31\n7 | 2016-11-06 11:00:00 |       8750.00 |        650.00 | 2009-06-01  | 2012-12-31\n8 | 2016-11-06 12:00:00 |      11167.00 |        800.00 | 2009-06-01  | 2012-12-31\n9 | 2016-11-06 13:00:00 |       7000.00 |        470.00 | 2010-01-01  | 2013-06-01\n10 | 2016-11-13 10:00:00 |       8750.00 |        650.00 | 2010-01-01  | 2013-06-01\n11 | 2016-11-13 10:30:00 |       7000.00 |        470.00 | 2010-01-01  | 2013-06-01\n12 | 2016-11-13 12:00:00 |       6125.00 |        450.00 | 2010-01-01  | 2013-06-01\n(12 rows)\n</code></pre> <p>Muestro la tabla <code>caballos</code>:</p> <pre><code>hipodromo=&gt; select * from caballos;\ncodigocaballo | dnipropietario |    nombre     |  fechanac  |        raza\n---------------+----------------+---------------+------------+--------------------\n1 | 21913124n      | Wad Vison     | 2011-11-11 | Quarter Horse\n2 | Z7782152S      | Dagoberto     | 2010-10-10 | Purasangre espa\u00f1ol\n3 | 83069279H      | Atreus        | 2011-12-24 | Shagya \u00c1rabe\n4 | X58056225B     | Mayo          | 2010-03-15 | Purasangre espa\u00f1ol\n5 | 21913124n      | Argos         | 2012-04-04 | Purasangre ingl\u00e9s\n6 | Z7782152S      | Daniela       | 2011-06-06 | Shagya \u00c1rabe\n7 | 83069279H      | Kayak         | 2010-02-14 | Purasangre espa\u00f1ol\n8 | X58056225B     | Charming Star | 2011-09-23 | Quarter Horse\n9 | 21913124n      | Perdigon      | 2012-06-24 | Purasangre espa\u00f1ol\n10 | Z7782152S      | Innuendo      | 2011-01-31 | Darley Arabian\n(10 rows)\n</code></pre> <p>Como podemos ver, con el estado actual de la base de datos no podr\u00edamos probar el trigger ya que todos los caballos est\u00e1n dentro del rango de fechas de nacimiento permitido por las carreras.</p> <p>Tengo que insertar un caballo que se salga del rango:</p> <pre><code>hipodromo=&gt; INSERT INTO caballos values (11,'21913124n', 'test', to_date('11-11-2015', 'DD-MM-YYYY'), 'test' );\nINSERT 0 1\n</code></pre> <p>El trigger evitar\u00e1 que inserte este caballo en <code>participaciones</code>, en cualquier carrera, ya que se sale de cualquier rango de edades permitido:</p> <pre><code>hipodromo=&gt; INSERT INTO participaciones values(1, 11, 'Y6857984L', 1, 1);\nERROR:  El caballo con codigo 11 no esta en el rango de edades permitido para la carrera 1\nCONTEXT:  PL/pgSQL function fn_monitorizar_participaciones() line 4 at RAISE\n</code></pre> <p>En cambio, si intento insertar un caballo que est\u00e9 dentro del rango de edades permitido, dejar\u00e1 insertar:</p> <pre><code>hipodromo=&gt; INSERT INTO participaciones values(1, 10, 'Y6857984L', 1, 1);\nINSERT 0 1\n</code></pre>"},{"location":"p4-grupal-plsql/ejercicio3/","title":"Ejercicio 3","text":"<p>Realiza un trigger que controle que solo participan en una carrera caballos en el rango de edades permitido. Si es necesario, cambia el modelo de datos</p> <pre><code>CREATE OR REPLACE PROCEDURE comprobar_edad(p_codigocarrera participaciones.codigocarrera%TYPE, p_codigocaballo participaciones.codigocaballo%TYPE, p_control OUT BOOLEAN)\nIS\nv_fechanac_caballo caballos.fechanac%TYPE;\nv_fechanacmin_carreras carrerasprofesionales.fechanacmin%TYPE;\nv_fechanacmac_carreras carrerasprofesionales.fechanacmac%TYPE;\nBEGIN\nSELECT fechanac\nINTO v_fechanac_caballo\nFROM caballos\nWHERE codigocaballo = p_codigocaballo;\nSELECT fechanacmin, fechanacmac\nINTO v_fechanacmin_carreras, v_fechanacmac_carreras\nFROM carrerasprofesionales\nWHERE codigocarrera = p_codigocarrera;\nIF v_fechanac_caballo &lt;= v_fechanacmac_carreras AND v_fechanac_caballo &gt;= v_fechanacmin_carreras THEN\np_control := TRUE;\nELSE\np_control := FALSE;\nEND IF;\nEXCEPTION\nWHEN NO_DATA_FOUND THEN\nRAISE_APPLICATION_ERROR(-20002, 'La carrera o caballo, o ambos, que estas intentando insertar no existen');\nEND;\n/\n-- (1)!\n</code></pre> <ol> <li>Este procedimiento comprueba que la edad de un caballo sea permitida seg\u00fan la carrera. Si la edad del caballo est\u00e1 en el rango permitido o no, lo controla el par\u00e1metro OUT BOOLEAN</li> </ol> <pre><code>CREATE OR REPLACE TRIGGER monitorizar_participaciones\nBEFORE INSERT OR UPDATE ON participaciones\nFOR EACH ROW\nDECLARE\nv_control BOOLEAN;\nBEGIN\ncomprobar_edad(:NEW.codigocarrera,:NEW.codigocaballo,v_control);\nIF v_control = FALSE THEN\nRAISE_APPLICATION_ERROR(-20001, 'El caballo con codigo ' || :NEW.codigocaballo || ' no esta en el rango de edades permitido para la carrera ' || :NEW.codigocarrera);\nEND IF;\nEND;\n/\n-- (1)!\n</code></pre> <ol> <li>Este es el bloque de c\u00f3digo principal, el trigger que monitoriza las participaciones. Desde aqu\u00ed se llama al procedimiento hijo anterior</li> </ol> <p>Danger</p> <p>No se pueden llamar a funciones dentro de un trigger, s\u00f3lo a procedimientos</p> <p>Muestro la tabla <code>carrerasprofesionales</code>:</p> <p></p> <p>Muestro la tabla <code>caballos</code>:</p> <p></p> <p>Como podemos ver, con el estado actual de la base de datos no podr\u00edamos probar el trigger ya que todos los caballos est\u00e1n dentro del rango de fechas de nacimiento permitido por las carreras.</p> <p>Tengo que insertar un caballo que se salga del rango:</p> <pre><code>INSERT INTO caballos values (11,'21913124n', 'test', to_date('11-11-2015', 'DD-MM-YYYY'), 'test' );\n</code></pre> <p>El trigger evitar\u00e1 que inserte este caballo en <code>participaciones</code>, en cualquier carrera, ya que se sale de cualquier rango de edades permitido:</p> <pre><code>INSERT INTO participaciones values(1, 11, 'Y6857984L', 1, 1);\nINSERT INTO participaciones values(1, 11, 'Y6857984L', 1, 1)\n*\nERROR at line 1:\nORA-20001: El caballo con codigo 11 no esta en el rango de edades permitido para la carrera 1\nORA-06512: at \"HIPODROMO.MONITORIZAR_PARTICIPACIONES\", line 6\nORA-04088: error during execution of trigger 'HIPODROMO.MONITORIZAR_PARTICIPACIONES'\n</code></pre> <p>En cambio, si intento insertar un caballo que est\u00e9 dentro del rango de edades permitido, dejar\u00e1 insertar:</p> <pre><code>INSERT INTO participaciones values(1, 10, 'Y6857984L', 1, 1);\n1 row created.\n</code></pre> <p>Como funcionalidad adicional y fuera de enunciado, he a\u00f1adido una excepci\u00f3n para manejar el error que ocurre en caso de que intentemos insertar una carrera o un caballo que no existen:</p> <pre><code>INSERT INTO participaciones values(1, 100, 'Y6857984L', 1, 1);\nINSERT INTO participaciones values(1, 100, 'Y6857984L', 1, 1)\n*\nERROR at line 1:\nORA-20002: La carrera o caballo, o ambos, que estas intentando insertar no existen\nORA-06512: at \"HIPODROMO.COMPROBAR_EDAD\", line 24\nORA-06512: at \"HIPODROMO.MONITORIZAR_PARTICIPACIONES\", line 4\nORA-04088: error during execution of trigger 'HIPODROMO.MONITORIZAR_PARTICIPACIONES'\n</code></pre>"},{"location":"p4-grupal-plsql/ejercicio4/","title":"Ejercicio 4","text":"<p>A\u00f1ade una columna email en la tabla Clientes y rell\u00e9nala con datos consistentes. Realiza un trigger que cuando se actualice la tabla Participaciones para introducir los resultados de la carrera env\u00ede un correo electr\u00f3nico a todos los apostantes del caballo ganador inform\u00e1ndoles del importe apostado y el beneficio obtenido</p>"},{"location":"p4-grupal-plsql/ejercicio4/#modificacion-de-la-tabla-y-los-datos","title":"Modificaci\u00f3n de la tabla y los datos","text":"<pre><code>ALTER TABLE clientes ADD email varchar2(50);\nUPDATE clientes SET email = 'mariaromeroangulo@correo.com' WHERE dni = '28841115N';\nUPDATE clientes SET email = 'johnsmith@correo.com' WHERE dni = 'Z4128090D';\nUPDATE clientes SET email = 'joseltorresandrades@correo.com' WHERE dni = '41500351W';\nUPDATE clientes SET email = 'desaconnif@correo.com' WHERE dni = 'X5339679E';\nUPDATE clientes SET email = 'mayumiozaki@correo.com' WHERE dni = '18498310P';\nUPDATE clientes SET email = 'pacojovercobos@correo.com' WHERE dni = '02411561B';\n</code></pre>"},{"location":"p4-grupal-plsql/ejercicio4/#envio-de-correos-mediante-utl_mail","title":"Env\u00edo de correos mediante UTL_MAIL","text":"<p>Para poder enviar correos desde PLSQL seguir los siguientes pasos conect\u00e1ndose como sysdba.</p> <pre><code>@$ORACLE_HOME/rdbms/admin/utlmail.sql\n@$ORACLE_HOME/rdbms/admin/prvtmail.plb\nALTER SYSTEM SET smtp_out_server='localhost' SCOPE=BOTH;\nBEGIN\ndbms_network_acl_admin.create_acl(\nacl =&gt; 'aclcorreo.xml',\ndescription =&gt; 'Enviar correos',\nprincipal =&gt; 'ADMIN',\nis_grant =&gt; true,\nprivilege =&gt; 'connect',\nstart_date =&gt; systimestamp,\nend_date =&gt; NULL\n);\nCOMMIT;\nEND;\n/\nBEGIN\ndbms_network_acl_admin.assign_acl (\nacl =&gt; 'aclcorreo.xml',\nhost =&gt; '*',\nlower_port =&gt; NULL,\nupper_port =&gt; NULL\n);\nCOMMIT;\nEND;\n/\ngrant execute on UTL_MAIL to ADMIN;\n</code></pre> <p>A continuaci\u00f3n ya podremos conectarnos con ADMIN y enviar un correo de prueba:</p> <pre><code>BEGIN\nutl_mail.send (\nsender =&gt; 'ara.fer.mor@gmail.com',\nrecipients =&gt; 'ara.fer.mor@gmail.com',\nsubject =&gt; 'Prueba',\nmessage =&gt; 'Esto es un mensaje de prueba.'\n);\nEND;\n/\n</code></pre> <p></p>"},{"location":"p4-grupal-plsql/ejercicio4/#creacion-del-trigger","title":"Creaci\u00f3n del trigger","text":"<pre><code>CREATE OR REPLACE TRIGGER enviar_correo_clientes\nAFTER INSERT OR UPDATE ON participaciones\nFOR EACH ROW\nDECLARE\n-- Creo un cursor para recorrer todos los clientes que han apostado por el caballo insertado y la carrera\nCURSOR c_clientes IS\nSELECT dni, nombre, apellido1, email\nFROM clientes\nWHERE dni in (select dniCliente from apuestas where codigoCaballo=:NEW.codigoCaballo AND codigoCarrera = :NEW.codigoCarrera);\n-- Declaraci\u00f3n de variables\nv_importeApostado apuestas.importeApostado%TYPE;\nv_tantoauno apuestas.tantoAUno%TYPE;\nv_beneficios NUMBER;\nBEGIN\n-- Si el caballo ha ganado la carrera, enviar correo a todos los clientes que hayan apostado por \u00e9l\nIF :NEW.posicionFinal = 1 THEN\nFOR cliente IN c_clientes LOOP\n-- Obtener el importe apostado y el tanto a uno de cada cliente \nSELECT importeApostado,tantoAUno\nINTO v_importeApostado,v_tantoAUno\nFROM apuestas\nWHERE codigoCaballo=:NEW.codigoCaballo AND dniCliente=cliente.dni;\n-- Calcular el beneficio obtenido por cada cliente\nv_beneficios := (v_tantoAUno/100) * v_importeApostado;\n-- Enviar correo electr\u00f3nico a cada cliente\nUTL_MAIL.SEND(\nsender =&gt; 'ara.fer.mor@gmail.com@gmail.com',\nrecipients =&gt; cliente.email,\nsubject =&gt; 'Resultados de la carrera',\nmessage =&gt; 'Estimado/a ' || cliente.nombre || ' ' || cliente.apellido1||',' ||CHR(10)|| 'su caballo ha ganado la carrera!!!'||CHR(10)||CHR(10)||'El importe apostado ha sido: ' || v_importeApostado || CHR(10)||'Y el beneficio obtenido: ' || v_beneficios || CHR(10)||CHR(10)|| 'Gracias por su apuesta!' ||CHR(10)||CHR(10)||'Atentamente,'||CHR(10)||'El equipo del hipodromo.',\nmime_type =&gt; 'text/plain; charset=us-ascii'\n);\nEND LOOP;\nEND IF;\nEND enviar_correo_clientes;\n/\n</code></pre>"},{"location":"p4-grupal-plsql/ejercicio4/#prueba","title":"Prueba","text":"<pre><code>insert into clientes values ('49034862N', 'Arantxa', 'Fernandez', '', 'Avenida Ram\u00f3n y Cajal', 'Dos Hermanas', 'Sevilla', '628806858', 'ara.fer.mor@gmail.com');\ninsert into carrerasProfesionales  values (13, to_date('11-12-2022 12:00' , 'DD-MM-YYYY HH24:MI'), 6125, 450, '01-01-2020', '01-06-2020');\ninsert into apuestas values ('49034862N',13 ,3 ,300 ,50.15);\ninsert into participaciones values(13, 3, 'Y6857984L', 1, 1);\n</code></pre> <p>Comandos que me han ayudado a solucionar algunos problemas con UTL_MAIL</p> <p>Para ver las ACL creadas y los privilegios asignados a esas ACLs:</p> <pre><code>select * from dba_network_acls;\nselect * from dba_network_acl_privileges;\n</code></pre> <p>Procedimientos para borrar un privilegio de una ACL y para borrar una ACL:</p> <pre><code>BEGIN\nDBMS_NETWORK_ACL_ADMIN.DELETE_PRIVILEGE(\nacl         =&gt; 'aclmail.xml',\nprincipal   =&gt; 'ADMIN');\nEND;\n/\nBEGIN\nDBMS_NETWORK_ACL_ADMIN.DROP_ACL(\nacl =&gt; 'aclmail.xml');\nEND;\n/\n</code></pre>"},{"location":"p4-grupal-plsql/ejercicio5-postgres/","title":"Ejercicio 5 PostgreSQL","text":"<p>A\u00f1ade una columna a la tabla Propietarios llamada ImporteTotalPremios. Rell\u00e9nala con un procedimiento o una sentencia SQL considerando los premios que han conseguido los caballos de cada uno de ellos por sus victorias en las carreras. Haz un trigger que la mantenga actualizada cada vez que se realice cualquier cambio en la tabla Participaciones que afecte a este total.</p>"},{"location":"p4-grupal-plsql/ejercicio5-postgres/#pasos-previos","title":"Pasos previos","text":"<p>Hay que a\u00f1adir la nueva columna a propietarios:</p> <pre><code>ALTER TABLE propietarios ADD COLUMN IMPORTETOTALPREMIOS NUMERIC;\n</code></pre>"},{"location":"p4-grupal-plsql/ejercicio5-postgres/#codigo","title":"C\u00f3digo","text":"<pre><code>CREATE OR REPLACE PROCEDURE pr_importe_total()\nAS\n$$\nDECLARE\nc_propietarios CURSOR FOR\nSELECT nombre\nFROM propietarios\nWHERE dni IN (\nSELECT dnipropietario\nFROM caballos\nWHERE codigocaballo IN (\nSELECT codigocaballo\nFROM participaciones\nWHERE posicionfinal=1\n)\n);\nv_importe NUMERIC;\nBEGIN\nFOR i IN c_propietarios LOOP\nSELECT SUM(importepremio) INTO v_importe\nFROM carrerasprofesionales\nWHERE codigocarrera IN (\nSELECT codigocarrera\nFROM participaciones\nWHERE posicionfinal=1 AND codigocaballo IN (\nSELECT codigocaballo\nFROM caballos\nWHERE dnipropietario IN (\nSELECT dni\nFROM propietarios\nWHERE nombre=i.nombre\n)\n)\n);\nUPDATE propietarios\nSET\nimportetotalpremios=v_importe\nWHERE\nnombre=i.nombre;\nEND LOOP;\nEND;\n$$ LANGUAGE plpgsql;\n</code></pre> <pre><code>CREATE OR REPLACE FUNCTION fn_nueva_carrera()\nRETURNS TRIGGER AS $$\nBEGIN\nCALL pr_importe_total();\nRETURN NEW;\nEND;\n$$ LANGUAGE plpgsql;\n</code></pre> <pre><code>CREATE TRIGGER tr_nueva_carrera\nAFTER INSERT OR UPDATE OR DELETE ON participaciones\nFOR EACH ROW\nEXECUTE FUNCTION fn_nueva_carrera();\n</code></pre>"},{"location":"p4-grupal-plsql/ejercicio5-postgres/#pruebas-de-funcionamiento","title":"Pruebas de funcionamiento","text":"<ul> <li> <p>Probamos el primer procedimiento:</p> <pre><code>hipodromo=&gt; call pr_importe_total();\nCALL\nhipodromo=&gt; select * from propietarios;\ndni     | nombre  | apellido1 | apellido2 | cuotamensual | importetotalpremios\n------------+---------+-----------+-----------+--------------+---------------------\n21913124n  | Horacio | Arreguy   | Fazzio    |       250.00 |            16607.00\nZ7782152S  | Robert  | Chase     |           |       300.00 |             8750.00\n83069279H  | Lucas   | Mart\u00ednez  | Mu\u00f1oz     |       200.70 |             7000.00\nX58056225B | Gustavo | Scarpello |           |       100.00 |             7000.00\n(4 rows)\n</code></pre> </li> <li> <p>Instertamos nueva informaci\u00f3n en las tablas carrerasProfesionales y participaciones para comprobar si el trigger funciona correctamente:</p> <pre><code>hipodromo=&gt; insert into carrerasProfesionales values (13, TO_TIMESTAMP('20-11-2016 13:00', 'DD-MM-YYYY HH24:MI'), 8000, 650, TO_DATE('01-01-2010', 'DD-MM-YYYY'), TO_DATE('01-06-2013', 'DD-MM-YYYY'));\nINSERT 0 1\nhipodromo=&gt; insert into participaciones values(13, 7, 'X6785562X', 1, 1);\nINSERT 0 1\nhipodromo=&gt; insert into participaciones values(13, 4, '85108890N', 5, 5);\nINSERT 0 1\nhipodromo=&gt; select * from propietarios;\ndni     | nombre  | apellido1 | apellido2 | cuotamensual | importetotalpremios\n------------+---------+-----------+-----------+--------------+---------------------\n21913124n  | Horacio | Arreguy   | Fazzio    |       250.00 |            16607.00\nZ7782152S  | Robert  | Chase     |           |       300.00 |             8750.00\n83069279H  | Lucas   | Mart\u00ednez  | Mu\u00f1oz     |       200.70 |            15000.00\nX58056225B | Gustavo | Scarpello |           |       100.00 |             7000.00\n(4 rows)\n</code></pre> </li> </ul>"},{"location":"p4-grupal-plsql/ejercicio5/","title":"Ejercicio 5","text":"<p>A\u00f1ade una columna a la tabla Propietarios llamada ImporteTotalPremios. Rell\u00e9nala con un procedimiento o una sentencia SQL considerando los premios que han conseguido los caballos de cada uno de ellos por sus victorias en las carreras. Haz un trigger que la mantenga actualizada cada vez que se realice cualquier cambio en la tabla Participaciones que afecte a este total.</p>"},{"location":"p4-grupal-plsql/ejercicio5/#codigo","title":"C\u00f3digo","text":"<pre><code>CREATE OR REPLACE PROCEDURE importe_total IS\nCURSOR c_propietarios IS\nSELECT nombre\nFROM propietarios\nWHERE dni IN (\nSELECT dnipropietario\nFROM caballos\nWHERE codigocaballo IN (\nSELECT codigocaballo\nFROM participaciones\nWHERE posicionfinal=1\n)\n);\nv_importe NUMBER;\nBEGIN\nFOR i IN c_propietarios LOOP\nSELECT SUM(importepremio) INTO v_importe\nFROM carrerasprofesionales\nWHERE codigocarrera IN (\nSELECT codigocarrera\nFROM participaciones\nWHERE posicionfinal=1 AND codigocaballo IN (\nSELECT codigocaballo\nFROM caballos\nWHERE dnipropietario IN (\nSELECT dni\nFROM propietarios\nWHERE nombre=i.nombre\n)\n)\n);\nUPDATE propietarios\nSET\nimportetotalpremios=v_importe\nWHERE\nnombre=i.nombre;\nEND LOOP;\nEND importe_total;\n/\nCREATE OR REPLACE TRIGGER nueva_carrera\nBEFORE INSERT OR UPDATE ON participaciones\nBEGIN\nimporte_total;\nEND;\n/\n</code></pre>"},{"location":"p4-grupal-plsql/ejercicio5/#prueba-de-funcionamiento","title":"Prueba de funcionamiento","text":"<ul> <li> <p>Probamos el primer procedimiento:</p> <pre><code>SQL&gt; exec importe_total;\nProcedimiento PL/SQL terminado correctamente.\nSQL&gt; select *\n2  from propietarios;\nDNI        NOMBRE          APELLIDO1       APELLIDO2       CUOTAMENSUAL IMPORTETOTALPREMIOS\n---------- --------------- --------------- --------------- ------------ -------------------\n21913124n  Horacio         Arreguy         Fazzio          250          16607\nZ7782152S  Robert          Chase                           300          8750\n83069279H  Lucas           Martinez        Munoz           200,7        7000\nX58056225B Gustavo         Scarpello                       100          7000\n</code></pre> </li> <li> <p>Instertamos nueva informaci\u00f3n en las tablas carrerasProfesionales y participaciones para comprobar si el trigger funciona correctamente:</p> <pre><code>SQL&gt; insert into carrerasProfesionales values (13, to_date('20-11-2016 13:00' , 'DD-MM-YYYY HH24:MI'), 8000, 650, to_date('01-01-2010', 'DD-MM-YYYY'), to_date('01-06-2013', 'DD-MM-YYYY'));\n1 fila creada.\nSQL&gt; insert into participaciones values(13, 7, 'X6785562X', 1, 1);\n1 fila creada.\nSQL&gt; insert into participaciones values(13, 4, '85108890N', 5, 5);\n1 fila creada.\nDNI        NOMBRE          APELLIDO1       APELLIDO2       CUOTAMENSUAL IMPORTETOTALPREMIOS\n---------- --------------- --------------- --------------- ------------ -------------------\n21913124n  Horacio         Arreguy         Fazzio          250          16607\nZ7782152S  Robert          Chase                           300          8750\n83069279H  Lucas           Martinez        Munoz           200,7        15000\nX58056225B Gustavo         Scarpello                       100          7000\n</code></pre> </li> </ul>"},{"location":"p4-grupal-plsql/ejercicio6/","title":"Ejercicio 6","text":"<p>Realiza los m\u00f3dulos de programaci\u00f3n necesarios para evitar que un mismo propietario env\u00ede dos caballos a una misma carrera.</p>"},{"location":"p4-grupal-plsql/ejercicio6/#paso-1","title":"PASO 1","text":"<p>Primero voy a crear el paquete que albergue la tabla vac\u00eda con el c\u00f3digo del dni de la tabla caballos, y el c\u00f3digo de la carrera de la tabla participaciones, le damos los nombres que consideremos necesarios y al final al realizar el llamamiento del paquete debemos utilizar CONTROLPROPIETARIOS.CONTAR y el nombre del registro de la tabla, ya sea codigodni o codigocarrera.</p> <pre><code>CREATE OR REPLACE PACKAGE controlpropietarios AS\nv_codcaballo NUMBER;\nTYPE tregistrodni IS\nRECORD ( codigodni caballos.dnipropietario%type, codigocarrera participaciones.codigocarrera%type );\nTYPE ttablacontroldni IS\nTABLE OF tregistrodni INDEX BY BINARY_INTEGER;\ncontar       ttablacontroldni;\nEND controlpropietarios;\n/\n</code></pre>"},{"location":"p4-grupal-plsql/ejercicio6/#paso-2","title":"PASO 2","text":"<p>Creamos un trigger que realice la funci\u00f3n de rellenar las tablas que hemos creado en el paquete, esto afectar\u00e1 a la tabla que hemos creado en memoria entonces en ning\u00fan momento toca la tabla participaciones, por lo tanto no mutar\u00e1, as\u00ed que se le puede hacer consultas y cursores. El \u00edndice es el identificador que se le proporciona a la fila de la tabla, como vemos en el bucle for, tenemos un \u00edndice que al ser recorrido va insertando los datos de la tabla participaciones en el \u00edndice, y generar\u00e1 una nueva fila (+1) hasta que se hayan insertado todos los datos.</p> <pre><code>CREATE OR REPLACE TRIGGER rellenarvariablesdni\nBEFORE INSERT OR UPDATE ON participaciones\nDECLARE\nCURSOR c_buscar IS\nSELECT codigocarrera, dnipropietario\nFROM participaciones p, caballos c\nWHERE c.codigocaballo=p.codigocaballo;\nindice NUMBER:=0;\nBEGIN\nFOR v_buscar IN c_buscar LOOP\ncontrolpropietarios.contar(indice).codigodni := v_buscar.dnipropietario;\ncontrolpropietarios.contar(indice).codigocarrera := v_buscar.codigocarrera;\nindice:=indice+1;\nEND LOOP;\nEND rellenarvariablesdni;\n/\n</code></pre>"},{"location":"p4-grupal-plsql/ejercicio6/#paso-3","title":"PASO 3","text":"<p>Vamos a generar una funci\u00f3n que realice la comprobaci\u00f3n de que esa carrera existe, entonces en el bucle for vamos a recorrer el paquete de principio a fin buscando las coincidencias de que los nuevos par\u00e1metros que se inserten van a ser los mismos que los ya albergados en el array (tabla en memoria), as\u00ed que si el nuevo dni introducido coincide con uno que est\u00e9 dentro de la tabla y el nuevo c\u00f3digo carrera coincide tabi\u00e9n, la funci\u00f3n devolver\u00e1 un 1, que ser\u00eda similar a un booleano.</p> <pre><code>CREATE OR REPLACE FUNCTION existecarreradni (\np_dni caballos.dnipropietario%type,\np_carrera participaciones.codigocarrera%type\n) RETURN NUMBER IS\nv_existe NUMBER:=0;\nBEGIN\nFOR i IN controlpropietarios.contar.first .. controlpropietarios.contar.last LOOP\nIF controlpropietarios.contar(i).codigodni = p_dni AND controlpropietarios.contar(i).codigocarrera = p_carrera THEN\nv_existe:=1;\nEND IF;\nEND LOOP;\nRETURN v_existe;\nEND;\n/\n</code></pre> <p>Dentro de este procedimiento vamos a declarar una variable que va a ser comparada con el nuevo c\u00f3digo caballo introducido en la tabla participaciones, de manera que podemos ingresarlo como par\u00e1metro de entrada a ACTUALIZARPARTICIPACIONES junto con :NEW.CODIGOCARRERA que obtendremos de la propia tabla del trigger, luego, procedemos a ver que si la funci\u00f3n anterior ha resultado ser 1 entonces salta un RAISE_APPLICATION_ERROR con su respectivo mensaje, que es desde un principio el objetivo del ejercicio.</p> <p>Si la funci\u00f3n no devuelve 1 proceder\u00edamos a ACTUALIZARPARTICIPACIONES, esto debemos hacerlo porque cuando ingresamos datos, la tabla en memoria debemos actualizarlas ya que si no lo hacemos el trigger s\u00f3lo contemplar\u00eda los antiguos registros.</p> <p>Este trigger es en esencia el que nos permite levantar la excepci\u00f3n del ejercicio.</p> <pre><code>CREATE OR REPLACE TRIGGER controlarcaballos\nBEFORE INSERT OR UPDATE ON participaciones\nFOR EACH ROW\nDECLARE\nv_dniprop caballos.dnipropietario%type;\nBEGIN\nSELECT dnipropietario INTO v_dniprop\nFROM caballos\nWHERE codigocaballo = :new.codigocaballo;\nIF existecarreradni(v_dniprop, :new.codigocarrera) = 1 THEN\nraise_application_error(-20003, 'No puedes meter m\u00e1s de un caballo por propietario');\nELSE\nactualizarparticipaciones(v_dniprop, :new.codigocarrera);\nEND IF;\nEND controlarcaballos;\n/\n</code></pre>"},{"location":"p4-grupal-plsql/ejercicio6/#paso-4","title":"PASO 4","text":"<p>Por \u00faltimo podemos ver que en ACTUALIZARPARTICIPACIONES declaramos el \u00edndice, el cual cuando se llame proceder\u00e1 a ingresar una fila nueva, por tanto en los valores CODIGODNI y CODIGOCARRERA vamos a actualizar los nuevos valores con los introducidos por los par\u00e1metros, para as\u00ed cuando se vuelva a ingresar, se vuelve a actualizar por cada insert que yo realice.</p> <pre><code>CREATE OR REPLACE PROCEDURE actualizarparticipaciones (\np_dni caballos.dnipropietario%type,\np_carrera participaciones.codigocarrera%type\n) IS\nindice NUMBER;\nBEGIN\nindice:=controlpropietarios.contar.last+1;\ncontrolpropietarios.contar(indice).codigodni:=p_dni;\ncontrolpropietarios.contar(indice).codigocarrera:=p_carrera;\nEND;\n/\n</code></pre>"},{"location":"p4-grupal-plsql/ejercicio6/#prueba-de-funcionamiento","title":"PRUEBA DE FUNCIONAMIENTO","text":"<pre><code>insert into participaciones values(90, 10, '09849927Q', 3, 4);\ninsert into participaciones values(90, 11, '09849927Q', 7, 6);\n</code></pre>"},{"location":"p4-grupal-plsql/ejercicio7/","title":"Ejercicio 7","text":"<p>Realiza los m\u00f3dulos de programaci\u00f3n necesarios para evitar que un mismo jockey corra m\u00e1s de tres carreras en el mismo d\u00eda.</p> <p>En un primer momento hice este trigger, pero \u00e9ste no contempla el error de mutaci\u00f3n de la tabla al hacer un insert all. Si se hacen los inserts uno a uno s\u00ed funciona.</p> <pre><code>CREATE OR REPLACE TRIGGER evitar_tres_carreras_jockey\nBEFORE INSERT OR UPDATE ON participaciones\nFOR EACH ROW\nDECLARE\nv_num_carreras NUMBER;\nBEGIN\nSELECT COUNT(*) INTO v_num_carreras\nFROM participaciones p, carrerasprofesionales c\nWHERE p.codigocarrera=c.codigocarrera\nAND p.dnijockey = :new.dnijockey\nAND to_char(c.fechahora, 'DD-MM-YYYY') = (\nSELECT to_char(fechahora, 'DD-MM-YYYY')\nFROM carrerasprofesionales\nWHERE codigocarrera = :new.codigocarrera\n);\nIF v_num_carreras &gt;= 3 THEN\nraise_application_error(-20001, 'El jockey ya ha corrido tres carreras ese d\u00eda.');\nEND IF;\nEND;\n/\n</code></pre> <p>Prueba:</p> <p>Las carreras con c\u00f3digo 10, 11 y 12 son en la misma fecha (13-11-2016), voy a a\u00f1adir otra carrera que sea en esa fecha y voy a a\u00f1adir las participaciones de un mismo jockey en esas carreras.</p> <pre><code>insert into carrerasProfesionales  values (14, to_date('13-11-2016 13:00', 'DD-MM-YYYY HH24:MI'), 6125, 450, '01-01-2016', '01-06-2016');\n</code></pre> <pre><code>insert into participaciones values(10, 2, 'Y6857984L', 2, 5);\ninsert into participaciones values(11, 2, 'Y6857984L', 7, 4);\ninsert into participaciones values(12, 2, 'Y6857984L', 1, 3);\ninsert into participaciones values(14, 2, 'Y6857984L', 1, 1);\n</code></pre> <p></p> <p>Con insert all vemos que nos aparece el problema de la tabla mutando.</p> <pre><code>INSERT ALL\nINTO participaciones VALUES(10, 5, '00015258D', 3, 4)\nINTO participaciones VALUES(11, 5, '00015258D', 5, 1)\nINTO participaciones VALUES(12, 5, '00015258D', 2, 5)\nINTO participaciones VALUES(14, 2, '00015258D', 1, 1)\nSELECT * FROM dual;\n</code></pre> <p></p> <p>Borro los datos que he insertado y el trigger y vamos a intentar hacerlo de forma que no de error por mutaci\u00f3n de la tabla.</p> <pre><code>delete from participaciones where codigocarrera=10 and codigocaballo=2 and dnijockey='Y6857984L';\ndelete from participaciones where codigocarrera=11 and codigocaballo=2 and dnijockey='Y6857984L';\ndelete from participaciones where codigocarrera=12 and codigocaballo=2 and dnijockey='Y6857984L';\ndelete from participaciones where codigocarrera=14 and codigocaballo=2 and dnijockey='Y6857984L';\ndrop trigger evitar_tres_carreras_jockey;\n</code></pre>"},{"location":"p4-grupal-plsql/ejercicio7/#mutante","title":"Mutante","text":"<p>Mi c\u00f3digo lo muestro a continuaci\u00f3n pero no hemos conseguido hacer que funcione, no vemos d\u00f3nde est\u00e1 el error (ning\u00fan compa\u00f1ero del grupo). El error es que al hacer inserts individuales no detecta que haya jockeys que ya hayan participado tres veces ese d\u00eda, y al hacer insert all aparece un error como el siguiente:</p> <pre><code>ORA-04091: la tabla ADMIN.PARTICIPACIONES esta mutando, puede que el\ndisparador/la funcion no puedan verla\nORA-06512: en \"ADMIN.RELLENARTABLACONTROLJOCKEYS\", linea 3\nORA-06512: en \"ADMIN.RELLENARTABLACONTROLJOCKEYS\", linea 8\nORA-04088: error durante la ejecucion del disparador\n'ADMIN.RELLENARTABLACONTROLJOCKEYS'\n</code></pre> <p>M\u00f3dulos de programaci\u00f3n:</p> <pre><code>CREATE OR REPLACE PACKAGE CONTROLJOCKEYS\nAS\nTYPE tREGISTROJOCKEYFECHA IS RECORD\n(\nDNIJOCKEY PARTICIPACIONES.DNIJOCKEY%TYPE,\nFECHAHORA DATE\n);\nTYPE tTABLACONTROLJOCKEYS IS TABLE OF tREGISTROJOCKEYFECHA\nINDEX BY BINARY_INTEGER;\ncontar tTABLACONTROLJOCKEYS;\nEND CONTROLJOCKEYS;\n/\nCREATE OR REPLACE TRIGGER RELLENARTABLACONTROLJOCKEYS\nBEFORE INSERT OR UPDATE ON PARTICIPACIONES\nDECLARE\nCURSOR C_DNIFECHA IS\nSELECT P.DNIJOCKEY, C.FECHAHORA\nFROM PARTICIPACIONES P, CARRERASPROFESIONALES C\nWHERE P.CODIGOCARRERA = C.CODIGOCARRERA;\nINDICE NUMBER := 0;\nBEGIN\nFOR v IN C_DNIFECHA LOOP\nCONTROLJOCKEYS.CONTAR(INDICE).DNIJOCKEY := v.DNIJOCKEY;\nCONTROLJOCKEYS.CONTAR(INDICE).FECHAHORA := TRUNC(v.FECHAHORA);\nINDICE := INDICE + 1;\nEND LOOP;\nEND;\n/\nCREATE OR REPLACE FUNCTION superacarreras (p_dni PARTICIPACIONES.DNIJOCKEY%TYPE, p_fecha DATE)\nRETURN NUMBER\nAS\nv_exist NUMBER := 0;\nBEGIN\nFOR i IN CONTROLJOCKEYS.CONTAR.FIRST .. CONTROLJOCKEYS.CONTAR.LAST LOOP\nIF CONTROLJOCKEYS.CONTAR(i).DNIJOCKEY = P_DNI AND CONTROLJOCKEYS.CONTAR(i).FECHAHORA = P_FECHA THEN\nv_exist := v_exist + 1;\nEND IF;\nEND LOOP;\n-- Si el jockey ha participado en tres o m\u00e1s carreras en la misma fecha,\n-- se devuelve 1 (verdadero), en caso contrario se devuelve 0 (falso).\nIF v_exist &gt;= 3 THEN\nRETURN 1;\nELSE\nRETURN 0;\nEND IF;\nEND;\n/\nCREATE OR REPLACE PROCEDURE actualizartablacontroljockeys (P_DNIJOCKEY PARTICIPACIONES.DNIJOCKEY%TYPE, P_FECHA_CARRERA CARRERASPROFESIONALES.FECHAHORA%TYPE)\nIS\nINDICE NUMBER := CONTROLJOCKEYS.CONTAR.LAST + 1;\nBEGIN\nCONTROLJOCKEYS.CONTAR(INDICE).DNIJOCKEY := P_DNIJOCKEY;\nCONTROLJOCKEYS.CONTAR(INDICE).FECHAHORA := P_FECHA_CARRERA;\nEND actualizartablacontroljockeys;\n/\nCREATE OR REPLACE TRIGGER MaxTresCarreras\nBEFORE INSERT OR UPDATE ON PARTICIPACIONES\nFOR EACH ROW\nDECLARE\nV_DNIJOCKEY PARTICIPACIONES.DNIJOCKEY%TYPE; V_FECHA_CARRERA CARRERASPROFESIONALES.FECHAHORA%TYPE;\nBEGIN\nV_DNIJOCKEY := :NEW.DNIJOCKEY;\nselect c.fechahora into V_FECHA_CARRERA from carrerasprofesionales c where c.codigocarrera=:new.codigocarrera;\nIF SUPERACARRERAS(V_DNIJOCKEY, V_FECHA_CARRERA) = 1 THEN\nRAISE_APPLICATION_ERROR(-20002, 'No puedes participar en m\u00e1s de tres carreras en un mismo d\u00eda');\nELSE\nactualizartablacontroljockeys(V_DNIJOCKEY, V_FECHA_CARRERA);\nEND IF;\nEND MaxTresCarreras;\n/\n</code></pre>"},{"location":"p4-grupal-plsql/ejercicio7/#prueba-de-errores","title":"Prueba de errores","text":"<p>Creo que el error puede estar en RELLENARTABLACONTROLJOCKEYS. A continuaci\u00f3n comento algunas cosas que he probado:</p> <ul> <li>He probado si la funci\u00f3n superacarreras funcionaba y he comprobado que efectivamente funciona:</li> </ul> <pre><code>select superacarreras('Y6857984L', '13-11-2016') from dual;\nSUPERACARRERAS('Y6857984L','13-11-2016')\n----------------------------------------\n1\nselect superacarreras('00015258D', '13-11-2016') from dual;\nSUPERACARRERAS('00015258D','13-11-2016')\n----------------------------------------\n0\nselect superacarreras('09849927Q', '13-11-2016') from dual;\nSUPERACARRERAS('09849927Q','13-11-2016')\n----------------------------------------\n1\n</code></pre> <ul> <li>He probado a meter \"prints\" en el c\u00f3digo para encontrar d\u00f3nde falla, por ejemplo en RELLENARTABLACONTROLJOCKEYS:</li> </ul> <pre><code>CREATE OR REPLACE TRIGGER RELLENARTABLACONTROLJOCKEYS\nBEFORE INSERT OR UPDATE ON PARTICIPACIONES\nDECLARE\nCURSOR C_DNIFECHA IS\nSELECT P.DNIJOCKEY, C.FECHAHORA\nFROM PARTICIPACIONES P, CARRERASPROFESIONALES C\nWHERE P.CODIGOCARRERA = C.CODIGOCARRERA;\nINDICE NUMBER := 0;\nBEGIN\ndbms_output.put_line('Empezando cursor');\nFOR v IN C_DNIFECHA LOOP\nCONTROLJOCKEYS.CONTAR(INDICE).DNIJOCKEY := v.DNIJOCKEY;\nCONTROLJOCKEYS.CONTAR(INDICE).FECHAHORA := TRUNC(v.FECHAHORA);\nINDICE := INDICE + 1;\ndbms_output.put_line('Indice:'||INDICE);\ndbms_output.put_line('IndiceDNI:'||CONTROLJOCKEYS.CONTAR(INDICE).DNIJOCKEY);\ndbms_output.put_line('IndiceFECHA:'||CONTROLJOCKEYS.CONTAR(INDICE).FECHAHORA);\nEND LOOP;\ndbms_output.put_line('Terminado cursor');\nEND;\n/\n</code></pre> <ul> <li>Tambi\u00e9n he probado lo anterior en la funci\u00f3n superacarreras.</li> </ul> <pre><code>CREATE OR REPLACE FUNCTION superacarreras (p_dni PARTICIPACIONES.DNIJOCKEY%TYPE, p_fecha DATE)\nRETURN NUMBER\nAS\nv_exist NUMBER := 0;\nBEGIN\nFOR i IN CONTROLJOCKEYS.CONTAR.FIRST .. CONTROLJOCKEYS.CONTAR.LAST LOOP\ndbms_output.put_line('superacarreras i '||i);\ndbms_output.put_line('superacarreras dni '||P_DNI || 'vs DNI ' || CONTROLJOCKEYS.CONTAR(i).DNIJOCKEY);\ndbms_output.put_line('superacarreras fechahora '||P_FECHA || 'vs fechahora ' || CONTROLJOCKEYS.CONTAR(i).FECHAHORA);\nIF CONTROLJOCKEYS.CONTAR(i).DNIJOCKEY = P_DNI AND CONTROLJOCKEYS.CONTAR(i).FECHAHORA = P_FECHA THEN\nv_exist := v_exist + 1;\ndbms_output.put_line('dentro if');\nEND IF;\n....\n</code></pre> <ul> <li>He hecho lo mismo con el \u00faltimo trigger MaxTresCarreras.</li> </ul> <pre><code>CREATE OR REPLACE TRIGGER MaxTresCarreras\n...\nBEGIN\ndbms_output.put_line('Empieza la ejecuci\u00f3n');\nV_DNIJOCKEY := :NEW.DNIJOCKEY;\nselect c.fechahora into V_FECHA_CARRERA from carrerasprofesionales c where c.codigocarrera=:new.codigocarrera;\ndbms_output.put_line('Se ha hecho el select y se han guardado los datos');\n.....\n</code></pre> <p>La primera vez que met\u00ed un dbms_output de comprobaci\u00f3n en RELLENARTABLACONTROLJOCKEYS me apareci\u00f3 lo siguiente:</p> <p></p> <p>Lo cual me pareci\u00f3 raro, ya que una vez terminado el loop no deber\u00eda haberme aparecido de nuevo \"Empezando cursor\".</p> <p>Al meter los prints de dentro del loop en el mismo trigger, el error cambi\u00f3.</p> <p></p> <p>Al hacer un insert individual me aparece el mensaje de que ya ha participado m\u00e1s de tres veces por lo que he intentado borrar los datos de la colecci\u00f3n pero me sigue dando el mismo error a pesar de no haber m\u00e1s datos que tengan al mismo jockey participando el mismo d\u00eda.</p> <p></p> <p>Para borrar los datos de la colecci\u00f3n he hecho lo siguiente:</p> <pre><code>CREATE OR REPLACE PROCEDURE borrar_controljockeys\nAS\n-- Declare a variable to hold the number of elements in the collection\nv_count NUMBER;\nBEGIN\n-- Get the number of elements in the collection\nv_count := CONTROLJOCKEYS.CONTAR.COUNT;\n-- Loop through the collection and delete each element\nFOR i IN 1 .. v_count LOOP\nCONTROLJOCKEYS.CONTAR.DELETE(1);\nEND LOOP;\nEND borrar_controljockeys;\n/\nexec borrar_controljockeys;\n</code></pre>"},{"location":"p4-grupal-plsql/ejercicio8/","title":"Ejercicio 8","text":"<p>Realiza los m\u00f3dulos de programaci\u00f3n necesarios para evitar que un propietario apueste por un caballo que no sea de su propiedad si en esa misma carrera corre alg\u00fan caballo suyo</p>"},{"location":"p4-grupal-plsql/ejercicio8/#codigo","title":"C\u00f3digo","text":"<pre><code>CREATE OR REPLACE PROCEDURE comprobar_si_propietario(p_dnicliente apuestas.dnicliente%TYPE, p_control_propietario OUT BOOLEAN)\nIS\nv_propietario_si_no NUMBER;\nBEGIN\nSELECT COUNT(*)\nINTO v_propietario_si_no\nFROM propietarios\nWHERE dni = p_dnicliente;\nIF v_propietario_si_no = 1 THEN\np_control_propietario := TRUE;\nELSE\np_control_propietario := FALSE;\nEND IF;\nEND;\n/\n-- (1)!\n</code></pre> <ol> <li>Este procedimiento comprueba si un cliente es propietario o no, recibiendo el dni insertado y busc\u00e1ndolo en la tabla propietarios. Se utiliza un par\u00e1metro OUT BOOLEAN para responder si el cliente era propietario o no.</li> </ol> <pre><code>CREATE OR REPLACE PROCEDURE comprobar_si_caballo_suyo(p_codigocaballo participaciones.codigocaballo%TYPE, p_dnicliente apuestas.dnicliente%TYPE, p_control_caballo_suyo OUT BOOLEAN)\nIS\nv_caballo_suyo_si_no NUMBER;\nBEGIN\nSELECT COUNT(*)\nINTO v_caballo_suyo_si_no\nFROM caballos\nWHERE dnipropietario = p_dnicliente AND codigocaballo = p_codigocaballo;\nIF v_caballo_suyo_si_no = 1 THEN\np_control_caballo_suyo := TRUE;\nELSE\np_control_caballo_suyo := FALSE;\nEND IF;\nEND;\n/\n-- (1)!\n</code></pre> <ol> <li>Este procedimiento comprueba si un caballo es propiedad de un propietario o no, recibiendo el c\u00f3digo del caballo y el dni del propietario, busc\u00e1ndolo en la tabla caballos. Se utiliza un par\u00e1metro OUT BOOLEAN para responder si el caballo era suyo o no.</li> </ol> <pre><code>CREATE OR REPLACE PROCEDURE comprobar_carrera(p_codigocarrera apuestas.codigocarrera%TYPE, p_dnicliente apuestas.dnicliente%TYPE, p_control_carrera OUT BOOLEAN)\nIS\nCURSOR c_caballos IS\nSELECT codigocaballo\nFROM participaciones\nWHERE codigocarrera = p_codigocarrera;\nv_control_suyo BOOLEAN;\nv_contador NUMBER := 0;\nBEGIN\nFOR i IN c_caballos LOOP\ncomprobar_si_caballo_suyo(i.codigocaballo,p_dnicliente,v_control_suyo);\nIF v_control_suyo = TRUE THEN\nv_contador := v_contador+1;\nEND IF;\nEND LOOP;\nIF v_contador &gt; 0 THEN\np_control_carrera := TRUE;\nELSE\np_control_carrera := FALSE;\nEND IF;\nEND;\n/\n-- (1)!\n</code></pre> <ol> <li>Este procedimiento comprueba si alguno de los caballos de una carrera espec\u00edfica es propiedad del propietario que intenta apostar. Recibe el c\u00f3digo de la carrera, el dni del propietario, y se utiliza un par\u00e1metro OUT BOOLEAN para responder si en la carrera hab\u00eda alg\u00fan caballo suyo o no.</li> </ol> <pre><code>CREATE OR REPLACE TRIGGER monitorizar_apuestas\nBEFORE INSERT OR UPDATE ON apuestas\nFOR EACH ROW\nDECLARE\nv_control_propietario BOOLEAN;\nv_control_carrera BOOLEAN;\nv_control_caballo_suyo BOOLEAN;\nBEGIN\ncomprobar_si_propietario(:NEW.dnicliente,v_control_propietario);\nIF v_control_propietario = TRUE THEN\ncomprobar_carrera(:NEW.codigocarrera,:NEW.dnicliente,v_control_carrera);\nIF v_control_carrera = TRUE THEN\ncomprobar_si_caballo_suyo(:NEW.codigocaballo,:NEW.dnicliente,v_control_caballo_suyo);\nIF v_control_caballo_suyo = FALSE THEN\nRAISE_APPLICATION_ERROR(-20001,'El propietario con DNI ' || :NEW.dnicliente || ' no puede apostar por el caballo con codigo ' || :NEW.codigocaballo || ' porque no es suyo');\nEND IF;\nEND IF;\nEND IF;\nEND;\n/\n-- (1)!\n</code></pre> <ol> <li>Este es el bloque de c\u00f3digo principal, el trigger que monitoriza las apuestas. Desde aqu\u00ed se llama a los procedimientos hijos anteriores</li> </ol>"},{"location":"p4-grupal-plsql/ejercicio8/#requerimientos","title":"Requerimientos","text":"<p>Tengo que a\u00f1adir un cliente que sea un propietario, porque en principio no hay ning\u00fan propietario que sea a su vez cliente para poder apostar:</p> <pre><code>INSERT INTO clientes values ('21913124n', 'Horacio', 'Arreguy', 'Fazzio', 'Calle Real, 12', 'Cordoba', 'Cordoba','678123467');\n</code></pre>"},{"location":"p4-grupal-plsql/ejercicio8/#comprobaciones","title":"Comprobaciones","text":"<p>Inserto una apuesta por un cliente normal, no propietario (dejar\u00e1 insertar):</p> <pre><code>INSERT INTO apuestas values ('28841115N',1 ,2 ,300 ,3.10);\n1 row created.\n</code></pre> <p>Para las comprobaciones que vienen a continuaci\u00f3n ser\u00e1 necesario tener presente cu\u00e1les son los caballos que pertenecen al propietario anteriormente a\u00f1adido como cliente:</p> <pre><code>SELECT *\nFROM caballos\nWHERE dnipropietario = '21913124n';\n</code></pre> <pre><code>CODIGOCABALLO DNIPROPIET NOMBRE                         FECHANAC  RAZA\n------------- ---------- ------------------------------ --------- ------------------------------\n1 21913124n  Wad Vison                      11-NOV-11 Quarter Horse\n5 21913124n  Argos                              04-APR-12 Purasangre ingles\n9 21913124n  Perdigon                       24-JUN-12 Purasangre espanol\n</code></pre> <p>Inserto una apuesta de un propietario en una carrera en la que no corren caballos suyos. Por ejemplo, la carrera 1 nos sirve. Muestro los caballos que hay en esa carrera:</p> <pre><code>SELECT codigocaballo\nFROM participaciones\nWHERE codigocarrera = 1;\n</code></pre> <pre><code>CODIGOCABALLO\n-------------\n2\n4\n6\n</code></pre> <p>Como no hay ning\u00fan caballo suyo, le dejar\u00e1 apostar tanto en uno suyo como en uno ajeno:</p> <pre><code>INSERT INTO apuestas values ('21913124n',1 ,1 ,300 ,3.10);\n1 row created.\nINSERT INTO apuestas values ('21913124n',1 ,10 ,300 ,3.10);\n1 row created.\n</code></pre> <p>Ahora inserto una apuesta de un propietario en una carrera en la corre alg\u00fan caballo suyo. Por ejemplo, la carrera 3 nos sirve. Muestro los caballos que hay en esa carrera:</p> <pre><code>SELECT codigocaballo\nFROM participaciones\nWHERE codigocarrera = 3;\n</code></pre> <pre><code>CODIGOCABALLO\n-------------\n2\n5\n7\n8\n</code></pre> <p>Como hay un caballo suyo, el 5, le dejar\u00e1 apostar en alguno de los dem\u00e1s suyos, pero no en ajenos:</p> <pre><code>INSERT INTO apuestas values ('21913124n',3 ,9 ,300 ,3.10);\n1 row created.\nINSERT INTO apuestas values ('21913124n',3 ,10 ,300 ,3.10);\nINSERT INTO apuestas values ('21913124n',3 ,10 ,300 ,3.10)\n*\nERROR at line 1:\nORA-20001: El propietario con DNI 21913124n no puede apostar por el caballo con codigo 10 porque no es suyo\nORA-06512: at \"HIPODROMO.MONITORIZAR_APUESTAS\", line 12\nORA-04088: error during execution of trigger 'HIPODROMO.MONITORIZAR_APUESTAS'\n</code></pre>"},{"location":"p4-grupal-plsql/intro/","title":"Introducci\u00f3n","text":"<p>En esta pr\u00e1ctica se explota la base de datos del proyecto \"Gran Hip\u00f3dromo\" mediante PL/SQL.</p> <p>Reparto de roles:</p> <ul> <li>Capit\u00e1n: Antonio March\u00e1n Posada</li> <li>Secretario: Adri\u00e1n Jaramillo Rodr\u00edguez</li> <li>Facilitador: Jos\u00e9 Juan Herv\u00e1s Carrasco</li> <li>Portavoz: Arantxa Fern\u00e1ndez Morat\u00f3</li> </ul> <p>Puedes empezar a navegar por la documentaci\u00f3n utilizando el navbar a tu izquierda.</p> <p>Esperamos que esta documentaci\u00f3n sea clara, y de utilidad.</p> <p></p>"},{"location":"p4-grupal-plsql/pasos-previos/","title":"Pasos previos","text":""},{"location":"p4-grupal-plsql/pasos-previos/#oracle","title":"Oracle","text":"<p>Descargo el script de generaci\u00f3n de tablas y datos:</p> <pre><code>wget https://gist.githubusercontent.com/adriasir123/0896abce2b81714557d3c1e2a038c3cb/raw/312c27d4e56b292cfb4fb1d235eacb781b98a4e4/gran-hipodromo-oracle.sql\n</code></pre> <p>Accedo como <code>sys</code>:</p> <pre><code>sqlplus / as sysdba\n</code></pre> <p>Creo el usuario y le doy privilegios:</p> <pre><code>create user hipodromo identified by 1234;\ngrant all privileges to hipodromo;\n</code></pre> <p>Cambio a este usuario:</p> <pre><code>connect hipodromo/1234;\n</code></pre> <p>Ejecuto el script:</p> <pre><code>@gran-hipodromo-oracle.sql\n</code></pre>"},{"location":"p4-grupal-plsql/pasos-previos/#postgresql","title":"PostgreSQL","text":"<p>A\u00f1ado un nuevo usuario de sistema:</p> <pre><code>sudo adduser hipodromo_admin\n</code></pre> <p>Cambio al usuario <code>postgres</code>:</p> <pre><code>su - postgres\n</code></pre> <p>Descargo el script de generaci\u00f3n de tablas y datos:</p> <pre><code>wget https://gist.githubusercontent.com/adriasir123/652ee842c3966696aeb6a07ab22a59b2/raw/715cf2683488b6aa9e8d481749620c282e5872c3/gran-hipodromo-postgres.sql\n</code></pre> <p>Accedo a la bd:</p> <pre><code>psql\n</code></pre> <p>Creo la bd y me conecto:</p> <pre><code>CREATE DATABASE hipodromo;\n\\connect hipodromo\n</code></pre> <p>Ejecuto el script:</p> <pre><code>\\i gran-hipodromo-postgres.sql\n</code></pre> <p>Creo el usuario y doy privilegios:</p> <pre><code>create user hipodromo_admin with encrypted password '1234';\nGRANT all privileges ON DATABASE hipodromo TO hipodromo_admin;\nGRANT ALL PRIVILEGES ON ALL TABLES IN SCHEMA public TO hipodromo_admin;\n</code></pre> <p>Cambio a este usuario:</p> <pre><code>set role hipodromo_admin;\n</code></pre>"},{"location":"p5-usuarios/intro/","title":"Introducci\u00f3n","text":"<p>En esta pr\u00e1ctica se gestionan usuarios, permisos, roles y perfiles sobre diferentes bases de datos.</p> <p>Reparto de roles:</p> <ul> <li>Capit\u00e1n: Jos\u00e9 Juan Herv\u00e1s Carrasco</li> <li>Secretaria: Arantxa Fern\u00e1ndez Morat\u00f3</li> <li>Facilitador: Antonio March\u00e1n Posada</li> <li>Portavoz: Adri\u00e1n Jaramillo Rodr\u00edguez</li> </ul> <p>Puedes empezar a navegar por la documentaci\u00f3n utilizando el navbar a tu izquierda.</p> <p>Esperamos que esta documentaci\u00f3n sea clara, y de utilidad.</p> <p></p>"},{"location":"p5-usuarios/rg/caso-practico-1-ej1/","title":"Ejercicio 1","text":""},{"location":"p5-usuarios/rg/caso-practico-1-ej1/#oracle","title":"Oracle","text":"<p>Creo el usuario <code>becario</code>:</p> <pre><code>CREATE USER becario IDENTIFIED BY 1234;\n</code></pre> <p>Le doy la siguiente lista de privilegios...</p> <p>Conexi\u00f3n a la base de datos:</p> <pre><code>GRANT CREATE SESSION TO becario;\n</code></pre> <p>Modificaci\u00f3n del n\u00famero de errores en la introducci\u00f3n de contrase\u00f1a de cualquier usuario:</p> <pre><code>CREATE PROFILE errores_contrasena LIMIT FAILED_LOGIN_ATTEMPTS 3;\nGRANT ALTER PROFILE TO becario;\nGRANT ALTER USER TO becario;\n</code></pre> <p>Modificaci\u00f3n de \u00edndices en cualquier esquema, pudiendo pasarlo a quien quiera:</p> <pre><code>GRANT ALTER ANY INDEX TO becario WITH GRANT OPTION;\n</code></pre> <p>Inserci\u00f3n de filas en <code>scott.emp</code>, pudiendo pasarlo a quien quiera:</p> <pre><code>GRANT INSERT ON scott.emp TO becario WITH GRANT OPTION;\n</code></pre> <p>Uso de almacenamiento ilimitado en cualquier tablespace:</p> <pre><code>GRANT UNLIMITED TABLESPACE TO becario;\n</code></pre> <p>Gesti\u00f3n completa de usuarios:</p> <pre><code>GRANT CREATE USER TO becario;\nGRANT ALTER USER TO becario;\nGRANT DROP USER TO becario;\n</code></pre> <p>Gesti\u00f3n completa de privilegios:</p> <pre><code>GRANT GRANT ANY PRIVILEGE TO becario;\nGRANT GRANT ANY OBJECT PRIVILEGE TO becario;\n</code></pre> <p>Gesti\u00f3n completa de roles:</p> <pre><code>GRANT CREATE ROLE TO becario;\nGRANT ALTER ANY ROLE TO becario;\nGRANT DROP ANY ROLE TO becario;\nGRANT GRANT ANY ROLE TO becario;\n</code></pre>"},{"location":"p5-usuarios/rg/caso-practico-1-ej1/#2-postgresql","title":"2. PostgreSQL","text":""},{"location":"p5-usuarios/rg/caso-practico-1-ej1/#2-ejercicio-1","title":"2. Ejercicio 1","text":"<p>Crear el usuario <code>becario</code></p> <p>En debian:</p> <pre><code>sudo adduser becario\n</code></pre> <p>En PostgreSQL:</p> <pre><code>CREATE USER becario WITH PASSWORD '1234';\n</code></pre> <p>Info</p> <p><code>CREATE USER</code> lleva impl\u00edcito el atributo <code>LOGIN</code>, por lo que no ser\u00e1 necesario darle permisos de conexi\u00f3n a la base de datos</p>"},{"location":"p5-usuarios/rg/caso-practico-1-ej1/#2-ejercicio-2","title":"2. Ejercicio 2","text":"<p>Dar el privilegio de modificar el n\u00famero de errores en la introducci\u00f3n de contrase\u00f1a de cualquier usuario</p> <p>En PostgreSQL seg\u00fan este post, nativamente al menos, no existe un equivalente al <code>FAILED_LOGIN_ATTEMPTS</code> de Oracle. Existe <code>auth_delay</code>, pero no llegar\u00edamos al mismo resultado.</p> <p>Podr\u00edamos llegar al mismo resultado, pero tendr\u00edamos que una de dos:</p> <ul> <li>Usar herramientas externas como Fail2Ban</li> <li>Usar versiones modificadas de PostgreSQL como Postgres Pro</li> </ul>"},{"location":"p5-usuarios/rg/caso-practico-1-ej1/#2-ejercicio-3","title":"2. Ejercicio 3","text":"<p>Dar el privilegio de modificar \u00edndices en cualquier esquema, pudiendo pasarlo a quien quiera</p> <p>Seg\u00fan este y este otro post, la creaci\u00f3n y modificaci\u00f3n de \u00edndices en PostgreSQL funcionan un poco diferente a como es en Oracle.</p> <p>Primero de todo, no existen directamente estos privilegios en PostgreSQL. S\u00f3lo el superusuario y el propietario de una tabla pueden crear/modificar \u00edndices sobre ella.</p> <p>Por ejemplo, si intentamos crear un \u00edndice de una tabla que no es de ese usuario, aparece este error:</p> <pre><code>scott=&gt; CREATE INDEX test ON dept(dname);\nERROR:  must be owner of table dept\n</code></pre>"},{"location":"p5-usuarios/rg/caso-practico-1-ej1/#2-ejercicio-4","title":"2. Ejercicio 4","text":"<p>Dar el privilegio de inserci\u00f3n de filas en la tabla emp de scott, pudiendo pasarlo a quien quiera</p> <p>Seg\u00fan este post no podemos dar permisos sobre objetos de una base de datos mientras estamos conectados a otra, as\u00ed que primero nos conectamos a <code>scott</code>:</p> <pre><code>\\c scott\n</code></pre> <p>Damos el privilegio:</p> <pre><code>GRANT INSERT ON emp TO becario WITH GRANT OPTION;\n</code></pre> <p>Info</p> <p>Por este mismo funcionamiento, no podr\u00edamos insertar datos si no estamos conectados a la misma base de datos</p>"},{"location":"p5-usuarios/rg/caso-practico-1-ej1/#2-ejercicio-5","title":"2. Ejercicio 5","text":"<p>Dar el privilegio de almacenamiento ilimitado en cualquier tablespace</p> <p>Aunque los tablespaces existan en PostgreSQL y se puedan listar con <code>\\db</code>, no existe una equivalencia para el privilegio <code>UNLIMITED TABLESPACE</code>.</p>"},{"location":"p5-usuarios/rg/caso-practico-1-ej1/#2-ejercicio-6","title":"2. Ejercicio 6","text":"<p>Dar gesti\u00f3n completa de usuarios</p> <pre><code>ALTER USER becario WITH CREATEROLE;\n</code></pre> <p>Info</p> <p>Un usuario con el par\u00e1metro <code>CREATEROLE</code> tambi\u00e9n podr\u00e1 hacer ALTER y DROP de ellos</p>"},{"location":"p5-usuarios/rg/caso-practico-1-ej1/#2-ejercicio-7","title":"2. Ejercicio 7","text":"<p>Dar gesti\u00f3n completa de privilegios</p> <p>En PostgreSQL no existe una equivalencia directa a <code>GRANT ANY PRIVILEGE</code> ni <code>GRANT ANY OBJECT PRIVILEGE</code>, pero s\u00ed que existe <code>WITH GRANT OPTION</code> al otorgar privilegios.</p> <p>Si el usuario <code>becario</code> tuviera todos los privilegios posibles con <code>WITH GRANT OPTION</code>, llegar\u00edamos a una situaci\u00f3n lo m\u00e1s similar posible a la que ten\u00edamos en Oracle, as\u00ed que eso hacemos:</p> <pre><code>GRANT ALL PRIVILEGES ON ALL TABLES IN SCHEMA schema_name TO becario WITH GRANT OPTION;\nGRANT ALL PRIVILEGES ON ALL SEQUENCES IN SCHEMA schema_name TO becario WITH GRANT OPTION;\nGRANT ALL PRIVILEGES ON DATABASE database_name TO becario WITH GRANT OPTION;\nGRANT ALL PRIVILEGES ON DOMAIN domain_name TO becario WITH GRANT OPTION;\nGRANT ALL PRIVILEGES ON FOREIGN DATA WRAPPER fdw_name TO becario WITH GRANT OPTION;\nGRANT ALL PRIVILEGES ON FOREIGN SERVER server_name TO becario WITH GRANT OPTION;\nGRANT ALL PRIVILEGES ON ALL FUNCTIONS IN SCHEMA schema_name TO becario WITH GRANT OPTION;\nGRANT ALL PRIVILEGES ON ALL PROCEDURES IN SCHEMA schema_name TO becario WITH GRANT OPTION;\nGRANT ALL PRIVILEGES ON ALL ROUTINES IN SCHEMA schema_name TO becario WITH GRANT OPTION;\nGRANT ALL PRIVILEGES ON LANGUAGE lang_name TO becario WITH GRANT OPTION;\nGRANT ALL PRIVILEGES ON LARGE OBJECT loid TO becario WITH GRANT OPTION;\nGRANT ALL PRIVILEGES ON PARAMETER configuration_parameter TO becario WITH GRANT OPTION;\nGRANT ALL PRIVILEGES ON SCHEMA schema_name TO becario WITH GRANT OPTION;\nGRANT ALL PRIVILEGES ON TABLESPACE tablespace_name TO becario WITH GRANT OPTION;\nGRANT ALL PRIVILEGES ON TYPE type_name TO becario WITH GRANT OPTION;\n</code></pre>"},{"location":"p5-usuarios/rg/caso-practico-1-ej1/#2-ejercicio-8","title":"2. Ejercicio 8","text":"<p>Dar gesti\u00f3n completa de roles</p> <p>En PostgreSQL, los usuarios y los roles son lo mismo; y m\u00e1s espec\u00edficamente no existen los usuarios, s\u00f3lo los roles.</p> <p>Por esto, cuando tuvimos que dar gesti\u00f3n completa de usuarios lo que dimos realmente fue gesti\u00f3n completa de roles, por lo que este paso no es necesario, ya se ha hecho.</p>"},{"location":"p5-usuarios/rg/caso-practico-1-ej1/#3-mariadb","title":"3. MariaDB","text":""},{"location":"p5-usuarios/rg/caso-practico-1-ej1/#3-ejercicio-1","title":"3. Ejercicio 1","text":"<p>Crear el usuario <code>becario</code></p> <pre><code>CREATE USER 'becario'@'%' IDENTIFIED BY '1234';\n</code></pre>"},{"location":"p5-usuarios/rg/caso-practico-1-ej1/#3-ejercicio-2","title":"3. Ejercicio 2","text":"<p>Dar el privilegio de conexi\u00f3n a la base de datos</p> <p>El privilegio <code>CREATE SESSION</code> no existe en MariaDB, porque este proceso funciona un poco diferente a Oracle.</p> <p>Nada m\u00e1s crear un usuario se permiten las conexiones pero no deja hacer nada, porque s\u00f3lo se le otorga al usuario el privilegio <code>USAGE</code>, que no tiene ning\u00fan uso real:</p> <p></p> <pre><code>MariaDB [(none)]&gt; show grants;\n+--------------------------------------------------------------------------------------------------------+\n| Grants for becario@%                                                                                   |\n+--------------------------------------------------------------------------------------------------------+\n| GRANT USAGE ON *.* TO `becario`@`%` IDENTIFIED BY PASSWORD '*A4B6157319038724E3560894F7F932C8886EBFCF' |\n+--------------------------------------------------------------------------------------------------------+\n1 row in set (0.001 sec)\n</code></pre> <p>Para que un usuario pueda acceder a una base de datos en MariaDB, tiene que tener alg\u00fan tipo de privilegio relacionado con los objetos.</p> <p>El m\u00ednimo que le podemos dar para llegar a la equivalencia m\u00e1s cercana con <code>CREATE SESSION</code> es <code>SELECT</code>:</p> <pre><code>GRANT SELECT ON *.* TO 'becario'@'%';\n</code></pre>"},{"location":"p5-usuarios/rg/caso-practico-1-ej1/#3-ejercicio-3","title":"3. Ejercicio 3","text":"<p>Dar el privilegio de modificar el n\u00famero de errores en la introducci\u00f3n de contrase\u00f1a de cualquier usuario</p> <p>En MariaDB los perfiles no existen de la misma manera que existen en Oracle, de hecho no se pueden crear manualmente porque no son el mismo concepto.</p> <p>S\u00f3lo existen los comandos de visualizaci\u00f3n <code>SHOW PROFILE</code> y <code>SHOW PROFILES</code>, que incluso ser\u00e1n eliminados porque est\u00e1n obsoletos:</p> <p></p> <p>Se puede llegar a una equivalencia con Oracle pero no se podr\u00eda hacer ni con privilegios ni con perfiles, tendr\u00eda que ser fuera de la base de datos a\u00f1adiendo lo siguiente a este fichero:</p> <pre><code>sudo nano /etc/mysql/my.cnf\n</code></pre> <pre><code>[mariadb]\nmax_password_errors=3\n</code></pre> <p>Reinicio:</p> <pre><code>sudo systemctl restart mariadb\n</code></pre> <p>Compruebo que ha funcionado:</p> <pre><code>MariaDB [(none)]&gt; SELECT @@max_password_errors;\n+-----------------------+\n| @@max_password_errors |\n+-----------------------+\n|                     3 |\n+-----------------------+\n1 row in set (0.001 sec)\n</code></pre>"},{"location":"p5-usuarios/rg/caso-practico-1-ej1/#3-ejercicio-4","title":"3. Ejercicio 4","text":"<p>Dar el privilegio de modificar \u00edndices en cualquier esquema, pudiendo pasarlo a quien quiera</p> <p>En MariaDB no existe un <code>ALTER INDEX</code> como en Oracle, simplemente existe un privilegio general:</p> <pre><code>GRANT INDEX ON *.* TO 'becario'@'%' IDENTIFIED BY '1234' WITH GRANT OPTION;\n</code></pre>"},{"location":"p5-usuarios/rg/caso-practico-1-ej1/#3-ejercicio-5","title":"3. Ejercicio 5","text":"<p>Dar el privilegio de inserci\u00f3n de filas en scott.emp, pudiendo pasarlo a quien quiera</p> <pre><code>GRANT INSERT ON scott.emp TO 'becario'@'%' WITH GRANT OPTION;\n</code></pre>"},{"location":"p5-usuarios/rg/caso-practico-1-ej1/#3-ejercicio-6","title":"3. Ejercicio 6","text":"<p>Dar el privilegio de almacenamiento ilimitado en cualquier tablespace</p> <p>No existe una equivalencia para el privilegio <code>UNLIMITED TABLESPACE</code> en MariaDB.</p>"},{"location":"p5-usuarios/rg/caso-practico-1-ej1/#3-ejercicio-7","title":"3. Ejercicio 7","text":"<p>Dar gesti\u00f3n completa de usuarios</p> <pre><code>GRANT CREATE USER ON *.* TO 'becario'@'%';\n</code></pre> <p>El privilegio <code>CREATE USER</code> en MariaDB incluye las funciones de <code>ALTER USER</code> y <code>DROP USER</code> de Oracle.</p>"},{"location":"p5-usuarios/rg/caso-practico-1-ej1/#3-ejercicio-8","title":"3. Ejercicio 8","text":"<p>Dar gesti\u00f3n completa de privilegios</p> <p>En MariaDB tampoco existe <code>GRANT ANY PRIVILEGE</code> ni <code>GRANT ANY OBJECT PRIVILEGE</code>, pero como existe <code>WITH GRANT OPTION</code> podemos llegar a una soluci\u00f3n similar a lo que hicimos en PostgreSQL.</p> <p>La diferencia es que en MariaDB existe <code>ALL PRIVILEGES</code>, facilit\u00e1ndonos el trabajo en una l\u00ednea:</p> <pre><code>GRANT ALL PRIVILEGES ON *.* TO 'becario'@'%' WITH GRANT OPTION;\n</code></pre>"},{"location":"p5-usuarios/rg/caso-practico-1-ej1/#3-ejercicio-9","title":"3. Ejercicio 9","text":"<p>Dar gesti\u00f3n completa de roles</p> <p>Para gestionar los roles lo \u00fanico que se necesita es el privilegio <code>CREATE USER</code>, que ya dimos antes.</p>"},{"location":"p5-usuarios/rg/caso-practico-1-ej2/","title":"Ejercicio 2","text":""},{"location":"p5-usuarios/rg/caso-practico-1-ej2/#1-oracle","title":"1. Oracle","text":""},{"location":"p5-usuarios/rg/caso-practico-1-ej2/#1-enunciado","title":"1. Enunciado","text":"<p>Escribe una consulta que genere un script para quitar el privilegio de borrar registros en alguna tabla de SCOTT a los usuarios que lo tengan.</p>"},{"location":"p5-usuarios/rg/caso-practico-1-ej2/#1-codigo","title":"1. C\u00f3digo","text":"<pre><code>CREATE OR REPLACE FUNCTION generador_script_quitar_privilegios(\np_tabla VARCHAR2\n) RETURN VARCHAR2 IS\nCURSOR c_usuarios IS\nSELECT grantee\nFROM dba_tab_privs\nWHERE privilege = 'DELETE'\nAND table_name = p_tabla\nAND owner = 'SCOTT';\nv_output VARCHAR2(2000);\nBEGIN\nFOR i IN c_usuarios LOOP\nv_output := v_output || 'REVOKE DELETE ON scott.' || p_tabla || ' FROM ' || i.grantee || ';' || chr(10);\nEND LOOP;\nRETURN v_output;\nEND;\n/\n</code></pre>"},{"location":"p5-usuarios/rg/caso-practico-1-ej2/#1-comprobaciones","title":"1. Comprobaciones","text":"<p>Para que la prueba funcione a\u00f1ado los siguientes privilegios de borrado sobre la tabla a probar de SCOTT en algunos usuarios:</p> <pre><code>GRANT DELETE ON scott.dept TO hipodromo;\nGRANT DELETE ON scott.dept TO examenbd34;\n</code></pre> <p>Lanzo la consulta que genera el script y muestro el output:</p> <pre><code>SELECT generador_script_quitar_privilegios('DEPT') AS \"Copia y pega este script\" FROM dual;\n</code></pre> <pre><code>Copia y pega este script\n--------------------------------------------------\nREVOKE DELETE ON scott.DEPT FROM HIPODROMO;\nREVOKE DELETE ON scott.DEPT FROM EXAMENBD34;\n</code></pre> <p>Ya s\u00f3lo tendr\u00edamos que copiar y pegar el resultado, y quitar\u00edamos los privilegios.</p>"},{"location":"p5-usuarios/rg/caso-practico-1-ej2/#2-postgresql","title":"2. PostgreSQL","text":""},{"location":"p5-usuarios/rg/caso-practico-1-ej2/#2-pasos-previos","title":"2. Pasos previos","text":"<p>Para que el output de la funci\u00f3n sea \"copiable y pegable\", tenemos que acceder a postgres as\u00ed:</p> <pre><code>psql -At\n</code></pre> <p>Warning</p> <p>Si no se hace esto, osea si se accede de forma normal, el output de la funci\u00f3n saldr\u00e1 con signos <code>+</code> al final de las l\u00edneas y no ser\u00e1 \"copiable y pegable\"</p> <p>Las funciones en PostgreSQL se almacenan seg\u00fan la base de datos a la que estemos conectados, as\u00ed que nos conectamos a la base de datos sobre la que queramos usar la funci\u00f3n:</p> <pre><code>\\c scott\n</code></pre>"},{"location":"p5-usuarios/rg/caso-practico-1-ej2/#2-codigo","title":"2. C\u00f3digo","text":"<pre><code>CREATE OR REPLACE FUNCTION generador_script_quitar_privilegios(p_tabla text)\nRETURNS text AS $$\nDECLARE\nc_usuarios CURSOR FOR\nSELECT grantee FROM information_schema.role_table_grants WHERE privilege_type = 'DELETE' AND table_name = p_tabla;\nv_output text := '';\nBEGIN\nFOR i IN c_usuarios LOOP\nv_output := v_output || 'REVOKE DELETE ON ' || p_tabla || ' FROM ' || i.grantee || ';' || E'\\n';\nEND LOOP;\nRETURN v_output;\nEND;\n$$ LANGUAGE plpgsql;\n</code></pre>"},{"location":"p5-usuarios/rg/caso-practico-1-ej2/#2-comprobaciones","title":"2. Comprobaciones","text":"<p>Lanzo la consulta que genera el script y muestro el output:</p> <pre><code>scott=# SELECT generador_script_quitar_privilegios('dept');\nREVOKE DELETE ON dept FROM postgres;\nREVOKE DELETE ON dept FROM scott;\n</code></pre> <p>Ya s\u00f3lo tendr\u00edamos que copiar y pegar el resultado, y quitar\u00edamos los privilegios.</p>"},{"location":"p5-usuarios/rg/caso-practico-1-ej2/#3-mariadb","title":"3. MariaDB","text":""},{"location":"p5-usuarios/rg/caso-practico-1-ej2/#3-pasos-previos","title":"3. Pasos previos","text":"<p>Es necesario acceder as\u00ed:</p> <pre><code>sudo mariadb -Nsr\n</code></pre> <p>Tambi\u00e9n que entre en la base de datos a usar:</p> <pre><code>USE scott;\n</code></pre> <p>Para que la prueba luego funcione, a\u00f1ado el siguiente privilegio de borrado sobre la tabla a probar de SCOTT:</p> <pre><code>GRANT DELETE ON dept TO 'scott'@'%' IDENTIFIED BY '1234';\nflush privileges;\n</code></pre>"},{"location":"p5-usuarios/rg/caso-practico-1-ej2/#3-codigo","title":"3. C\u00f3digo","text":"<pre><code>DELIMITER //\nCREATE OR REPLACE FUNCTION generador_script_quitar_privilegios(p_tabla text)\nRETURNS text\nBEGIN\nDECLARE v_output text default '';\nDECLARE done INT DEFAULT FALSE;\nDECLARE usuario TEXT;\nDECLARE c_usuarios CURSOR FOR SELECT user\nFROM mysql.tables_priv\nWHERE table_priv = 'delete'\nAND table_name = p_tabla\nAND db = 'scott';\nDECLARE CONTINUE HANDLER FOR NOT FOUND SET done = TRUE;\nOPEN c_usuarios;\nREPEAT\nFETCH c_usuarios INTO usuario;\nIF NOT done THEN\nSET v_output = CONCAT(v_output, 'REVOKE DELETE ON ', p_tabla, ' FROM ', usuario, ';' , '\\n');\nEND IF;\nUNTIL done\nEND REPEAT;\nCLOSE c_usuarios;\nRETURN v_output;\nEND //\nDELIMITER ;\n</code></pre>"},{"location":"p5-usuarios/rg/caso-practico-1-ej2/#3-comprobaciones","title":"3. Comprobaciones","text":"<p>Lanzo la consulta que genera el script y muestro el output:</p> <pre><code>MariaDB [scott]&gt; SELECT generador_script_quitar_privilegios('dept');\nREVOKE DELETE ON dept FROM scott;\n</code></pre> <p>Ya s\u00f3lo tendr\u00edamos que copiar y pegar el resultado, y quitar\u00edamos los privilegios.</p>"},{"location":"p5-usuarios/rg/caso-practico-1-ej3/","title":"Ejercicio 3","text":""},{"location":"p5-usuarios/rg/caso-practico-1-ej3/#enunciado","title":"Enunciado","text":"<p>Crea un tablespace TS2 con tama\u00f1o de extensi\u00f3n de 256K. Realiza una consulta que genere un script que asigne ese tablespace como tablespace por defecto a los usuarios que no tienen privilegios para consultar ninguna tabla de SCOTT, excepto a SYSTEM.</p>"},{"location":"p5-usuarios/rg/caso-practico-1-ej3/#creacion","title":"Creaci\u00f3n","text":"<p>Creamos el tablespace TS2:</p> <pre><code>SQL&gt; CREATE TABLESPACE TS2\nDATAFILE 'TS2.dbf' SIZE 256K\nEXTENT MANAGEMENT LOCAL AUTOALLOCATE;\nTablespace creado.\n</code></pre>"},{"location":"p5-usuarios/rg/caso-practico-1-ej3/#comprobacion","title":"Comprobaci\u00f3n","text":"<p>Realizamos la consulta que nos generara un script:</p> <pre><code>SQL&gt; SELECT 'ALTER USER ' || username || ' DEFAULT TABLESPACE TS2;'\nFROM dba_users\nWHERE username NOT IN (SELECT grantee FROM dba_tab_privs WHERE owner = 'SCOTT')\nAND username != 'SYSTEM';\n'ALTERUSER'||USERNAME||'DEFAULTTABLESPACETS2;'\n--------------------------------------------------------------------------------\nALTER USER XS$NULL DEFAULT TABLESPACE TS2;\nALTER USER SYS DEFAULT TABLESPACE TS2;\nALTER USER OJVMSYS DEFAULT TABLESPACE TS2;\nALTER USER LBACSYS DEFAULT TABLESPACE TS2;\nALTER USER OUTLN DEFAULT TABLESPACE TS2;\nALTER USER SYS$UMF DEFAULT TABLESPACE TS2;\nALTER USER DBSNMP DEFAULT TABLESPACE TS2;\nALTER USER APPQOSSYS DEFAULT TABLESPACE TS2;\nALTER USER DBSFWUSER DEFAULT TABLESPACE TS2;\nALTER USER GGSYS DEFAULT TABLESPACE TS2;\nALTER USER ANONYMOUS DEFAULT TABLESPACE TS2;\nALTER USER CTXSYS DEFAULT TABLESPACE TS2;\nALTER USER DVSYS DEFAULT TABLESPACE TS2;\nALTER USER DVF DEFAULT TABLESPACE TS2;\nALTER USER GSMADMIN_INTERNAL DEFAULT TABLESPACE TS2;\nALTER USER MDSYS DEFAULT TABLESPACE TS2;\nALTER USER OLAPSYS DEFAULT TABLESPACE TS2;\nALTER USER XDB DEFAULT TABLESPACE TS2;\nALTER USER WMSYS DEFAULT TABLESPACE TS2;\nALTER USER GSMCATUSER DEFAULT TABLESPACE TS2;\nALTER USER MDDATA DEFAULT TABLESPACE TS2;\nALTER USER SYSBACKUP DEFAULT TABLESPACE TS2;\nALTER USER REMOTE_SCHEDULER_AGENT DEFAULT TABLESPACE TS2;\nALTER USER GSMUSER DEFAULT TABLESPACE TS2;\nALTER USER EXAMENPLSQL DEFAULT TABLESPACE TS2;\nALTER USER SYSRAC DEFAULT TABLESPACE TS2;\nALTER USER GSMROOTUSER DEFAULT TABLESPACE TS2;\nALTER USER JUVENIL DEFAULT TABLESPACE TS2;\nALTER USER SI_INFORMTN_SCHEMA DEFAULT TABLESPACE TS2;\nALTER USER AUDSYS DEFAULT TABLESPACE TS2;\nALTER USER DIP DEFAULT TABLESPACE TS2;\nALTER USER ORDPLUGINS DEFAULT TABLESPACE TS2;\nALTER USER JOSEJU DEFAULT TABLESPACE TS2;\nALTER USER SYSKM DEFAULT TABLESPACE TS2;\nALTER USER ORDDATA DEFAULT TABLESPACE TS2;\nALTER USER ORACLE_OCM DEFAULT TABLESPACE TS2;\nALTER USER HIPODROMO DEFAULT TABLESPACE TS2;\nALTER USER C###JOSEJU10 DEFAULT TABLESPACE TS2;\nALTER USER SYSDG DEFAULT TABLESPACE TS2;\nALTER USER ORDSYS DEFAULT TABLESPACE TS2;\n40 filas seleccionadas.\n</code></pre> <ul> <li>Ejecutamos el script:</li> </ul> <pre><code>SQL&gt; ALTER USER XS$NULL DEFAULT TABLESPACE TS2;\nALTER USER SYS DEFAULT TABLESPACE TS2;\nALTER USER OJVMSYS DEFAULT TABLESPACE TS2;\nALTER USER LBACSYS DEFAULT TABLESPACE TS2;\nALTER USER OUTLN DEFAULT TABLESPACE TS2;\nALTER USER SYS$UMF DEFAULT TABLESPACE TS2;\nALTER USER DBSNMP DEFAULT TABLESPACE TS2;\nALTER USER APPQOSSYS DEFAULT TABLESPACE TS2;\nALTER USER DBSFWUSER DEFAULT TABLESPACE TS2;\nALTER USER GGSYS DEFAULT TABLESPACE TS2;\nALTER USER ANONYMOUS DEFAULT TABLESPACE TS2;\nALTER USER CTXSYS DEFAULT TABLESPACE TS2;\nALTER USER DVSYS DEFAULT TABLESPACE TS2;\nALTER USER DVF DEFAULT TABLESPACE TS2;\nALTER USER GSMADMIN_INTERNAL DEFAULT TABLESPACE TS2;\nALTER USER MDSYS DEFAULT TABLESPACE TS2;\nALTER USER OLAPSYS DEFAULT TABLESPACE TS2;\nALTER USER XDB DEFAULT TABLESPACE TS2;\nALTER USER WMSYS DEFAULT TABLESPACE TS2;\nALTER USER GSMCATUSER DEFAULT TABLESPACE TS2;\nALTER USER MDDATA DEFAULT TABLESPACE TS2;\nALTER USER SYSBACKUP DEFAULT TABLESPACE TS2;\nALTER USER REMOTE_SCHEDULER_AGENT DEFAULT TABLESPACE TS2;\nALTER USER GSMUSER DEFAULT TABLESPACE TS2;\nALTER USER EXAMENPLSQL DEFAULT TABLESPACE TS2;\nALTER USER SYSRAC DEFAULT TABLESPACE TS2;\nALTER USER GSMROOTUSER DEFAULT TABLESPACE TS2;\nALTER USER JUVENIL DEFAULT TABLESPACE TS2;\nALTER USER SI_INFORMTN_SCHEMA DEFAULT TABLESPACE TS2;\nALTER USER AUDSYS DEFAULT TABLESPACE TS2;\nALTER USER DIP DEFAULT TABLESPACE TS2;\nALTER USER ORDPLUGINS DEFAULT TABLESPACE TS2;\nALTER USER JOSEJU DEFAULT TABLESPACE TS2;\nALTER USER SYSKM DEFAULT TABLESPACE TS2;\nALTER USER ORDDATA DEFAULT TABLESPACE TS2;\nALTER USER ORACLE_OCM DEFAULT TABLESPACE TS2;\nALTER USER HIPODROMO DEFAULT TABLESPACE TS2;\nALTER USER C###JOSEJU10 DEFAULT TABLESPACE TS2;\nALTER USER SYSDG DEFAULT TABLESPACE TS2;\nALTER USER ORDSYS DEFAULT TABLESPACE TS2;ALTER USER XS$NULL DEFAULT TABLESPACE TS2\n*\nSQL&gt; Usuario modificado.\n</code></pre>"},{"location":"p5-usuarios/rg/caso-practico-1-ej4-oracle/","title":"Ejercicio 4 Oracle","text":""},{"location":"p5-usuarios/rg/caso-practico-1-ej4-oracle/#enunciado","title":"Enunciado","text":"<p>Realizar un procedimiento que reciba un nombre de usuario y nos muestre cu\u00e1ntas sesiones tiene abiertas en este momento. Adem\u00e1s, para cada una de dichas sesiones nos mostrar\u00e1 la hora de comienzo y el nombre de la m\u00e1quina, sistema operativo y programa desde el que fue abierta.</p>"},{"location":"p5-usuarios/rg/caso-practico-1-ej4-oracle/#codigo","title":"C\u00f3digo","text":"<pre><code>CREATE OR REPLACE PROCEDURE MostrarSesionUsuario (\np_usuario VARCHAR2\n) IS\nCURSOR c_datos IS\nSELECT s.sid,s.serial#,s.username,s.machine,s.osuser,s.program,s.logon_time\nFROM V$SESSION s\nWHERE s.username = upper(p_usuario)\nAND status='ACTIVE';\nBEGIN\nFOR i IN c_datos LOOP\nDBMS_OUTPUT.PUT_LINE('SID: ' || i.sid);\nDBMS_OUTPUT.PUT_LINE('Serial#: ' || i.serial#);\nDBMS_OUTPUT.PUT_LINE('Username: ' || i.username);\nDBMS_OUTPUT.PUT_LINE('Machine: ' || i.machine);\nDBMS_OUTPUT.PUT_LINE('OS User: ' || i.osuser);\nDBMS_OUTPUT.PUT_LINE('Program: ' || i.program);\nDBMS_OUTPUT.PUT_LINE('Logon Time: ' || i.logon_time);\nDBMS_OUTPUT.PUT_LINE('----------------');\nEND LOOP;\nEND;\n/\n</code></pre>"},{"location":"p5-usuarios/rg/caso-practico-1-ej4-oracle/#comprobaciones","title":"Comprobaciones","text":"<pre><code>SQL&gt; exec MostrarSesionUsuario('sys');\nSID: 22\nSerial#: 29357\nUsername: SYS\nMachine: joseju\\joseju\nOS User: joseju\nProgram: OracleVSCodeServer60.dll\nLogon Time: 17-JAN-23\n----------------\nSID: 401\nSerial#: 17964\nUsername: SYS\nMachine: oracle\nOS User: oracle\nProgram: oracle@oracle (OFSD)\nLogon Time: 17-JAN-23\n----------------\nPL/SQL procedure successfully completed.\n</code></pre>"},{"location":"p5-usuarios/rg/caso-practico-1-ej4-postgres/","title":"Ejercicio 4 PostgreSQL","text":""},{"location":"p5-usuarios/rg/caso-practico-1-ej4-postgres/#pasos-previos","title":"Pasos previos","text":"<p>Modifico el siguiente par\u00e1metro en <code>/etc/postgresql/13/main/postgresql.conf</code>:</p> <pre><code>log_hostname = on\n</code></pre> <p>Reinicio:</p> <pre><code>sudo systemctl restart postgresql\n</code></pre> <p>Info</p> <p>Es necesario activar ese par\u00e1metro para que luego aparezca el hostname</p>"},{"location":"p5-usuarios/rg/caso-practico-1-ej4-postgres/#codigo","title":"C\u00f3digo","text":"<pre><code>CREATE OR REPLACE PROCEDURE MostrarSesionesUsuario (p_usuario VARCHAR)\nAS $$\nDECLARE\nc_sesiones CURSOR FOR SELECT client_hostname,backend_start,application_name\nFROM pg_stat_activity\nWHERE usename = p_usuario;\nv_hora VARCHAR;\nBEGIN\nFOR i IN c_sesiones LOOP\nv_hora := i.backend_start;\nSELECT SUBSTRING(v_hora from 12 for 8) INTO v_hora;\nRAISE NOTICE 'Hora de comienzo: %', v_hora;\nRAISE NOTICE 'Hostname: %', i.client_hostname;\nRAISE NOTICE 'Programa: %', i.application_name;\nRAISE NOTICE '----------------';\nEND LOOP;\nEND;\n$$ LANGUAGE plpgsql;\n</code></pre>"},{"location":"p5-usuarios/rg/caso-practico-1-ej4-postgres/#comprobaciones","title":"Comprobaciones","text":"<p>Muestro las sesiones del usuario <code>postgres</code>:</p> <pre><code>postgres=# CALL MostrarSesionesUsuario('postgres');\nNOTICE:  Hora de comienzo: 09:48:14\nNOTICE:  Hostname: &lt;NULL&gt;\nNOTICE:  Programa: NOTICE:  ----------------\nNOTICE:  Hora de comienzo: 09:48:57\nNOTICE:  Hostname: &lt;NULL&gt;\nNOTICE:  Programa: psql\nNOTICE:  ----------------\nNOTICE:  Hora de comienzo: 09:58:55\nNOTICE:  Hostname: servidorpostgresql1\nNOTICE:  Programa: psql\nNOTICE:  ----------------\n</code></pre> <p>La \u00faltima sesi\u00f3n es la nuestra.</p>"},{"location":"p5-usuarios/rg/caso-practico-1-ej5/","title":"Ejercicio 5","text":""},{"location":"p5-usuarios/rg/caso-practico-1-ej5/#enunciado","title":"Enunciado","text":"<p>Realiza un procedimiento que muestre los usuarios que pueden conceder privilegios de sistema a otros usuarios y cuales son dichos privilegios.</p>"},{"location":"p5-usuarios/rg/caso-practico-1-ej5/#codigo","title":"C\u00f3digo","text":"<pre><code>SQL&gt; CREATE OR REPLACE PROCEDURE mostrar_privilegios_sistema\nAS\nCURSOR c_info IS\nSELECT USERNAME, PRIVILEGE\nFROM USER_SYS_PRIVS\nWHERE PRIVILEGE IN ('CREATE USER', 'ALTER USER', 'DROP USER');\nv_usuario VARCHAR2(30);\nv_privilegio VARCHAR2(30);\nBEGIN\nDBMS_OUTPUT.PUT_LINE('Usuarios que tienen privilegios de sistema y sus privilegios:');\nDBMS_OUTPUT.PUT_LINE('--------------------------------------------------------------');\nFOR i IN c_info LOOP\nv_usuario := i.USERNAME;\nv_privilegio := i.PRIVILEGE;\nDBMS_OUTPUT.PUT_LINE(v_usuario || ' tiene el privilegio de ' || v_privilegio);\nEND LOOP;\nEND mostrar_privilegios_sistema;\n/\nProcedimiento creado.\n</code></pre>"},{"location":"p5-usuarios/rg/caso-practico-1-ej5/#comprobacion","title":"Comprobaci\u00f3n","text":"<pre><code>SQL&gt; exec mostrar_privilegios_sistema;\nUsuarios que tienen privilegios de sistema y sus privilegios:\n--------------------------------------------------------------\nSYS tiene el privilegio de ALTER USER\nSYS tiene el privilegio de DROP USER\nSYS tiene el privilegio de CREATE USER\nPL/SQL procedure successfully completed.\nCommit complete.\n</code></pre>"},{"location":"p5-usuarios/rg/caso-practico-2-ej1/","title":"Ejercicio 1 (Oracle)","text":""},{"location":"p5-usuarios/rg/caso-practico-2-ej1/#enunciado","title":"Enunciado","text":"<p>La vida de un DBA es dura. Tras pedirlo insistentemente, en tu empresa han contratado una persona para ayudarte. Decides que se encargar\u00e1 de las siguientes tareas:</p> <ul> <li>Resetear los archivos de log en caso de necesidad.</li> <li>Crear funciones de complejidad de contrase\u00f1a y asign\u00e1rselas a  usuarios.</li> <li>Eliminar la informaci\u00f3n de rollback. (este privilegio podr\u00e1 pasarlo a quien quiera)</li> <li>Modificar informaci\u00f3n existente en la tabla dept del usuario scott. (este privilegio podr\u00e1 pasarlo a quien quiera)</li> <li>Realizar pruebas de todos los procedimientos existentes en la base de datos.</li> <li>Poner un tablespace fuera de l\u00ednea.</li> </ul> <p>Crea un usuario llamado Ayudante y, sin usar los roles predefinidos de ORACLE, dale  los privilegios m\u00ednimos para que pueda resolver dichas tareas.</p> <p>Pista: Si no recuerdas el nombre de un privilegio, puedes buscarlo en el diccionario de datos.</p>"},{"location":"p5-usuarios/rg/caso-practico-2-ej1/#realizacion","title":"Realizaci\u00f3n","text":"<p>Vamos a crear un usuario llamado ayudante:</p> <pre><code>CREATE USER ayudante identified by ayudante;\n</code></pre> <p>Ahora vamos a crear el rol:</p> <pre><code>CREATE ROLE rol_ayudante;\nGRANT ALTER SYSTEM TO rol_ayudante;\nGRANT CREATE SESSION TO rol_ayudante;\nGRANT SELECT ON v_$log TO rol_ayudante;\nGRANT CREATE ANY PROCEDURE TO rol_ayudante;\nGRANT ALTER PROFILE TO rol_ayudante;\nGRANT DROP ROLLBACK SEGMENT TO rol_ayudante WITH ADMIN OPTION;\nGRANT FLASHBACK ANY TABLE TO rol_ayudante WITH ADMIN OPTION;\nGRANT SELECT, UPDATE, DELETE ON scott.dept TO rol_ayudante;\nGRANT EXECUTE ANY PROCEDURE TO rol_ayudante;\nGRANT ALTER TABLESPACE TO rol_ayudante;\nGRANT rol_ayudante TO ayudante;\n</code></pre>"},{"location":"p5-usuarios/rg/caso-practico-2-ej1/#comprobaciones","title":"Comprobaciones","text":"<p>Aqu\u00ed vamos a ver que con el usuario ayudante gracias al rol que ahora tenemos podemos ver las tablas de SCOTT.DEPT:</p> <p></p> <p>Ahora vamos a hacer una prueba de perfil en el cual har\u00e9 que incremente el l\u00edmite de sesiones por usuario:</p> <p></p> <p>Aqu\u00ed incrementar\u00e9 el tiempo de conexi\u00f3n del usuario a 10 minutos:</p> <p></p>"},{"location":"p5-usuarios/rg/caso-practico-2-ej2/","title":"Ejercicio 2 (Oracle)","text":""},{"location":"p5-usuarios/rg/caso-practico-2-ej2/#enunciado","title":"Enunciado","text":"<p>Muestra el texto de la \u00faltima sentencia SQL que se ejecut\u00f3 en el servidor, junto con el n\u00famero de veces que se ha ejecutado desde que se carg\u00f3 en el Shared Pool y el tiempo de CPU empleado en su ejecuci\u00f3n</p>"},{"location":"p5-usuarios/rg/caso-practico-2-ej2/#codigo","title":"C\u00f3digo","text":"<pre><code>SELECT DISTINCT sql_text,executions,cpu_time\nFROM v$sqlarea\nORDER BY first_load_time DESC\nFETCH FIRST 1 ROWS ONLY;\n</code></pre>"},{"location":"p5-usuarios/rg/caso-practico-2-ej2/#comprobacion","title":"Comprobaci\u00f3n","text":"<p>Podemos comprobar que la \u00faltima sentencia que se ejecut\u00f3 fue \"select * from pelicula\", se ha ejecutado 1 vez desde que se carg\u00f3 en el Shared Pool y el tiempo usado ha sido 21710.</p> <p></p>"},{"location":"p5-usuarios/rg/caso-practico-2-ej3/","title":"Ejercicio 3 (Oracle, Postgres)","text":""},{"location":"p5-usuarios/rg/caso-practico-2-ej3/#enunciado","title":"Enunciado","text":"<p>Realiza un procedimiento que reciba dos nombres de usuario y genere un script que asigne al primero los privilegios de inserci\u00f3n y modificaci\u00f3n sobre todas las tablas del segundo, as\u00ed como el de ejecuci\u00f3n de cualquier procedimiento que tenga el segundo usuario.</p>"},{"location":"p5-usuarios/rg/caso-practico-2-ej3/#codigo","title":"C\u00f3digo","text":"<p>Primero vamos a crear el procedimiento que ceder\u00e1 los privilegios sobre objetos sobre el segundo usuario:</p> <pre><code>CREATE OR REPLACE PROCEDURE conceder_privilegios (p_privilegiado VARCHAR2, p_cede VARCHAR2)\nAS\nv_sql VARCHAR2(2000);\nv_tab_name VARCHAR2(40);\nv_proc_name VARCHAR2(40);\nBEGIN\nCOMPROBARUSUARIO(p_privilegiado,p_cede);\nFOR v_tablas IN (SELECT table_name FROM all_tables WHERE owner = p_cede) LOOP\nv_tab_name := v_tablas.table_name;\nv_sql := 'GRANT INSERT, UPDATE ON ' || p_cede || '.' || v_tab_name || ' TO ' || p_privilegiado;\nEXECUTE IMMEDIATE v_sql;\nEND LOOP;\nFOR v_objeto IN (SELECT object_name FROM all_procedures WHERE owner = p_cede) LOOP\nv_proc_name := v_objeto.object_name;\nv_sql := 'GRANT EXECUTE ON ' || p_cede || '.' || v_proc_name || ' TO ' || p_privilegiado;\nEXECUTE IMMEDIATE v_sql;\nEND LOOP;\nEND;\n/\n</code></pre> <p>Ahora vamos a hacer el c\u00f3digo de comprobaci\u00f3n de usuario:</p> <pre><code>CREATE OR REPLACE PROCEDURE comprobarusuario (\np_privilegiado VARCHAR2,\np_cede VARCHAR2\n) IS\nv_resultado NUMBER;\nBEGIN\nSELECT COUNT (username) INTO v_resultado\nFROM dba_users\nWHERE username = p_privilegiado\nOR username = p_cede;\nIF v_resultado &lt; 2 THEN\nraise_application_error(-20110, 'Hay uno o varios usuarios que no existen');\nEND IF;\nEND;\n/\n</code></pre>"},{"location":"p5-usuarios/rg/caso-practico-2-ej3/#comprobaciones","title":"Comprobaciones","text":"<p>Ahora procedemos a hacer la prueba de ingresar un usuario que no exista, tras esto introduciremos el usuario v\u00e1lido:</p> <p></p> <p>Ahora la prueba de funcionamiento, entramos en el usuario antonio para ver si tenemos acceso a las tablas:</p> <p></p>"},{"location":"p5-usuarios/rg/caso-practico-2-ej4/","title":"Ejercicio 4 (Oracle)","text":""},{"location":"p5-usuarios/rg/caso-practico-2-ej4/#enunciado","title":"Enunciado","text":"<p>Realiza un procedimiento que genere un script que cree un rol conteniendo todos los permisos que tenga el usuario cuyo nombre reciba como par\u00e1metro, le hayan sido asignados a aqu\u00e9l directamente o a traves de roles. El nuevo rol deber\u00e1 llamarse BackupPrivsNombreUsuario</p>"},{"location":"p5-usuarios/rg/caso-practico-2-ej4/#codigo","title":"C\u00f3digo","text":"<p>Este ser\u00eda el procedimiento principal, al cual le dar\u00edamos un usuario y, si existe, nos mostrar\u00e1 por pantalla la creaci\u00f3n del rol y la asignaci\u00f3n de todos los privilegios (de sistema, sobre objetos y sobre columnas) al rol creado.</p> <pre><code>create or replace procedure CrearRol (p_usuario varchar2)\nis\nv_validacion number:=0;\nv_nuevoRol varchar(50):='BackupPrivs'||p_usuario;\nbegin\nv_validacion:=ComprobarUsuario(p_usuario);\nif v_validacion=0 then\ndbms_output.put_line('CREATE ROLE BackupPrivs'||p_usuario);\nSysPrivs(p_usuario, v_nuevoRol);\nPrivsObjetos(p_usuario, v_nuevoRol);\nColPrivs(p_usuario, v_nuevorol);\nend if;\nend CrearRol;\n/\n</code></pre> <p>Los siguientes procedimientos buscan los privilegios por objeto y del sistema del usuario especificado en el procedimiento principal.</p> <p>PrivsObjetos asigna los privilegios sobre objetos a trav\u00e9s de un cursor que recupera los privilegios sobre objetos de DBA_TAB_PRIVS para el usuario especificado o para cualquier rol asignado al usuario, y SysPrivs asigna los privilegios del sistema de la misma manera a trav\u00e9s de otro cursor que recupera los privilegios de DBA_SYS_PRIVS. ColPrivs hace lo mismo que los anteriores pero recupera los privilegios sobre columnas (DBA_COL_PRIVS) del usuario.</p> <pre><code>create or replace procedure PrivsObjetos(p_usuario varchar2, p_nuevoRol varchar2)\nis\ncursor c_tabprivs is\nselect distinct PRIVILEGE, OWNER, TABLE_NAME from DBA_TAB_PRIVS where GRANTEE=p_usuario or GRANTEE in\n(select distinct granted_role from DBA_ROLE_PRIVS start with GRANTEE=p_usuario connect by GRANTEE=prior GRANTED_ROLE);\nv_cursor c_tabprivs%ROWTYPE;\nbegin\nfor v_cursor in c_tabprivs loop\nAgregarPrivsObjeto(v_cursor.PRIVILEGE, v_cursor.OWNER, v_cursor.TABLE_NAME, p_nuevoRol);\nend loop;\nend PrivsObjetos;\n/\ncreate or replace procedure SysPrivs(p_usuario varchar2, p_nuevoRol varchar2)\nis\ncursor c_sysprivs is\nselect distinct PRIVILEGE, ADMIN_OPTION from DBA_SYS_PRIVS where GRANTEE=p_usuario or GRANTEE in\n(select distinct granted_role from DBA_ROLE_PRIVS start with GRANTEE = p_usuario connect by GRANTEE = prior GRANTED_ROLE);\nv_cursor c_sysprivs%ROWTYPE;\nbegin\nfor v_cursor in c_sysprivs loop\nAgregarSysPrivs(v_cursor.PRIVILEGE, v_cursor.ADMIN_OPTION, p_nuevoRol);\nend loop;\nend SysPrivs;\n/\ncreate or replace procedure ColPrivs(p_usuario varchar2, p_nuevoRol varchar2)\nis\ncursor c_colprivs is\nselect distinct PRIVILEGE, OWNER, TABLE_NAME, COLUMN_NAME from DBA_COL_PRIVS where GRANTEE=p_usuario or GRANTEE in\n(select distinct granted_role from DBA_ROLE_PRIVS start with GRANTEE = p_usuario connect by GRANTEE = prior GRANTED_ROLE);\nv_cursor c_colprivs%ROWTYPE;\nbegin\nfor v_cursor in c_colprivs loop\nAgregarColPrivs(v_cursor.PRIVILEGE, v_cursor.OWNER, v_cursor.TABLE_NAME, v_cursor.COLUMN_NAME, p_nuevoRol);\nend loop;\nend ColPrivs;\n/\n</code></pre> <p>Los procedimientos AgregarPrivsObjeto, AgregarSysPrivs y AgregarColPrivs, con lo datos obtenido en los cursores de los procedimientos anteriores, devuelven el c\u00f3digo concreto del script que se mostrar\u00e1 por pantalla al ejecutar el procedimiento principal.</p> <pre><code>create or replace procedure AgregarPrivsObjeto(p_privilegio DBA_TAB_PRIVS.PRIVILEGE%TYPE, p_propietario DBA_TAB_PRIVS.OWNER%TYPE, p_nombreTabla DBA_TAB_PRIVS.TABLE_NAME%TYPE, p_nuevoRol varchar2)\nis\nbegin\ndbms_output.put_line('grant '||p_privilegio||' on '||p_propietario||'.'||p_nombreTabla||' to '||p_nuevoRol||';');\nend AgregarPrivsObjeto;\n/\ncreate or replace procedure AgregarSysPrivs(p_privilegio USER_SYS_PRIVS.PRIVILEGE%TYPE, p_opcAdmin USER_SYS_PRIVS.ADMIN_OPTION%TYPE, p_nuevoRol varchar2)\nis\nbegin\nif p_opcAdmin='YES' then dbms_output.put_line('grant '||p_privilegio||' to '||p_nuevoRol||' with admin option;');\nelse dbms_output.put_line('grant '||p_privilegio||' to '||p_nuevoRol||';');\nend if;\nend AgregarSysPrivs;\n/\ncreate or replace procedure AgregarColPrivs(p_privilegio DBA_COL_PRIVS.PRIVILEGE%TYPE, p_propietario DBA_COL_PRIVS.OWNER%TYPE, p_nombreTabla DBA_COL_PRIVS.TABLE_NAME%TYPE, p_nombreColumna DBA_COL_PRIVS.COLUMN_NAME%TYPE, p_nuevoRol varchar2)\nis\nbegin\ndbms_output.put_line('grant '||p_privilegio||'('||p_nombreColumna||')'||' on '||p_propietario||'.'||p_nombreTabla||' to '||p_nuevoRol||';');\nend AgregarColPrivs;\n/\n</code></pre> <p>La funci\u00f3n ComprobarUsuario verifica si el usuario existe en la base de datos antes de asignarle los privilegios.</p> <pre><code>create or replace function ComprobarUsuario(p_usuario varchar2)\nreturn number\nis\nv_resultado varchar2(30);\nbegin\nselect USERNAME into v_resultado\nfrom DBA_USERS\nwhere USERNAME=p_usuario;\nreturn 0;\nexception\nwhen NO_DATA_FOUND then\ndbms_output.put_line('No existe el usuario '||p_usuario);\nreturn 1;\nend ComprobarUsuario;\n/\n</code></pre>"},{"location":"p5-usuarios/rg/caso-practico-2-ej4/#comprobacion","title":"Comprobaci\u00f3n","text":"<p>En la captura de pantalla vemos que si usamos el procedimiento CrearRol con un usuario que no existe nos aparece el mensaje \"No existe el usuario usuario\". En cambio si lo usamos con el usuario ADMIN nos mostrar\u00e1 todos los grant que deberemos aplicar al nuevo rol creado, que en este caso ser\u00e1n todos, ya que el usuario admin tiene todos los privilegios otorgados.</p> <p></p> <p>Si creo un usuario nuevo y usamos el procedimiento sobre este solo creara el rol pero como no le he otorgado ning\u00fan privilegio no aparecer\u00e1 nada m\u00e1s.</p> <p></p> <p>Dejo aqu\u00ed el c\u00f3digo devuelto para que se vea m\u00e1s claro:</p> <pre><code>exec CrearRol('usuario');\nNo existe el usuario usuario\nProcedimiento PL/SQL terminado correctamente.\nexec CrearRol('ADMIN');\nCREATE ROLE BackupPrivsADMIN\ngrant CREATE ANY TABLE to BackupPrivsADMIN;\ngrant ALTER DATABASE to BackupPrivsADMIN;\ngrant DROP ANY OUTLINE to BackupPrivsADMIN;\ngrant ALTER ANY HIERARCHY to BackupPrivsADMIN;\ngrant ALTER ANY INDEX to BackupPrivsADMIN;\ngrant DROP ANY RULE to BackupPrivsADMIN;\ngrant CREATE MINING MODEL to BackupPrivsADMIN;\ngrant RESTRICTED SESSION to BackupPrivsADMIN;\ngrant SELECT ANY TABLE to BackupPrivsADMIN;\ngrant GRANT ANY ROLE to BackupPrivsADMIN;\ngrant ALTER ANY ROLE to BackupPrivsADMIN;\ngrant DROP ANY OPERATOR to BackupPrivsADMIN;\ngrant EXECUTE ANY PROGRAM to BackupPrivsADMIN;\ngrant SELECT ANY CUBE BUILD PROCESS to BackupPrivsADMIN;\ngrant ALTER ANY RULE to BackupPrivsADMIN;\ngrant DROP ANY ASSEMBLY to BackupPrivsADMIN;\ngrant ALTER ANY CUBE BUILD PROCESS to BackupPrivsADMIN;\ngrant DROP ANY HIERARCHY to BackupPrivsADMIN;\ngrant ALTER ANY DIMENSION to BackupPrivsADMIN;\ngrant CREATE ANY SQL PROFILE to BackupPrivsADMIN;\ngrant SELECT ANY CUBE to BackupPrivsADMIN;\ngrant CREATE CUBE BUILD PROCESS to BackupPrivsADMIN;\ngrant CREATE ANY CUBE BUILD PROCESS to BackupPrivsADMIN;\ngrant LOCK ANY TABLE to BackupPrivsADMIN;\ngrant ALTER ANY INDEXTYPE to BackupPrivsADMIN;\ngrant CREATE ANY OUTLINE to BackupPrivsADMIN;\ngrant EXECUTE ANY RULE SET to BackupPrivsADMIN;\ngrant DROP PUBLIC SYNONYM to BackupPrivsADMIN;\ngrant CREATE ANY VIEW to BackupPrivsADMIN;\ngrant MANAGE ANY FILE GROUP to BackupPrivsADMIN;\ngrant MERGE ANY VIEW to BackupPrivsADMIN;\ngrant SELECT ANY TRANSACTION to BackupPrivsADMIN;\ngrant ALTER RESOURCE COST to BackupPrivsADMIN;\ngrant GLOBAL QUERY REWRITE to BackupPrivsADMIN;\ngrant CREATE ASSEMBLY to BackupPrivsADMIN;\ngrant ALTER USER to BackupPrivsADMIN;\ngrant CREATE SYNONYM to BackupPrivsADMIN;\ngrant DROP ANY TRIGGER to BackupPrivsADMIN;\ngrant ALTER LOCKDOWN PROFILE to BackupPrivsADMIN;\ngrant CREATE ATTRIBUTE DIMENSION to BackupPrivsADMIN;\ngrant DROP ANY TABLE to BackupPrivsADMIN;\ngrant AUDIT ANY to BackupPrivsADMIN;\ngrant EXECUTE ANY OPERATOR to BackupPrivsADMIN;\ngrant CHANGE NOTIFICATION to BackupPrivsADMIN;\ngrant CREATE CUBE DIMENSION to BackupPrivsADMIN;\ngrant DELETE ANY CUBE DIMENSION to BackupPrivsADMIN;\ngrant ADMINISTER RESOURCE MANAGER to BackupPrivsADMIN;\ngrant EXECUTE ANY ASSEMBLY to BackupPrivsADMIN;\ngrant CREATE ANALYTIC VIEW to BackupPrivsADMIN;\ngrant DELETE ANY TABLE to BackupPrivsADMIN;\ngrant CREATE TRIGGER to BackupPrivsADMIN;\ngrant SELECT ANY SEQUENCE to BackupPrivsADMIN;\ngrant CREATE PROCEDURE to BackupPrivsADMIN;\ngrant ALTER ANY ATTRIBUTE DIMENSION to BackupPrivsADMIN;\ngrant ALTER ANY OUTLINE to BackupPrivsADMIN;\ngrant CREATE ANY EDITION to BackupPrivsADMIN;\ngrant INSERT ANY CUBE DIMENSION to BackupPrivsADMIN;\ngrant CREATE ANY MEASURE FOLDER to BackupPrivsADMIN;\ngrant UPDATE ANY CUBE BUILD PROCESS to BackupPrivsADMIN;\ngrant ADMINISTER SQL MANAGEMENT OBJECT to BackupPrivsADMIN;\ngrant ALTER ANY MEASURE FOLDER to BackupPrivsADMIN;\ngrant CREATE ANY SYNONYM to BackupPrivsADMIN;\ngrant GRANT ANY PRIVILEGE to BackupPrivsADMIN;\ngrant DROP ANY RULE SET to BackupPrivsADMIN;\ngrant CREATE CUBE to BackupPrivsADMIN;\ngrant DROP ANY SQL TRANSLATION PROFILE to BackupPrivsADMIN;\ngrant DROP ANY EVALUATION CONTEXT to BackupPrivsADMIN;\ngrant CREATE ANY RULE SET to BackupPrivsADMIN;\ngrant COMMENT ANY MINING MODEL to BackupPrivsADMIN;\ngrant CREATE ANY SEQUENCE to BackupPrivsADMIN;\ngrant CREATE EVALUATION CONTEXT to BackupPrivsADMIN;\ngrant CREATE LIBRARY to BackupPrivsADMIN;\ngrant ALTER ANY RULE SET to BackupPrivsADMIN;\ngrant DROP ANY MINING MODEL to BackupPrivsADMIN;\ngrant DROP ANY CUBE to BackupPrivsADMIN;\ngrant READ ANY TABLE to BackupPrivsADMIN;\ngrant CREATE TABLESPACE to BackupPrivsADMIN;\ngrant MANAGE TABLESPACE to BackupPrivsADMIN;\ngrant CREATE ROLE to BackupPrivsADMIN;\ngrant ANALYZE ANY to BackupPrivsADMIN;\ngrant EXECUTE ANY TYPE to BackupPrivsADMIN;\ngrant EXECUTE ANY LIBRARY to BackupPrivsADMIN;\ngrant CREATE OPERATOR to BackupPrivsADMIN;\ngrant USE ANY JOB RESOURCE to BackupPrivsADMIN;\ngrant CREATE PUBLIC SYNONYM to BackupPrivsADMIN;\ngrant ALTER ANY MINING MODEL to BackupPrivsADMIN;\ngrant SELECT ANY CUBE DIMENSION to BackupPrivsADMIN;\ngrant CREATE ANY ATTRIBUTE DIMENSION to BackupPrivsADMIN;\ngrant CREATE SEQUENCE to BackupPrivsADMIN;\ngrant DROP PROFILE to BackupPrivsADMIN;\ngrant CREATE JOB to BackupPrivsADMIN;\ngrant CREATE ANY CUBE to BackupPrivsADMIN;\ngrant CREATE MEASURE FOLDER to BackupPrivsADMIN;\ngrant DROP ANY ATTRIBUTE DIMENSION to BackupPrivsADMIN;\ngrant DROP ANY INDEXTYPE to BackupPrivsADMIN;\ngrant QUERY REWRITE to BackupPrivsADMIN;\ngrant MANAGE SCHEDULER to BackupPrivsADMIN;\ngrant SELECT ANY MINING MODEL to BackupPrivsADMIN;\ngrant DROP ANY CUBE DIMENSION to BackupPrivsADMIN;\ngrant ALTER ROLLBACK SEGMENT to BackupPrivsADMIN;\ngrant EXECUTE ANY EVALUATION CONTEXT to BackupPrivsADMIN;\ngrant DROP ANY SEQUENCE to BackupPrivsADMIN;\ngrant UNDER ANY VIEW to BackupPrivsADMIN;\ngrant EXECUTE ANY RULE to BackupPrivsADMIN;\ngrant ADVISOR to BackupPrivsADMIN;\ngrant LOGMINING to BackupPrivsADMIN;\ngrant DROP USER to BackupPrivsADMIN;\ngrant RESUMABLE to BackupPrivsADMIN;\ngrant ALTER ANY SQL PROFILE to BackupPrivsADMIN;\ngrant SELECT ANY MEASURE FOLDER to BackupPrivsADMIN;\ngrant CREATE ANY HIERARCHY to BackupPrivsADMIN;\ngrant UNLIMITED TABLESPACE to BackupPrivsADMIN;\ngrant EXECUTE ANY PROCEDURE to BackupPrivsADMIN;\ngrant CREATE ANY INDEX to BackupPrivsADMIN;\ngrant DEBUG ANY PROCEDURE to BackupPrivsADMIN;\ngrant CREATE ANY EVALUATION CONTEXT to BackupPrivsADMIN;\ngrant ALTER SYSTEM to BackupPrivsADMIN;\ngrant CREATE ANY TRIGGER to BackupPrivsADMIN;\ngrant DROP ANY DIMENSION to BackupPrivsADMIN;\ngrant CREATE RULE to BackupPrivsADMIN;\ngrant BACKUP ANY TABLE to BackupPrivsADMIN;\ngrant GRANT ANY OBJECT PRIVILEGE to BackupPrivsADMIN;\ngrant UPDATE ANY CUBE DIMENSION to BackupPrivsADMIN;\ngrant USE ANY SQL TRANSLATION PROFILE to BackupPrivsADMIN;\ngrant ALTER TABLESPACE to BackupPrivsADMIN;\ngrant CREATE MATERIALIZED VIEW to BackupPrivsADMIN;\ngrant DROP ANY ANALYTIC VIEW to BackupPrivsADMIN;\ngrant UPDATE ANY TABLE to BackupPrivsADMIN;\ngrant CREATE ANY LIBRARY to BackupPrivsADMIN;\ngrant ADMINISTER SQL TUNING SET to BackupPrivsADMIN;\ngrant ALTER ANY ASSEMBLY to BackupPrivsADMIN;\ngrant CREATE CLUSTER to BackupPrivsADMIN;\ngrant CREATE ANY MATERIALIZED VIEW to BackupPrivsADMIN;\ngrant DROP ANY MEASURE FOLDER to BackupPrivsADMIN;\ngrant CREATE ANY CREDENTIAL to BackupPrivsADMIN;\ngrant CREATE HIERARCHY to BackupPrivsADMIN;\ngrant ALTER SESSION to BackupPrivsADMIN;\ngrant DROP TABLESPACE to BackupPrivsADMIN;\ngrant CREATE VIEW to BackupPrivsADMIN;\ngrant DEBUG CONNECT SESSION to BackupPrivsADMIN;\ngrant CREATE ANY JOB to BackupPrivsADMIN;\ngrant ADMINISTER ANY SQL TUNING SET to BackupPrivsADMIN;\ngrant CREATE PROFILE to BackupPrivsADMIN;\ngrant CREATE SESSION to BackupPrivsADMIN;\ngrant REDEFINE ANY TABLE to BackupPrivsADMIN;\ngrant CREATE ANY INDEXTYPE to BackupPrivsADMIN;\ngrant DROP ANY INDEX to BackupPrivsADMIN;\ngrant EXECUTE ANY INDEXTYPE to BackupPrivsADMIN;\ngrant ALTER ANY EDITION to BackupPrivsADMIN;\ngrant CREATE ANY ASSEMBLY to BackupPrivsADMIN;\ngrant CREATE LOCKDOWN PROFILE to BackupPrivsADMIN;\ngrant CREATE DIMENSION to BackupPrivsADMIN;\ngrant ON COMMIT REFRESH to BackupPrivsADMIN;\ngrant READ ANY FILE GROUP to BackupPrivsADMIN;\ngrant ALTER ANY TRIGGER to BackupPrivsADMIN;\ngrant IMPORT FULL DATABASE to BackupPrivsADMIN;\ngrant ALTER ANY CLUSTER to BackupPrivsADMIN;\ngrant ALTER ANY SEQUENCE to BackupPrivsADMIN;\ngrant FORCE TRANSACTION to BackupPrivsADMIN;\ngrant ALTER ANY EVALUATION CONTEXT to BackupPrivsADMIN;\ngrant CREATE ANY MINING MODEL to BackupPrivsADMIN;\ngrant CREATE ANY CUBE DIMENSION to BackupPrivsADMIN;\ngrant AUDIT SYSTEM to BackupPrivsADMIN;\ngrant ALTER ANY TABLE to BackupPrivsADMIN;\ngrant COMMENT ANY TABLE to BackupPrivsADMIN;\ngrant FORCE ANY TRANSACTION to BackupPrivsADMIN;\ngrant CREATE ANY DIMENSION to BackupPrivsADMIN;\ngrant DROP ANY ROLE to BackupPrivsADMIN;\ngrant CREATE DATABASE LINK to BackupPrivsADMIN;\ngrant CREATE RULE SET to BackupPrivsADMIN;\ngrant CREATE ANY ANALYTIC VIEW to BackupPrivsADMIN;\ngrant DROP ANY SQL PROFILE to BackupPrivsADMIN;\ngrant ALTER ANY CUBE DIMENSION to BackupPrivsADMIN;\ngrant DROP ANY TYPE to BackupPrivsADMIN;\ngrant ALTER ANY MATERIALIZED VIEW to BackupPrivsADMIN;\ngrant CREATE ANY DIRECTORY to BackupPrivsADMIN;\ngrant ALTER ANY LIBRARY to BackupPrivsADMIN;\ngrant ENQUEUE ANY QUEUE to BackupPrivsADMIN;\ngrant CREATE ANY RULE to BackupPrivsADMIN;\ngrant CREATE SQL TRANSLATION PROFILE to BackupPrivsADMIN;\ngrant DROP ANY MATERIALIZED VIEW to BackupPrivsADMIN;\ngrant DROP ANY DIRECTORY to BackupPrivsADMIN;\ngrant CREATE ANY TYPE to BackupPrivsADMIN;\ngrant CREATE INDEXTYPE to BackupPrivsADMIN;\ngrant UNDER ANY TABLE to BackupPrivsADMIN;\ngrant FLASHBACK ANY TABLE to BackupPrivsADMIN;\ngrant DELETE ANY MEASURE FOLDER to BackupPrivsADMIN;\ngrant ALTER ANY ANALYTIC VIEW to BackupPrivsADMIN;\ngrant CREATE PUBLIC DATABASE LINK to BackupPrivsADMIN;\ngrant DROP PUBLIC DATABASE LINK to BackupPrivsADMIN;\ngrant EXPORT FULL DATABASE to BackupPrivsADMIN;\ngrant INSERT ANY TABLE to BackupPrivsADMIN;\ngrant CREATE EXTERNAL JOB to BackupPrivsADMIN;\ngrant EXECUTE ASSEMBLY to BackupPrivsADMIN;\ngrant CREATE ANY SQL TRANSLATION PROFILE to BackupPrivsADMIN;\ngrant SET CONTAINER to BackupPrivsADMIN;\ngrant CREATE ANY CLUSTER to BackupPrivsADMIN;\ngrant ALTER ANY CUBE to BackupPrivsADMIN;\ngrant FLASHBACK ARCHIVE ADMINISTER to BackupPrivsADMIN;\ngrant DROP LOCKDOWN PROFILE to BackupPrivsADMIN;\ngrant ALTER ANY PROCEDURE to BackupPrivsADMIN;\ngrant DROP ANY LIBRARY to BackupPrivsADMIN;\ngrant DEBUG CONNECT ANY to BackupPrivsADMIN;\ngrant DROP ANY EDITION to BackupPrivsADMIN;\ngrant CREATE ROLLBACK SEGMENT to BackupPrivsADMIN;\ngrant CREATE TABLE to BackupPrivsADMIN;\ngrant DROP ANY SYNONYM to BackupPrivsADMIN;\ngrant CREATE ANY PROCEDURE to BackupPrivsADMIN;\ngrant ALTER PROFILE to BackupPrivsADMIN;\ngrant DROP ANY CONTEXT to BackupPrivsADMIN;\ngrant CREATE PLUGGABLE DATABASE to BackupPrivsADMIN;\ngrant CREATE CREDENTIAL to BackupPrivsADMIN;\ngrant UNDER ANY TYPE to BackupPrivsADMIN;\ngrant ADMINISTER DATABASE TRIGGER to BackupPrivsADMIN;\ngrant CREATE USER to BackupPrivsADMIN;\ngrant CREATE TYPE to BackupPrivsADMIN;\ngrant DEQUEUE ANY QUEUE to BackupPrivsADMIN;\ngrant ALTER ANY SQL TRANSLATION PROFILE to BackupPrivsADMIN;\ngrant DROP ANY CLUSTER to BackupPrivsADMIN;\ngrant ALTER ANY OPERATOR to BackupPrivsADMIN;\ngrant CREATE ANY CONTEXT to BackupPrivsADMIN;\ngrant EXECUTE ANY CLASS to BackupPrivsADMIN;\ngrant EM EXPRESS CONNECT to BackupPrivsADMIN;\ngrant DROP ROLLBACK SEGMENT to BackupPrivsADMIN;\ngrant MANAGE ANY QUEUE to BackupPrivsADMIN;\ngrant UPDATE ANY CUBE to BackupPrivsADMIN;\ngrant DROP ANY PROCEDURE to BackupPrivsADMIN;\ngrant CREATE ANY OPERATOR to BackupPrivsADMIN;\ngrant MANAGE FILE GROUP to BackupPrivsADMIN;\ngrant INSERT ANY MEASURE FOLDER to BackupPrivsADMIN;\ngrant BECOME USER to BackupPrivsADMIN;\ngrant DROP ANY VIEW to BackupPrivsADMIN;\ngrant ALTER ANY TYPE to BackupPrivsADMIN;\ngrant DROP ANY CUBE BUILD PROCESS to BackupPrivsADMIN;\ngrant EXECUTE on SYS.UTL_SMTP to BackupPrivsADMIN;\ngrant EXECUTE on SYS.UTL_MAIL to BackupPrivsADMIN;\nProcedimiento PL/SQL terminado correctamente.\ncreate user arantxaora identified by arantxaora;\nUsuario creado.\nexec CrearRol('ARANTXAORA');\nCREATE ROLE BackupPrivsARANTXAORA\nProcedimiento PL/SQL terminado correctamente.\n</code></pre>"},{"location":"p5-usuarios/rg/ejercicio-grupal-3/","title":"Ejercicio grupal 3","text":""},{"location":"p5-usuarios/ri/alumno1/","title":"Alumno 1 (ORACLE)","text":""},{"location":"p5-usuarios/ri/alumno1/#pasos-previos","title":"Pasos previos","text":"<p>Durante toda esta parte individual, a veces usar\u00e9 el siguiente usuario de pruebas:</p> <pre><code>CREATE USER TESTING IDENTIFIED BY 1234;\n</code></pre>"},{"location":"p5-usuarios/ri/alumno1/#ejercicio-1","title":"Ejercicio 1","text":""},{"location":"p5-usuarios/ri/alumno1/#1-enunciado","title":"1. Enunciado","text":"<p>Crear el rol <code>ROLPRACTICA1</code> con privilegios:</p> <ul> <li>Conexi\u00f3n a la base de datos</li> <li>Creaci\u00f3n de tablas</li> <li>Creaci\u00f3n de vistas</li> <li>Inserci\u00f3n de datos en la tabla EMP de SCOTT</li> </ul>"},{"location":"p5-usuarios/ri/alumno1/#1-realizacion","title":"1. Realizaci\u00f3n","text":"<p>Creo el rol:</p> <pre><code>CREATE ROLE rolpractica1;\n</code></pre> <p>Le asigno los privilegios:</p> <pre><code>GRANT CREATE SESSION, CREATE TABLE, CREATE VIEW TO rolpractica1;\nGRANT INSERT ON scott.emp TO rolpractica1;\n</code></pre>"},{"location":"p5-usuarios/ri/alumno1/#1-comprobaciones","title":"1. Comprobaciones","text":"<p>Compruebo que se ha creado el rol:</p> <pre><code>SELECT role\nFROM DBA_ROLES\nWHERE role = 'ROLPRACTICA1';\n</code></pre> <pre><code>ROLE\n--------------------------------------------------------------------------------------------------------------------------------\nROLPRACTICA1\n</code></pre> <p>Compruebo que los privilegios est\u00e1n asignados:</p> <pre><code>SELECT privilege\nFROM DBA_SYS_PRIVS\nWHERE grantee = 'ROLPRACTICA1';\n</code></pre> <pre><code>PRIVILEGE\n----------------------------------------\nCREATE TABLE\nCREATE VIEW\nCREATE SESSION\n</code></pre> <pre><code>SELECT privilege\nFROM DBA_TAB_PRIVS\nWHERE grantee = 'ROLPRACTICA1';\n</code></pre> <pre><code>PRIVILEGE\n----------------------------------------\nINSERT\n</code></pre> <p>Le asigno el rol al usuario <code>testing</code>:</p> <pre><code>GRANT ROLPRACTICA1 TO testing;\nGrant succeeded.\n</code></pre> <p>Me conecto:</p> <pre><code>connect testing/1234\nConnected.\nORA-01031: insufficient privileges\nORA-01078: failure in processing system parameters\nSession altered.\n</code></pre> <p>Note</p> <p>Esos errores de privilegios no son relevantes, ya que como vemos he conectado correctamente. Aclaro que simplemente aparecen porque tengo un script personalizado en sqlplus que se lanza en cada conexi\u00f3n, que hace ciertas acciones; algunas necesitan permisos de administrador.</p> <p>Creo una tabla:</p> <pre><code>CREATE TABLE tabla (\nid NUMBER(10) NOT NULL,\ncampo VARCHAR2(50) NOT NULL,\nCONSTRAINT tabla_pk PRIMARY KEY (id)\n);\nTable created.\n</code></pre> <p>Creo una vista:</p> <pre><code>CREATE OR REPLACE VIEW view_tabla AS\nSELECT *\nFROM tabla;\n</code></pre> <pre><code>CREATE OR REPLACE VIEW view_tabla AS\n2      SELECT *\nFROM tabla;\nView created.\n</code></pre> <p>Inserto un registro en <code>scott.emp</code>:</p> <pre><code>INSERT INTO scott.emp VALUES (8000,'TESTER','TESTER',7782,to_date('23-1-1982','dd-mm-yyyy'),1300,NULL,10);\n1 row created.\n</code></pre>"},{"location":"p5-usuarios/ri/alumno1/#ejercicio-2","title":"Ejercicio 2","text":""},{"location":"p5-usuarios/ri/alumno1/#2-enunciado","title":"2. Enunciado","text":"<p>Crear el usuario USRPRACTICA1 con el tablespace USERS por defecto y averiguar qu\u00e9 cuota se le ha asignado por defecto en el mismo. Sustit\u00fayela por una cuota de 1M.</p>"},{"location":"p5-usuarios/ri/alumno1/#2-realizacion","title":"2. Realizaci\u00f3n","text":"<p>Creo el usuario:</p> <pre><code>CREATE USER USRPRACTICA1 IDENTIFIED BY 1234 DEFAULT TABLESPACE USERS;\nUser created.\n</code></pre> <p>Por defecto, la cuota de los usuarios sobre los tablespaces es 0:</p> <pre><code>SELECT tablespace_name,username,max_bytes\nFROM DBA_TS_QUOTAS\nWHERE username = 'USRPRACTICA1' AND tablespace_name = 'USERS';\n</code></pre> <pre><code>SELECT tablespace_name,username,max_bytes\n2  FROM DBA_TS_QUOTAS\nWHERE username = 'USRPRACTICA1' AND tablespace_name = 'USERS';\nno rows selected\n</code></pre> <p>No hay registros porque <code>USRPRACTICA1</code> todav\u00eda no tiene cuota. Si quisi\u00e9ramos insertar datos, no podr\u00edamos, aunque para que podamos hacer esto antes primero tenemos que dar algunos permisos:</p> <pre><code>GRANT CREATE SESSION, CREATE TABLE TO USRPRACTICA1;\n</code></pre> <p>Ahora ya s\u00ed, comprobamos que no podemos meter datos:</p> <pre><code>CREATE TABLE tabla (\nid NUMBER(10) NOT NULL,\ncampo VARCHAR2(50) NOT NULL,\nCONSTRAINT tabla_pk PRIMARY KEY (id)\n);\nTable created.\nINSERT INTO tabla VALUES (1,'test');\nINSERT INTO tabla VALUES (1,'test')\n*\nERROR at line 1:\nORA-01950: no privileges on tablespace 'USERS'\n</code></pre> <p>Info</p> <p>Aunque diga tabla creada, realmente no se ha creado porque no tenemos cuota. Cuando pasa esto, estamos experimentando el mecanismo <code>deferred_segment_creation</code> de Oracle, que b\u00e1sicamente \"retrasa\" el allocation real de datos hasta que la tabla contiene datos.</p> <p>Le cambio la cuota:</p> <pre><code>ALTER USER USRPRACTICA1 QUOTA 1M ON USERS;\nUser altered.\n</code></pre> <p>Compruebo que ya s\u00ed aparece la cuota registrada:</p> <pre><code>SELECT tablespace_name,username,max_bytes\nFROM DBA_TS_QUOTAS\nWHERE username = 'USRPRACTICA1' AND tablespace_name = 'USERS';\n</code></pre> <pre><code>SELECT tablespace_name,username,max_bytes\n2  FROM DBA_TS_QUOTAS\nWHERE username = 'USRPRACTICA1' AND tablespace_name = 'USERS';\nTABLE USERNAME      MAX_BYTES\n----- ------------ ----------\nUSERS USRPRACTICA1    1048576\n</code></pre> <p>Ya podr\u00eda insertar el registro:</p> <pre><code>INSERT INTO tabla VALUES (1,'test');\n1 row created.\nselect * from tabla;\nID CAMPO\n---------- --------------------------------------------------\n1 test\n</code></pre>"},{"location":"p5-usuarios/ri/alumno1/#ejercicio-3","title":"Ejercicio 3","text":""},{"location":"p5-usuarios/ri/alumno1/#3-enunciado","title":"3. Enunciado","text":"<p>Modificar el usuario <code>USRPRACTICA1</code> para que tenga cuota 0 en el tablespace SYSTEM.</p>"},{"location":"p5-usuarios/ri/alumno1/#3-realizacion","title":"3. Realizaci\u00f3n","text":"<pre><code>ALTER USER USRPRACTICA1 QUOTA 0 ON system;\nUser altered.\n</code></pre>"},{"location":"p5-usuarios/ri/alumno1/#3-comprobaciones","title":"3. Comprobaciones","text":"<p>Muestro que no hay cuota:</p> <pre><code>SELECT tablespace_name,username,max_bytes\nFROM DBA_TS_QUOTAS\nWHERE username = 'USRPRACTICA1' AND tablespace_name = 'SYSTEM';\nno rows selected\n</code></pre> <p>Muestro que no puedo insertar datos en <code>SYSTEM</code>:</p> <pre><code>CREATE TABLE tabla_system (\nid NUMBER(10) NOT NULL,\ncampo VARCHAR2(50) NOT NULL,\nCONSTRAINT tabla_system_pk PRIMARY KEY (id)\n) TABLESPACE SYSTEM;\nTable created.\nINSERT INTO tabla_system VALUES (1,'test');\nINSERT INTO tabla_system VALUES (1,'test')\n*\nERROR at line 1:\nORA-01536: space quota exceeded for tablespace 'SYSTEM'\n</code></pre>"},{"location":"p5-usuarios/ri/alumno1/#ejercicio-4","title":"Ejercicio 4","text":""},{"location":"p5-usuarios/ri/alumno1/#4-enunciado","title":"4. Enunciado","text":"<p>Conceder <code>ROLPRACTICA1</code> a <code>USRPRACTICA1</code>.</p>"},{"location":"p5-usuarios/ri/alumno1/#4-realizacion","title":"4. Realizaci\u00f3n","text":"<pre><code>GRANT ROLPRACTICA1 TO USRPRACTICA1;\nGrant succeeded.\n</code></pre>"},{"location":"p5-usuarios/ri/alumno1/#4-comprobaciones","title":"4. Comprobaciones","text":"<p>Muestro que tiene el rol asignado:</p> <pre><code>SELECT granted_role,grantee\nFROM DBA_ROLE_PRIVS\nWHERE granted_role = 'ROLPRACTICA1' AND grantee = 'USRPRACTICA1';\n</code></pre> <pre><code>GRANTED_ROLE GRANTEE\n------------ --------------------------------------------------------------------------------------------------------------------------------\nROLPRACTICA1 USRPRACTICA1\n</code></pre> <p>Info</p> <p>El funcionamiento del rol ya se ha probado en el ejercicio 1</p>"},{"location":"p5-usuarios/ri/alumno1/#ejercicio-5","title":"Ejercicio 5","text":""},{"location":"p5-usuarios/ri/alumno1/#5-enunciado","title":"5. Enunciado","text":"<p>Conceder a USRPRACTICA1 el privilegio de crear tablas e insertar datos en el esquema de cualquier usuario. Probar los privilegios. Comprobar si se puede modificar la estructura o eliminar la tabla creada.</p>"},{"location":"p5-usuarios/ri/alumno1/#5-realizacion","title":"5. Realizaci\u00f3n","text":"<p>Doy privilegios:</p> <pre><code>GRANT CREATE ANY TABLE, INSERT ANY TABLE, CREATE ANY INDEX TO USRPRACTICA1;\nGrant succeeded.\n</code></pre> <p>Info</p> <p>No se menciona en el enunciado, pero el privilegio <code>CREATE ANY INDEX</code> es necesario</p> <p>Le doy cuota a <code>TESTING</code> para que luego se puedan insertar datos:</p> <pre><code>ALTER USER TESTING QUOTA 1M ON USERS;\n</code></pre>"},{"location":"p5-usuarios/ri/alumno1/#5-comprobaciones","title":"5. Comprobaciones","text":"<p>Creo una tabla e inserto un registro en <code>TESTING</code> desde <code>USRPRACTICA1</code>:</p> <pre><code>CREATE TABLE TESTING.tabla (\nid NUMBER(10) NOT NULL,\ncampo VARCHAR2(50) NOT NULL,\nCONSTRAINT tabla_testing_pk PRIMARY KEY (id)\n);\nTable created.\nINSERT INTO TESTING.tabla VALUES (1,'test');\n1 row created.\n</code></pre> <p>Como desde <code>USRPRACTICA1</code> no tengo privilegios de SELECT sobre esa tabla, la muestro desde <code>SYS</code>:</p> <pre><code>connect sys/sys as sysdba\nConnected.\nORA-01081: cannot start already-running ORACLE - shut it down first\nSession altered.\nselect * from TESTING.tabla;\nID CAMPO\n---------- --------------------------------------------------\n1 test\n</code></pre> <p>Vuelvo a <code>USRPRACTICA1</code> y compruebo si se puede modificar la estructura de la tabla creada o eliminarla:</p> <pre><code>connect USRPRACTICA1/1234\nConnected.\nORA-01031: insufficient privileges\nORA-01078: failure in processing system parameters\nSession altered.\nALTER TABLE TESTING.tabla DROP COLUMN CAMPO;\nALTER TABLE TESTING.tabla DROP COLUMN CAMPO\n*\nERROR at line 1:\nORA-01031: insufficient privileges\nDROP TABLE TESTING.tabla;\nDROP TABLE TESTING.tabla\n*\nERROR at line 1:\nORA-01031: insufficient privileges\n</code></pre> <p>No se puede, porque en ning\u00fan momento le hemos dado a <code>USRPRACTICA1</code> los privilegios necesarios para estas acciones.</p>"},{"location":"p5-usuarios/ri/alumno1/#ejercicio-6","title":"Ejercicio 6","text":""},{"location":"p5-usuarios/ri/alumno1/#6-enunciado","title":"6. Enunciado","text":"<p>Conceder a <code>USRPRACTICA1</code> el privilegio de leer la tabla DEPT de SCOTT con la posibilidad de que lo pase a su vez a terceros usuarios.</p>"},{"location":"p5-usuarios/ri/alumno1/#6-realizacion","title":"6. Realizaci\u00f3n","text":"<pre><code>GRANT READ ON scott.dept TO USRPRACTICA1 WITH GRANT OPTION;\nGrant succeeded.\n</code></pre> <p>Info</p> <p>El privilegio <code>READ</code> se a\u00f1adi\u00f3 en la versi\u00f3n 12.1 de Oracle, y es equivalente a <code>SELECT</code> pero m\u00e1s seguro; no se da impl\u00edcitamente privilegio de LOCK sobre el objeto. Si se otorga el privilegio <code>SELECT</code> a un usuario sobre una tabla por ejemplo, \u00e9ste podr\u00eda bloquearla, pero con <code>READ</code> no podr\u00eda.</p>"},{"location":"p5-usuarios/ri/alumno1/#6-comprobaciones","title":"6. Comprobaciones","text":"<p>Me conecto a <code>USRPRACTICA1</code> y pruebo el privilegio:</p> <pre><code>connect USRPRACTICA1/1234\nConnected.\nORA-01031: insufficient privileges\nORA-01078: failure in processing system parameters\nSession altered.\nSELECT * FROM scott.dept;\nDEPTNO DNAME          LOC\n---------- -------------- -------------\n10 ACCOUNTING     NEW YORK\n20 RESEARCH       DALLAS\n30 SALES          CHICAGO\n40 OPERATIONS     BOSTON\n</code></pre> <p>Pruebo a pasarle el privilegio a <code>TESTING</code>:</p> <pre><code>GRANT READ ON scott.dept TO TESTING;\nGrant succeeded.\n</code></pre> <p>Me conecto a <code>TESTING</code> y pruebo que puedo hacer lo mismo:</p> <pre><code>connect TESTING/1234\nConnected.\nORA-01031: insufficient privileges\nORA-01078: failure in processing system parameters\nSession altered.\nSELECT * FROM scott.dept;\nDEPTNO DNAME          LOC\n---------- -------------- -------------\n10 ACCOUNTING     NEW YORK\n20 RESEARCH       DALLAS\n30 SALES          CHICAGO\n40 OPERATIONS     BOSTON\n</code></pre>"},{"location":"p5-usuarios/ri/alumno1/#ejercicio-7","title":"Ejercicio 7","text":""},{"location":"p5-usuarios/ri/alumno1/#7-enunciado","title":"7. Enunciado","text":"<p>Comprobar que <code>USRPRACTICA1</code> puede realizar todas las operaciones previstas en el rol <code>ROLPRACTICA1</code> (se dio en el ejercicio 4).</p>"},{"location":"p5-usuarios/ri/alumno1/#7-realizacion","title":"7. Realizaci\u00f3n","text":"<p>Info</p> <p>El funcionamiento del rol ya se ha probado en el ejercicio 1</p>"},{"location":"p5-usuarios/ri/alumno1/#ejercicio-8","title":"Ejercicio 8","text":""},{"location":"p5-usuarios/ri/alumno1/#8-enunciado","title":"8. Enunciado","text":"<p>Quitar a <code>USRPRACTICA1</code> el privilegio de crear vistas. Comprobar que ya no puede hacerlo.</p>"},{"location":"p5-usuarios/ri/alumno1/#8-realizacion","title":"8. Realizaci\u00f3n","text":"<pre><code>REVOKE CREATE VIEW FROM ROLPRACTICA1;\nRevoke succeeded.\n</code></pre> <p>Info</p> <p>El privilegio <code>CREATE VIEW</code> se dio a <code>ROLPRACTICA1</code>, no a <code>USRPRACTICA1</code>. Este usuario puede crear vistas por el rol, no porque tenga el privilegio otorgado directamente, as\u00ed que el privilegio se tiene que quitar del rol.</p>"},{"location":"p5-usuarios/ri/alumno1/#8-comprobaciones","title":"8. Comprobaciones","text":"<p>Me conecto a <code>USRPRACTICA1</code>, y aprovechando que en el ejercicio 6 se le dio permisos de lectura sobre <code>scott.dept</code>, intento crear una vista de esa tabla:</p> <pre><code>connect USRPRACTICA1/1234\nConnected.\nORA-01031: insufficient privileges\nORA-01078: failure in processing system parameters\nSession altered.\n</code></pre> <pre><code>CREATE OR REPLACE VIEW view_dept AS\nSELECT *\nFROM scott.dept;\n</code></pre> <pre><code>CREATE OR REPLACE VIEW view_dept AS\n*\nERROR at line 1:\nORA-01031: insufficient privileges\n</code></pre>"},{"location":"p5-usuarios/ri/alumno1/#ejercicio-9","title":"Ejercicio 9","text":""},{"location":"p5-usuarios/ri/alumno1/#9-enunciado","title":"9. Enunciado","text":"<p>Crear el perfil <code>NOPARESDECURRAR</code> que limite a dos el n\u00famero de minutos de inactividad permitidos en una sesi\u00f3n.</p>"},{"location":"p5-usuarios/ri/alumno1/#9-realizacion","title":"9. Realizaci\u00f3n","text":"<pre><code>CREATE PROFILE NOPARESDECURRAR LIMIT IDLE_TIME 2;\nProfile created.\n</code></pre>"},{"location":"p5-usuarios/ri/alumno1/#9-comprobaciones","title":"9. Comprobaciones","text":"<p>Compruebo que se ha creado:</p> <pre><code>SELECT profile,resource_name,limit\nFROM DBA_PROFILES\nWHERE profile = 'NOPARESDECURRAR';\nPROFILE                                                                                                                          RESOURCE_NAME                    LIMIT\n-------------------------------------------------------------------------------------------------------------------------------- -------------------------------- --------------------------------------------------------------------------------------------------------------------------------\nNOPARESDECURRAR                                                                                                                  COMPOSITE_LIMIT                  DEFAULT\nNOPARESDECURRAR                                                                                                                  SESSIONS_PER_USER                DEFAULT\nNOPARESDECURRAR                                                                                                                  CPU_PER_SESSION                  DEFAULT\nNOPARESDECURRAR                                                                                                                  CPU_PER_CALL                     DEFAULT\nNOPARESDECURRAR                                                                                                                  LOGICAL_READS_PER_SESSION        DEFAULT\nNOPARESDECURRAR                                                                                                                  LOGICAL_READS_PER_CALL           DEFAULT\nNOPARESDECURRAR                                                                                                                  IDLE_TIME                        2\nNOPARESDECURRAR                                                                                                                  CONNECT_TIME                     DEFAULT\nNOPARESDECURRAR                                                                                                                  PRIVATE_SGA                      DEFAULT\nNOPARESDECURRAR                                                                                                                  FAILED_LOGIN_ATTEMPTS            DEFAULT\nNOPARESDECURRAR                                                                                                                  PASSWORD_LIFE_TIME               DEFAULT\nNOPARESDECURRAR                                                                                                                  PASSWORD_REUSE_TIME              DEFAULT\nNOPARESDECURRAR                                                                                                                  PASSWORD_REUSE_MAX               DEFAULT\nNOPARESDECURRAR                                                                                                                  PASSWORD_VERIFY_FUNCTION         DEFAULT\nNOPARESDECURRAR                                                                                                                  PASSWORD_LOCK_TIME               DEFAULT\nNOPARESDECURRAR                                                                                                                  PASSWORD_GRACE_TIME              DEFAULT\nNOPARESDECURRAR                                                                                                                  INACTIVE_ACCOUNT_TIME            DEFAULT\n17 rows selected.\n</code></pre> <p>Info</p> <p>Aunque no se lo indiquemos, Oracle nos a\u00f1ade unos l\u00edmites por defecto, pero lo importante es que el l\u00edmite que nosotros hemos a\u00f1adido es correcto</p>"},{"location":"p5-usuarios/ri/alumno1/#ejercicio-10","title":"Ejercicio 10","text":""},{"location":"p5-usuarios/ri/alumno1/#10-enunciado","title":"10. Enunciado","text":"<p>Activar el uso de perfiles.</p>"},{"location":"p5-usuarios/ri/alumno1/#10-realizacion","title":"10. Realizaci\u00f3n","text":"<pre><code>ALTER SYSTEM SET RESOURCE_LIMIT=TRUE;\nSystem altered.\n</code></pre>"},{"location":"p5-usuarios/ri/alumno1/#10-comprobaciones","title":"10. Comprobaciones","text":"<p>Compruebo el estado del par\u00e1metro:</p> <pre><code>show parameter resource_limit;\nNAME                                 TYPE        VALUE\n------------------------------------ ----------- ------------------------------\nresource_limit                       boolean     TRUE\n</code></pre>"},{"location":"p5-usuarios/ri/alumno1/#ejercicio-11","title":"Ejercicio 11","text":""},{"location":"p5-usuarios/ri/alumno1/#11-enunciado","title":"11. Enunciado","text":"<p>Asignar el perfil creado a <code>USRPRACTICA1</code> y comprobar su correcto funcionamiento.</p>"},{"location":"p5-usuarios/ri/alumno1/#11-realizacion","title":"11. Realizaci\u00f3n","text":"<pre><code>ALTER USER USRPRACTICA1 PROFILE NOPARESDECURRAR;\nUser altered.\n</code></pre>"},{"location":"p5-usuarios/ri/alumno1/#11-comprobaciones","title":"11. Comprobaciones","text":"<p>Me conecto a <code>USRPRACTICA1</code> y tras 2 minutos, esto es lo que pasa:</p> <pre><code>connect USRPRACTICA1/1234\nConnected.\nORA-01031: insufficient privileges\nORA-01078: failure in processing system parameters\nSession altered.\nselect user from dual;\nselect user from dual\n*\nERROR at line 1:\nORA-02396: exceeded maximum idle time, please connect again\n</code></pre> <p>Warning</p> <p>Cuando sobrepasamos el tiempo de inactividad no se corta la conexi\u00f3n autom\u00e1ticamente. El error aparecer\u00e1 cuando intentemos realizar alguna acci\u00f3n, por eso he escrito un comando de ejemplo para la prueba</p>"},{"location":"p5-usuarios/ri/alumno1/#ejercicio-12","title":"Ejercicio 12","text":""},{"location":"p5-usuarios/ri/alumno1/#12-enunciado","title":"12. Enunciado","text":"<p>Crear el perfil <code>CONTRASENASEGURA</code> con los l\u00edmites:</p> <ul> <li>Caducidad mensual</li> <li>M\u00e1ximo tres intentos fallidos permitidos de acceso</li> <li>Bloqueo de cuenta indefinido si se superan los intentos</li> </ul>"},{"location":"p5-usuarios/ri/alumno1/#12-realizacion","title":"12. Realizaci\u00f3n","text":"<pre><code>CREATE PROFILE CONTRASENASEGURA LIMIT\nPASSWORD_LIFE_TIME 30\nFAILED_LOGIN_ATTEMPTS 4\nPASSWORD_LOCK_TIME UNLIMITED;\n</code></pre> <pre><code>Profile created.\n</code></pre>"},{"location":"p5-usuarios/ri/alumno1/#12-comprobaciones","title":"12. Comprobaciones","text":"<p>Muestro que se ha creado con los l\u00edmites dichos:</p> <pre><code>SELECT profile,resource_name,limit\nFROM DBA_PROFILES\nWHERE profile = 'CONTRASENASEGURA'\nAND resource_name IN ('PASSWORD_LIFE_TIME','FAILED_LOGIN_ATTEMPTS','PASSWORD_LOCK_TIME');\n</code></pre> <pre><code>PROFILE                                                                                                                          RESOURCE_NAME                    LIMIT\n-------------------------------------------------------------------------------------------------------------------------------- -------------------------------- --------------------------------------------------------------------------------------------------------------------------------\nCONTRASENASEGURA                                                                                                                 FAILED_LOGIN_ATTEMPTS            4\nCONTRASENASEGURA                                                                                                                 PASSWORD_LIFE_TIME               30\nCONTRASENASEGURA                                                                                                                 PASSWORD_LOCK_TIME               UNLIMITED\n</code></pre>"},{"location":"p5-usuarios/ri/alumno1/#ejercicio-13","title":"Ejercicio 13","text":""},{"location":"p5-usuarios/ri/alumno1/#13-enunciado","title":"13. Enunciado","text":"<p>Asignar el perfil <code>CONTRASENASEGURA</code> a <code>USRPRACTICA1</code> y comprobar su funcionamiento. Desbloquear posteriormente al usuario.</p>"},{"location":"p5-usuarios/ri/alumno1/#13-realizacion","title":"13. Realizaci\u00f3n","text":"<pre><code>ALTER USER USRPRACTICA1 PROFILE CONTRASENASEGURA;\nUser altered.\n</code></pre>"},{"location":"p5-usuarios/ri/alumno1/#13-comprobaciones","title":"13. Comprobaciones","text":"<p>Me equivoco 4 veces en la contrase\u00f1a para probar el funcionamiento:</p> <pre><code>connect USRPRACTICA1/123\nERROR:\nORA-01017: invalid username/password; logon denied\nWarning: You are no longer connected to ORACLE.\nconnect USRPRACTICA1/123\nERROR:\nORA-01017: invalid username/password; logon denied\nconnect USRPRACTICA1/123\nERROR:\nORA-01017: invalid username/password; logon denied\nconnect USRPRACTICA1/123\nERROR:\nORA-01017: invalid username/password; logon denied\nconnect USRPRACTICA1/1234\nERROR:\nORA-28000: The account is locked.\n</code></pre> <p>Como vemos, aunque Oracle no nos avise expl\u00edcitamente, al 4 intento fallido la cuenta se ha bloqueado.  </p> <p>Lo sabemos porque si intentamos acceder una 5 vez, aunque sea con la contrase\u00f1a correcta, nos dar\u00e1 el error <code>ORA-28000: The account is locked.</code></p> <p>Desbloqueo la cuenta:</p> <pre><code>ALTER USER USRPRACTICA1 IDENTIFIED BY 1234 ACCOUNT UNLOCK;\nUser altered.\n</code></pre> <p>Pruebo que se ha desbloqueado:</p> <pre><code>connect USRPRACTICA1/1234\nConnected.\nORA-01031: insufficient privileges\nORA-01078: failure in processing system parameters\nSession altered.\n</code></pre>"},{"location":"p5-usuarios/ri/alumno1/#ejercicio-14","title":"Ejercicio 14","text":""},{"location":"p5-usuarios/ri/alumno1/#14-enunciado","title":"14. Enunciado","text":"<p>Consultar qu\u00e9 usuarios existen en la base de datos.</p>"},{"location":"p5-usuarios/ri/alumno1/#14-realizacion","title":"14. Realizaci\u00f3n","text":"<pre><code>SELECT USERNAME\nFROM DBA_USERS;\nUSERNAME\n--------------------------------------------------------------------------------------------------------------------------------\nSYS\nSYSTEM\nXS$NULL\nOJVMSYS\nLBACSYS\nOUTLN\nSYS$UMF\nDBSNMP\nAPPQOSSYS\nDBSFWUSER\nGGSYS\nANONYMOUS\nCTXSYS\nDVSYS\nDVF\nGSMADMIN_INTERNAL\nMDSYS\nOLAPSYS\nXDB\nWMSYS\nGSMCATUSER\nMDDATA\nBECARIO\nSYSBACKUP\nREMOTE_SCHEDULER_AGENT\nGSMUSER\nSYSRAC\nGSMROOTUSER\nSI_INFORMTN_SCHEMA\nAUDSYS\nEXAMENBD34\nDIP\nORDPLUGINS\nTESTING\nSYSKM\nORDDATA\nORACLE_OCM\nSCOTT\nHIPODROMO\nSYSDG\nORDSYS\nUSRPRACTICA1\n42 rows selected.\n</code></pre>"},{"location":"p5-usuarios/ri/alumno1/#ejercicio-15","title":"Ejercicio 15","text":""},{"location":"p5-usuarios/ri/alumno1/#15-enunciado","title":"15. Enunciado","text":"<p>Elegir un usuario concreto y consultar qu\u00e9 cuota tiene sobre cada uno de los tablespaces.</p>"},{"location":"p5-usuarios/ri/alumno1/#15-realizacion","title":"15. Realizaci\u00f3n","text":"<p>Elijo <code>AUDSYS</code>:</p> <pre><code>SELECT tablespace_name,username,max_bytes\nFROM DBA_TS_QUOTAS\nWHERE username = 'AUDSYS';\nTABLESPACE_NAME                USERNA  MAX_BYTES\n------------------------------ ------ ----------\nSYSAUX                         AUDSYS         -1\n</code></pre> <p>S\u00f3lo tiene cuota sobre 1 tablespace, <code>SYSAUX</code>, y el tama\u00f1o -1 quiere decir que es ilimitada.</p>"},{"location":"p5-usuarios/ri/alumno1/#ejercicio-16","title":"Ejercicio 16","text":""},{"location":"p5-usuarios/ri/alumno1/#16-enunciado","title":"16. Enunciado","text":"<p>Elegir un usuario concreto y mostrar qu\u00e9 privilegios de sistema tiene asignados.</p>"},{"location":"p5-usuarios/ri/alumno1/#16-realizacion","title":"16. Realizaci\u00f3n","text":"<p>Elijo <code>SYSTEM</code>:</p> <pre><code>SELECT privilege\nFROM DBA_SYS_PRIVS\nWHERE grantee = 'SYSTEM';\n</code></pre> <pre><code>PRIVILEGE\n----------------------------------------\nGLOBAL QUERY REWRITE\nCREATE TABLE\nDEQUEUE ANY QUEUE\nENQUEUE ANY QUEUE\nSELECT ANY TABLE\nMANAGE ANY QUEUE\nUNLIMITED TABLESPACE\nCREATE MATERIALIZED VIEW\n8 rows selected.\n</code></pre>"},{"location":"p5-usuarios/ri/alumno1/#ejercicio-17","title":"Ejercicio 17","text":""},{"location":"p5-usuarios/ri/alumno1/#17-enunciado","title":"17. Enunciado","text":"<p>Elegir un usuario concreto y mostrar qu\u00e9 privilegios sobre objetos tiene asignados.</p>"},{"location":"p5-usuarios/ri/alumno1/#17-realizacion","title":"17. Realizaci\u00f3n","text":"<p>Elijo <code>SYS</code>:</p> <pre><code>SELECT privilege,table_name\nFROM DBA_TAB_PRIVS\nWHERE grantee = 'SYS';\n</code></pre> <pre><code>PRIVILEGE                                TABLE_NAME\n---------------------------------------- --------------------------------------------------------------------------------------------------------------------------------\nEXECUTE                                  LBAC_STANDARD\nEXECUTE                                  LBAC_SERVICES\nSELECT                                   DBA_DV_STATUS\nEXECUTE                                  CONFIGURE_DV_INTERNAL\nSELECT                                   OL$\nSELECT                                   OL$HINTS\nSELECT                                   OL$NODES\n7 rows selected.\n</code></pre>"},{"location":"p5-usuarios/ri/alumno1/#ejercicio-18","title":"Ejercicio 18","text":""},{"location":"p5-usuarios/ri/alumno1/#18-enunciado","title":"18. Enunciado","text":"<p>Consultar qu\u00e9 roles existen en la base de datos.</p>"},{"location":"p5-usuarios/ri/alumno1/#18-realizacion","title":"18. Realizaci\u00f3n","text":"<pre><code>SELECT role FROM DBA_ROLES;\n</code></pre> <p>Output largo</p>"},{"location":"p5-usuarios/ri/alumno1/#ejercicio-19","title":"Ejercicio 19","text":""},{"location":"p5-usuarios/ri/alumno1/#19-enunciado","title":"19. Enunciado","text":"<p>Elegir un rol concreto y consultar qu\u00e9 usuarios lo tienen asignado.</p>"},{"location":"p5-usuarios/ri/alumno1/#19-realizacion","title":"19. Realizaci\u00f3n","text":"<p>Elijo <code>CONNECT</code>:</p> <pre><code>SELECT grantee\nFROM DBA_ROLE_PRIVS\nWHERE granted_role = 'CONNECT';\n</code></pre> <pre><code>GRANTEE\n--------------------------------------------------------------------------------------------------------------------------------\nSYS\nDV_ACCTMGR\nGSMADMIN_ROLE\nGSM_POOLADMIN_ROLE\nGSMROOTUSER_ROLE\nSCOTT\n6 rows selected.\n</code></pre>"},{"location":"p5-usuarios/ri/alumno1/#ejercicio-20","title":"Ejercicio 20","text":""},{"location":"p5-usuarios/ri/alumno1/#20-enunciado","title":"20. Enunciado","text":"<p>Elegir un rol concreto y averiguar si est\u00e1 compuesto por otros roles o no.</p>"},{"location":"p5-usuarios/ri/alumno1/#20-realizacion","title":"20. Realizaci\u00f3n","text":"<p>Elijo <code>DBA</code>:</p> <pre><code>SELECT granted_role\nFROM DBA_ROLE_PRIVS\nWHERE grantee = 'DBA';\n</code></pre> <pre><code>GRANTED_ROLE\n--------------------------------------------------------------------------------------------------------------------------------\nEXECUTE_CATALOG_ROLE\nDATAPUMP_IMP_FULL_DATABASE\nSCHEDULER_ADMIN\nXDBADMIN\nOLAP_DBA\nCAPTURE_ADMIN\nSELECT_CATALOG_ROLE\nDATAPUMP_EXP_FULL_DATABASE\nGATHER_SYSTEM_STATISTICS\nWM_ADMIN_ROLE\nEXP_FULL_DATABASE\nOPTIMIZER_PROCESSING_RATE\nEM_EXPRESS_ALL\nIMP_FULL_DATABASE\nXDB_SET_INVOKER\nJAVA_ADMIN\nOLAP_XS_ADMIN\n17 rows selected.\n</code></pre> <p>Esos son todos los roles por los que est\u00e1 compuesto el rol <code>DBA</code>.</p>"},{"location":"p5-usuarios/ri/alumno1/#ejercicio-21","title":"Ejercicio 21","text":""},{"location":"p5-usuarios/ri/alumno1/#21-enunciado","title":"21. Enunciado","text":"<p>Consultar qu\u00e9 perfiles existen en la base de datos.</p>"},{"location":"p5-usuarios/ri/alumno1/#21-realizacion","title":"21. Realizaci\u00f3n","text":"<pre><code>SELECT DISTINCT profile\nFROM DBA_PROFILES;\nPROFILE\n--------------------------------------------------------------------------------------------------------------------------------\nCONTRASENASEGURA\nDEFAULT\nNOPARESDECURRAR\nORA_STIG_PROFILE\n</code></pre>"},{"location":"p5-usuarios/ri/alumno1/#ejercicio-22","title":"Ejercicio 22","text":""},{"location":"p5-usuarios/ri/alumno1/#22-enunciado","title":"22. Enunciado","text":"<p>Elegir un perfil y consultar qu\u00e9 l\u00edmites se establecen en el mismo.</p>"},{"location":"p5-usuarios/ri/alumno1/#22-realizacion","title":"22. Realizaci\u00f3n","text":"<p>Elijo <code>DEFAULT</code>:</p> <pre><code>SELECT resource_name,limit\nFROM DBA_PROFILES\nWHERE profile = 'DEFAULT';\n</code></pre> <pre><code>RESOURCE_NAME                    LIMIT\n-------------------------------- --------------------------------------------------------------------------------------------------------------------------------\nCOMPOSITE_LIMIT                  UNLIMITED\nSESSIONS_PER_USER                UNLIMITED\nCPU_PER_SESSION                  UNLIMITED\nCPU_PER_CALL                     UNLIMITED\nLOGICAL_READS_PER_SESSION        UNLIMITED\nLOGICAL_READS_PER_CALL           UNLIMITED\nIDLE_TIME                        UNLIMITED\nCONNECT_TIME                     UNLIMITED\nPRIVATE_SGA                      UNLIMITED\nFAILED_LOGIN_ATTEMPTS            10\nPASSWORD_LIFE_TIME               180\nPASSWORD_REUSE_TIME              UNLIMITED\nPASSWORD_REUSE_MAX               UNLIMITED\nPASSWORD_VERIFY_FUNCTION         NULL\nPASSWORD_LOCK_TIME               1\nPASSWORD_GRACE_TIME              7\nINACTIVE_ACCOUNT_TIME            UNLIMITED\n17 rows selected.\n</code></pre>"},{"location":"p5-usuarios/ri/alumno1/#ejercicio-23","title":"Ejercicio 23","text":""},{"location":"p5-usuarios/ri/alumno1/#23-enunciado","title":"23. Enunciado","text":"<p>Mostrar los nombres de los usuarios que tienen limitado el n\u00famero de sesiones concurrentes.</p>"},{"location":"p5-usuarios/ri/alumno1/#23-realizacion","title":"23. Realizaci\u00f3n","text":"<p>Ahora mismo no tengo ning\u00fan perfil que tenga <code>SESSIONS_PER_USER</code> limitado:</p> <pre><code>SELECT profile\nFROM DBA_PROFILES\nWHERE resource_name = 'SESSIONS_PER_USER'\nAND limit NOT IN ('UNLIMITED', 'DEFAULT');\n</code></pre> <pre><code>no rows selected\n</code></pre> <p>Por lo tanto, por ejemplo, voy a limitar <code>SESSIONS_PER_USER</code> en el perfil <code>NOPARESDECURRAR</code>:</p> <pre><code>ALTER PROFILE NOPARESDECURRAR LIMIT SESSIONS_PER_USER 1;\n</code></pre> <p>Si vuelvo a lanzar la consulta anterior, ya aparece el perfil:</p> <pre><code>SELECT profile\n2  FROM DBA_PROFILES\nWHERE resource_name = 'SESSIONS_PER_USER'\nAND limit NOT IN ('UNLIMITED', 'DEFAULT');\nPROFILE\n--------------------------------------------------------------------------------------------------------------------------------\nNOPARESDECURRAR\n</code></pre> <p>Adem\u00e1s, ahora mismo tampoco tengo ning\u00fan usuario con el perfil <code>NOPARESDECURRAR</code> asignado:</p> <pre><code>SELECT username\nFROM DBA_USERS\nWHERE profile = 'NOPARESDECURRAR';\n</code></pre> <pre><code>no rows selected\n</code></pre> <p>As\u00ed que, por ejemplo, se lo vuelvo a asignar a <code>USRPRACTICA1</code>:</p> <pre><code>ALTER USER USRPRACTICA1 PROFILE NOPARESDECURRAR;\nUser altered.\n</code></pre> <p>Si vuelvo a lanzar la consulta anterior, ya aparece el usuario con el perfil:</p> <pre><code>SELECT username\n2  FROM DBA_USERS\nWHERE profile = 'NOPARESDECURRAR';\nUSERNAME\n--------------------------------------------------------------------------------------------------------------------------------\nUSRPRACTICA1\n</code></pre>"},{"location":"p5-usuarios/ri/alumno1/#23-comprobaciones","title":"23. Comprobaciones","text":"<p>Despu\u00e9s de hacer todo lo anterior, ya podemos mostrar directamente los usuarios que tienen limitado el n\u00famero de sesiones (que ser\u00e1 1, el que he \"forzado\" para que la siguiente consulta no saliera vac\u00eda):</p> <pre><code>SELECT username\nFROM DBA_USERS\nWHERE profile IN (\nSELECT profile\nFROM DBA_PROFILES\nWHERE resource_name = 'SESSIONS_PER_USER'\nAND limit NOT IN ('UNLIMITED', 'DEFAULT')\n);\n</code></pre> <pre><code>USERNAME\n--------------------------------------------------------------------------------------------------------------------------------\nUSRPRACTICA1\n</code></pre> <p>Adem\u00e1s, puedo comprobar que efectivamente las sesiones concurrentes de este usuario est\u00e1n limitadas a 1:</p> <p></p>"},{"location":"p5-usuarios/ri/alumno1/#ejercicio-24","title":"Ejercicio 24","text":""},{"location":"p5-usuarios/ri/alumno1/#24-enunciado","title":"24. Enunciado","text":"<p>Realizar un procedimiento que reciba un nombre de usuario y un privilegio de sistema y nos muestre el mensaje 'SI, DIRECTO' si el usuario tiene ese privilegio concedido directamente, 'SI, POR ROL' si el usuario tiene ese privilegio en alguno de los roles que tiene concedidos y un 'NO' si el usuario no tiene dicho privilegio.</p>"},{"location":"p5-usuarios/ri/alumno1/#24-codigo","title":"24. C\u00f3digo","text":"<pre><code>CREATE OR REPLACE PROCEDURE comprobar_privilegio_sistema (\np_usuario IN VARCHAR2,\np_privilegio IN VARCHAR2\n) AS\nCURSOR c_lista_privilegios IS\nSELECT *\nFROM DBA_SYS_PRIVS\nWHERE grantee = p_usuario\nOR grantee IN (\nSELECT granted_role\nFROM DBA_ROLE_PRIVS\nCONNECT BY PRIOR granted_role = grantee START WITH grantee = p_usuario\n)\nORDER BY 1,2,3;\nv_es_usuario NUMBER;\nv_es_rol     NUMBER;\nBEGIN\nFOR i IN c_lista_privilegios LOOP\nIF i.privilege = p_privilegio THEN\nSELECT COUNT(*) INTO v_es_usuario\nFROM DBA_USERS\nWHERE username = i.grantee;\nSELECT COUNT(*) INTO v_es_rol\nFROM DBA_ROLES\nWHERE role = i.grantee;\nEND IF;\nEND LOOP;\nIF v_es_usuario = 1 THEN\nDBMS_OUTPUT.PUT_LINE('SI, DIRECTO');\nELSIF v_es_rol = 1 THEN\nDBMS_OUTPUT.PUT_LINE('SI, POR ROL');\nELSE\nDBMS_OUTPUT.PUT_LINE('NO');\nEND IF;\nEND;\n/\n</code></pre>"},{"location":"p5-usuarios/ri/alumno1/#24-comprobaciones","title":"24. Comprobaciones","text":"<p>Antes de nada, aclaro que estar\u00e9 usando el usuario <code>USRPRACTICA1</code> para las pruebas, porque lo tengo preparado con privilegios y roles para que salgan unos resultados lo m\u00e1s completos posibles.</p> <p>Primero voy a mostrar TODOS (directos, por rol, y con recursividad de rol) los privilegios de <code>USRPRACTICA1</code> para que tengamos una imagen global:</p> <pre><code>SELECT *\nFROM DBA_SYS_PRIVS\nWHERE grantee = 'USRPRACTICA1'\nOR grantee IN (\nSELECT granted_role\nFROM DBA_ROLE_PRIVS\nCONNECT BY PRIOR granted_role = grantee START WITH grantee = 'USRPRACTICA1'\n)\nORDER BY 1,2,3;\n</code></pre> <pre><code>GRANTEE                                                                                                                          PRIVILEGE                                ADM COM INH\n-------------------------------------------------------------------------------------------------------------------------------- ---------------------------------------- --- --- ---\nEJEMPLO                                                                                                                          CREATE ANY SYNONYM                       NO  YES NO\nROLPRACTICA1                                                                                                                     CREATE SESSION                           NO  YES NO\nROLPRACTICA1                                                                                                                     CREATE TABLE                             NO  YES NO\nUSRPRACTICA1                                                                                                                     CREATE ANY INDEX                         NO  YES NO\nUSRPRACTICA1                                                                                                                     CREATE ANY TABLE                         NO  YES NO\nUSRPRACTICA1                                                                                                                     CREATE SESSION                           NO  YES NO\nUSRPRACTICA1                                                                                                                     INSERT ANY TABLE                         NO  YES NO\n7 rows selected.\n</code></pre> <p>Depende de quien haya recibido el privilegio, es de un tipo u otro:</p> <ul> <li><code>USRPRACTICA1</code>: directo, lo recibe el usuario</li> <li><code>ROLPRACTICA1</code>: por rol, est\u00e1 otorgado a <code>USRPRACTICA1</code></li> <li><code>EJEMPLO</code>: por rol recursivo, ya que ejemplo no es un rol otorgado a <code>USRPRACTICA1</code>, es un rol otorgado a <code>ROLPRACTICA1</code></li> </ul> <p>Para probar lo dicho, muestro los roles de <code>USRPRACTICA1</code>:</p> <pre><code>SELECT granted_role\nFROM dba_role_privs\nWHERE grantee = 'USRPRACTICA1';\n</code></pre> <pre><code>GRANTED_ROLE\n--------------------------------------------------------------------------------------------------------------------------------\nROLPRACTICA1\n</code></pre> <p>Y muestros los roles del rol <code>ROLPRACTICA1</code>:</p> <pre><code>SELECT granted_role\nFROM dba_role_privs\nWHERE grantee = 'ROLPRACTICA1';\n</code></pre> <pre><code>GRANTED_ROLE\n--------------------------------------------------------------------------------------------------------------------------------\nEJEMPLO\n</code></pre> <p>Como vemos, ejemplo (un rol que he creado y preparado) no es un rol directo de <code>USRPRACTICA1</code>, es un rol directo de <code>ROLPRACTICA1</code>, as\u00ed que ya aqu\u00ed entrar\u00eda en juego la recursividad.</p> <p>Teniendo todo esto en mente, y el resultado completo de privilegios de arriba, podremos entender el resultado de la ejecuci\u00f3n del procedimiento.</p> <p>Muestro un privilegio directo:</p> <pre><code>EXEC comprobar_privilegio_sistema('USRPRACTICA1','CREATE ANY TABLE');\nSI, DIRECTO\nPL/SQL procedure successfully completed.\n</code></pre> <p>Muestro un privilegio por rol:</p> <pre><code>EXEC comprobar_privilegio_sistema('USRPRACTICA1','CREATE TABLE');\nSI, POR ROL\nPL/SQL procedure successfully completed.\n</code></pre> <p>Muestro un privilegio por rol recursivo:</p> <pre><code>EXEC comprobar_privilegio_sistema('USRPRACTICA1','CREATE ANY SYNONYM');\nSI, POR ROL\nPL/SQL procedure successfully completed.\n</code></pre> <p>Muestro un privilegio que no tenga asignado de ninguna manera:</p> <pre><code>EXEC comprobar_privilegio_sistema('USRPRACTICA1','CREATE ANY PROCEDURE');\nNO\nPL/SQL procedure successfully completed.\n</code></pre>"},{"location":"p5-usuarios/ri/alumno1/#ejercicio-25","title":"Ejercicio 25","text":""},{"location":"p5-usuarios/ri/alumno1/#25-enunciado","title":"25. Enunciado","text":"<p>Realizar un procedimiento llamado <code>MostrarNumSesiones</code> que:</p> <ul> <li>Reciba un nombre de usuario</li> <li>Muestre el n\u00famero de sesiones concurrentes que puede tener abiertas como m\u00e1ximo</li> <li>Muestre el n\u00famero de sesiones concurrentes que tiene abiertas actualmente</li> </ul>"},{"location":"p5-usuarios/ri/alumno1/#25-codigo","title":"25. C\u00f3digo","text":"<pre><code>CREATE OR REPLACE PROCEDURE MostrarNumSesiones (\nusuarioentrante IN VARCHAR2\n) IS\nv_perfilsacado     VARCHAR2(30);\nv_limitmaxsesiones VARCHAR2(40);\nv_numsesiones      NUMBER;\nBEGIN\n-- Sacamos el perfil del usuario solicitado\nSELECT profile INTO v_perfilsacado\nFROM DBA_USERS\nWHERE username = usuarioentrante;\n-- Sacamos el n\u00famero m\u00e1ximo de sesiones permitidas para ese usuario\nSELECT limit INTO v_limitmaxsesiones\nFROM DBA_PROFILES\nWHERE profile = v_perfilsacado\nAND resource_name = 'SESSIONS_PER_USER';\n-- Sacamos las sesiones abiertas por ese usuario actualmente\nSELECT COUNT(username) INTO v_numsesiones\nFROM V$SESSION\nWHERE username = usuarioentrante;\nDBMS_OUTPUT.PUT_LINE('El usuario '|| usuarioentrante || ' tiene un limite de sesiones concurrentes permitidas de: ' || v_limitmaxsesiones);\nDBMS_OUTPUT.PUT_LINE('Pero el numero real de sesiones que tiene abiertas son: '|| v_numsesiones);\nEND;\n/\n</code></pre>"},{"location":"p5-usuarios/ri/alumno1/#25-comprobaciones","title":"25. Comprobaciones","text":"<p>Primero dejo abiertas 2 sesiones con el usuario <code>TESTING</code>:</p> <p></p> <p>Lanzo el procedimiento y pruebo que funciona:</p> <pre><code>EXEC MostrarNumSesiones('TESTING');\nEl usuario TESTING tiene un limite de sesiones concurrentes permitidas de: UNLIMITED\nPero el numero real de sesiones que tiene abiertas son: 2\nPL/SQL procedure successfully completed.\n</code></pre>"},{"location":"p5-usuarios/ri/alumno2/","title":"Alumno 2","text":""},{"location":"p5-usuarios/ri/alumno2/#postgres","title":"Postgres:","text":""},{"location":"p5-usuarios/ri/alumno2/#ejercicio-1","title":"EJERCICIO 1","text":"<p>Averigua que privilegios de sistema hay en Postgres y como se asignan a un usuario.</p> <p>Para asignar privilegios de sistema a un usuario o grupos de usuario en concreto, en Postgres, debemos realizar la creaci\u00f3n de roles, a los cu\u00e1les se les ir\u00e1n otorgando permisos. </p> <p>Podemos asignar los siguientes privilegios a un rol:</p> <ul> <li> <p>superuser status: Se otorga a un rol los privilegios de un super usuario.</p> </li> <li> <p>database creation: Se otorga a un rol los privilegios de crear una base de datos.</p> </li> <li> <p>role creation:  Se le otorga al rol el privilegio de crear usuarios o roles. Realmente el comando <code>create user</code> es un alias de <code>create role</code>, ya que al crear un usuario, estamos creando un rol.</p> </li> <li> <p>initiating replication: Se otorga a un rol el privilegio </p> </li> <li> <p>password: Se otorga a un rol el privilegio de generar o crear contrase\u00f1as.</p> </li> <li> <p>inheritance of privileges: Se otorga el privilegio de otorgar privilegios.</p> </li> <li> <p>bypassing row-level security: Se otorga a un rol el privilegio de indicar que la contrase\u00f1a de los usuarios sean seguras.</p> </li> <li> <p>connection limit: Se otorga a un rol el privilegio de limitar el numero de conexiones a la base de datos.</p> </li> </ul>"},{"location":"p5-usuarios/ri/alumno2/#ejercicio-2","title":"EJERCICIO 2","text":"<p>Averigua cual es la forma de asignar y revocar privilegios sobre una tabla concreta en Postgres.</p> <p>La forma de asignar privilegios en sobre una tabla en concreto tiene la siguiente sintaxis:</p> <pre><code>GRANT SELECT, INSERT, UPDATE, DELETE ON TABLE table1, table2...\n</code></pre> <p>Para revocar los privilegios de una tabla:</p> <pre><code>REVOKE * ON TABLE table1, table2...\n</code></pre>"},{"location":"p5-usuarios/ri/alumno2/#ejercicio-3","title":"EJERCICIO 3","text":"<p>Averigua si existe el concepto de rol en Postgres y se\u00f1ala las diferencias con los roles de ORACLE.</p> <p>S\u00ed, existe el concepto de \"rol\" en PostgreSQL. Los roles en PostgreSQL son similares a los roles en Oracle en el sentido de que ambos se utilizan para controlar el acceso a los objetos de la base de datos. Sin embargo, hay algunas diferencias clave entre los roles de PostgreSQL y los roles de Oracle.</p> <ol> <li> <p>En PostgreSQL, los roles son similares a los usuarios, ya que ambos tienen credenciales de inicio de sesi\u00f3n y contrase\u00f1as. Los roles tambi\u00e9n pueden ser miembros de otros roles, lo que permite la herencia de privilegios.</p> </li> <li> <p>En Oracle, los roles se utilizan principalmente para otorgar privilegios a los usuarios. Los usuarios se asignan a roles y los roles se les otorgan los privilegios necesarios.</p> </li> <li> <p>En PostgreSQL los roles pueden tener diferentes tipos de autenticaci\u00f3n como pueden ser password, ident, trust entre otros, mientras que en Oracle solo pueden ser autenticados con contrase\u00f1a.</p> </li> <li> <p>En PostgreSQL, los roles pueden tener diferentes privilegios en diferentes bases de datos y esquemas, mientras que en Oracle los privilegios se asignan a nivel de usuario.</p> </li> <li> <p>Los roles en PostgreSQL son independientes de los usuarios, es decir, un usuario puede ser miembro de varios roles, mientras que en Oracle un usuario solo puede tener un rol.</p> </li> </ol> <p>En resumen, los roles en PostgreSQL y Oracle son similares en cuanto a su funci\u00f3n principal: controlar el acceso a los objetos de la base de datos. Sin embargo, hay algunas diferencias importantes en la forma en que se utilizan y se administran en cada sistema.</p>"},{"location":"p5-usuarios/ri/alumno2/#ejercicio-4","title":"EJERCICIO 4","text":"<p>Averigua si existe el concepto de perfil como conjunto de l\u00edmites sobre el uso de recursos o sobre la contrase\u00f1a en Postgres y se\u00f1ala las diferencias con los perfiles de ORACLE.</p> <p>S\u00ed, existe el concepto de perfil en PostgreSQL, pero funciona de manera diferente a como se utiliza en Oracle.</p> <p>En Oracle, los perfiles son conjuntos de l\u00edmites que se establecen para controlar el uso de recursos y las contrase\u00f1as de los usuarios. Los l\u00edmites de recursos pueden incluir cosas como el tiempo de sesi\u00f3n m\u00e1ximo, el uso de CPU y el uso de memoria. Los l\u00edmites de contrase\u00f1a pueden incluir cosas como la longitud m\u00ednima de la contrase\u00f1a, la cantidad de d\u00edas antes de que expire una contrase\u00f1a y el n\u00famero de intentos fallidos permitidos antes de bloquear una cuenta.</p> <p>En PostgreSQL, no existe un sistema de perfiles integrado para establecer l\u00edmites de recursos y contrase\u00f1as. Sin embargo, se pueden establecer l\u00edmites de recursos utilizando la configuraci\u00f3n del sistema operativo o utilizando herramientas de terceros. Adem\u00e1s, se pueden establecer l\u00edmites de contrase\u00f1as utilizando las caracter\u00edsticas de autenticaci\u00f3n de PostgreSQL.</p> <p>En resumen, en Oracle existe un sistema de perfiles integrado que se utiliza para establecer l\u00edmites de recursos y contrase\u00f1as, mientras que en PostgreSQL no existe un sistema de perfiles integrado, pero se pueden establecer l\u00edmites de recursos y contrase\u00f1as utilizando configuraciones del sistema operativo o herramientas de terceros.</p>"},{"location":"p5-usuarios/ri/alumno2/#ejercicio-5","title":"EJERCICIO 5","text":"<p>Realiza consultas al diccionario de datos de Postgres para averiguar todos los privilegios que tiene un usuario concreto.</p> <pre><code>SELECT grantee, privilege_type, table_name\nFROM information_schema.role_table_grants\nWHERE grantee = 'joseju';\n</code></pre>"},{"location":"p5-usuarios/ri/alumno2/#ejercicio-6","title":"EJERCICIO 6","text":"<p>Realiza consultas al diccionario de datos en Postgres para averiguar qu\u00e9 usuarios pueden consultar una tabla concreta.</p> <p>Para obtener una lista de usuarios y roles que tienen permisos de SELECT en una tabla espec\u00edfica, ejecutamos la siguiente consulta:</p> <pre><code>postgres=# SELECT grantee, privilege_type\nFROM information_schema.table_privileges\nWHERE table_name = 'pg_aggregate' AND privilege_type = 'SELECT';\ngrantee  | privilege_type ----------+----------------\npostgres | SELECT\nPUBLIC   | SELECT\n(2 filas)\n</code></pre> <p>Debemos tener en cuenta que tenemos que reemplazar 'nombre_tabla' con el nombre de la tabla para la cual deseas obtener informaci\u00f3n de permisos.</p> <p>Es importante mencionar que estas consultas estan basadas en la estructura del diccionario de datos de PostgreSQL, puede variar dependiendo de la version y configuracion de tu base de datos.</p>"},{"location":"p5-usuarios/ri/alumno2/#oracle","title":"ORACLE:","text":""},{"location":"p5-usuarios/ri/alumno2/#ejercicio-7","title":"EJERCICIO 7","text":"<p>Realiza una funci\u00f3n de verificaci\u00f3n de contrase\u00f1as que compruebe que la contrase\u00f1a difiere en m\u00e1s de tres caracteres de la anterior y que la longitud de la misma es diferente de la anterior. As\u00edgnala al perfil CONTRASE\u00d1ASEGURA. Comprueba que funciona correctamente.</p> <pre><code>CREATE OR REPLACE FUNCTION verificar_contrasenas (old_password VARCHAR2, new_password VARCHAR2) RETURN BOOLEAN IS\ndifferent_characters INTEGER;\nBEGIN\ndifferent_characters := 0;\nFOR i IN 1..LENGTH(old_password) LOOP\nIF SUBSTR(old_password, i, 1) != SUBSTR(new_password, i, 1) THEN\ndifferent_characters := different_characters + 1;\nEND IF;\nEND LOOP;\nIF different_characters &gt; 3 AND LENGTH(old_password) != LENGTH(new_password) THEN\nRETURN TRUE;\nELSE\nRETURN FALSE;\nEND IF;\nEND verificar_contrasenas;\n/\n</code></pre> <p>Para asignar la funci\u00f3n que acabamos de crear al perfil CONTRASE\u00d1ASEGURA, ejecutamos el siguiente comando:</p> <pre><code>ALTER PROFILE \"CONTRASENASEGURA\" LIMIT PASSWORD_VERIFY_FUNCTION \"verificar_contrasenas\";\n</code></pre> <p>Comprobamos que se ha asignado correctamente realizando la siguiente consulta:</p> <pre><code>SQL&gt; SELECT profile, resource_name, limit FROM dba_profiles\nWHERE profile = 'CONTRASENASEGURA' AND resource_name = 'PASSWORD_VERIFY_FUNCTION';\nverificar_contrasenas\n</code></pre>"},{"location":"p5-usuarios/ri/alumno2/#ejercicio-8","title":"EJERCICIO 8","text":"<p>Realiza un procedimiento llamado MostrarPrivilegiosdelRol que reciba el nombre de un rol y muestre los privilegios de sistema y los privilegios sobre objetos que lo componen.</p> <pre><code>create or replace procedure MostrarPrivilegiosdeRol(p_rol dba_roles.role%type)\nis\nbegin\ndbms_output.put_line( 'Rol: ' || p_rol);\nMostrarPrivSistema(p_rol);\nMostrarPrivObjetos(p_rol);\nend MostrarPrivilegiosdeRol;\n/\ncreate or replace procedure MostrarPrivSistema(p_rol dba_roles.role%type)\nis\ncursor c_sistema is select privilege from ROLE_SYS_PRIVS where role=p_rol;\nbegin\ndbms_output.put_line( ' ');\ndbms_output.put_line( 'Privilegios de sistema: ' || p_rol);\ndbms_output.put_line( ' ');\nfor i in c_sistema loop\ndbms_output.put_line(i.privilege);\nend loop;\nend MostrarPrivSistema;\n/\ncreate or replace procedure MostrarPrivObjetos(p_rol dba_roles.role%type)\nis\ncursor c_objetos is select privilege, table_name from ROLE_TAB_PRIVS where role=p_rol;\nbegin\ndbms_output.put_line( ' ');\ndbms_output.put_line( 'Privilegios sobre objetos: ' || p_rol);\ndbms_output.put_line( ' ');\nfor d in c_objetos loop\ndbms_output.put_line( 'Nombre objeto: ' || d.table_name || ' -------------- Privilegio: ' || d.privilege);\nend loop;\nend MostrarPrivObjetos;\n/\n</code></pre>"},{"location":"p5-usuarios/ri/alumno2/#prueba-de-funcionamiento","title":"Prueba de funcionamiento","text":"<pre><code>SQL&gt; exec MostrarPrivilegiosdeRol('DBA');\nRol: DBA\nPrivilegios de sistema: DBA\nCREATE ANY HIERARCHY\nALTER ANY ATTRIBUTE DIMENSION\nCREATE ANY ATTRIBUTE DIMENSION\nCREATE ATTRIBUTE DIMENSION\nALTER ANY MEASURE FOLDER\nLOGMINING\nCREATE ANY CREDENTIAL\nCREATE CREDENTIAL\nDROP LOCKDOWN PROFILE\nCREATE LOCKDOWN PROFILE\nCREATE ANY SQL TRANSLATION PROFILE\nCREATE SQL TRANSLATION PROFILE\nCREATE CUBE BUILD PROCESS\nSELECT ANY CUBE\nDROP ANY CUBE DIMENSION\nSELECT ANY MINING MODEL\nDROP ANY MINING MODEL\nSELECT ANY TRANSACTION\nON COMMIT REFRESH\nCREATE ANY OUTLINE\nCREATE ANY CONTEXT\nUNDER ANY VIEW\nALTER ANY MATERIALIZED VIEW\nDROP PROFILE\nSELECT ANY SEQUENCE\nCREATE ANY SYNONYM\nCREATE ANY CLUSTER\nALTER ROLLBACK SEGMENT\nALTER USER\nALTER TABLESPACE\nCREATE TABLESPACE\nALTER SESSION\nALTER ANY CUBE BUILD PROCESS\nSELECT ANY MEASURE FOLDER\nCREATE PLUGGABLE DATABASE\nFLASHBACK ARCHIVE ADMINISTER\nUPDATE ANY CUBE BUILD PROCESS\nDELETE ANY MEASURE FOLDER\nCREATE MEASURE FOLDER\nDELETE ANY CUBE DIMENSION\nADMINISTER ANY SQL TUNING SET\nCREATE ANY JOB\nALTER ANY RULE SET\nCREATE RULE SET\nDROP ANY EVALUATION CONTEXT\nALTER ANY EVALUATION CONTEXT\nCREATE EVALUATION CONTEXT\nDEBUG CONNECT ANY\nDROP ANY CONTEXT\nCREATE LIBRARY\nCREATE ANY MATERIALIZED VIEW\nALTER PROFILE\nALTER ANY TRIGGER\nCREATE TRIGGER\nCREATE PROCEDURE\nFORCE TRANSACTION\nDROP ANY VIEW\nUPDATE ANY TABLE\nLOCK ANY TABLE\nDROP ANY TABLE\nRESTRICTED SESSION\nALTER SYSTEM\nALTER ANY ANALYTIC VIEW\nCREATE ANY ANALYTIC VIEW\nCREATE HIERARCHY\nUSE ANY JOB RESOURCE\nDROP ANY SQL TRANSLATION PROFILE\nDROP ANY CUBE\nCREATE CUBE\nADMINISTER SQL TUNING SET\nMANAGE SCHEDULER\nANALYZE ANY DICTIONARY\nALTER ANY RULE\nEXECUTE ANY EVALUATION CONTEXT\nCREATE ANY EVALUATION CONTEXT\nDROP ANY DIMENSION\nCREATE DIMENSION\nALTER ANY OPERATOR\nALTER ANY LIBRARY\nUNDER ANY TYPE\nEXECUTE ANY TYPE\nGRANT ANY PRIVILEGE\nCREATE PROFILE\nALTER DATABASE\nCREATE PUBLIC DATABASE LINK\nCREATE ANY SEQUENCE\nCREATE ANY VIEW\nCREATE PUBLIC SYNONYM\nCREATE ANY INDEX\nCREATE CLUSTER\nDELETE ANY TABLE\nDROP ANY ANALYTIC VIEW\nALTER ANY HIERARCHY\nCREATE ANY CUBE BUILD PROCESS\nINSERT ANY MEASURE FOLDER\nCREATE ANY CUBE\nSELECT ANY CUBE DIMENSION\nEXECUTE ASSEMBLY\nEXECUTE ANY ASSEMBLY\nCREATE ASSEMBLY\nMANAGE ANY FILE GROUP\nEXECUTE ANY CLASS\nCREATE RULE\nEXPORT FULL DATABASE\nCREATE ANY RULE SET\nDEBUG CONNECT SESSION\nMERGE ANY VIEW\nDROP ANY OUTLINE\nMANAGE ANY QUEUE\nCREATE ANY DIMENSION\nQUERY REWRITE\nDROP ANY DIRECTORY\nDROP ANY TRIGGER\nCREATE ANY TRIGGER\nFORCE ANY TRANSACTION\nCREATE DATABASE LINK\nDROP ANY INDEX\nALTER ANY CLUSTER\nCOMMENT ANY TABLE\nBACKUP ANY TABLE\nCREATE TABLE\nDROP ROLLBACK SEGMENT\nDROP TABLESPACE\nDROP ANY HIERARCHY\nEM EXPRESS CONNECT\nALTER ANY SQL TRANSLATION PROFILE\nADMINISTER SQL MANAGEMENT OBJECT\nCREATE ANY MEASURE FOLDER\nINSERT ANY CUBE DIMENSION\nCREATE CUBE DIMENSION\nALTER ANY ASSEMBLY\nCREATE ANY EDITION\nCREATE EXTERNAL JOB\nREAD ANY FILE GROUP\nMANAGE FILE GROUP\nCREATE ANY RULE\nEXECUTE ANY RULE SET\nFLASHBACK ANY TABLE\nDEBUG ANY PROCEDURE\nRESUMABLE\nADMINISTER RESOURCE MANAGER\nALTER ANY OUTLINE\nUNDER ANY TABLE\nCREATE OPERATOR\nDROP ANY MATERIALIZED VIEW\nCREATE MATERIALIZED VIEW\nANALYZE ANY\nALTER RESOURCE COST\nDROP ANY ROLE\nCREATE ROLE\nDROP ANY SEQUENCE\nDROP PUBLIC SYNONYM\nCREATE SYNONYM\nALTER ANY INDEX\nDROP ANY CLUSTER\nREDEFINE ANY TABLE\nSELECT ANY TABLE\nCREATE ROLLBACK SEGMENT\nCREATE USER\nCREATE SESSION\nCREATE ANALYTIC VIEW\nDROP ANY ATTRIBUTE DIMENSION\nSELECT ANY CUBE BUILD PROCESS\nALTER LOCKDOWN PROFILE\nUPDATE ANY CUBE\nALTER ANY MINING MODEL\nCREATE ANY MINING MODEL\nCREATE MINING MODEL\nALTER ANY EDITION\nEXECUTE ANY PROGRAM\nDROP ANY RULE\nDROP ANY RULE SET\nGRANT ANY OBJECT PRIVILEGE\nSELECT ANY DICTIONARY\nADMINISTER DATABASE TRIGGER\nALTER ANY DIMENSION\nGLOBAL QUERY REWRITE\nCREATE INDEXTYPE\nEXECUTE ANY OPERATOR\nCREATE TYPE\nCREATE VIEW\nDROP ANY SYNONYM\nINSERT ANY TABLE\nDROP USER\nBECOME USER\nREAD ANY TABLE\nDROP ANY MEASURE FOLDER\nCOMMENT ANY MINING MODEL\nCREATE ANY ASSEMBLY\nDROP ANY EDITION\nCHANGE NOTIFICATION\nCREATE ANY SQL PROFILE\nALTER ANY SQL PROFILE\nDROP ANY SQL PROFILE\nCREATE JOB\nEXECUTE ANY RULE\nIMPORT FULL DATABASE\nEXECUTE ANY INDEXTYPE\nDROP ANY INDEXTYPE\nCREATE ANY INDEXTYPE\nDROP ANY OPERATOR\nCREATE ANY OPERATOR\nEXECUTE ANY LIBRARY\nDROP ANY TYPE\nALTER ANY TYPE\nAUDIT ANY\nDROP PUBLIC DATABASE LINK\nALTER ANY SEQUENCE\nALTER ANY TABLE\nAUDIT SYSTEM\nSET CONTAINER\nUSE ANY SQL TRANSLATION PROFILE\nUPDATE ANY CUBE DIMENSION\nDROP ANY CUBE BUILD PROCESS\nALTER ANY CUBE\nCREATE ANY CUBE DIMENSION\nALTER ANY CUBE DIMENSION\nDROP ANY ASSEMBLY\nADVISOR\nDEQUEUE ANY QUEUE\nENQUEUE ANY QUEUE\nALTER ANY INDEXTYPE\nDROP ANY LIBRARY\nCREATE ANY LIBRARY\nCREATE ANY TYPE\nCREATE ANY DIRECTORY\nEXECUTE ANY PROCEDURE\nDROP ANY PROCEDURE\nALTER ANY PROCEDURE\nCREATE ANY PROCEDURE\nALTER ANY ROLE\nGRANT ANY ROLE\nCREATE SEQUENCE\nCREATE ANY TABLE\nMANAGE TABLESPACE\nPrivilegios sobre objetos: DBA\nNombre objeto: ADR_LOG_MSG_T -------------- Privilegio: EXECUTE\nNombre objeto: V_$DIAG_ADR_CONTROL -------------- Privilegio: SELECT\nNombre objeto: V_$DIAG_IPS_PACKAGE_FILE -------------- Privilegio: SELECT\nNombre objeto: V_$DIAG_IPS_REMOTE_PACKAGE -------------- Privilegio: SELECT\nNombre objeto: V_$DIAG_VIPS_PACKAGE_HISTORY -------------- Privilegio: SELECT\nNombre objeto: V_$DIAG_VPROBLEM -------------- Privilegio: SELECT\nNombre objeto: CDB_XS_SESSION_NS_ATTRIBUTES -------------- Privilegio: SELECT\nNombre objeto: DBMS_FLASHBACK_ARCHIVE -------------- Privilegio: EXECUTE\nNombre objeto: DBMS_MONITOR -------------- Privilegio: EXECUTE\nNombre objeto: DBMS_WORKLOAD_REPOSITORY -------------- Privilegio: EXECUTE\nNombre objeto: DBMS_ADR -------------- Privilegio: EXECUTE\nNombre objeto: DBMS_APP_CONT -------------- Privilegio: EXECUTE\nNombre objeto: DBMS_APP_CONT_ADMIN -------------- Privilegio: EXECUTE\nNombre objeto: XDB$D_LINK -------------- Privilegio: DELETE\nNombre objeto: XDB$ACL -------------- Privilegio: INSERT\nNombre objeto: XDB$RESCONFIG -------------- Privilegio: INSERT\nNombre objeto: XDB$CONFIG -------------- Privilegio: DELETE\nNombre objeto: DBA_REGISTRY_SQLPATCH_RU_INFO -------------- Privilegio: SELECT\nNombre objeto: OJDS_CONTEXT -------------- Privilegio: EXECUTE\nNombre objeto: XSDB$SCHEMA_ACL -------------- Privilegio: SELECT\nNombre objeto: ADR_INCIDENT_T -------------- Privilegio: EXECUTE\nNombre objeto: V_$DIAG_INCCKEY -------------- Privilegio: SELECT\nNombre objeto: V_$DIAG_VIEWCOL -------------- Privilegio: SELECT\nNombre objeto: V_$DIAG_HM_MESSAGE -------------- Privilegio: SELECT\nNombre objeto: V_$DIAG_IPS_PACKAGE_INCIDENT -------------- Privilegio: SELECT\nNombre objeto: V_$DIAG_IPS_FILE_COPY_LOG -------------- Privilegio: SELECT\nNombre objeto: V_$DIAG_IPS_PACKAGE_HISTORY -------------- Privilegio: SELECT\nNombre objeto: V_$DIAG_ALERT_EXT -------------- Privilegio: SELECT\nNombre objeto: V_$DIAG_RELMD_EXT -------------- Privilegio: SELECT\nNombre objeto: V_$DIAG_DFW_PATCH_CAPTURE -------------- Privilegio: SELECT\nNombre objeto: V_$DIAG_VINCIDENT -------------- Privilegio: SELECT\nNombre objeto: V_$DIAG_VIPS_FILE_COPY_LOG -------------- Privilegio: SELECT\nNombre objeto: V_$DIAG_VIPS_PACKAGE_SIZE -------------- Privilegio: SELECT\nNombre objeto: V_$DIAG_V_INCCOUNT -------------- Privilegio: SELECT\nNombre objeto: V_$DIAG_VPROBLEM_LASTINC -------------- Privilegio: SELECT\nNombre objeto: V_$DIAG_V_INC_METER_INFO_PROB -------------- Privilegio: SELECT\nNombre objeto: V_$DIAG_VPDB_PROBLEM -------------- Privilegio: SELECT\nNombre objeto: DBA_XS_SESSIONS -------------- Privilegio: SELECT\nNombre objeto: DBA_XS_ACTIVE_SESSIONS -------------- Privilegio: SELECT\nNombre objeto: DBA_XS_SESSION_NS_ATTRIBUTES -------------- Privilegio: SELECT\nNombre objeto: DBMS_TDB -------------- Privilegio: EXECUTE\nNombre objeto: DBMS_SERVER_ALERT -------------- Privilegio: EXECUTE\nNombre objeto: DBMS_HM -------------- Privilegio: EXECUTE\nNombre objeto: DBMS_AWR_WAREHOUSE_SERVER -------------- Privilegio: EXECUTE\nNombre objeto: DBMS_UMF -------------- Privilegio: EXECUTE\nNombre objeto: DBMS_GSM_FIX -------------- Privilegio: EXECUTE\nNombre objeto: DBMS_INMEMORY_ADMIN -------------- Privilegio: EXECUTE\nNombre objeto: DBMS_NETWORK_ACL_ADMIN -------------- Privilegio: EXECUTE\nNombre objeto: XDB$H_INDEX -------------- Privilegio: INSERT\nNombre objeto: XDB$H_INDEX -------------- Privilegio: UPDATE\nNombre objeto: XDB$D_LINK -------------- Privilegio: INSERT\nNombre objeto: XDB$D_LINK -------------- Privilegio: SELECT\nNombre objeto: XDB$RESOURCE -------------- Privilegio: DELETE\nNombre objeto: X$PT46MP5MDR0M04NE0KWN0SK0K1LN -------------- Privilegio: INSERT\nNombre objeto: DBA_REGISTRY_SQLPATCH -------------- Privilegio: DELETE\nNombre objeto: DBA_REGISTRY_SQLPATCH -------------- Privilegio: UPDATE\nNombre objeto: DBMS_XDBT -------------- Privilegio: EXECUTE\nNombre objeto: XSDB$SCHEMA_ACL -------------- Privilegio: UPDATE\nNombre objeto: ADR_INCIDENT_INFO_T -------------- Privilegio: EXECUTE\nNombre objeto: ADR_LOG_MSG_SUPPL_ATTR_T -------------- Privilegio: EXECUTE\nNombre objeto: V_$DIAG_PICKLEERR -------------- Privilegio: SELECT\nNombre objeto: V_$DIAG_DDE_USR_ACT_PARAM -------------- Privilegio: SELECT\nNombre objeto: V_$DIAG_DDE_USR_INC_ACT_MAP -------------- Privilegio: SELECT\nNombre objeto: V_$DIAG_IPS_CONFIGURATION -------------- Privilegio: SELECT\nNombre objeto: V_$DIAG_INC_METER_IMPT_DEF -------------- Privilegio: SELECT\nNombre objeto: V_$DIAG_EM_USER_ACTIVITY -------------- Privilegio: SELECT\nNombre objeto: V_$DIAG_VIPS_PACKAGE_FILE -------------- Privilegio: SELECT\nNombre objeto: V_$DIAG_VPROBLEM1 -------------- Privilegio: SELECT\nNombre objeto: V_$DIAG_VPROBLEM_BUCKET -------------- Privilegio: SELECT\nNombre objeto: V_$DIAG_VADR_CONTROL -------------- Privilegio: SELECT\nNombre objeto: CDB_XS_SESSION_ROLES -------------- Privilegio: SELECT\nNombre objeto: DBMS_MANAGEMENT_BOOTSTRAP -------------- Privilegio: EXECUTE\nNombre objeto: DBMS_AWR_WAREHOUSE_SOURCE -------------- Privilegio: EXECUTE\nNombre objeto: OUTLN_PKG -------------- Privilegio: EXECUTE\nNombre objeto: XDB$H_LINK -------------- Privilegio: DELETE\nNombre objeto: DBMS_XDB_ADMIN -------------- Privilegio: EXECUTE\nNombre objeto: X$PT46MP5MDR0M04NE0KWN0SK0K1LN -------------- Privilegio: DELETE\nNombre objeto: X$PT46MP5MDR0M04NE0KWN0SK0K1LN -------------- Privilegio: UPDATE\nNombre objeto: XDB$ACL -------------- Privilegio: SELECT\nNombre objeto: XDB$CHECKOUTS -------------- Privilegio: SELECT\nNombre objeto: DBA_REGISTRY_SQLPATCH_RU_INFO -------------- Privilegio: INSERT\nNombre objeto: GRANT_RDF_OWNER_DR_PRIVS -------------- Privilegio: EXECUTE\nNombre objeto: MAP_OBJECT -------------- Privilegio: DELETE\nNombre objeto: ADR_INCIDENT_FILES_T -------------- Privilegio: EXECUTE\nNombre objeto: V_$DIAG_VIEW -------------- Privilegio: SELECT\nNombre objeto: V_$DIAG_DDE_USER_ACTION_DEF -------------- Privilegio: SELECT\nNombre objeto: V_$DIAG_IPS_PKG_UNPACK_HIST -------------- Privilegio: SELECT\nNombre objeto: V_$DIAG_EM_DIAG_JOB -------------- Privilegio: SELECT\nNombre objeto: V_$DIAG_VSHOWINCB_I -------------- Privilegio: SELECT\nNombre objeto: V_$DIAG_V_INCFCOUNT -------------- Privilegio: SELECT\nNombre objeto: V_$DIAG_V_NFCINC -------------- Privilegio: SELECT\nNombre objeto: V_$DIAG_V_IPSPRBCNT -------------- Privilegio: SELECT\nNombre objeto: V_$DIAG_DIAGV_INCIDENT -------------- Privilegio: SELECT\nNombre objeto: CDB_XS_SESSIONS -------------- Privilegio: SELECT\nNombre objeto: XS_MTCACHE_INT -------------- Privilegio: EXECUTE\nNombre objeto: DBMS_SERVICE -------------- Privilegio: EXECUTE\nNombre objeto: DBMS_IR -------------- Privilegio: EXECUTE\nNombre objeto: DBMS_FEATURE_USAGE_REPORT -------------- Privilegio: EXECUTE\nNombre objeto: DBMS_UNDO_ADV -------------- Privilegio: EXECUTE\nNombre objeto: LOAD_UNDO_STAT -------------- Privilegio: EXECUTE\nNombre objeto: DBMS_CACHEUTIL -------------- Privilegio: EXECUTE\nNombre objeto: DBMS_DNFS -------------- Privilegio: EXECUTE\nNombre objeto: DBMS_FS -------------- Privilegio: EXECUTE\nNombre objeto: DBMS_XS_PRINCIPALS -------------- Privilegio: EXECUTE\nNombre objeto: XDB$H_INDEX -------------- Privilegio: SELECT\nNombre objeto: XDB$H_LINK -------------- Privilegio: SELECT\nNombre objeto: XDB$RESOURCE -------------- Privilegio: SELECT\nNombre objeto: DBMS_CSX_ADMIN -------------- Privilegio: EXECUTE\nNombre objeto: X$PT46MP5MDR0M04NE0KWN0SK0K1LN -------------- Privilegio: SELECT\nNombre objeto: XDB$ACL -------------- Privilegio: DELETE\nNombre objeto: XDB$CONFIG -------------- Privilegio: SELECT\nNombre objeto: DBA_REGISTRY_SQLPATCH -------------- Privilegio: INSERT\nNombre objeto: DBA_REGISTRY_SQLPATCH -------------- Privilegio: SELECT\nNombre objeto: DBA_REGISTRY_SQLPATCH_RU_INFO -------------- Privilegio: UPDATE\nNombre objeto: RDF_NETWORK_CREATOR_PRIVS -------------- Privilegio: EXECUTE\nNombre objeto: MAP_OBJECT -------------- Privilegio: UPDATE\nNombre objeto: ADR_LOG_MSG_SUPPL_ATTRS_T -------------- Privilegio: EXECUTE\nNombre objeto: ADR_LOG_MSG_ECID_T -------------- Privilegio: EXECUTE\nNombre objeto: V_$DIAG_INCIDENT -------------- Privilegio: SELECT\nNombre objeto: V_$DIAG_INCIDENT_FILE -------------- Privilegio: SELECT\nNombre objeto: V_$DIAG_HM_RUN -------------- Privilegio: SELECT\nNombre objeto: V_$DIAG_HM_FINDING -------------- Privilegio: SELECT\nNombre objeto: V_$DIAG_DDE_USER_ACTION -------------- Privilegio: SELECT\nNombre objeto: V_$DIAG_IPS_PACKAGE -------------- Privilegio: SELECT\nNombre objeto: V_$DIAG_IPS_PROGRESS_LOG -------------- Privilegio: SELECT\nNombre objeto: V_$DIAG_INC_METER_PK_IMPTS -------------- Privilegio: SELECT\nNombre objeto: V_$DIAG_DFW_CONFIG_ITEM -------------- Privilegio: SELECT\nNombre objeto: V_$DIAG_DFW_PURGE -------------- Privilegio: SELECT\nNombre objeto: V_$DIAG_ADR_CONTROL_AUX -------------- Privilegio: SELECT\nNombre objeto: V_$DIAG_VIPS_PKG_INC_DTL1 -------------- Privilegio: SELECT\nNombre objeto: V_$DIAG_VEM_USER_ACTLOG -------------- Privilegio: SELECT\nNombre objeto: V_$DIAG_VPROBLEM2 -------------- Privilegio: SELECT\nNombre objeto: V_$DIAG_VPROBLEM_BUCKET_COUNT -------------- Privilegio: SELECT\nNombre objeto: V_$DIAG_VIPS_PKG_MAIN_PROBLEM -------------- Privilegio: SELECT\nNombre objeto: V_$DIAG_V_ACTPROB -------------- Privilegio: SELECT\nNombre objeto: DBMS_FLASHBACK -------------- Privilegio: EXECUTE\nNombre objeto: DBMS_WORKLOAD_REPLAY -------------- Privilegio: EXECUTE\nNombre objeto: DBMS_ROLLING -------------- Privilegio: EXECUTE\nNombre objeto: DBMS_TNS -------------- Privilegio: EXECUTE\nNombre objeto: DBMS_AUTO_TASK_IMMEDIATE -------------- Privilegio: EXECUTE\nNombre objeto: AS_REPLAY -------------- Privilegio: EXECUTE\nNombre objeto: XDB$H_INDEX -------------- Privilegio: DELETE\nNombre objeto: XDB$D_LINK -------------- Privilegio: UPDATE\nNombre objeto: XDB$RESCONFIG -------------- Privilegio: DELETE\nNombre objeto: MAP_OBJECT -------------- Privilegio: SELECT\nNombre objeto: DBMS_LOGSTDBY -------------- Privilegio: EXECUTE\nNombre objeto: ADR_LOG_MSG_ERRID_T -------------- Privilegio: EXECUTE\nNombre objeto: V_$DIAG_SWEEPERR -------------- Privilegio: SELECT\nNombre objeto: V_$DIAG_HM_RECOMMENDATION -------------- Privilegio: SELECT\nNombre objeto: V_$DIAG_HM_INFO -------------- Privilegio: SELECT\nNombre objeto: V_$DIAG_DDE_USR_INC_TYPE -------------- Privilegio: SELECT\nNombre objeto: V_$DIAG_IPS_FILE_METADATA -------------- Privilegio: SELECT\nNombre objeto: V_$DIAG_DFW_CONFIG_CAPTURE -------------- Privilegio: SELECT\nNombre objeto: V_$DIAG_VIPS_PKG_FILE -------------- Privilegio: SELECT\nNombre objeto: V_$DIAG_VINCIDENT_FILE -------------- Privilegio: SELECT\nNombre objeto: V_$DIAG_VPROBLEM_INT -------------- Privilegio: SELECT\nNombre objeto: V_$DIAG_VEM_USER_ACTLOG1 -------------- Privilegio: SELECT\nNombre objeto: V_$DIAG_VPROBLEM_BUCKET1 -------------- Privilegio: SELECT\nNombre objeto: V_$DIAG_VHM_RUN -------------- Privilegio: SELECT\nNombre objeto: V_$DIAG_V_SWPERRCOUNT -------------- Privilegio: SELECT\nNombre objeto: V_$DIAG_VNOT_EXIST_INCIDENT -------------- Privilegio: SELECT\nNombre objeto: DBMS_AUTO_SQLTUNE -------------- Privilegio: EXECUTE\nNombre objeto: DBMS_RESULT_CACHE -------------- Privilegio: EXECUTE\nNombre objeto: DBMS_WORKLOAD_CAPTURE -------------- Privilegio: EXECUTE\nNombre objeto: DBMS_RAT_MASK -------------- Privilegio: EXECUTE\nNombre objeto: DBMS_SERVICE_CONST -------------- Privilegio: EXECUTE\nNombre objeto: DBMS_SERVICE_ERR -------------- Privilegio: EXECUTE\nNombre objeto: XDB$NLOCKS -------------- Privilegio: DELETE\nNombre objeto: XDB$NLOCKS -------------- Privilegio: INSERT\nNombre objeto: DBA_REGISTRY_SQLPATCH_RU_INFO -------------- Privilegio: DELETE\nNombre objeto: ADR_HOME_T -------------- Privilegio: EXECUTE\nNombre objeto: ADR_INCIDENT_CORR_KEYS_T -------------- Privilegio: EXECUTE\nNombre objeto: V_$DIAG_PROBLEM -------------- Privilegio: SELECT\nNombre objeto: V_$DIAG_HM_FDG_SET -------------- Privilegio: SELECT\nNombre objeto: V_$DIAG_INC_METER_SUMMARY -------------- Privilegio: SELECT\nNombre objeto: V_$DIAG_INC_METER_CONFIG -------------- Privilegio: SELECT\nNombre objeto: V_$DIAG_EM_TARGET_INFO -------------- Privilegio: SELECT\nNombre objeto: V_$DIAG_AMS_XACTION -------------- Privilegio: SELECT\nNombre objeto: V_$DIAG_DFW_PATCH_ITEM -------------- Privilegio: SELECT\nNombre objeto: V_$DIAG_PDB_PROBLEM -------------- Privilegio: SELECT\nNombre objeto: V_$DIAG_PDB_SPACE_MGMT -------------- Privilegio: SELECT\nNombre objeto: V_$DIAG_VSHOWINCB -------------- Privilegio: SELECT\nNombre objeto: V_$DIAG_VSHOWCATVIEW -------------- Privilegio: SELECT\nNombre objeto: V_$DIAG_VIPS_PKG_INC_DTL -------------- Privilegio: SELECT\nNombre objeto: V_$DIAG_VIPS_PACKAGE_MAIN_INT -------------- Privilegio: SELECT\nNombre objeto: V_$DIAG_V_ACTINC -------------- Privilegio: SELECT\nNombre objeto: V_$DIAG_VIPS_PKG_INC_CAND -------------- Privilegio: SELECT\nNombre objeto: CDB_XS_ACTIVE_SESSIONS -------------- Privilegio: SELECT\nNombre objeto: DBMS_STORAGE_MAP -------------- Privilegio: EXECUTE\nNombre objeto: DBMS_SERVER_TRACE -------------- Privilegio: EXECUTE\nNombre objeto: DBMS_PERF -------------- Privilegio: EXECUTE\nNombre objeto: DBMS_WRR_STATE -------------- Privilegio: EXECUTE\nNombre objeto: RESET_UNDO_STAT -------------- Privilegio: EXECUTE\nNombre objeto: DBMS_ILM_ADMIN -------------- Privilegio: EXECUTE\nNombre objeto: DBMS_MEMOPTIMIZE_ADMIN -------------- Privilegio: EXECUTE\nNombre objeto: DBMS_AUTO_INDEX -------------- Privilegio: EXECUTE\nNombre objeto: DBMS_AUTO_TASK_ADMIN -------------- Privilegio: EXECUTE\nNombre objeto: HM_SQLTK_INTERNAL -------------- Privilegio: EXECUTE\nNombre objeto: XDB$NLOCKS -------------- Privilegio: SELECT\nNombre objeto: XDB$ACL -------------- Privilegio: UPDATE\nNombre objeto: XDB$RESCONFIG -------------- Privilegio: SELECT\nNombre objeto: XDB$RESCONFIG -------------- Privilegio: UPDATE\nNombre objeto: XDB$CHECKOUTS -------------- Privilegio: DELETE\nNombre objeto: XDB$CHECKOUTS -------------- Privilegio: INSERT\nNombre objeto: XDB$CONFIG -------------- Privilegio: INSERT\nNombre objeto: XDB$CONFIG -------------- Privilegio: UPDATE\nNombre objeto: ORD_ADMIN -------------- Privilegio: EXECUTE\nNombre objeto: CARTRIDGE -------------- Privilegio: EXECUTE\nNombre objeto: MAP_OBJECT -------------- Privilegio: INSERT\nNombre objeto: XSDB$SCHEMA_ACL -------------- Privilegio: INSERT\nNombre objeto: ADR_LOG_MSG_ARG_T -------------- Privilegio: EXECUTE\nNombre objeto: ADR_LOG_MSG_ARGS_T -------------- Privilegio: EXECUTE\nNombre objeto: V_$DIAG_ADR_INVALIDATION -------------- Privilegio: SELECT\nNombre objeto: V_$DIAG_DDE_USR_ACT_PARAM_DEF -------------- Privilegio: SELECT\nNombre objeto: V_$DIAG_INC_METER_INFO -------------- Privilegio: SELECT\nNombre objeto: V_$DIAG_DIR_EXT -------------- Privilegio: SELECT\nNombre objeto: V_$DIAG_LOG_EXT -------------- Privilegio: SELECT\nNombre objeto: V_$DIAG_DFW_PURGE_ITEM -------------- Privilegio: SELECT\nNombre objeto: V_$DIAG_VINC_METER_INFO -------------- Privilegio: SELECT\nNombre objeto: V_$DIAG_VIPS_FILE_METADATA -------------- Privilegio: SELECT\nNombre objeto: V_$DIAG_V_IPSPRBCNT1 -------------- Privilegio: SELECT\nNombre objeto: V_$DIAG_VTEST_EXISTS -------------- Privilegio: SELECT\nNombre objeto: DBA_XS_SESSION_ROLES -------------- Privilegio: SELECT\nNombre objeto: DBMS_RESUMABLE -------------- Privilegio: EXECUTE\nNombre objeto: DBMS_SERVICE_PRVT -------------- Privilegio: EXECUTE\nNombre objeto: DBMS_UADV_ARR -------------- Privilegio: EXECUTE\nNombre objeto: DBMS_ADR_APP -------------- Privilegio: EXECUTE\nNombre objeto: DBMS_HANG_MANAGER -------------- Privilegio: EXECUTE\nNombre objeto: XDB$H_LINK -------------- Privilegio: INSERT\nNombre objeto: XDB$H_LINK -------------- Privilegio: UPDATE\nNombre objeto: XDB$RESOURCE -------------- Privilegio: INSERT\nNombre objeto: XDB$RESOURCE -------------- Privilegio: UPDATE\nNombre objeto: XDB$NLOCKS -------------- Privilegio: UPDATE\nNombre objeto: XDB$CHECKOUTS -------------- Privilegio: UPDATE\nPL/SQL procedure successfully completed.\n</code></pre>"},{"location":"p5-usuarios/ri/alumno3/","title":"Alumno 3","text":""},{"location":"p5-usuarios/ri/alumno3/#mysql","title":"MySQL:","text":""},{"location":"p5-usuarios/ri/alumno3/#1-averigua-que-privilegios-de-sistema-hay-en-mysql-y-como-se-asignan-a-un-usuario","title":"1. Averigua qu\u00e9 privilegios de sistema hay en MySQL y como se asignan a un usuario.","text":"<p>En Mysql no hay privilegios de sistema como tal.</p> <p>MySQL permite otorgar privilegios en seis niveles diferentes, en orden descendente del alcance de los privilegios son los siguientes:</p> <ul> <li>Global: los privilegios globales son administrativos o se aplican a todas las bases de datos en un servidor determinado. Se almacenan en la tabla del sistema mysql.user, y para asignarlos se usa la sintaxis: ON .</li> <li>Nivel de base de datos: los privilegios de base de datos se aplican a todos los objetos de una base de datos determinada. Se almacenan en la tabla del sistema mysql.db. Para asignarlos se usa la sintaxis: ON db_name.*</li> <li>Privilegios de tabla: los privilegios de tabla se aplican a todas las columnas de una tabla determinada. Se almacenan en la tabla del sistema mysql.tables_priv. Para asignar privilegios a nivel de tabla, hay que usar la sintaxis: ON db_name.tbl_name</li> <li>Privilegios de columna: los privilegios de columna se aplican a columnas individuales en una tabla determinada. Se almacenan en la tabla del sistema mysql.columns_priv. Cada privilegio que se conceder\u00e1 a nivel de columna debe ir seguido de la columna o columnas entre par\u00e9ntesis.</li> <li>Privilegios de rutinas almacenadas: los privilegios ALTER ROUTINE, CREATE ROUTINE, EXECUTE y GRANT OPTION se aplican a las rutinas almacenadas (procedimientos y funciones). Se pueden otorgar a nivel global y de base de datos. Excepto para CREATE RUTINE, estos privilegios se pueden otorgar para rutinas individuales. Se almacenan en la tabla del sistema mysql.procs_priv.</li> <li>Privilegios de usuario proxy: el privilegio PROXY permite que un usuario sea proxy para otro. El usuario apoderado suplanta o toma la identidad del usuario apoderado; es decir, asume los privilegios del usuario proxy. Se alamacenan en la tabla del sistema mysql.proxies_priv.</li> </ul> <p>Para ver los privilegios del usuario con el que hayamos accedido a la base de datos:</p> <pre><code>show grants;\n</code></pre> <p>Para ver los privilegios de un usuario espec\u00edfico:</p> <pre><code>show grants for arantxa;\n</code></pre> <p>Para mostrar la lista de todos los privilegios que tiene MySQL:</p> <pre><code>show privileges;\n</code></pre> <p>Sintaxis:</p> <pre><code>GRANT privilegio ON basedatos.tabla TO 'usuario|rol'@'host'  [WITH GRANT OPTION]\n</code></pre> <p>WITH GRANT OPTION: Si queremos que el usuario al que le damos el privilegio pueda dar ese mismo privilegio.</p> <p>Ejemplo:</p> <pre><code>GRANT all ON bd1.* TO 'arantxa'@'localhost';\n</code></pre>"},{"location":"p5-usuarios/ri/alumno3/#2-averigua-cual-es-la-forma-de-asignar-y-revocar-privilegios-sobre-una-tabla-concreta-en-mysql","title":"2. Averigua cual es la forma de asignar y revocar privilegios sobre una tabla concreta en MySQL.","text":"<p>Como vimos en el punto anterior, para asignar privilegios a nivel de tabla, se usa la sintaxis ON db_name.tbl_name. Por ejemplo:</p> <pre><code>grant select on maravilla.actor to 'arantxa'@'localhost';\n</code></pre> <p>Para revocar permisos a nivel de tabla se usar\u00eda la siguiente sintaxis:</p> <pre><code>REVOKE privilegio ON basedatos.tabla FROM 'usuario|rol'@'host';\n</code></pre> <p>Ejemplo:</p> <pre><code>revoke select on maravilla.actor from 'arantxa'@'loaclhost';\n</code></pre>"},{"location":"p5-usuarios/ri/alumno3/#3-averigua-si-existe-el-concepto-de-rol-en-mysql-y-senala-las-diferencias-con-los-roles-de-oracle","title":"3. Averigua si existe el concepto de rol en MySQL y se\u00f1ala las diferencias con los roles de ORACLE.","text":"<p>En MySQL s\u00ed existen los roles. Los roles de MySQL son colecciones de privilegios. Al igual que a los usuarios, a los roles se le pueden otorgar o revocar privilegios.</p> <p>A un usuario se le puede otorgar roles, lo que otorga al usuario los privilegios asociados con cada rol asociado. Esto permite la asignaci\u00f3n de conjuntos de privilegios a los usuarios.</p> <p>A continuaci\u00f3n se ven las posibilidades de gesti\u00f3n de roles proporcionadas por MySQL:</p> <ul> <li> <p>CREATE ROLE y DROP ROLE: crean y eliminan roles.</p> </li> <li> <p>GRANT y REVOKE: asignan y revocan privilegios de usuarios y roles.</p> </li> <li> <p>SHOW GRANTS: muestra los roles y privilegios que pertenecen a un usuario o un rol.</p> </li> <li> <p>SET DEFAULT ROLE: especifica qu\u00e9 roles de cuenta est\u00e1n activos de forma predeterminada.</p> </li> <li> <p>SET ROLE: cambia los roles activos dentro de la sesi\u00f3n actual.</p> </li> <li> <p>La funci\u00f3n CURRENT_ROLE() muestra los roles activos dentro de la sesi\u00f3n actual.</p> </li> <li> <p>Las variables de sistema mandatory_roles y activate_all_roles_on_login permiten definir roles obligatorios y la activaci\u00f3n autom\u00e1tica de roles otorgados cuando los usuarios inician sesi\u00f3n en el servidor.</p> </li> </ul> <p>En Oracle la gesti\u00f3n de los roles es muy similar a MySQL, la diferencia est\u00e1 en que tiene m\u00e1s funcionalidades.</p> <p>Para empezar en Oracle los roles no solo son colecciones de privilegios sino que tambi\u00e9n puede agrupar otros roles.</p> <p>Adem\u00e1s en Oracle se proporcionan algunos roles ya predefinidos para ayudar en la administraci\u00f3n. Estos roles se definen autom\u00e1ticamente cuando se crea la base de datos de Oracle. Algunos roles predefinidos son: CONNECT, RESOURCE, DBA, EXP_FULL_DATABASE, SELECT_CATALOG_ROLE, EXECUTE_CATALOG_ROLE...</p> <p>Otra diferencia es que en Oracle, a la hora de crear un rol se le puede especificar la forma de identificaci\u00f3n. Por ejemplo mediante una contrase\u00f1a que tendr\u00e1 que poner el usuario antes de usar el rol.</p> <pre><code>CREATE ROLE nombrerol IDENTIFIED BY contrase\u00f1a;\n</code></pre> <p>O identific\u00e1ndose mediante una aplicaci\u00f3n.</p> <pre><code>CREATE ROLE nombrerolapp IDENTIFIED USING nombrepaquetePLSQL;\n</code></pre> <p>IDENTIFIED USING package_name: permite crear un rol de aplicaci\u00f3n, y especificar qu\u00e9 paquete PL/SQL est\u00e1 autorizado para habilitar el rol.</p> <p>Otras formas de crear un rol mediante autorizaci\u00f3n son las siguientes:</p> <pre><code>CREATE ROLE nombrerol IDENTIFIED EXTERNALLY;\nCREATE ROLE nombrerol IDENTIFIED GLOBALLY;\n</code></pre> <p>Una diferencia entre ambos SGBD es la forma de consultar los privilegios asociados a un rol o los roles asociados a un usuario tambi\u00e9n es algo diferente.</p> <p>En MySQL:</p> <pre><code>SHOW GRANTS FOR usuario|rol [USING rol];\n</code></pre> <p>La cl\u00e1usula USING es opcional, y le prmite a SHOW GRANTS examinar los privilegios asociados con los roles del usuario (el rol mencionado en la cl\u00e1usula USING debe haberse otorgado al usuario).</p> <p>En Oracle:</p> <ul> <li>Listar todos los roles otorgados:</li> </ul> <pre><code>SELECT * FROM DBA_ROLE_PRIVS;\n</code></pre> <ul> <li>Listar los roles de la sesi\u00f3n actual.</li> </ul> <pre><code>SELECT * FROM SESSION_ROLES;\n</code></pre> <ul> <li>Listar roles de la base de datos.</li> </ul> <pre><code>SELECT * FROM DBA_ROLES;\n</code></pre> <p>Por \u00faltimo, en MySQL he visto que existen los roles obligatorios (mandatory roles). Los roles obligatorios permiten especificar roles como obligatorios nombr\u00e1ndolos en el valor de la variable de sistema mandatory_roles. El servidor trata un rol obligatorio como si fuera otorgado a todos los usuarios, por lo que no es necesario otorgarlo expl\u00edcitamente a ninguna cuenta. Para especificar funciones obligatorias al inicio del servidor se definen los mandatory_roles en el archivo my.cnf del servidor.</p>"},{"location":"p5-usuarios/ri/alumno3/#4-averigua-si-existe-el-concepto-de-perfil-como-conjunto-de-limites-sobre-el-uso-de-recursos-o-sobre-la-contrasena-en-mysql-y-senala-las-diferencias-con-los-perfiles-de-oracle","title":"4. Averigua si existe el concepto de perfil como conjunto de l\u00edmites sobre el uso de recursos o sobre la contrase\u00f1a en MySQL y se\u00f1ala las diferencias con los perfiles de ORACLE.","text":"<p>En MySQL no existe la creaci\u00f3n de perfiles en s\u00ed, la forma de limitar los recursos a los usuarios se hace de forma diferente a como se hace en Oracle.</p> <p>Para restringir el uso que los usuarios hacen del servidor MySQL se debe establecer la variable del sistema max_user_connections en un valor distinto a cero. Esto limita la cantidad de conexiones simult\u00e1neas que puede realizar una cuenta determinada, pero no impone l\u00edmites a lo que un cliente puede hacer una vez conectado. Configurar max_user_connections no habilita la administraci\u00f3n de cuentas individuales, opci\u00f3n que es interesante para los administradores y que s\u00ed tenemos en Oracle.</p> <p>Para contrarrestar esta limitaci\u00f3n MySQL, a la hora de usar alguno de los siguientes recursos, s\u00ed permite poner l\u00edmites para cuentas individuales. Esos recursos son:</p> <ul> <li>El n\u00famero de consultas que una cuenta puede emitir por hora.</li> <li>La cantidad de actualizaciones que una cuenta puede emitir por hora.</li> <li>La cantidad de veces que una cuenta puede conectarse al servidor por hora.</li> <li>El n\u00famero de conexiones simult\u00e1neas al servidor por una cuenta.</li> </ul> <p>Cualquier declaraci\u00f3n que un cliente pueda emitir tiene en contra el l\u00edmite de consultas. Solo las declaraciones que modifican bases de datos o tablas cuentan para el l\u00edmite de actualizaci\u00f3n.</p> <p>Se pueden limitar los recursos de una cuenta a la vez que se utiliza CREATE USER o ALTER USER, us\u00e1ndolo junto con WITH y el recurso a limitar. Por ejemplo:</p> <pre><code>CREATE USER 'arantxa'@'localhost' IDENTIFIED BY '1234'\n-&gt;     WITH MAX_QUERIES_PER_HOUR 20\n-&gt;          MAX_UPDATES_PER_HOUR 10\n-&gt;          MAX_CONNECTIONS_PER_HOUR 5\n-&gt;          MAX_USER_CONNECTIONS 2;\nALTER USER 'arantxa'@'localhost' WITH MAX_QUERIES_PER_HOUR 100;\n--Para eliminar la limitaci\u00f3n de un recurso habr\u00e1 que ponerlo a 0\nALTER USER 'arantxa'@'localhost' WITH MAX_CONNECTIONS_PER_HOUR 0;\n</code></pre> <p>En cuanto a las contrase\u00f1as, MySQL permite las siguientes opciones de administraci\u00f3n:</p> <ul> <li>Caducidad de la contrase\u00f1a, para exigir que las contrase\u00f1as se cambien peri\u00f3dicamente.</li> <li>Restricciones de reutilizaci\u00f3n de contrase\u00f1as, para evitar que se vuelvan a elegir contrase\u00f1as antiguas.</li> <li>Verificaci\u00f3n de contrase\u00f1a, para solicitar que los cambios de contrase\u00f1a tambi\u00e9n especifiquen la contrase\u00f1a actual para ser reemplazada.</li> <li>Contrase\u00f1as duales, para permitir que los clientes se conecten usando una contrase\u00f1a principal o secundaria.</li> <li>Evaluaci\u00f3n de la seguridad de la contrase\u00f1a, para exigir contrase\u00f1as seguras.</li> <li>Generaci\u00f3n aleatoria de contrase\u00f1as, como alternativa a la necesidad de contrase\u00f1as literales expl\u00edcitas especificadas por el administrador.</li> <li>Seguimiento de fallas de contrase\u00f1a, para habilitar el bloqueo temporal de la cuenta despu\u00e9s de demasiadas fallas consecutivas de inicio de sesi\u00f3n con contrase\u00f1a incorrecta.</li> </ul> <p>Para m\u00e1s informaci\u00f3n sobre c\u00f3mo se gestionan las anteriores limitaciones y la sintaxis que se utiliza se puede consultar la web oficial.</p> <p>En Oracle la creaci\u00f3n de perfiles se utiliza para limitar los recursos que pueda utilizar el usuario. A cada usuario se le puede asignar un perfil ya creado, y cada perfil puede tener diferentes limitaciones, por ejemplo limitaciones de los recursos del kernel (uso de la CPU, duraci\u00f3n de la sesi\u00f3n...) y limitaciones en el uso de las contrase\u00f1as de acceso (duraci\u00f3n, intentos de acceso, cambio de contrase\u00f1as, longitud y car\u00e1ceres permitidos...).</p> <p>Que las limitaciones se puedan agrupar en un perfil concreto es una gran ventaja para Oracle, ya que no habr\u00e1 que asignar las limitaciones a cada usuario concreto, se podr\u00e1 crear un perfil que sirva para muchos usuarios. Adem\u00e1s Oracle tiene m\u00e1s opciones de limitaci\u00f3n y permite al administrador llevar un mayor y mejor control de lo que hacen los usuarios en la base de datos.</p>"},{"location":"p5-usuarios/ri/alumno3/#5-realiza-consultas-al-diccionario-de-datos-de-mysql-para-averiguar-todos-los-privilegios-que-tiene-un-usuario-concreto","title":"5. Realiza consultas al diccionario de datos de MySQL para averiguar todos los privilegios que tiene un usuario concreto.","text":"<p>Como hemos dicho anteriormente, para consultar los privilegios de un usuario concreto habr\u00e1 que utilizar SHOW GRANT. En ese caso vamos a consultar los privilegios que tiene mi usuario llamado \"arantxa\".</p> <pre><code>mysql&gt; show grants for arantxa;\n+--------------------------------------------------------+\n| Grants for arantxa@%                                   |\n+--------------------------------------------------------+\n| GRANT USAGE ON *.* TO `arantxa`@`%`                    |\n| GRANT ALL PRIVILEGES ON `maravilla`.* TO `arantxa`@`%` |\n| GRANT SELECT ON `maravilla`.`actor` TO `arantxa`@`%`   |\n+--------------------------------------------------------+\n3 rows in set (0,00 sec)\n</code></pre>"},{"location":"p5-usuarios/ri/alumno3/#6-realiza-consultas-al-diccionario-de-datos-en-mysql-para-averiguar-que-usuarios-pueden-consultar-una-tabla-concreta","title":"6. Realiza consultas al diccionario de datos en MySQL para averiguar qu\u00e9 usuarios pueden consultar una tabla concreta.","text":"<p>En el primer ejercicio vimos que los privilegios a nivel de tabla se almacenan en la tabla del sistema mysql.tables_priv. Por tanto, para comprobar los usuarios que pueden consultar una tabla concreta habr\u00e1 que hacer una consulta a mysql.tables_priv.</p> <pre><code>mysql&gt; select * from mysql.tables_priv;\n+-----------+-----------+---------------+------------+----------------+---------------------+------------+-------------+\n| Host      | Db        | User          | Table_name | Grantor        | Timestamp           | Table_priv | Column_priv |\n+-----------+-----------+---------------+------------+----------------+---------------------+------------+-------------+\n| %         | maravilla | arantxa       | actor      | root@localhost | 2023-02-02 18:17:23 | Select     |             |\n| localhost | mysql     | mysql.session | user       | boot@          | 2022-10-26 09:23:03 | Select     |             |\n| localhost | sys       | mysql.sys     | sys_config | root@localhost | 2022-10-26 09:23:03 | Select     |             |\n+-----------+-----------+---------------+------------+----------------+---------------------+------------+-------------+\n3 rows in set (0,00 sec)\n</code></pre> <p>En el anterior caso comprobamos que mi usuario puede consultar (select) la tabla actor de la base de datos maravilla, y que el usuario que le ha dado los permisos es root.</p>"},{"location":"p5-usuarios/ri/alumno3/#oracle","title":"ORACLE:","text":""},{"location":"p5-usuarios/ri/alumno3/#1-realiza-un-procedimiento-llamado-permisosdeasobreb-que-reciba-dos-nombres-de-usuario-y-muestre-los-permisos-que-tiene-el-primero-de-ellos-sobre-objetos-del-segundo","title":"1. Realiza un procedimiento llamado PermisosdeAsobreB que reciba dos nombres de usuario y muestre los permisos que tiene el primero de ellos sobre objetos del segundo.","text":"<pre><code>CREATE OR REPLACE PROCEDURE PermisosdeAsobreB (p_usuarioA VARCHAR2, p_usuarioB VARCHAR2)\nAS\nBEGIN\nFOR obj IN (SELECT grantee, owner, table_name, privilege\nFROM dba_tab_privs\nWHERE grantee = p_usuarioA AND owner = p_usuarioB)\nLOOP\nDBMS_OUTPUT.PUT_LINE('El usuario ' || p_usuarioA || ' tiene el privilegio ' || obj.privilege || ' sobre la tabla ' || obj.table_name || ' de ' || obj.owner);\nEND LOOP;\nEND;\n/\nexec PermisosdeAsobreB ('ARANTXA','ADMIN');\n</code></pre> <p>Comprobaci\u00f3n:</p> <p>Los nombres de los usuarios deben estar en may\u00fasculas, ya que as\u00ed es como se guardan en las vistas del diccionario de datos.</p> <p></p>"},{"location":"p5-usuarios/ri/alumno3/#2-realiza-un-procedimiento-llamado-mostrarinfoperfil-que-reciba-el-nombre-de-un-perfil-y-muestre-su-composicion-y-los-usuarios-que-lo-tienen-asignado","title":"2. Realiza un procedimiento llamado MostrarInfoPerfil que reciba el nombre de un perfil y muestre su composici\u00f3n y los usuarios que lo tienen asignado.","text":"<pre><code>create or replace procedure MostrarInfoPerfil (p_perfil_name dba_profiles.profile%type)\nis\ncursor c_informacion is\nselect resource_name, resource_type, limit\nfrom dba_profiles\nwhere profile = p_perfil_name;\ncursor c_usuarios is\nselect username\nfrom dba_users\nwhere profile = p_perfil_name;\nbegin\ndbms_output.put_line(CHR(10)||'Composicion del perfil '|| p_perfil_name );\ndbms_output.put_line('--------------------------');\nfor i in c_informacion loop\ndbms_output.put_line('Recurso: '|| i.resource_name ||CHR(9)||CHR(9)||'Tipo de recurso: '|| i.resource_type ||CHR(9)||CHR(9)||' Limite: '|| i.limit);\nend loop;\ndbms_output.put_line(CHR(10)||'Usuarios con ese perfil: ');\ndbms_output.put_line('--------------------------');\nfor i in c_usuarios loop\ndbms_output.put_line(i.username);\nend loop;\nend MostrarInfoPerfil;\n/\n</code></pre> <p>Comprobaci\u00f3n:</p> <p>Habilitar los perfiles de ususario en Oracle:</p> <pre><code>alter session set \"_ORACLE_SCRIPT\"=true;\nALTER SYSTEM SET RESOURCE_LIMIT=TRUE;\n</code></pre> <p>He creado un perfil de prueba para el usuario 'arantxa' y 'admin' que solo permite tres sesiones concurrentes, el tiempo de conexi\u00f3n es de 240 minutos y el tiempo de inactividad no es mayor a 5 minutos. Los dem\u00e1s valores ser\u00e1n por defecto. Le asigno el nuevo perfil a los usuarios.</p> <pre><code>CREATE PROFILE admin_perfil_prueba\nLIMIT\nSESSIONS_PER_USER 3\nCONNECT_TIME 240\nIDLE_TIME 5;\nALTER USER arantxa PROFILE admin_perfil_prueba;\nALTER USER admin PROFILE admin_perfil_prueba;\n</code></pre> <p></p> <p>Probamos el procedimiento creado anteriormente:</p> <pre><code>exec MostrarInfoPerfil('ADMIN_PERFIL_PRUEBA');\n</code></pre> <p></p>"},{"location":"p5-usuarios/ri/alumno4/","title":"Alumno 4","text":""},{"location":"p5-usuarios/ri/alumno4/#mongodb","title":"Mongodb","text":""},{"location":"p5-usuarios/ri/alumno4/#ejercicio-1-averigua-si-existe-la-posibilidad-en-mongodb-de-limitar-el-acceso-de-un-usuario-a-los-datos-de-una-coleccion-determinada","title":"Ejercicio 1: Averigua si existe la posibilidad en MongoDB de limitar el acceso de un usuario a los datos de una colecci\u00f3n determinada.","text":"<p>Primero entramos en la base de datos como administrador, luego entramos en la base de datos que queremos crear:</p> <pre><code>mongo -u admin -p\n\nuse ejemplo\n\ndb.createCollection(\"coleccion\")\n\ndb.coleccion.InsertOne({nombre : \"Antonio\"})\n\ndb.createUser({user: \"antonio\", pwd: \"antonio\", roles: [\"readWrite\"]})\n\ndb.revokeRolesFromUser(\"antonio\",[ { \"role\" : \"readWrite\", db : \"ejemplo\" } ])\n\ndb.createCollection(\"coleccion2\")\n\ndb.createRole({role: \"leer_coleccion\", privileges: [{resource: {db: \"ejemplo\", collection: \"coleccion\"}, actions: [\"find\"]}], roles: []})\n\ndb.grantRolesToUser(\"antonio\", [{role: \"leer_coleccion\", db: \"ejemplo\"}])\n</code></pre> <p>Con esto al haber creado el usuario, se le da con derechos de lectura y escritura por defecto en la base de datos en la que ha sido creada, lo que ocurre es que al hacer un RevoqueRolesFromUser pues ha perdido su rol de readWrite, por tanto s\u00f3lo podr\u00e1 ver la colecci\u00f3n \"coleccion\":</p> <p></p> <p>Si volvemos a entrar como administrador en el sistema y volvemos a entrar en la base de datos, podemos volver a conceder los permisos:</p> <pre><code>use ejemplo\n\ndb.grantRolesToUser(\"antonio\",[ { \"role\" : \"readWrite\", db : \"ejemplo\" } ])\n\n&gt; db.getUser(\"antonio\")\n{\n    \"_id\" : \"ejemplo.antonio\",\n    \"userId\" : UUID(\"722d3e71-2c31-4371-803d-21c4ba8ba622\"),\n    \"user\" : \"antonio\",\n    \"db\" : \"ejemplo\",\n    \"roles\" : [\n        {\n            \"role\" : \"leer_coleccion\",\n            \"db\" : \"ejemplo\"\n        },\n        {\n            \"role\" : \"readWrite\",\n            \"db\" : \"ejemplo\"\n        }\n    ],\n    \"mechanisms\" : [\n        \"SCRAM-SHA-1\",\n        \"SCRAM-SHA-256\"\n    ]\n}\n&gt; \n</code></pre> <p>Y de esta manera al listar las colecciones podemos ver que estar\u00e1 disponible la que hemos otorgado a trav\u00e9s del rol:</p> <p></p>"},{"location":"p5-usuarios/ri/alumno4/#ejercicio-2-averigua-si-en-mongodb-existe-el-concepto-de-privilegio-del-sistema-y-muestra-las-diferencias-mas-importantes-con-oracle","title":"Ejercicio 2: Averigua si en MongoDB existe el concepto de privilegio del sistema y muestra las diferencias m\u00e1s importantes con ORACLE.","text":"<p>MongoDB tiene un sistema de autorizaci\u00f3n basado en roles que se utiliza para controlar el acceso a los recursos de la base de datos, por tanto s\u00ed, tiene sistema de privilegios de usuario similar al de Oracle. Los roles se asignan a los usuarios y definen los privilegios de acceso que tienen sobre los recursos de la base de datos.</p> <p>En comparaci\u00f3n con Oracle, MongoDB tiene algunas diferencias importantes en cuanto a los privilegios del sistema:</p> <ol> <li> <p>MongoDB no tiene una jerarqu\u00eda de privilegios como Oracle, donde los usuarios pueden heredar privilegios de otros usuarios o roles.</p> </li> <li> <p>MongoDB no tiene un sistema de vistas de seguridad como Oracle, donde los datos pueden ser filtrados para que solo se muestren los datos a los que un usuario tiene acceso.</p> </li> <li> <p>MongoDB tiene un sistema de autorizaci\u00f3n basado en roles en vez de a objetos, lo que significa que los privilegios se asignan a los roles en lugar de asignarlos directamente a los objetos de la base de datos como hemos podido comprobar en anteriores ejercicios con Oracle.</p> </li> <li> <p>MongoDB tiene un sistema de autorizaci\u00f3n en el nivel de campo, lo que significa que se pueden asignar privilegios espec\u00edficos para el acceso a los campos individuales de un documento como hemos visto en el anterior ejercicio.</p> </li> <li> <p>MongoDB tiene un enfoque m\u00e1s simple en la gesti\u00f3n de privilegios. Los roles se definen en un nivel de base de datos, en lugar de en un nivel de sistema como en ORACLE.</p> </li> <li> <p>MongoDB no tiene una funcionalidad de encriptaci\u00f3n de datos nativa como ORACLE, por lo que la encriptaci\u00f3n debe ser manejada por el cliente o a trav\u00e9s de un complemento.</p> </li> </ol>"},{"location":"p5-usuarios/ri/alumno4/#ejercicio-3-explica-los-roles-por-defecto-que-incorpora-mongodb-y-como-se-asignan-a-los-usuarios","title":"Ejercicio 3: Explica los roles por defecto que incorpora MongoDB y como se asignan a los usuarios.","text":"<p>Los roles por defecto que incorpora mongodb son los siguientes:</p> <p>read:  permite al usuario leer los documentos de una colecci\u00f3n.</p> <p>readWrite: Permite al usuario tanto leer como escribir en documentos de una colecci\u00f3n.</p> <p>dbAdmin:  permite al usuario administrar la base de datos.</p> <p>userAdmin:  permite al usuario administrar usuarios y roles en una base de datos.</p> <p>clusterAdmin: permite al usuario realizar tareas administrativas en todo el cluster de MongoDB</p> <p>backup: permite al usuario realizar copias de seguridad y restaurar datos.</p> <p>restore: Otorga acceso para restaurar la base de datos.</p> <p>dbOwner: Este rol otorga acceso total a todas las operaciones y colecciones en la base de datos, incluyendo la capacidad de crear y eliminar colecciones.</p> <p>readAnyDatabase: Otorga Acceso de lectura a cualquier base de datos.</p> <p>readWriteAnyDatabase: Otorga acceso de lectura y escritura a cualquier base de datos.</p> <p>Se le puede asignar un rol a un usuario cuando este es creado, si no se especifica este tendr\u00e1 por defecto un readWrite.</p> <pre><code>db.createUser({\n  user: \"antonio\",\n  pwd: \"antonio\",\n  roles: [{ role: \"read\", db: \"ejemplo\" }]\n});\n</code></pre> <p>Ahora bien, si queremos cambiar el rol que queremos que tenga un usuario podemos emplear los comandos de quitar o a\u00f1adir roles:</p> <pre><code>db.grantRolesToUser(\"antonio\",[ { \"role\" : \"readWrite\", db : \"ejemplo\" } ])\n\ndb.revokeRolesFromUser(\"antonio\",[ { \"role\" : \"readWrite\", db : \"ejemplo\" } ])\n</code></pre> <p>O de una manera alternativa podemos especificar qu\u00e9 rol queremos que tenga el usuario: <pre><code>db.updateUser(\"antonio\", { roles: [{ role: \"readWrite\", db: \"ejemplo\" }] });\n</code></pre></p>"},{"location":"p5-usuarios/ri/alumno4/#ejercicio-4-explica-como-puede-consultarse-el-diccionario-de-datos-de-mongodb-para-saber-que-roles-han-sido-concedidos-a-un-usuario-y-que-privilegios-incluyen","title":"Ejercicio 4: Explica como puede consultarse el diccionario de datos de MongoDB para saber que roles han sido concedidos a un usuario y qu\u00e9 privilegios incluyen.","text":"<p>Para obtener los roles de un usuario en Mongodb utilizaremos el comando <code>db.getUser(\"antonio\")</code> para ver qu\u00e9 roles tiene disponibles y en la base de datos en la que las tiene.</p> <p>el comando <code>db.runCommand({usersInfo:\"antonio\", showPrivileges:true})</code> mostrar\u00e1 la base de datos que tiene un determinado usuario y luego los roles que posee sobre ella.</p> <pre><code>ejemplo&gt; db.runCommand({usersInfo:\"antonio\", showPrivileges:true})\n{\n  users: [\n    {\n      _id: 'ejemplo.antonio',\n      userId: new UUID(\"722d3e71-2c31-4371-803d-21c4ba8ba622\"),\n      user: 'antonio',\n      db: 'ejemplo',\n      mechanisms: [ 'SCRAM-SHA-1', 'SCRAM-SHA-256' ],\n      roles: [],\n      inheritedRoles: [],\n      inheritedPrivileges: [],\n      inheritedAuthenticationRestrictions: []\n    }\n  ],\n  ok: 1\n}\n</code></pre> <p>Si queremos ver los privilegios que alberga un rol, podemos utilizar el getRole, especificando el par\u00e1metro de los privilegios en verdadero:</p> <pre><code>ejemplo&gt; db.getRole(\"readWrite\", { showPrivileges: true })\n{\n  db: 'ejemplo',\n  role: 'readWrite',\n  roles: [],\n  privileges: [\n    {\n      resource: { db: 'ejemplo', collection: '' },\n      actions: [\n        'changeStream',\n        'collStats',\n        'convertToCapped',\n        'createCollection',\n        'createIndex',\n        'dbHash',\n        'dbStats',\n        'dropCollection',\n        'dropIndex',\n        'emptycapped',\n        'find',\n        'insert',\n        'killCursors',\n        'listCollections',\n        'listIndexes',\n        'planCacheRead',\n        'remove',\n        'renameCollectionSameDB',\n        'update'\n      ]\n    },\n</code></pre>"},{"location":"p5-usuarios/ri/alumno4/#oracle","title":"Oracle","text":""},{"location":"p5-usuarios/ri/alumno4/#ejercicio-1","title":"Ejercicio 1:","text":"<p>Realiza un procedimiento llamado MostrarObjetosAccesibles que reciba un nombre de usuario y muestre todos los objetos a los que tiene acceso.</p> <pre><code>create or replace procedure MostrarObjetosAccesibles (p_usuario varchar2)\nIS\n  Cursor c_objeto is\n  select table_name, privilege, owner from dba_tab_privs where grantee = p_usuario;\n  v_nombretabla varchar2(50);\n  v_nombretabla_old varchar2(50):=' ';\nBEGIN\n  dbms_output.put_line('objetos accesibles:');\n  for v_objeto in c_objeto loop\n    v_nombretabla:=v_objeto.table_name;\n    if v_nombretabla_old != v_nombretabla then\n      dbms_output.put_line('Tabla: ' || v_objeto.table_name);\n      dbms_output.put_line(CHR(9)|| 'Propietario: '|| v_objeto.owner);\n      dbms_output.put_line(CHR(9)|| 'privilegios:');\n    end if;\n    dbms_output.put_line(CHR(9)||CHR(9)|| '- '|| v_objeto.privilege);\n    v_nombretabla_old:=v_nombretabla;\nend loop;\nEND;\n/\n</code></pre> <p>Listado con tabulaciones:</p> <p></p>"},{"location":"p5-usuarios/ri/alumno4/#ejercicio-2","title":"Ejercicio 2:","text":"<p>Realiza un procedimiento que reciba un nombre de usuario, un privilegio y un objeto y nos muestre el mensaje 'SI, DIRECTO' si el usuario tiene ese privilegio sobre objeto concedido directamente, 'SI, POR ROL' si el usuario lo tiene en alguno de los roles que tiene concedidos y un 'NO' si el usuario no tiene dicho privilegio.</p> <pre><code>create or replace procedure mostrarobjetoprivilegio (p_usuario varchar2, p_privilegio varchar2, p_objeto varchar2)\nIS\nv_contador number:=0;\nBEGIN\nCOMPROBARUSUARIO (p_usuario);\nSELECT COUNT(*) INTO v_contador FROM DBA_TAB_PRIVS WHERE GRANTEE = p_usuario AND PRIVILEGE = p_privilegio AND TABLE_NAME = p_objeto;\nif v_contador = 1 then\n    SELECT COUNT(*) INTO v_contador FROM DBA_ROLE_PRIVS WHERE grantee = p_usuario;\n    if v_contador = 1 then\n        dbms_output.put_line('SI, POR ROL');\n    else\n        dbms_output.put_line('SI, DIRECTO');\n    end if;\nelse\n    dbms_output.put_line('NO');\nend if;\nEND;\n/\n\ncreate or replace procedure COMPROBARUSUARIO (p_usuario varchar2)\nIS\nv_existe number:=0;\nBEGIN\nselect count(*) into v_existe from DBA_USERS where USERNAME = p_usuario;\nif v_existe = 0 then\n    raise_application_error(-20112,'No existe el usuario');\nend if;\nEND;\n/\n</code></pre> <p>Ahora podemos contemplar cada tipo de posibilidad:</p> <p></p>"},{"location":"p6-almacenamiento/intro/","title":"Introducci\u00f3n","text":"<p>En esta pr\u00e1ctica se trata el almacenamiento sobre diferentes bases de datos.</p> <p>Reparto de roles:</p> <ul> <li>Capitana: Arantxa Fern\u00e1ndez Morat\u00f3</li> <li>Secretario: Antonio March\u00e1n Posada</li> <li>Portavoz: Jos\u00e9 Juan Herv\u00e1s Carrasco</li> <li>Facilitador: Adri\u00e1n Jaramillo Rodr\u00edguez</li> </ul> <p>Puedes empezar a navegar por la documentaci\u00f3n utilizando el navbar a tu izquierda.</p> <p>Esperamos que esta documentaci\u00f3n sea clara, y de utilidad.</p> <p></p>"},{"location":"p6-almacenamiento/rg/caso-practico-parte-a/","title":"Parte A","text":"<p>Pepe es el administrador de la base de datos. Juan y Clara son los programadores de la base de datos, que trabajan tanto en la aplicaci\u00f3n que usa el departamento de Ventas como en la usada por el departamento de Producci\u00f3n. Ana y Eva tienen permisos para insertar, modificar y borrar registros en las tablas de la aplicaci\u00f3n de Ventas que tienes que crear, y se llaman Productos y Ventas, siendo propiedad de Ana. Jaime y Lidia pueden leer la informaci\u00f3n de esas tablas pero no pueden modificar la informaci\u00f3n. Crea los usuarios y dale los roles y permisos que creas conveniente.</p>"},{"location":"p6-almacenamiento/rg/caso-practico-parte-a/#creacion-de-usuarios","title":"Creaci\u00f3n de usuarios","text":"<p>Vamos a crear los usuarios y a continuaci\u00f3n vamos a darles los permisos de conexi\u00f3n a la base de datos:</p> <pre><code>CREATE USER pepe IDENTIFIED BY pepe;\ngrant create session to pepe;\nCREATE USER juan IDENTIFIED BY juan;\ngrant create session to juan;\nCREATE USER clara IDENTIFIED BY clara;\ngrant create session to clara;\n</code></pre> <p>Ahora le vamos a dar los derechos del sistema a pepe y los recursos de creaci\u00f3n de plsql a juan y clara:</p> <pre><code>grant dba to pepe;\ngrant resource to juan;\ngrant resource to clara;\n</code></pre> <p>grant dba se utiliza para dar otorgar permisos de administrador de base de datos a un usuario, es un permiso extremadamente poderoso que solo pocos usuarios deben tener.</p> <p>grant resource es un rol predefinido de Oracle que consiste en otorgar el uso de recursos de la base de datos, como por ejemplo la creaci\u00f3n de tablas, vistas, ejecuci\u00f3n de procedimientos o creaci\u00f3n de los mismos siempre y cuando tenga derechos sobre esas tablas y no sobre los procedimientos del sistema.</p> <p>A continuaci\u00f3n craemos los usuarios de Ana y Eva:</p> <pre><code>create user Ana identified by Ana;\ngrant create session to Ana;\ncreate user Eva identified by Eva;\ngrant create session to Eva;\n</code></pre> <p>A\u00f1adimos las tablas junto con los siguientes datos:</p> <pre><code>CREATE TABLE Ana.ventas (\nid NUMBER PRIMARY KEY,\nfecha DATE,\nproducto VARCHAR2(50),\ncantidad NUMBER,\nprecio NUMBER\n);\nCREATE TABLE Ana.productos (\nid NUMBER PRIMARY KEY,\nfecha DATE,\nproducto VARCHAR2(50),\ncantidad NUMBER,\nprecio NUMBER\n);\n</code></pre> <pre><code>INSERT INTO Ana.ventas (id, fecha, producto, cantidad, precio)\nVALUES (1, '01-FEB-2023', 'Computadora', 2, 800);\nINSERT INTO Ana.ventas (id, fecha, producto, cantidad, precio)\nVALUES (2, '01-FEB-2023', 'Impresora', 3, 200);\nINSERT INTO Ana.ventas (id, fecha, producto, cantidad, precio)\nVALUES (3, '02-FEB-2023', 'Teclado', 5, 30);\nINSERT INTO Ana.productos (id, fecha, producto, cantidad, precio)\nVALUES (1, '01-FEB-2023', 'Computadora', 2, 800);\nINSERT INTO Ana.productos (id, fecha, producto, cantidad, precio)\nVALUES (2, '01-FEB-2023', 'Impresora', 3, 200);\nINSERT INTO Ana.productos (id, fecha, producto, cantidad, precio)\nVALUES (3, '02-FEB-2023', 'Teclado', 5, 30);\n</code></pre> <p>Creamos los tablespaces de ambas tablas, porque si no tenemos espacios no pueden haber registros en las tablas:</p> <pre><code>CREATE TABLESPACE ventas\nDATAFILE 'ventas.dbf'\nSIZE 50M;\nCREATE TABLESPACE productos\nDATAFILE 'productos.dbf'\nSIZE 50M;\n</code></pre> <p>Ahora vamos a darle los permisos de ventas y productos a Ana:</p> <pre><code>ALTER USER ana DEFAULT TABLESPACE ventas;\nALTER USER ana quota 2M on ventas;\nALTER USER ana quota 2M on productos;\n</code></pre> <p>Ahora crearemos al usuario eva, la cual tendr\u00e1 cuotas en ambas tablas para hacer select, insert, update y delete:</p> <pre><code>CREATE USER Eva identified by eva;\nALTER USER Eva quota 2M on ventas;\nALTER USER Eva quota 2M on productos;\ngrant create session to eva;\n</code></pre> <p>Vamos a crear el rol de ventasyproductos, que tendr\u00e1 permisos de select, insert, update y delete en ambas tablas:</p> <pre><code>CREATE ROLE ventasyproductos;\nGRANT select, insert, update, delete on Ana.Ventas to ventasyproductos;\nGRANT select, insert, update, delete on Ana.Ventas to ventasyproductos;\nGRANT select, insert, update, delete on Ana.productos to ventasyproductos;\nGRANT select, insert, update, delete on Ana.productos to ventasyproductos;\n</code></pre> <pre><code>GRANT ventasyproductos to eva;\nGRANT ventasyproductos to juan;\nGRANT ventasyproductos to clara;\n</code></pre> <p>Ahora vamos a crear los usuarios de Jaime y Lidia, que solo podr\u00e1n hacer select:</p> <pre><code>CREATE USER Jaime identified by Jaime;\nALTER USER Jaime quota 2M on ventas;\nALTER USER Jaime quota 2M on productos;\ngrant create session to Jaime;\nCREATE USER Lidia identified by Lidia;\nALTER USER Lidia quota 2M on ventas;\nALTER USER Lidia quota 2M on productos;\ngrant create session to Lidia;\n</code></pre> <pre><code>CREATE ROLE verventasyproductos;\nGRANT select on Ana.Ventas to ventasyproductos;\nGRANT select on Ana.Ventas to ventasyproductos;\nGRANT select on Ana.productos to ventasyproductos;\nGRANT select on Ana.productos to ventasyproductos;\n</code></pre> <p>Por \u00faltimo vamos a dar los permisos del rol a Jaime y Lidia:</p> <pre><code>GRANT verventasyproductos to Jaime;\nGRANT verventasyproductos to Lidia;\n</code></pre> <p>Y con esto doy pro finalizado el ejercicio.</p>"},{"location":"p6-almacenamiento/rg/caso-practico-parte-b/","title":"Parte B","text":"<p>b) Los espacios de tablas son System, Producci\u00f3n (ficheros prod1.dbf y prod2.dbf) y Ventas (fichero vent.dbf).  Los programadores del departamento de Inform\u00e1tica pueden crear objetos en cualquier tablespace de la base de datos, excepto en System. Los dem\u00e1s usuarios solo podr\u00e1n crear objetos en su tablespace correspondiente teniendo un l\u00edmite de espacio de 30 M los del departamento de Ventas y 100K los del de Producci\u00f3n. Pepe tiene cuota ilimitada en todos los espacios, aunque el suyo por defecto es System.</p> <p>Primero vamos a crear los tablespaces:</p> <pre><code>CREATE TABLESPACE ts_produccion\nDATAFILE 'prod1.dbf' SIZE 100M,\n'prod2.dbf' SIZE 100M;\nCREATE TABLESPACE ts_venta\nDATAFILE 'vent.dbf'\nSIZE 100M;\n</code></pre> <p>Ahora vamos a modificar la quota del usuario ana y eva en 30M por el tablespace ts_venta y a Jaime y Lidia en 100K por el tablespace ts_produccion:</p> <pre><code>ALTER USER ANA QUOTA 30M ON ts_venta;\nALTER USER EVA QUOTA 30M ON ts_venta;\nALTER USER JAIME QUOTA 100K ON ts_produccion;\nALTER USER LIDIA QUOTA 100K ON ts_produccion;\n</code></pre> <p>Concedemos a pepe el tablespace por defecto en system para que pueda crear objetos en cualquier tablespace y le damos cuota ilimitada, y que por defecto sus objetos se creen en system:</p> <pre><code>ALTER USER Pepe DEFAULT TABLESPACE SYSTEM;\nGRANT UNLIMITED TABLESPACE TO Pepe;\n</code></pre> <pre><code>GRANT UNLIMITED TABLESPACE TO JUAN;\nGRANT UNLIMITED TABLESPACE TO CLARA;\nALTER USER JUAN QUOTA 0 ON SYSTEM;\nALTER USER CLARA QUOTA 0 ON SYSTEM;\n</code></pre> <p>Aprendiendo sobre los tablespaces:</p> <p>UNLIMITED TABLESPACE lo que hace es tener derecho de almacenamiento ilimitado sobre cualquier espacio de tablas, lo cual te da derecho tambi\u00e9n a escribir sobre ellas.</p> <p>DEFAULT TABLESPACE con ello al crear un objeto sin especificar a que tablespace pertenece, se crear\u00e1 en el de por defecto, que en el caso del ejercicio es system.</p> <p>TEMPORARY TABLESPACE es muy utilizado en los joins, el cual almacena datos de ese tablespace para luego liberarlos, sin derecho a escribir en ese espacio de tablas.</p>"},{"location":"p6-almacenamiento/rg/caso-practico-parte-c/","title":"Parte C","text":"<p>c) Pepe quiere crear una tabla Prueba que ocupe inicialmente 256K en el tablespace Ventas.</p> <p>El usuario Pepe se conecta con su usuario y crea la tabla Prueba con el el storage inicial a 256K y en el tablespace ts_venta, creada anteriormente.</p> <pre><code>CREATE TABLE Prueba (\ncodigo varchar2(20),\nproducto varchar2(20),\nconstraint pk_codigo PRIMARY KEY(codigo))\nSTORAGE (INITIAL 256K)\nTABLESPACE ts_venta;\n</code></pre> <p>Captura de la creaci\u00f3n:</p> <p></p>"},{"location":"p6-almacenamiento/rg/caso-practico-parte-d/","title":"Parte D","text":"<p>Para permitir que los programadores tengan acceso a la tabla \"Prueba\" y puedan ceder ese derecho y el de conectarse a la base de datos a los usuarios que ellos quieran, se pueden seguir varios pasos:</p> <p>1- Crear un rol de programadores con los privilegios necesarios para acceder a la tabla \"Prueba\" y conectarse a la base de datos. Por ejemplo:</p> <pre><code>SQL&gt; CREATE ROLE programadores;\nSQL&gt; GRANT CONNECT, SELECT, INSERT, UPDATE, DELETE ON Prueba TO programadores;\nRol creado.\n</code></pre> <p>2- Asignar el rol de programadores a los programadores deseados. Por ejemplo:</p> <pre><code>GRANT programadores TO programador1, programador2, programador3;\n</code></pre> <p>3- Permitir que los programadores asignen el rol de programadores y el privilegio de conectarse a la base de datos a otros usuarios. Por ejemplo: GRANT CREATE SESSION, GRANT ANY ROLE TO programadores;</p> <p>Con estos pasos se permite que los programadores tengan acceso a la tabla \"Prueba\" y puedan ceder ese derecho y el de conectarse a la base de datos a los usuarios que ellos quieran. </p> <p>Sin embargo, es importante tener en cuenta que esta configuraci\u00f3n puede representar un riesgo de seguridad si no se administra adecuadamente, ya que los programadores tendr\u00e1n acceso a la tabla \"Prueba\" y podr\u00e1n otorgar acceso a otros usuarios sin supervisi\u00f3n.</p>"},{"location":"p6-almacenamiento/rg/caso-practico-parte-f/","title":"Parte F","text":"<p>Lidia y Jaime dejan la empresa. Borrar los usuarios</p> <pre><code>DROP USER lidia CASCADE;\nDROP USER jaime CASCADE;\n</code></pre> <p>Borrar los tablespaces creados en el punto b (producci\u00f3n y ventas) sin dejar rastro de los tablespaces</p> <pre><code>DROP TABLESPACE ts_produccion INCLUDING CONTENTS AND DATAFILES;\nDROP TABLESPACE ts_venta INCLUDING CONTENTS AND DATAFILES;\n</code></pre>"},{"location":"p6-almacenamiento/rg/ejercicio1/","title":"Ejercicio 1","text":""},{"location":"p6-almacenamiento/rg/ejercicio1/#cread-un-indice-para-la-tabla-emp-de-scott-que-agilice-las-consultas-por-nombre-de-empleado-en-un-tablespace-creado-especificamente-para-indices-donde-deberiais-ubicar-el-fichero-de-datos-asociado-como-se-os-ocurre-que-podriais-probar-si-el-indice-resulta-de-utilidad","title":"Cread un \u00edndice para la tabla EMP de SCOTT que agilice las consultas por nombre de empleado en un tablespace creado espec\u00edficamente para \u00edndices. \u00bfD\u00f3nde deberi\u00e1is ubicar el fichero de datos asociado? \u00bfC\u00f3mo se os ocurre que podri\u00e1is probar si el \u00edndice resulta de utilidad?","text":"<p>Vamos a emplear un procedimiento que genere nombres en el usuario scott y que nos permita crear 100000 empleados, tras esto haremos que la fila ename sea char (1000)</p> <p>CREATE OR REPLACE PROCEDURE add_100000_emp AS v_nombre emp.ename%TYPE; BEGIN     FOR i IN 10001..100000 LOOP         v_nombre := 'e' || i;         INSERT INTO scott.emp VALUES (i, v_nombre, 'ANTONIO', 7902, TO_DATE('01/01/1980', 'DD/MM/YYYY'), 1000, 1000 , 20);     END LOOP; END; /</p> <p>explain plan for select ename from emp where ename = 'e92153';</p> <p>select id,operation,cpu_cost,cost,time,object_name from PLAN_TABLE;</p> <p></p> <p>Una vez hecho esto vamos a montar un disco r\u00e1pido en el sistema donde albergar\u00e1 el tablespace del \u00edndice para que funcione lo m\u00e1s r\u00e1pido posible y la b\u00fasqueda del nombre sea mucho m\u00e1s eficiente.</p> <p></p> <p>Vamos a montar una unidad en systemd en el cual haremos persistente el montaje del nuevo disco.</p> <p>nano /etc/systemd/system/opt-oracle-oradata-ORCLCDB-vdb.mount</p> <pre><code>[Unit]\nDescription=Disco Oracle     [Mount]\nWhat=/dev/vdb\nWhere=/opt/oracle/oradata/ORCLCDB/vdb\nType=ext4\nOptions=defaults\n\n[Install]\nWantedBy=multi-user.target\n</code></pre> <p>systemctl daemon-reload systemctl enable opt-oracle-oradata-ORCLCDB-vdb.mount systemctl start opt-oracle-oradata-ORCLCDB-vdb.mount</p> <p></p> <p>Ahora entramos como administrador a sqlplus y creamos el tablespace en el disco que hemos montado.</p> <p>Vamos a crear un tablespace para los \u00edndices y vamos a crear un \u00edndice para el nombre de los empleados, de esta manera almacenaremos en un tablespace aparte los \u00edndices y ser\u00e1 mucho m\u00e1s r\u00e1pido la b\u00fasqueda de los nombres de los empleados.</p> <pre><code>create tablespace indices\ndatafile 'ename.dbf'\nsize 10M\nautoextend on;\n</code></pre> <pre><code>CREATE TABLESPACE TS_INDICE\nDATAFILE 'ts_indice.dbf'\nSIZE 150M;\nCREATE INDEX index_emp_ename ON emp(ename)\nTABLESPACE TS_INDICE;\n</code></pre> <p></p>"},{"location":"p6-almacenamiento/rg/ejercicio2/","title":"Ejercicio 2","text":"<p>Realizad una consulta al diccionario de datos que muestre qu\u00e9 \u00edndices existen para objetos pertenecientes al esquema de SCOTT y sobre qu\u00e9 columnas est\u00e1n definidos. Averiguad en qu\u00e9 fichero o ficheros de datos se encuentran las extensiones de sus segmentos correspondientes.</p> <p>Para mostrar los \u00edndices existentes para objetos pertenecientes al esquema de SCOTT y sobre qu\u00e9 columnas est\u00e1n definidos, se puede utilizar la siguiente consulta SQL:</p> <pre><code>SQL&gt; SELECT i.index_name, i.table_name, i.uniqueness, c.column_name\nFROM dba_indexes i\nJOIN dba_ind_columns c ON i.index_name = c.index_name\nWHERE i.owner = 'SCOTT'; INDEX_NAME\n--------------------------------------------------------------------------------\nTABLE_NAME\n--------------------------------------------------------------------------------\nUNIQUENES\n---------\nCOLUMN_NAME\n--------------------------------------------------------------------------------\nPK_DEPTNO\nDEPT\nUNIQUE\nDEPTNO\nINDEX_NAME\n--------------------------------------------------------------------------------\nTABLE_NAME\n--------------------------------------------------------------------------------\nUNIQUENES\n---------\nCOLUMN_NAME\n--------------------------------------------------------------------------------\nPK_EMPNO\nEMP\nUNIQUE\nEMPNO\n</code></pre> <p>La consulta anterior utiliza las vistas del diccionario de datos DBA_INDEXES y DBA_IND_COLUMNS para obtener informaci\u00f3n sobre los \u00edndices y columnas de los objetos pertenecientes al esquema de SCOTT. </p> <p>La columna \"index_name\" contiene el nombre del \u00edndice, \"table_name\" contiene el nombre de la tabla a la que pertenece el \u00edndice, \"uniqueness\" indica si el \u00edndice es \u00fanico o no, y \"column_name\" contiene el nombre de la columna sobre la que est\u00e1 definido el \u00edndice.</p> <p>Para averiguar en qu\u00e9 fichero o ficheros de datos se encuentran las extensiones de los segmentos correspondientes a los \u00edndices, se puede utilizar la siguiente consulta SQL:</p> <pre><code>SQL&gt; SELECT i.index_name, s.tablespace_name\nFROM dba_segments s\nJOIN dba_indexes i ON s.segment_name = i.index_name\nWHERE i.owner = 'SCOTT';\nINDEX_NAME\n--------------------------------------------------------------------------------\nTABLESPACE_NAME\n------------------------------\nPK_EMPNO\nUSERS\nPK_DEPTNO\nUSERS\n</code></pre> <p>\u00bfC\u00f3mo averiguo en que fichero o ficheros de datos se encuentran las extensiones de los segmentos correspondientes a los \u00edndices?</p> <p>La consulta anterior utiliza las vistas del diccionario de datos DBA_SEGMENTS y DBA_INDEXES para obtener informaci\u00f3n sobre los segmentos y \u00edndices pertenecientes al esquema de SCOTT. </p> <p>La columna \"index_name\" contiene el nombre del \u00edndice, y \"file_name\" contiene el nombre del fichero de datos en el que se encuentra el segmento correspondiente al \u00edndice.</p>"},{"location":"p6-almacenamiento/rg/ejercicio3/","title":"Ejercicio 3","text":"<p>Crear una secuencia para rellenar el campo deptno de la tabla dept de forma coherente con los datos ya existentes</p> <pre><code>CREATE SEQUENCE deptno_seq\nINCREMENT BY 10\nSTART WITH 50;\n</code></pre> <p>Insertar al menos dos registros haciendo uso de la secuencia</p> <pre><code>INSERT INTO SCOTT.DEPT VALUES (deptno_seq.NEXTVAL,'MARKETING','DOS HERMANAS');\n1 row created.\nINSERT INTO SCOTT.DEPT VALUES (deptno_seq.NEXTVAL,'FINANCE','UTRERA');\n1 row created.\n</code></pre> <p>Comprobar que los valores en <code>deptno</code> son correctos</p> <pre><code>select * from scott.dept;\nDEPTNO DNAME          LOC\n---------- -------------- -------------\n10 ACCOUNTING     NEW YORK\n20 RESEARCH       DALLAS\n30 SALES          CHICAGO\n40 OPERATIONS     BOSTON\n50 MARKETING      DOS HERMANAS\n60 FINANCE        UTRERA\n</code></pre>"},{"location":"p6-almacenamiento/rg/ejercicio4/","title":"Ejercicio 4","text":"<p>Queremos limpiar nuestro fichero tnsnames.ora. Averiguad cuales de sus entradas se est\u00e1n usando en alg\u00fan enlace de la base de datos.</p> <p>Para limpiar un archivo tnsnames.ora, puede seguir los siguientes pasos:</p> <p>1- Primero realizarenmos una copia de seguridad del archivo tnsnames.ora original antes de realizar cualquier cambio.</p> <p>2- Seguidamente analizamos cada entrada en el archivo y verifique si est\u00e1 siendo utilizada actualmente. Para hacer esto ejecutamos el siguiente comando:</p> <pre><code>oracle@oracle:~$ lsnrctl status\n\nLSNRCTL for Linux: Version 19.0.0.0.0 - Production on 26-JAN-2023 01:24:42\n\nCopyright (c) 1991, 2019, Oracle.  All rights reserved.\n\nConnecting to (DESCRIPTION=(ADDRESS=(PROTOCOL=TCP)(HOST=0.0.0.0)(PORT=1521)))\nSTATUS of the LISTENER\n------------------------\nAlias                     LISTENER\nVersion                   TNSLSNR for Linux: Version 19.0.0.0.0 - Production\nStart Date                17-JAN-2023 20:40:57\nUptime                    8 days 4 hr. 43 min. 44 sec\nTrace Level               off\nSecurity                  ON: Local OS Authentication\nSNMP                      OFF\nListener Parameter File   /opt/oracle/product/19c/dbhome_1/network/admin/listener.ora\nListener Log File         /opt/oracle/diag/tnslsnr/oracle/listener/alert/log.xml\nListening Endpoints Summary...\n  (DESCRIPTION=(ADDRESS=(PROTOCOL=tcp)(HOST=0.0.0.0)(PORT=1521)))\n(DESCRIPTION=(ADDRESS=(PROTOCOL=ipc)(KEY=EXTPROC1521)))\n(DESCRIPTION=(ADDRESS=(PROTOCOL=tcps)(HOST=oracle)(PORT=5500))(Security=(my_wallet_directory=/opt/oracle/admin/ORCLCDB/xdb_wallet))(Presentation=HTTP)(Session=RAW))\nServices Summary...\nService \"ORCLCDB\" has 1 instance(s).\n  Instance \"ORCLCDB\", status READY, has 1 handler(s) for this service...\nService \"ORCLCDBXDB\" has 1 instance(s).\n  Instance \"ORCLCDB\", status READY, has 1 handler(s) for this service...\nService \"PSQLU\" has 1 instance(s).\n  Instance \"PSQLU\", status UNKNOWN, has 1 handler(s) for this service...\nService \"ec44a9570a350f2ae0530101007f64cf\" has 1 instance(s).\n  Instance \"ORCLCDB\", status READY, has 1 handler(s) for this service...\nService \"orclpdb1\" has 1 instance(s).\n  Instance \"ORCLCDB\", status READY, has 1 handler(s) for this service...\nThe command completed successfully\n</code></pre> <p>3- Abrimos  el archivo tnsnames.ora en un editor de texto.</p> <pre><code>oracle@oracle:/opt/oracle/product/19c/dbhome_1$ nano network/admin/tnsnames.ora # tnsnames.ora Network Configuration File: /opt/oracle/product/19c/dbhome_1/network/admin/tnsnames.ora\n# Generated by Oracle configuration tools.\nORCLCDB =\n(DESCRIPTION =\n(ADDRESS = (PROTOCOL = TCP)(HOST = oracle)(PORT = 1521))\n(CONNECT_DATA =\n(SERVER = DEDICATED)\n(SERVICE_NAME = ORCLCDB)\n)\n)\nLISTENER_ORCLCDB =\n(ADDRESS = (PROTOCOL = TCP)(HOST = oracle)(PORT = 1521))\nPSQLU  =\n(DESCRIPTION=\n(ADDRESS=(PROTOCOL=tcp)(HOST=localhost)(PORT=1521))\n(CONNECT_DATA=(SID=PSQLU))\n(HS=OK)\n)\n</code></pre> <p>4- Eliminamos las entradas que no est\u00e9n siendo utilizadas, en nuestro caso eliminar\u00edamos las entradas de LISTERNER_ORCLCDB y PSQLU:</p> <pre><code>oracle@oracle:/opt/oracle/product/19c/dbhome_1$ nano network/admin/tnsnames.ora # tnsnames.ora Network Configuration File: /opt/oracle/product/19c/dbhome_1/network/admin/tnsnames.ora\n# Generated by Oracle configuration tools.\nORCLCDB =\n(DESCRIPTION =\n(ADDRESS = (PROTOCOL = TCP)(HOST = oracle)(PORT = 1521))\n(CONNECT_DATA =\n(SERVER = DEDICATED)\n(SERVICE_NAME = ORCLCDB)\n)\n)\n</code></pre> <p>5- Verificamos que no haya errores despu\u00e9s de limpiar el archivo tnsnames.ora ejecutando una prueba de conexi\u00f3n a la base de datos:</p> <pre><code>oracle2@oracle2:~$ tnsping ORCLCDB\n\nTNS Ping Utility for Linux: Version 19.0.0.0.0 - Production on 01-FEB-2023 01:48:22\n\nCopyright (c) 1991, 2019, Oracle.  All rights reserved.\n\nUsed parameter files:\n/opt/oracle/product/19c/dbhome_1/network/admin/sqlnet.ora\n\nUsed TNSNAMES adapter to resolve the alias\nAttempting to contact (DESCRIPTION = (ADDRESS = (PROTOCOL = TCP)(HOST = oracle)(PORT = 1521)) (CONNECT_DATA = (SERVER = DEDICATED) (SERVICE_NAME = ORCLCDB)))\nOK (120 msec)\n</code></pre> <p>Hay que tener en cuenta que el archivo tnsnames.ora es un archivo de configuraci\u00f3n cr\u00edtico para la conexi\u00f3n a la base de datos Oracle, por lo que es importante ser cuidadoso al realizar cambios en \u00e9l.</p>"},{"location":"p6-almacenamiento/rg/ejercicio5/","title":"Ejercicio 5","text":""},{"location":"p6-almacenamiento/rg/ejercicio5/#meted-las-tablas-emp-y-dept-de-scott-en-un-cluster","title":"Meted las tablas EMP y DEPT de SCOTT en un cluster","text":"<p>Primero creo un tablespace que nos permitir\u00e1 controlar el espacio de almacenamiento que se asigna a las tablas agrupadas en el cluster.</p> <pre><code>CREATE TABLESPACE ts_empdept\nDATAFILE '/opt/oracle/oradata/ORCLCDB/ts_empdept.dbf' SIZE 64M\nAUTOEXTEND ON NEXT 64M MAXSIZE 512M;\n</code></pre> <p>Cl\u00e1usulas del Tablespace:</p> <p>En la cl\u00e1usula DATAFILE especificamos la ubicaci\u00f3n del archivo de datos, ya que esto permite controlar la ubicaci\u00f3n f\u00edsica de los datos y, por tanto, mejorar el rendimiento y la disponibilidad de las aplicaciones. Si no se especifica la ubicaci\u00f3n del archivo de datos, Oracle utilizar\u00e1 la ubicaci\u00f3n predeterminada. La cl\u00e1usula SIZE especifica el tama\u00f1o inicial del archivo de datos en 64 MB. La cl\u00e1usula 'AUTOEXTEND ON NEXT 64M MAXSIZE 512M' indica que el archivo de datos se ampliar\u00e1 autom\u00e1ticamente en bloques de 64 MB cuando sea necesario, hasta un m\u00e1ximo de 512 MB.</p> <p>Ahora creamos el cluster para las tablas emp y dept. Como la columna que tienen en com\u00fan es DEPTNO, a\u00f1adimos esta al cluster, as\u00ed se alamacenar\u00e1n los datos de ambas tablas en la misma p\u00e1gina y cada valor clave del cluster solo se almacenar\u00e1 una vez.</p> <pre><code>CREATE CLUSTER cluster_empdept (deptno number(2))\nTABLESPACE ts_empdept;\n</code></pre> <p>Creamos un \u00edndice para el cluster. Esto es obligatorio ya que si no se hiciera no se podr\u00eda ejecutar ninguna sentencia DML de las tablas del cluster. El \u00edndice se utiliza para localizar una fila en el cluster. Apunta a la p\u00e1gina asociada con cada valor de clave del cluster.</p> <pre><code>CREATE INDEX indice_cluster_empdept ON CLUSTER cluster_empdept;\n</code></pre> <p>A continuaci\u00f3n habr\u00eda que crear las tablas asociadas al cluster, pero en nustro caso ya tenemos creadas las tablas emp y dept con datos a\u00f1adidos, por lo que vamos a realizar los siguientes pasos:</p> <ul> <li>Crear una nueva tabla en el cluster con la misma estructura que la tabla DEPT:</li> </ul> <pre><code>CREATE TABLE dept_cluster (\ndeptno NUMBER (2),\ndname VARCHAR2 (14),\nloc VARCHAR2 (13),\nconstraint pk_deptno PRIMARY KEY(deptno)\n)\nCLUSTER cluster_empdept (deptno);\n</code></pre> <ul> <li>Copiar los datos de la tabla DEPT a la tabla DEPT_CLUSTER:</li> </ul> <pre><code>INSERT INTO dept_cluster SELECT * FROM dept;\n</code></pre> <ul> <li>Hacer lo mismo con la tabla EMP.</li> </ul> <pre><code>CREATE TABLE cluster_emp (\nempno NUMBER (4),\nename VARCHAR2 (10),\njob VARCHAR2 (9),\nmgr NUMBER (4),\nhiredate DATE,\nsal NUMBER (7,2),\ncomm NUMBER (7,2),\ndeptno NUMBER (2),\nconstraint pk_cluster_emp PRIMARY KEY (empno),\nconstraint fk_cluster_deptno FOREIGN KEY (deptno) REFERENCES dept_cluster (deptno)\n)\nCLUSTER cluster_empdept (deptno);\nINSERT INTO cluster_emp SELECT * FROM emp;\n</code></pre> <ul> <li>Borrar la tabla EMP y DEPT originales:</li> </ul> <pre><code>DROP TABLE emp;\nDROP TABLE dept;\n</code></pre> <ul> <li>Renombrar la tabla CLUSTER_EMP y DEPT_CLUSTER a EMP y DEPT:</li> </ul> <pre><code>ALTER TABLE dept_cluster RENAME TO dept;\nALTER TABLE cluster_emp RENAME TO emp;\n</code></pre>"},{"location":"p6-almacenamiento/rg/ejercicio5/#comprobaciones-generales","title":"Comprobaciones generales","text":"<p>Comprobamos que el cluster se ha creado:</p> <pre><code>SELECT cluster_name FROM DBA_CLUSTERS;\n</code></pre> <p></p> <p>Comprobamos que las tablas pertenecen al cluster creado:</p> <pre><code>SELECT table_name, cluster_name FROM USER_TABLES where table_name='DEPT' or table_name='EMP';\n</code></pre> <p></p> <p>Comprobamos que podemos consultar las tablas del cluster.</p> <pre><code>select empno,ename,emp.deptno,dname from emp,dept where emp.deptno=dept.deptno;\n</code></pre> <p></p>"},{"location":"p6-almacenamiento/rg/ejercicio6/","title":"Ejercicio 6","text":""},{"location":"p6-almacenamiento/rg/ejercicio6/#enunciado","title":"Enunciado","text":"<p>Realizar un procedimiento llamado <code>BalanceoCargaTemp</code> que balancee la carga de usuarios entre los tablespaces temporales existentes. Para ello se averiguar\u00e1 cu\u00e1ntos existen y asignar\u00e1 los usuarios entre ellos de forma equilibrada. Si es necesario para comprobar su funcionamiento, crea tablespaces temporales nuevos.</p>"},{"location":"p6-almacenamiento/rg/ejercicio6/#codigo","title":"C\u00f3digo","text":"<pre><code>CREATE OR REPLACE PROCEDURE BalanceoCargaTemp IS\nCURSOR c_usuarios IS\nSELECT username\nFROM DBA_USERS\nWHERE account_status = 'OPEN'\nAND username NOT IN ('SYS','SYSTEM');\nv_counter             NUMBER := -1;\nv_total_tablespaces   NUMBER;\nv_tablespace_asignado dba_tablespaces.tablespace_name%type;\nBEGIN\nSELECT COUNT(*) INTO v_total_tablespaces\nFROM DBA_TABLESPACES\nWHERE contents = 'TEMPORARY';\nFOR i IN c_usuarios LOOP\nIF v_counter = v_total_tablespaces - 1 THEN\nv_counter := -1;\nEND IF;\nv_counter := v_counter + 1;\nSELECT tablespace_name INTO v_tablespace_asignado\nFROM DBA_TABLESPACES\nWHERE contents = 'TEMPORARY'\nOFFSET v_counter ROWS\nFETCH NEXT 1 ROWS ONLY;\nEXECUTE IMMEDIATE 'ALTER USER ' || i.username || ' TEMPORARY TABLESPACE ' || v_tablespace_asignado;\nEND LOOP;\nEND;\n/\n</code></pre> <p>Info</p> <p>La combinaci\u00f3n de contadores y OFFSET la utilizo para poder hacer un bucle infinito secuencial sobre los tablespaces temporales, cuando una combinaci\u00f3n de FOR y WHILE no tiene sentido. Tampoco pod\u00eda recorrer un cursor infinitamente ya que siempre acaba en alg\u00fan momento y no vuelve al inicio</p>"},{"location":"p6-almacenamiento/rg/ejercicio6/#comprobaciones","title":"Comprobaciones","text":"<p>Lo ejecuto una primera vez sin crear tablespaces temporales extras:</p> <pre><code>EXEC BalanceoCargaTemp;\nPL/SQL procedure successfully completed.\n</code></pre> <p>Muestro el resultado:</p> <pre><code>SELECT username, temporary_tablespace\nFROM DBA_USERS\nWHERE account_status = 'OPEN' AND username NOT IN ('SYS','SYSTEM');\nUSERNAME                                                                                                                         TEMPORARY_TABLESPACE\n-------------------------------------------------------------------------------------------------------------------------------- ------------------------------\nBECARIO                                                                                                                          TEMP\nEXAMENBD34                                                                                                                       TEMP\nTESTING                                                                                                                          TEMP\nSCOTT                                                                                                                            TEMP\nHIPODROMO                                                                                                                        TEMP\nUSRPRACTICA1                                                                                                                     TEMP\n</code></pre> <p>Como vemos no ha podido balancear (obviamente) porque por defecto s\u00f3lo tenemos 1 tablespace temporal.</p> <p>Para probar el balanceo, a\u00f1ado un segundo tablespace:</p> <pre><code>CREATE TEMPORARY TABLESPACE TEMP2 TEMPFILE 'temporary2.dbf' SIZE 5M;\nTablespace created.\n</code></pre> <p>Vuelvo a ejecutar el procedimiento y muestro el resultado:</p> <pre><code>EXEC BalanceoCargaTemp;\nPL/SQL procedure successfully completed.\nSELECT username, temporary_tablespace\nFROM DBA_USERS\nWHERE account_status = 'OPEN' AND username NOT IN ('SYS','SYSTEM');\nUSERNAME                                                                                                                         TEMPORARY_TABLESPACE\n-------------------------------------------------------------------------------------------------------------------------------- ------------------------------\nBECARIO                                                                                                                          TEMP\nTESTING                                                                                                                          TEMP\nHIPODROMO                                                                                                                        TEMP\nEXAMENBD34                                                                                                                       TEMP2\nSCOTT                                                                                                                            TEMP2\nUSRPRACTICA1                                                                                                                     TEMP2\n</code></pre> <p>Como vemos ya s\u00ed ha hecho un balanceo de los tablespaces.</p> <p>Podr\u00eda incluso a\u00f1adir un tercer tablespace y comprobar que se sigue balanceando:</p> <pre><code>CREATE TEMPORARY TABLESPACE TEMP3 TEMPFILE 'temporary3.dbf' SIZE 5M;\nTablespace created.\n</code></pre> <pre><code>EXEC BalanceoCargaTemp;\nPL/SQL procedure successfully completed.\nSELECT username, temporary_tablespace\nFROM DBA_USERS\nWHERE account_status = 'OPEN' AND username NOT IN ('SYS','SYSTEM');\nUSERNAME                                                                                                                         TEMPORARY_TABLESPACE\n-------------------------------------------------------------------------------------------------------------------------------- ------------------------------\nBECARIO                                                                                                                          TEMP\nEXAMENBD34                                                                                                                       TEMP\nTESTING                                                                                                                          TEMP2\nSCOTT                                                                                                                            TEMP2\nHIPODROMO                                                                                                                        TEMP3\nUSRPRACTICA1                                                                                                                     TEMP3\n</code></pre> <p>Se ha vuelto a balancear equitativamente pero si a\u00fan as\u00ed queremos estar 100% seguros de que el procedimiento balancea a la perfecci\u00f3n, podemos a\u00f1adir la siguiente l\u00ednea al final del bucle <code>FOR</code> del procedimiento:</p> <pre><code>DBMS_OUTPUT.PUT_LINE('ALTER USER ' || i.username || ' TEMPORARY TABLESPACE ' || v_tablespace_asignado || ';');\n</code></pre> <p>De esta manera, cuando ejecutemos el procedimiento veremos las \u00f3rdenes que est\u00e1 ejecutando:</p> <pre><code>EXEC BalanceoCargaTemp;\nALTER USER BECARIO TEMPORARY TABLESPACE TEMP;\nALTER USER EXAMENBD34 TEMPORARY TABLESPACE TEMP2;\nALTER USER TESTING TEMPORARY TABLESPACE TEMP3;\nALTER USER SCOTT TEMPORARY TABLESPACE TEMP;\nALTER USER HIPODROMO TEMPORARY TABLESPACE TEMP2;\nALTER USER USRPRACTICA1 TEMPORARY TABLESPACE TEMP3;\nPL/SQL procedure successfully completed.\n</code></pre> <p>Este mismo procedimiento seguir\u00eda funcionando independientemente de cu\u00e1ntos usuarios y tablespaces temporales nuevos se creasen y borrasen.</p>"},{"location":"p6-almacenamiento/rg/ejercicio7/","title":"Ejercicio 7","text":""},{"location":"p6-almacenamiento/rg/ejercicio7/#explicad-en-que-consiste-el-sharding-en-mongodb-intentad-montarlo","title":"Explicad en qu\u00e9 consiste el sharding en MongoDB. Intentad montarlo","text":""},{"location":"p6-almacenamiento/rg/ejercicio7/#definicion-y-ventajas-del-sharding","title":"Definici\u00f3n y ventajas del Sharding","text":"<p>El sharding en MongoDB es un m\u00e9todo para distribuir la carga de datos y la capacidad de procesamiento en m\u00faltiples nodos. El sharding es \u00fatil cuando una sola instancia de MongoDB no puede manejar altas cargas de trabajo, ya que con este m\u00e9todo se puede escalar horizontalmente.</p> <p>Dicho de otra forma, el Sharding ofrece que la capacidad de procesamiento y almacenamiento de una aplicaci\u00f3n funcione manteniendo un alto nivel de rendimiento y disponibilidad. Esto lo hace distribuyendo la carga de datos y la capacidad de procesamiento a trav\u00e9s de m\u00faltiples m\u00e1quinas.</p> <p>En MongoDB, el Sharding se basa en el concepto de fragmentaci\u00f3n de los datos en \"particiones\" o fragmentos m\u00e1s peque\u00f1os, conocidos como chunks. Un fragmento o chunk es un conjunto de r\u00e9plicas que contiene un subconjunto de los datos del cl\u00faster.</p> <p>Cada chunk es almacenado y gestionado por un servidor distinto en la infraestructura de Sharding. La fragmentaci\u00f3n se basa en una clave de fragmento, que se utiliza para determinar en qu\u00e9 servidor se almacenar\u00e1 cada chunk, de acuerdo con los rangos de fragmentos y la cantidad de fragmentos.</p> <p>La clave de fragmento tiene un impacto directo en el rendimiento del cl\u00faster y debe elegirse con cuidado. Una clave de fragmento sub\u00f3ptima puede provocar problemas de rendimiento o de escalado debido a una distribuci\u00f3n desigual de los fragmentos.</p> <p>Existen dos estrategias de fragmentaci\u00f3n para distribuir datos entre cl\u00fasteres fragmentados:</p> <ul> <li>Fragmentaci\u00f3n por rangos (Ranged Sharding): divide los datos en rangos en funci\u00f3n de los valores de la clave de fragmentaci\u00f3n. Luego, a cada fragmento se le asigna un rango basado en los valores de la clave de fragmento. Es m\u00e1s probable que un rango de claves de fragmentos cuyos valores sean \"cercanos\" residan en el mismo fragmento. Esto permite operaciones dirigidas, ya que mongos puede enrutar las operaciones solo a los fragmentos que contienen los datos requeridos.</li> <li>Fragmentaci\u00f3n hash (Hashed Sharding): implica calcular un hash del valor del campo de la clave de fragmento. Luego, a cada fragmento se le asigna un rango basado en los valores de clave de fragmento con hash. Si bien un rango de claves de fragmento puede estar \"cercano\", es poco probable que sus valores hash est\u00e9n en el mismo fragmento. La distribuci\u00f3n de datos basada en valores hash facilita una distribuci\u00f3n de datos m\u00e1s uniforme, especialmente en conjuntos de datos donde la clave de fragmento cambia de forma mon\u00f3tona. Sin embargo, la fragmentaci\u00f3n hash no proporciona operaciones eficientes basadas en rangos.</li> </ul> <p>Ventajas del Sharding:</p> <ul> <li>Mayor rendimiento de lectura/escritura.</li> <li>Mayor capacidad de almacenamiento.</li> <li>Alta disponibilidad mediante la distribuci\u00f3n geogr\u00e1fica de los datos.</li> </ul>"},{"location":"p6-almacenamiento/rg/ejercicio7/#como-implementar-el-sharding-en-mongodb","title":"C\u00f3mo implementar el Sharding en MongoDB","text":"<p>Para implementar una configuraci\u00f3n de sharding en MongoDB, debemos tener tres componentes clave:</p> <ul> <li> <p>Un servior mongos: estos act\u00faan como intermediarios entre las aplicaciones cliente y los servidores de datos. Los servidores mongos gestionan la distribuci\u00f3n de los chunks de datos entre los servidores de datos y redirigen las consultas a los servidores apropiados.</p> </li> <li> <p>Servidores de datos fragmentados (shards): estos son servidores que almacenan los chunks de datos y ejecutan las operaciones CRUD.</p> </li> <li> <p>Al menos un servidor de configuraci\u00f3n de fragmentaci\u00f3n: que mantiene informaci\u00f3n sobre la configuraci\u00f3n de sharding, incluyendo la asignaci\u00f3n de chunks a servidores de datos.</p> </li> </ul> <p>Una vez realizada la configuraci\u00f3n de los nodos, se debe fragmentar una base de datos o colecci\u00f3n espec\u00edfica. Esto se hace asignando una clave de sharding a la colecci\u00f3n, que se utiliza para fragmentar los datos en chunks. Para especificar la clave de sharding se utiliza la siguiente sintaxis en la l\u00ednea de comandos:</p> <pre><code>sh.enableSharding(\"database_name\")\ndb.collection_name.ensureIndex( { shard_key: 1 } )\nsh.shardCollection(\"database_name.collection_name\", { shard_key: 1 } )\n</code></pre> <p>Shard_key es la clave de sharding que se utilizar\u00e1 para fragmentar los datos.</p> <p>Una vez shardeada la colecci\u00f3n, los chunks de datos se distribuir\u00e1n autom\u00e1ticamente entre los servidores de datos y las consultas se redirigir\u00e1n a los servidores apropiados utilizando los servidores mongos.</p> <p>Veremos m\u00e1s detenidamente cu\u00e1les son los pasos a seguir en el siguiente ejemplo de implementaci\u00f3n.</p>"},{"location":"p6-almacenamiento/rg/ejercicio7/#ejemplo-de-implementacion","title":"Ejemplo de implementaci\u00f3n","text":"<p>En nuestro caso vamos a crear un cluster shardeado (fragmentado) usando Docker-Compose, por lo que el primer paso ser\u00e1 instalar el paquete.</p> <pre><code>sudo apt install docker-compose\n</code></pre> <p>Comenzamos el servicio docker:</p> <pre><code>sudo systemctl start docker\n</code></pre> <p>Vamos a descargar los ficheros del siguiente repositorio: MongoDB Sharding with Docker</p> <p>Entramos en el repositorio descargado. Si queremos modificar las instancias que se crear\u00e1n, nombres o eliminar/a\u00f1adir alg\u00fan servidor shard o de configuraci\u00f3n, podemos ver el fichero docker-compose.yml del repositorio. Para nuestro caso no voy a modificar nada, ya que esto es un ejemplo de creaci\u00f3n de configuraci\u00f3n de sharding. As\u00ed pues, iniciamos docker-compose.</p> <pre><code>cd Descargas/mongodb-sharding-docker-master\n\nsudo docker-compose up -d\n</code></pre> <p> </p> <p>Entramos en el servidor de configuraci\u00f3n mongocfg1 e iniciamos el Replica Set (conjunto de r\u00e9plicas) mediante <code>rs.initiate()</code>. Este comando iniciar\u00e1 la replicaci\u00f3n con la configuraci\u00f3n predeterminada inferida por el servidor MongoDB, as\u00ed que si quiero configurar un conjunto de r\u00e9plicas que consta de varios servidores independientes, tengo que poner algunos datos: como el nombre del Replica Set, el valor configsvr en true y la informaci\u00f3n de los hosts creados.</p> <pre><code>docker exec -it mongocfg1 /bin/bash\n\nmongosh\n\nrs.initiate({_id: \"cfg\", configsvr: true, members: [{_id: 0, host: \"mongocfg1\"},{_id: 1, host: \"mongocfg2\"}, {_id: 2, host : \"mongocfg3\"}]})\n</code></pre> <p>Comprobamos el resultado con <code>rs.status()</code>. Deber\u00eda salirnos algo parecido a lo siguiente:</p> <pre><code>cfg [direct: primary] test&gt; rs.status()\n{\nset: 'cfg',\n  date: ISODate(\"2023-02-14T12:58:11.779Z\"),\n  myState: 1,\n  term: Long(\"1\"),\n  syncSourceHost: '',\n  syncSourceId: -1,\n  configsvr: true,\n  heartbeatIntervalMillis: Long(\"2000\"),\n  majorityVoteCount: 2,\n  writeMajorityCount: 2,\n  votingMembersCount: 3,\n  writableVotingMembersCount: 3,\n  optimes: {\nlastCommittedOpTime: { ts: Timestamp({ t: 1676379491, i: 1 }), t: Long(\"1\") },\n    lastCommittedWallTime: ISODate(\"2023-02-14T12:58:11.204Z\"),\n    readConcernMajorityOpTime: { ts: Timestamp({ t: 1676379491, i: 1 }), t: Long(\"1\") },\n    appliedOpTime: { ts: Timestamp({ t: 1676379491, i: 1 }), t: Long(\"1\") },\n    durableOpTime: { ts: Timestamp({ t: 1676379491, i: 1 }), t: Long(\"1\") },\n    lastAppliedWallTime: ISODate(\"2023-02-14T12:58:11.204Z\"),\n    lastDurableWallTime: ISODate(\"2023-02-14T12:58:11.204Z\")\n},\n  lastStableRecoveryTimestamp: Timestamp({ t: 1676379464, i: 1 }),\n  electionCandidateMetrics: {\nlastElectionReason: 'electionTimeout',\n    lastElectionDate: ISODate(\"2023-02-14T12:57:54.926Z\"),\n    electionTerm: Long(\"1\"),\n    lastCommittedOpTimeAtElection: { ts: Timestamp({ t: 1676379464, i: 1 }), t: Long(\"-1\") },\n    lastSeenOpTimeAtElection: { ts: Timestamp({ t: 1676379464, i: 1 }), t: Long(\"-1\") },\n    numVotesNeeded: 2,\n    priorityAtElection: 1,\n    electionTimeoutMillis: Long(\"10000\"),\n    numCatchUpOps: Long(\"0\"),\n    newTermStartDate: ISODate(\"2023-02-14T12:57:55.024Z\"),\n    wMajorityWriteAvailabilityDate: ISODate(\"2023-02-14T12:57:56.248Z\")\n},\n  members: [\n{\n_id: 0,\n      name: 'mongocfg1:27017',\n      health: 1,\n      state: 1,\n      stateStr: 'PRIMARY',\n      uptime: 566,\n      optime: { ts: Timestamp({ t: 1676379491, i: 1 }), t: Long(\"1\") },\n      optimeDate: ISODate(\"2023-02-14T12:58:11.000Z\"),\n      lastAppliedWallTime: ISODate(\"2023-02-14T12:58:11.204Z\"),\n      lastDurableWallTime: ISODate(\"2023-02-14T12:58:11.204Z\"),\n      syncSourceHost: '',\n      syncSourceId: -1,\n      infoMessage: '',\n      electionTime: Timestamp({ t: 1676379474, i: 1 }),\n      electionDate: ISODate(\"2023-02-14T12:57:54.000Z\"),\n      configVersion: 1,\n      configTerm: 1,\n      self: true,\n      lastHeartbeatMessage: ''\n},\n    {\n_id: 1,\n      name: 'mongocfg2:27017',\n      health: 1,\n      state: 2,\n      stateStr: 'SECONDARY',\n      uptime: 27,\n      optime: { ts: Timestamp({ t: 1676379490, i: 1 }), t: Long(\"1\") },\n      optimeDurable: { ts: Timestamp({ t: 1676379490, i: 1 }), t: Long(\"1\") },\n      optimeDate: ISODate(\"2023-02-14T12:58:10.000Z\"),\n      optimeDurableDate: ISODate(\"2023-02-14T12:58:10.000Z\"),\n      lastAppliedWallTime: ISODate(\"2023-02-14T12:58:11.204Z\"),\n      lastDurableWallTime: ISODate(\"2023-02-14T12:58:11.204Z\"),\n      lastHeartbeat: ISODate(\"2023-02-14T12:58:10.988Z\"),\n      lastHeartbeatRecv: ISODate(\"2023-02-14T12:58:10.495Z\"),\n      pingMs: Long(\"0\"),\n      lastHeartbeatMessage: '',\n      syncSourceHost: 'mongocfg1:27017',\n      syncSourceId: 0,\n      infoMessage: '',\n      configVersion: 1,\n      configTerm: 1\n},\n    {\n_id: 2,\n      name: 'mongocfg3:27017',\n      health: 1,\n      state: 2,\n      stateStr: 'SECONDARY',\n      uptime: 27,\n      optime: { ts: Timestamp({ t: 1676379490, i: 1 }), t: Long(\"1\") },\n      optimeDurable: { ts: Timestamp({ t: 1676379490, i: 1 }), t: Long(\"1\") },\n      optimeDate: ISODate(\"2023-02-14T12:58:10.000Z\"),\n      optimeDurableDate: ISODate(\"2023-02-14T12:58:10.000Z\"),\n      lastAppliedWallTime: ISODate(\"2023-02-14T12:58:11.204Z\"),\n      lastDurableWallTime: ISODate(\"2023-02-14T12:58:11.204Z\"),\n      lastHeartbeat: ISODate(\"2023-02-14T12:58:10.988Z\"),\n      lastHeartbeatRecv: ISODate(\"2023-02-14T12:58:10.497Z\"),\n      pingMs: Long(\"0\"),\n      lastHeartbeatMessage: '',\n      syncSourceHost: 'mongocfg1:27017',\n      syncSourceId: 0,\n      infoMessage: '',\n      configVersion: 1,\n      configTerm: 1\n}\n],\n  ok: 1,\n  lastCommittedOpTime: Timestamp({ t: 1676379491, i: 1 }),\n  '$clusterTime': {\nclusterTime: Timestamp({ t: 1676379491, i: 1 }),\n    signature: {\nhash: Binary(Buffer.from(\"0000000000000000000000000000000000000000\", \"hex\"), 0),\n      keyId: Long(\"0\")\n}\n},\n  operationTime: Timestamp({ t: 1676379491, i: 1 })\n}\n</code></pre> <p>Salimos del servidor mongocfg1 y entramos en mongoshard11 para iniciar el cl\u00faster del conjunto de r\u00e9plicas para el primer fragmento (shard1).</p> <pre><code>exit exit\ndocker exec -it mongoshard11 /bin/bash\n\nmongosh\n\nrs.initiate({_id : \"shard1\", members: [{ _id : 0, host : \"mongoshard11\" },{ _id : 1, host : \"mongoshard12\" },{ _id : 2, host : \"mongoshard13\" }]})\n</code></pre> <p>Comprobamos el resultado:</p> <pre><code>shard1 [direct: secondary] test&gt; rs.status()\n{\nset: 'shard1',\n  date: ISODate(\"2023-02-14T13:01:15.130Z\"),\n  myState: 1,\n  term: Long(\"1\"),\n  syncSourceHost: '',\n  syncSourceId: -1,\n  heartbeatIntervalMillis: Long(\"2000\"),\n  majorityVoteCount: 2,\n  writeMajorityCount: 2,\n  votingMembersCount: 3,\n  writableVotingMembersCount: 3,\n  optimes: {\nlastCommittedOpTime: { ts: Timestamp({ t: 1676379667, i: 6 }), t: Long(\"1\") },\n    lastCommittedWallTime: ISODate(\"2023-02-14T13:01:07.258Z\"),\n    readConcernMajorityOpTime: { ts: Timestamp({ t: 1676379667, i: 6 }), t: Long(\"1\") },\n    appliedOpTime: { ts: Timestamp({ t: 1676379667, i: 6 }), t: Long(\"1\") },\n    durableOpTime: { ts: Timestamp({ t: 1676379667, i: 6 }), t: Long(\"1\") },\n    lastAppliedWallTime: ISODate(\"2023-02-14T13:01:07.258Z\"),\n    lastDurableWallTime: ISODate(\"2023-02-14T13:01:07.258Z\")\n},\n  lastStableRecoveryTimestamp: Timestamp({ t: 1676379655, i: 1 }),\n  electionCandidateMetrics: {\nlastElectionReason: 'electionTimeout',\n    lastElectionDate: ISODate(\"2023-02-14T13:01:05.716Z\"),\n    electionTerm: Long(\"1\"),\n    lastCommittedOpTimeAtElection: { ts: Timestamp({ t: 1676379655, i: 1 }), t: Long(\"-1\") },\n    lastSeenOpTimeAtElection: { ts: Timestamp({ t: 1676379655, i: 1 }), t: Long(\"-1\") },\n    numVotesNeeded: 2,\n    priorityAtElection: 1,\n    electionTimeoutMillis: Long(\"10000\"),\n    numCatchUpOps: Long(\"0\"),\n    newTermStartDate: ISODate(\"2023-02-14T13:01:05.757Z\"),\n    wMajorityWriteAvailabilityDate: ISODate(\"2023-02-14T13:01:07.179Z\")\n},\n  members: [\n{\n_id: 0,\n      name: 'mongoshard11:27017',\n      health: 1,\n      state: 1,\n      stateStr: 'PRIMARY',\n      uptime: 750,\n      optime: { ts: Timestamp({ t: 1676379667, i: 6 }), t: Long(\"1\") },\n      optimeDate: ISODate(\"2023-02-14T13:01:07.000Z\"),\n      lastAppliedWallTime: ISODate(\"2023-02-14T13:01:07.258Z\"),\n      lastDurableWallTime: ISODate(\"2023-02-14T13:01:07.258Z\"),\n      syncSourceHost: '',\n      syncSourceId: -1,\n      infoMessage: '',\n      electionTime: Timestamp({ t: 1676379665, i: 1 }),\n      electionDate: ISODate(\"2023-02-14T13:01:05.000Z\"),\n      configVersion: 1,\n      configTerm: 1,\n      self: true,\n      lastHeartbeatMessage: ''\n},\n    {\n_id: 1,\n      name: 'mongoshard12:27017',\n      health: 1,\n      state: 2,\n      stateStr: 'SECONDARY',\n      uptime: 19,\n      optime: { ts: Timestamp({ t: 1676379667, i: 6 }), t: Long(\"1\") },\n      optimeDurable: { ts: Timestamp({ t: 1676379667, i: 6 }), t: Long(\"1\") },\n      optimeDate: ISODate(\"2023-02-14T13:01:07.000Z\"),\n      optimeDurableDate: ISODate(\"2023-02-14T13:01:07.000Z\"),\n      lastAppliedWallTime: ISODate(\"2023-02-14T13:01:07.258Z\"),\n      lastDurableWallTime: ISODate(\"2023-02-14T13:01:07.258Z\"),\n      lastHeartbeat: ISODate(\"2023-02-14T13:01:13.731Z\"),\n      lastHeartbeatRecv: ISODate(\"2023-02-14T13:01:13.243Z\"),\n      pingMs: Long(\"0\"),\n      lastHeartbeatMessage: '',\n      syncSourceHost: 'mongoshard11:27017',\n      syncSourceId: 0,\n      infoMessage: '',\n      configVersion: 1,\n      configTerm: 1\n},\n    {\n_id: 2,\n      name: 'mongoshard13:27017',\n      health: 1,\n      state: 2,\n      stateStr: 'SECONDARY',\n      uptime: 19,\n      optime: { ts: Timestamp({ t: 1676379667, i: 6 }), t: Long(\"1\") },\n      optimeDurable: { ts: Timestamp({ t: 1676379667, i: 6 }), t: Long(\"1\") },\n      optimeDate: ISODate(\"2023-02-14T13:01:07.000Z\"),\n      optimeDurableDate: ISODate(\"2023-02-14T13:01:07.000Z\"),\n      lastAppliedWallTime: ISODate(\"2023-02-14T13:01:07.258Z\"),\n      lastDurableWallTime: ISODate(\"2023-02-14T13:01:07.258Z\"),\n      lastHeartbeat: ISODate(\"2023-02-14T13:01:13.731Z\"),\n      lastHeartbeatRecv: ISODate(\"2023-02-14T13:01:13.242Z\"),\n      pingMs: Long(\"0\"),\n      lastHeartbeatMessage: '',\n      syncSourceHost: 'mongoshard11:27017',\n      syncSourceId: 0,\n      infoMessage: '',\n      configVersion: 1,\n      configTerm: 1\n}\n],\n  ok: 1,\n  '$clusterTime': {\nclusterTime: Timestamp({ t: 1676379667, i: 6 }),\n    signature: {\nhash: Binary(Buffer.from(\"0000000000000000000000000000000000000000\", \"hex\"), 0),\n      keyId: Long(\"0\")\n}\n},\n  operationTime: Timestamp({ t: 1676379667, i: 6 })\n}\n</code></pre> <p>Salimos y hacemos lo mismo con el segundo shard. Para ello tendremos que entrar en mongoshard21 e iniciar el conjunto de r\u00e9plicas de shard2.</p> <pre><code>exit\nexit\ndocker exec -it mongoshard21 /bin/bash\n\nmongosh\n\nrs.initiate({_id : \"shard2\", members: [{ _id : 0, host : \"mongoshard21\" },{ _id : 1, host : \"mongoshard22\" },{ _id : 2, host : \"mongoshard23\" }]})\n</code></pre> <p>Comprobamos el resultado:</p> <pre><code>shard2 [direct: secondary] test&gt; rs.status()\n{\nset: 'shard2',\n  date: ISODate(\"2023-02-14T13:02:27.343Z\"),\n  myState: 1,\n  term: Long(\"1\"),\n  syncSourceHost: '',\n  syncSourceId: -1,\n  heartbeatIntervalMillis: Long(\"2000\"),\n  majorityVoteCount: 2,\n  writeMajorityCount: 2,\n  votingMembersCount: 3,\n  writableVotingMembersCount: 3,\n  optimes: {\nlastCommittedOpTime: { ts: Timestamp({ t: 1676379736, i: 1 }), t: Long(\"-1\") },\n    lastCommittedWallTime: ISODate(\"2023-02-14T13:02:16.836Z\"),\n    readConcernMajorityOpTime: { ts: Timestamp({ t: 1676379736, i: 1 }), t: Long(\"-1\") },\n    appliedOpTime: { ts: Timestamp({ t: 1676379747, i: 7 }), t: Long(\"1\") },\n    durableOpTime: { ts: Timestamp({ t: 1676379747, i: 7 }), t: Long(\"1\") },\n    lastAppliedWallTime: ISODate(\"2023-02-14T13:02:27.304Z\"),\n    lastDurableWallTime: ISODate(\"2023-02-14T13:02:27.304Z\")\n},\n  lastStableRecoveryTimestamp: Timestamp({ t: 1676379736, i: 1 }),\n  electionCandidateMetrics: {\nlastElectionReason: 'electionTimeout',\n    lastElectionDate: ISODate(\"2023-02-14T13:02:27.197Z\"),\n    electionTerm: Long(\"1\"),\n    lastCommittedOpTimeAtElection: { ts: Timestamp({ t: 1676379736, i: 1 }), t: Long(\"-1\") },\n    lastSeenOpTimeAtElection: { ts: Timestamp({ t: 1676379736, i: 1 }), t: Long(\"-1\") },\n    numVotesNeeded: 2,\n    priorityAtElection: 1,\n    electionTimeoutMillis: Long(\"10000\"),\n    numCatchUpOps: Long(\"0\"),\n    newTermStartDate: ISODate(\"2023-02-14T13:02:27.274Z\")\n},\n  members: [\n{\n_id: 0,\n      name: 'mongoshard21:27017',\n      health: 1,\n      state: 1,\n      stateStr: 'PRIMARY',\n      uptime: 821,\n      optime: { ts: Timestamp({ t: 1676379747, i: 7 }), t: Long(\"1\") },\n      optimeDate: ISODate(\"2023-02-14T13:02:27.000Z\"),\n      lastAppliedWallTime: ISODate(\"2023-02-14T13:02:27.304Z\"),\n      lastDurableWallTime: ISODate(\"2023-02-14T13:02:27.304Z\"),\n      syncSourceHost: '',\n      syncSourceId: -1,\n      infoMessage: '',\n      electionTime: Timestamp({ t: 1676379747, i: 1 }),\n      electionDate: ISODate(\"2023-02-14T13:02:27.000Z\"),\n      configVersion: 1,\n      configTerm: 1,\n      self: true,\n      lastHeartbeatMessage: ''\n},\n    {\n_id: 1,\n      name: 'mongoshard22:27017',\n      health: 1,\n      state: 2,\n      stateStr: 'SECONDARY',\n      uptime: 10,\n      optime: { ts: Timestamp({ t: 1676379736, i: 1 }), t: Long(\"-1\") },\n      optimeDurable: { ts: Timestamp({ t: 1676379736, i: 1 }), t: Long(\"-1\") },\n      optimeDate: ISODate(\"2023-02-14T13:02:16.000Z\"),\n      optimeDurableDate: ISODate(\"2023-02-14T13:02:16.000Z\"),\n      lastAppliedWallTime: ISODate(\"2023-02-14T13:02:16.836Z\"),\n      lastDurableWallTime: ISODate(\"2023-02-14T13:02:16.836Z\"),\n      lastHeartbeat: ISODate(\"2023-02-14T13:02:27.244Z\"),\n      lastHeartbeatRecv: ISODate(\"2023-02-14T13:02:27.249Z\"),\n      pingMs: Long(\"0\"),\n      lastHeartbeatMessage: '',\n      syncSourceHost: '',\n      syncSourceId: -1,\n      infoMessage: '',\n      configVersion: 1,\n      configTerm: 0\n},\n    {\n_id: 2,\n      name: 'mongoshard23:27017',\n      health: 1,\n      state: 2,\n      stateStr: 'SECONDARY',\n      uptime: 10,\n      optime: { ts: Timestamp({ t: 1676379736, i: 1 }), t: Long(\"-1\") },\n      optimeDurable: { ts: Timestamp({ t: 1676379736, i: 1 }), t: Long(\"-1\") },\n      optimeDate: ISODate(\"2023-02-14T13:02:16.000Z\"),\n      optimeDurableDate: ISODate(\"2023-02-14T13:02:16.000Z\"),\n      lastAppliedWallTime: ISODate(\"2023-02-14T13:02:16.836Z\"),\n      lastDurableWallTime: ISODate(\"2023-02-14T13:02:16.836Z\"),\n      lastHeartbeat: ISODate(\"2023-02-14T13:02:27.244Z\"),\n      lastHeartbeatRecv: ISODate(\"2023-02-14T13:02:27.249Z\"),\n      pingMs: Long(\"0\"),\n      lastHeartbeatMessage: '',\n      syncSourceHost: '',\n      syncSourceId: -1,\n      infoMessage: '',\n      configVersion: 1,\n      configTerm: 0\n}\n],\n  ok: 1,\n  '$clusterTime': {\nclusterTime: Timestamp({ t: 1676379747, i: 7 }),\n    signature: {\nhash: Binary(Buffer.from(\"0000000000000000000000000000000000000000\", \"hex\"), 0),\n      keyId: Long(\"0\")\n}\n},\n  operationTime: Timestamp({ t: 1676379747, i: 7 })\n}\n</code></pre> <p>Salimos y entramos en la instancia mongos1 para a\u00f1adir los cl\u00fasteres fragmentados. Esto lo haremos con <code>sh.addShard()</code>.</p> <pre><code>exit\nexit\ndocker exec -it mongos1 /bin/bash\n\nmongosh\n\nsh.addShard(\"shard1/mongoshard11\")\nsh.addShard(\"shard2/mongoshard21\")\n</code></pre> <p></p> <p>Comprobamos los resultados de a\u00f1adir los fragmentos.</p> <pre><code>[direct: mongos] test&gt; sh.status()\nshardingVersion\n{\n_id: 1,\n  minCompatibleVersion: 5,\n  currentVersion: 6,\n  clusterId: ObjectId(\"63eb85532608d03f4afe05a8\")\n}\n---\nshards\n[\n{\n_id: 'shard1',\n    host: 'shard1/mongoshard11:27017,mongoshard12:27017,mongoshard13:27017',\n    state: 1,\n    topologyTime: Timestamp({ t: 1676379868, i: 5 })\n},\n  {\n_id: 'shard2',\n    host: 'shard2/mongoshard21:27017,mongoshard22:27017,mongoshard23:27017',\n    state: 1,\n    topologyTime: Timestamp({ t: 1676379880, i: 6 })\n}\n]\n---\nactive mongoses\n[ { '6.0.4': 1 } ]\n---\nautosplit\n{ 'Currently enabled': 'yes' }\n---\nbalancer\n{\n'Currently enabled': 'yes',\n  'Failed balancer rounds in last 5 attempts': 0,\n  'Currently running': 'no',\n  'Migration Results for the last 24 hours': 'No recent migrations'\n}\n---\ndatabases\n[\n{\ndatabase: { _id: 'config', primary: 'config', partitioned: true },\n    collections: {}\n}\n]\n</code></pre>"},{"location":"p6-almacenamiento/rg/ejercicio7/#sharded-database","title":"Sharded database","text":"<p>Ya podremos usar libremente el servidor de consultas mongos para trabajar con bases de datos, documentos y colecciones tal como se har\u00eda con una base de datos t\u00edpica sin fragmentar. Sin embargo, si no se realiza ninguna configuraci\u00f3n m\u00e1s, cualquier dato que se agregue al cl\u00faster terminar\u00e1 almacen\u00e1ndose solo en el fragmento principal, no se dividir\u00e1 autom\u00e1ticamente y no experimentar\u00e1 ninguno de los beneficios que proporciona la fragmentaci\u00f3n.</p> <p>Para utilizar el cl\u00faster MongoDB fragmentado que hemos creado en todo su potencial, se debe habilitar la fragmentaci\u00f3n para una base de datos dentro del cl\u00faster. Una base de datos MongoDB solo puede contener colecciones fragmentadas si tiene habilitada la fragmentaci\u00f3n.</p> <p>Para ello vamos a trabajar con la base de datos shardedDB y config desde el servidor mongos1:</p> <pre><code>use shardedDB\nsh.enableSharding(\"shardedDB\")\n</code></pre> <p>Al activar la fragmentaci\u00f3n deber\u00eda aparecer lo siguiente:</p> <pre><code>{\nok: 1,\n  '$clusterTime': {\nclusterTime: Timestamp({ t: 1676379934, i: 4 }),\n    signature: {\nhash: Binary(Buffer.from(\"0000000000000000000000000000000000000000\", \"hex\"), 0),\n      keyId: Long(\"0\")\n}\n},\n  operationTime: Timestamp({ t: 1676379934, i: 2 })\n}\n</code></pre> <p>Vamos a config y consultamos las bases de datos.</p> <pre><code>use config\ndb.databases.find()\n</code></pre> <p>Nos debe aparecer algo parecido a lo siguiente:</p> <pre><code>[\n{\n_id: 'shardedDB',\n    primary: 'shard2',\n    partitioned: false,\n    version: {\nuuid: new UUID(\"9926816f-0ed8-428c-a170-cbd14b270c5e\"),\n      timestamp: Timestamp({ t: 1676379933, i: 2 }),\n      lastMod: 1\n}\n}\n]\n</code></pre> <p>Creamos a continuaci\u00f3n la colecci\u00f3n fragmentada en la base de datos shardedDB. En este caso vamos a utilizar la estrategia de fragmentaci\u00f3n mediante hash (Hashed Sharding). La otra forma de hacerlo ser\u00eda mediante fragmentaci\u00f3n por rangos (Ranged Sharding).</p> <pre><code>use shardedDB\ndb.shardedCollection.ensureIndex({_id: \"hashed\"})\nsh.shardCollection(\"shardedDB.shardedCollection\", {\"_id\": \"hashed\"})\n</code></pre> <pre><code>{\ncollectionsharded: 'shardedDB.shardedCollection',\n  ok: 1,\n  '$clusterTime': {\nclusterTime: Timestamp({ t: 1676380085, i: 37 }),\n    signature: {\nhash: Binary(Buffer.from(\"0000000000000000000000000000000000000000\", \"hex\"), 0),\n      keyId: Long(\"0\")\n}\n},\n  operationTime: Timestamp({ t: 1676380085, i: 33 })\n}\n</code></pre> <p>Insertamos alg\u00fan registro a la colecci\u00f3n.</p> <pre><code>for(var i = 0; i &lt; 1500; i++) db.shardedCollection.insertOne({x: i})\n</code></pre> <pre><code>{\nacknowledged: true,\n  insertedId: ObjectId(\"63eb8845b958d280e786eb46\")\n}\n</code></pre> <p>Por \u00faltimo comprobamos la distribuci\u00f3n de los datos guardados en shard1 y shard2.</p> <pre><code>db.shardedCollection.getShardDistribution()\n</code></pre> <p>El resultado nos muestra que los datos se han fragmentado en ambos shards. Tenemos 4 chunks, dos en cada shard. Tambi\u00e9n vemos en Totals el porcentaje de los datos guardados en cada uno.</p> <pre><code>Shard shard2 at shard2/mongoshard21:27017,mongoshard22:27017,mongoshard23:27017\n{\ndata: '44KiB',\n  docs: 1554,\n  chunks: 2,\n  'estimated data per chunk': '22KiB',\n  'estimated docs per chunk': 777\n}\n---\nShard shard1 at shard1/mongoshard11:27017,mongoshard12:27017,mongoshard13:27017\n{\ndata: '40KiB',\n  docs: 1446,\n  chunks: 2,\n  'estimated data per chunk': '20KiB',\n  'estimated docs per chunk': 723\n}\n---\nTotals\n{\ndata: '84KiB',\n  docs: 3000,\n  chunks: 4,\n  'Shard shard2': [\n'51.8 % data',\n    '51.8 % docs in cluster',\n    '29B avg obj size on shard'\n],\n  'Shard shard1': [\n'48.2 % data',\n    '48.2 % docs in cluster',\n    '29B avg obj size on shard'\n]\n}\n</code></pre> <p>Si volvemos a hacer sh.status() nos aparecer\u00e1 la informaci\u00f3n de la base de datos creada y los datos de las colecciones.</p> <pre><code>...\ndatabases\n[\n{\ndatabase: { _id: 'config', primary: 'config', partitioned: true },\n    collections: {\n'config.system.sessions': {\nshardKey: { _id: 1 },\n        unique: false,\n        balancing: true,\n        chunkMetadata: [ { shard: 'shard1', nChunks: 1024 } ],\n        chunks: [\n'too many chunks to print, use verbose if you want to force print'\n],\n        tags: []\n}\n}\n},\n  {\ndatabase: {\n_id: 'shardedDB',\n      primary: 'shard2',\n      partitioned: false,\n      version: {\nuuid: new UUID(\"9926816f-0ed8-428c-a170-cbd14b270c5e\"),\n        timestamp: Timestamp({ t: 1676379933, i: 2 }),\n        lastMod: 1\n}\n},\n    collections: {\n'shardedDB.shardedCollection': {\nshardKey: { _id: 'hashed' },\n        unique: false,\n        balancing: true,\n        chunkMetadata: [\n{ shard: 'shard1', nChunks: 2 },\n          { shard: 'shard2', nChunks: 2 }\n],\n        chunks: [\n{ min: { _id: MinKey() }, max: { _id: Long(\"-4611686018427387902\") }, 'on shard': 'shard1', 'last modified': Timestamp({ t: 1, i: 0 }) },\n          { min: { _id: Long(\"-4611686018427387902\") }, max: { _id: Long(\"0\") }, 'on shard': 'shard1', 'last modified': Timestamp({ t: 1, i: 1 }) },\n          { min: { _id: Long(\"0\") }, max: { _id: Long(\"4611686018427387902\") }, 'on shard': 'shard2', 'last modified': Timestamp({ t: 1, i: 2 }) },\n          { min: { _id: Long(\"4611686018427387902\") }, max: { _id: MaxKey() }, 'on shard': 'shard2', 'last modified': Timestamp({ t: 1, i: 3 }) }\n],\n        tags: []\n}\n}\n}\n]\n</code></pre>"},{"location":"p6-almacenamiento/rg/ejercicio7/#base-de-datos-con-uno-de-los-campos-de-la-coleccion-fragmentado","title":"Base de datos con uno de los campos de la colecci\u00f3n fragmentado","text":"<p>Vamos a hacerlo con otra base de datos de ejemplo.</p> <p>Activamos la fragmentaci\u00f3n para la base de datos populations.</p> <pre><code>sh.enableSharding(\"populations\")\n</code></pre> <p>Creamos la colecci\u00f3n cities con el campo country como su clave de fragmentaci\u00f3n.</p> <pre><code>sh.shardCollection(\"populations.cities\", { \"country\": \"hashed\" })\n</code></pre> <p>Ahora insertamos varios documentos a la colecci\u00f3n cities.</p> <pre><code>use populations\n\ndb.cities.insertMany([\n{\"name\": \"Seoul\", \"country\": \"South Korea\", \"continent\": \"Asia\", \"population\": 25.674 },\n    {\"name\": \"Mumbai\", \"country\": \"India\", \"continent\": \"Asia\", \"population\": 19.980 },\n    {\"name\": \"Lagos\", \"country\": \"Nigeria\", \"continent\": \"Africa\", \"population\": 13.463 },\n    {\"name\": \"Beijing\", \"country\": \"China\", \"continent\": \"Asia\", \"population\": 19.618 },\n    {\"name\": \"Shanghai\", \"country\": \"China\", \"continent\": \"Asia\", \"population\": 25.582 },\n    {\"name\": \"Osaka\", \"country\": \"Japan\", \"continent\": \"Asia\", \"population\": 19.281 },\n    {\"name\": \"Cairo\", \"country\": \"Egypt\", \"continent\": \"Africa\", \"population\": 20.076 },\n    {\"name\": \"Tokyo\", \"country\": \"Japan\", \"continent\": \"Asia\", \"population\": 37.400 },\n    {\"name\": \"Karachi\", \"country\": \"Pakistan\", \"continent\": \"Asia\", \"population\": 15.400 },\n    {\"name\": \"Dhaka\", \"country\": \"Bangladesh\", \"continent\": \"Asia\", \"population\": 19.578 },\n    {\"name\": \"Rio de Janeiro\", \"country\": \"Brazil\", \"continent\": \"South America\", \"population\": 13.293 },\n    {\"name\": \"S\u00e3o Paulo\", \"country\": \"Brazil\", \"continent\": \"South America\", \"population\": 21.650 },\n    {\"name\": \"Mexico City\", \"country\": \"Mexico\", \"continent\": \"North America\", \"population\": 21.581 },\n    {\"name\": \"Delhi\", \"country\": \"India\", \"continent\": \"Asia\", \"population\": 28.514 },\n    {\"name\": \"Buenos Aires\", \"country\": \"Argentina\", \"continent\": \"South America\", \"population\": 14.967 },\n    {\"name\": \"Kolkata\", \"country\": \"India\", \"continent\": \"Asia\", \"population\": 14.681 },\n    {\"name\": \"New York\", \"country\": \"United States\", \"continent\": \"North America\", \"population\": 18.819 },\n    {\"name\": \"Manila\", \"country\": \"Philippines\", \"continent\": \"Asia\", \"population\": 13.482 },\n    {\"name\": \"Chongqing\", \"country\": \"China\", \"continent\": \"Asia\", \"population\": 14.838 },\n    {\"name\": \"Istanbul\", \"country\": \"Turkey\", \"continent\": \"Europe\", \"population\": 14.751 }\n])\n</code></pre> <p>Comprobamos la distribuci\u00f3n de los fragmentos.</p> <pre><code>db.cities.getShardDistribution()\n</code></pre> <pre><code>Shard shard2 at shard2/mongoshard21:27017,mongoshard22:27017,mongoshard23:27017\n{\ndata: '943B',\n  docs: 9,\n  chunks: 2,\n  'estimated data per chunk': '471B',\n  'estimated docs per chunk': 4\n}\n---\nShard shard1 at shard1/mongoshard11:27017,mongoshard12:27017,mongoshard13:27017\n{\ndata: '1KiB',\n  docs: 11,\n  chunks: 2,\n  'estimated data per chunk': '567B',\n  'estimated docs per chunk': 5\n}\n---\nTotals\n{\ndata: '2KiB',\n  docs: 20,\n  chunks: 4,\n  'Shard shard2': [\n'45.4 % data',\n    '45 % docs in cluster',\n    '104B avg obj size on shard'\n],\n  'Shard shard1': [\n'54.59 % data',\n    '55 % docs in cluster',\n    '103B avg obj size on shard'\n]\n}\n</code></pre> <p>M\u00e1s info</p> <p>Para m\u00e1s informaci\u00f3n y aprender a configurar el Sharding (fragmentaci\u00f3n) en MongoDB sin utilizar Docker se puede seguir el siguiente tutorial.</p>"},{"location":"p6-almacenamiento/ri/alumno1/","title":"Alumno 1","text":""},{"location":"p6-almacenamiento/ri/alumno1/#1-muestra-los-espacios-de-tablas-existentes-en-tu-base-de-datos-y-la-ruta-de-los-ficheros-que-los-componen-estan-las-extensiones-gestionadas-localmente-o-por-diccionario","title":"1. Muestra los espacios de tablas existentes en tu base de datos y la ruta de los ficheros que los componen. \u00bfEst\u00e1n las extensiones gestionadas localmente o por diccionario?","text":"<pre><code>select FILE_NAME, TABLESPACE_NAME, BLOCKS from dba_data_files UNION select FILE_NAME, TABLESPACE_NAME, BLOCKS from dba_temp_files;\n</code></pre>"},{"location":"p6-almacenamiento/ri/alumno1/#2-usa-la-vista-del-diccionario-de-datos-vdatafile-para-mirar-cuando-fue-la-ultima-vez-que-se-ejecuto-el-proceso-ckpt-en-tu-base-de-datos","title":"2. Usa la vista del diccionario de datos v$datafile para mirar cuando fue la \u00faltima vez que se ejecut\u00f3 el proceso CKPT en tu base de datos.","text":"<pre><code>select max(CHECKPOINT_TIME) from v$datafile;\nselect min(CHECKPOINT_TIME) from v$datafile;\n</code></pre> <p>Qu\u00e9 es CKPT?</p> <p>CKPT (Checkpoint): Este proceso escribe en los ficheros de control los checkpoints. Estos puntos de sincronizaci\u00f3n son referencias al estado coherente de todos los ficheros de la BD en un instante determinado, en un punto de sincronizaci\u00f3n. Esto significa que los bloques sucios de la BD se vuelcan a los ficheros de BD, asegur\u00e1ndose de que todos los bloques de datos modificados desde el \u00faltimo checkpoint se escriben realmente en los ficheros de datos y no s\u00f3lo en los ficheros redo log; y que los ficheros de redo log tambi\u00e9n almacenan los registros de redo log hasta este instante. La secuencia de puntos de control se almacena en los ficheros de datos, redo log y control. Los checkpoints se produce cuando: * un espacio de tabla se pone inactivo, offline, * se llena el fichero de redo log activo, * se para la BD, * el n\u00famero de bloques escritos en el redo log desde el \u00faltimo checkpoint alcanza el l\u00edmite definido en el par\u00e1metro LOG_CHECKPOINT_INTERVAL, * cuando transcurra el n\u00famero de segundos indicado por el par\u00e1metro LOG_CHECKPOINT_TIMEOUT desde el \u00faltimo checkpoint.</p>"},{"location":"p6-almacenamiento/ri/alumno1/#3-intenta-crear-el-tablespace-ts1-con-un-fichero-de-2m-en-tu-disco-que-crezca-automaticamente-cuando-sea-necesario-puedes-hacer-que-la-gestion-de-extensiones-sea-por-diccionario-averigua-la-razon","title":"3. Intenta crear el tablespace TS1 con un fichero de 2M en tu disco que crezca autom\u00e1ticamente cuando sea necesario. \u00bfPuedes hacer que la gesti\u00f3n de extensiones sea por diccionario? Averigua la raz\u00f3n.","text":"<pre><code>create tablespace ts1 datafile 'ts1.dbf' size 2M autoextend on;\n</code></pre> <p>A partir de Oracle9 los extends se gestionan de manera local, con el fin de evitar operaciones recurrentes al diccionario de datos, es lo m\u00e1s \u00f3ptimo a la hora de administrar la base de datos.</p> <p>Ejemplo de creaci\u00f3n de un tablespace con gesti\u00f3n de extensiones por diccionario:</p> <pre><code>create tablespace ts1 datafile 'ts1.dbf' size 2M EXTENT MANAGEMENT DICTIONARY\nDEFAULT STORAGE (\nINITIAL 64K\nNEXT 64K\nMINEXTENTS 2\nMAXEXTENTS 121\nPCTINCREASE 0);\n</code></pre>"},{"location":"p6-almacenamiento/ri/alumno1/#4-averigua-el-tamano-de-un-bloque-de-datos-en-tu-base-de-datos-cambialo-al-doble-del-valor-que-tenga","title":"4. Averigua el tama\u00f1o de un bloque de datos en tu base de datos. C\u00e1mbialo al doble del valor que tenga.","text":"<pre><code>select distinct bytes/blocks from user_segments;\no bien\nselect name, block_size, current_size from v$buffer_pool;\nselect tablespace_name, block_size from dba_tablespaces;\n</code></pre> <pre><code>ALTER SYSTEM SET DB_16k_CACHE_SIZE=80M;\n</code></pre> <p>Ahora podemos ver reflejado el cambio en el tama\u00f1o de los bloques de datos:</p> <p></p> <p>create tablespace ts_doble datafile 'tsdoble.dbf' size 2M blocksize 16K;</p> <p>select tablespace_name, block_size from dba_tablespaces where tablespace_name='ts_doble';</p> <p></p>"},{"location":"p6-almacenamiento/ri/alumno1/#5-realiza-un-procedimiento-mostrarobjetosdeusuarioents-que-reciba-el-nombre-de-un-tablespace-y-el-de-un-usuario-y-muestre-que-objetos-tiene-el-usuario-en-dicho-tablespace-y-que-tamano-tiene-cada-uno-de-ellos","title":"5. Realiza un procedimiento MostrarObjetosdeUsuarioenTS que reciba el nombre de un tablespace y el de un usuario y muestre qu\u00e9 objetos tiene el usuario en dicho tablespace y qu\u00e9 tama\u00f1o tiene cada uno de ellos.","text":"<pre><code>create or replace procedure MostrarObjetosdeUsuarioenTS(p_tablespace VARCHAR2,p_usuario VARCHAR2)\nis\ncursor c_tablespace is select segment_name, bytes from dba_segments where tablespace_name=p_tablespace and owner=p_usuario;\nbegin\ndbms_output.put_line('User:  '||p_usuario||CHR(9) ||'Size: ');\nfor v_tablespace in c_tablespace loop\ndbms_output.put_line(v_tablespace.segment_name||chr(9)||v_tablespace.bytes);\nend loop;\nend;\n/\n</code></pre>"},{"location":"p6-almacenamiento/ri/alumno1/#6-realiza-un-procedimiento-llamado-mostrarusrscuotailimitada-que-muestre-los-usuarios-que-puedan-escribir-de-forma-ilimitada-en-mas-de-uno-de-los-tablespaces-que-cuentan-con-ficheros-en-la-unidad-c","title":"6. Realiza un procedimiento llamado MostrarUsrsCuotaIlimitada que muestre los usuarios que puedan escribir de forma ilimitada en m\u00e1s de uno de los tablespaces que cuentan con ficheros en la unidad C:","text":"<pre><code>create or replace procedure MostrarUsrsCuotaIlimitada\nis\ncursor c_cuota is\nselect grantee\nfrom DBA_SYS_PRIVS\nwhere privilege = 'UNLIMITED TABLESPACE' union select\nusername from DBA_TS_QUOTAS where tablespace_name in (select tablespace_name\nfrom DBA_DATA_FILES where file_name = '/home/oracle');\nbegin\ndbms_output.put_line('Usuarios con cuota ilimitada');\nfor v_cuota in c_cuota loop\ndbms_output.put_line(v_cuota.grantee);\nend loop;\nend;\n/\n</code></pre> <p>Aqu\u00ed relacionamos al usuario con la cuota ilimitada y los tablespaces que tiene en /home/oracle, de esta manera podemos ver la lista de usuarios que tienen cuota ilimitada en /home/oracle;</p> <p></p> <p>Postgres:</p>"},{"location":"p6-almacenamiento/ri/alumno1/#7-averigua-si-existe-el-concepto-de-tablespace-en-postgres-en-que-consiste-y-las-diferencias-con-los-tablespaces-de-oracle","title":"7. Averigua si existe el concepto de tablespace en Postgres, en qu\u00e9 consiste y las diferencias con los tablespaces de ORACLE.","text":"<p>Los tablespaces en Postgres es la versi\u00f3n reducida de la de Oracle, pero presenta una mejora, ya que se pueden almacenar estos tablespaces en diferentes directorios, lo que permite una mejor gesti\u00f3n de los mismos.</p> <p>La gran diferencia con Oracle es que los tablespaces de Postgres son objetos de nivel de cluster y no hay posibilidad de restringir el tama\u00f1o del tablespace (por lo tanto, del cluster/base de datos). No tienes que lidiar con datafiles, sino con directorios.</p> <p>Ejemplo de crear un tablespace en Postgres:</p> <pre><code>CREATE TABLESPACE tablespace_name\nOWNER user_name\nLOCATION directory_path;\n</code></pre> <p>MySQL:</p>"},{"location":"p6-almacenamiento/ri/alumno1/#8-averigua-si-pueden-establecerse-clausulas-de-almacenamiento-para-las-tablas-o-los-espacios-de-tablas-en-mysql","title":"8. Averigua si pueden establecerse cla\u00fasulas de almacenamiento para las tablas o los espacios de tablas en MySQL.","text":"<p>Existe, pero es una extensi\u00f3n de la base de datos llamada InnoDB, que es la que permite el uso de estos tablespaces.</p> <p>Ejemplo de creaci\u00f3n de un tablespace en MySQL:</p> <pre><code>mysql&gt; CREATE TABLESPACE `ts1` ADD DATAFILE 'ts1.ibd' Engine=InnoDB;\n</code></pre> <p>Como podemos observar, la sintaxis es bastante parecida a la que encontramos en Oracle, esto es debido a que los desarrolladores de MySQL han tomado como base los tablespaces que podemos encontrar en Oracle.</p> <p>MongoDB:</p>"},{"location":"p6-almacenamiento/ri/alumno1/#9-averigua-si-existe-el-concepto-de-indice-en-mongodb-y-las-diferencias-con-los-indices-de-oracle-explica-los-distintos-tipos-de-indice-que-ofrece-mongodb","title":"9. Averigua si existe el concepto de \u00edndice en MongoDB y las diferencias con los \u00edndices de ORACLE. Explica los distintos tipos de \u00edndice que ofrece MongoDB.","text":"<p>En Oracle y MongoDB, los \u00edndices son responsables de acelerar la consulta de b\u00fasqueda proporcionando un acceso r\u00e1pido. Los \u00edndices en el sistema de gesti\u00f3n de bases de datos relacional o no relacional no siempre son relevantes. Los \u00edndices son excelentes para reducir el tiempo que requiere buscar y obtener datos utilizando las declaraciones SELECT.</p> <p>A veces los \u00edndices pueden disminuir el rendimiento de las consultas de actualizaci\u00f3n, inserci\u00f3n o eliminaci\u00f3n. En Oracle, el \u00edndice se crea normalmente para obtener el primer conjunto primario de filas r\u00e1pidamente cuando la tabla contiene demasiados datos. Esto es responsable del rendimiento general de la base de datos.</p> <p>Predefinidamente, mongodb tiene un index que filtra por '_id' del documento, este index es \u00fanico pero podemos crear otros para mejorar nuestra b\u00fasqueda: </p> <pre><code>db.SOULSWEAPONS.find({name : \"Black Knight Sword\"}).explain(\"executionStats\")\n</code></pre> <p></p> <pre><code>db.SOULSWEAPONS.createIndex({name : 1})\n</code></pre> <pre><code>db.SOULSWEAPONS.find({name : \"Black Knight Sword\"}).explain(\"executionStats\")\n</code></pre> <p></p> <p>Con esto podemos ver como el tiempo de ejecuci\u00f3n se ha reducido al m\u00ednimo, esto es debido a que hemos ajustado el \u00edndice a partir del nombre de forma ascendente.</p> <p>Tipos de \u00edndices en MongoDB:</p> <p>\u00cdndices simples o de un solo campo:</p> <p>Estos \u00edndices se aplican a un solo campo de nuestra colecci\u00f3n. Para declarar un \u00edndice de este tipo debemos usar un comando similar a este:</p> <pre><code>db.users.ensureIndex( { \"user_id\" : 1 } )\n</code></pre> <p>El n\u00famero indica que queremos que el \u00edndice se ordene de forma ascendente. Si quisi\u00e9ramos un orden descendente, el par\u00e1metro ser\u00e1 un -1.</p> <p>\u00cdndices compuestos En este caso el \u00edndice se generar\u00e1 sobre varios campos.</p> <p><pre><code>db.users.ensureIndex( { \"user_name\" : 1, \"age\":-1 } )\n</code></pre> El \u00edndice que se generar\u00e1 con la instrucci\u00f3n anterior, agrupar\u00e1 los datos primero por el campo user_name y luego por el campo age. Es decir, se generar\u00eda algo as\u00ed:</p> <pre><code>    \"Antonio\", 35\n\"Antonio\", 18\n\"Mar\u00eda\", 56\n\"Mar\u00eda\", 30\n\"Mar\u00eda\", 21\n\"Pedro\", 19\n\"Unai\", 34\n\"Unai\", 27\n</code></pre> <p>\u00cdndices \u00fanicos Los \u00edndices simples y m\u00faltiples, pueden estar obligados a contener valores \u00fanicos. Esto lo conseguimos a\u00f1adiendo el par\u00e1metro unique a la hora de crearlos.</p> <pre><code>    db.users.ensureIndex( { \"user_id\" : 1 }, {\"unique\":true} )\n</code></pre> <p>En el caso de que tratemos de insertar valores repetidos en alg\u00fan campo con un \u00edndice \u00fanico, MongoDB nos devolver\u00e1 un error.</p> <p>\u00cdndices sparse Los \u00edndices que hemos mencionado antes, incluyen todos los documentos. Tambi\u00e9n los documentos que no contengan el campo indexado. MongoDB no obliga a que usemos un esquema, as\u00ed que no hay obligatoriedad en que los campos existan en el documento. Vamos, que el campo user_name puede estar en el documento, o no.</p> <p>Para crear \u00edndices que solo incluyan los documentos cuyo campo indexado existe, utilizaremos la opci\u00f3n sparse.</p> <pre><code>db.users.ensureIndex( { \"user_name\" : 1 }, {\"sparse\":true} )\n</code></pre> <p>En este caso lo que hacemos es crear un \u00edndice que no tiene porque contener todos los documentos de la colecci\u00f3n.</p>"},{"location":"p6-almacenamiento/ri/alumno2/","title":"Alumno 2","text":""},{"location":"p6-almacenamiento/ri/alumno2/#oracle","title":"Oracle","text":"<p>1-  Establece que los objetos que se creen en el TS1 (creado por Alumno 1) tengan un tama\u00f1o inicial de 200K, y que cada extensi\u00f3n sea del doble del tama\u00f1o que la anterior. El n\u00famero m\u00e1ximo de extensiones debe ser de 3.</p> <p>Puedes establecer el tama\u00f1o inicial de los objetos en el Tablespace TS1 utilizando el siguiente comando SQL:</p> <pre><code>SQL&gt; ALTER TABLESPACE TS1 ADD DATAFILE 'TS1_01.dbf' SIZE 200K AUTOEXTEND ON NEXT 200K MAXSIZE 800K;\nTablespace modificado.\n</code></pre> <p>Esto especifica que el tama\u00f1o inicial del objeto es de 200K y que cada vez que se llene, se agregar\u00e1 autom\u00e1ticamente una extensi\u00f3n del doble del tama\u00f1o anterior, hasta un m\u00e1ximo de 3 extensiones (800K).</p> <p>2-  Crea dos tablas en el tablespace reci\u00e9n creado e inserta un registro en cada una de ellas. </p> <p>Puedes crear dos tablas en el tablespace TS1 y insertar un registro en cada una de ellas mediante los siguientes comandos SQL:</p> <pre><code>SQL&gt; CREATE TABLE tabla1 (\nid NUMBER PRIMARY KEY,\nnombre VARCHAR2(50),\nfecha DATE\n) TABLESPACE TS1;\nCREATE TABLE tabla2 (\nid NUMBER PRIMARY KEY,\ndescripcion VARCHAR2(100),\nvalor NUMBER\n) TABLESPACE TS1;\nINSERT INTO tabla1 (id, nombre, fecha) VALUES (1, 'Registro 1', SYSDATE);\nINSERT INTO tabla2 (id, descripcion, valor) VALUES (1, 'Registro 1', 123.45);  SQL&gt;\nTabla creada.\nSQL&gt;\nTabla creada.\nSQL&gt;  1 fila creada.\nSQL&gt; 1 fila creada.\n</code></pre> <p>Esto crear\u00e1 dos tablas llamadas tabla1 y tabla2 en el tablespace TS1 y agregar\u00e1 un registro en cada una de ellas.</p> <p>Comprueba el espacio libre existente en el tablespace:</p> <pre><code>SQL&gt; SELECT TABLESPACE_NAME, SUM(BYTES) / 1024 / 1024 AS \"Size (MB)\", (SUM(BYTES) - SUM(MAXBYTES)) / 1024 / 1024 AS \"Free (MB)\"\nFROM DBA_DATA_FILES\nWHERE TABLESPACE_NAME = 'TS1'\nGROUP BY TABLESPACE_NAME;\nTABLESPACE_NAME         Size (MB)  Free (MB)\n------------------------------ ---------- ----------\nTS1                     2,1953125 -18,585938\n</code></pre> <p>Este comando te proporcionar\u00e1 el nombre del tablespace, su tama\u00f1o en MB y la cantidad de espacio libre en MB.</p> <p>Borra una de las tablas y comprueba si ha aumentado el espacio disponible en el tablespace:  </p> <pre><code>SQL&gt; DROP TABLE tabla1;\nTabla borrada.\nSQL&gt; SELECT TABLESPACE_NAME, SUM(BYTES) / 1024 / 1024 AS \"Size (MB)\", (SUM(BYTES) - SUM(MAXBYTES)) / 1024 / 1024 AS \"Free (MB)\"\nFROM DBA_DATA_FILES\nWHERE TABLESPACE_NAME = 'TS1'\nGROUP BY TABLESPACE_NAME;\nTABLESPACE_NAME         Size (MB)  Free (MB)\n------------------------------ ---------- ----------\nTS1                     2,1953125 -18,585938\n</code></pre> <p>Este comando borrar\u00e1 la tabla tabla1 y luego mostrar\u00e1 el nombre del tablespace, su tama\u00f1o en MB y la cantidad de espacio libre en MB, lo que te permitir\u00e1 ver si el espacio disponible en el tablespace ha aumentado despu\u00e9s de borrar la tabla.</p> <p>Explica la raz\u00f3n:</p> <p>Es posible que el espacio liberado por la eliminaci\u00f3n de la tabla no se haya reflejado en el tablespace inmediatamente despu\u00e9s de la eliminaci\u00f3n debido a que Oracle no libera de forma autom\u00e1tica el espacio ocupado por las tablas eliminadas. </p> <p>Oracle utiliza un mecanismo llamado \"asignaci\u00f3n en bloques\" que reserva bloques de espacio en el tablespace para una tabla y, aunque la tabla se elimine, los bloques asignados a ella pueden continuar ocupados hasta que se necesiten para nuevos datos.</p> <p>Para liberar de forma expl\u00edcita el espacio ocupado por las tablas eliminadas en el tablespace, puedes ejecutar el comando SHRINK SPACE en la base de datos. Sin embargo, tenga en cuenta que este proceso puede ser costoso y requiere una cantidad significativa de recursos. </p> <p>Por lo tanto, solo se recomienda ejecutar este comando cuando sea necesario y despu\u00e9s de haber evaluado cuidadosamente sus posibles impactos en el rendimiento de la base de datos.</p> <p>3- Convierte a TS1 en un tablespace de s\u00f3lo lectura.</p> <pre><code>SQL&gt; ALTER TABLESPACE TS1 READ ONLY;\nTablespace modificado.\n</code></pre> <p>Este comando hace que el tablespace TS1 sea de s\u00f3lo lectura, lo que significa que los usuarios no podr\u00e1n realizar ninguna operaci\u00f3n de escritura en las tablas almacenadas en ese tablespace. Sin embargo, todav\u00eda podr\u00e1n leer los datos almacenados en ese tablespace.</p> <p>Hay que tener en cuenta que para convertir un tablespace en s\u00f3lo lectura, todas las tablas en ese tablespace deben estar cerradas y no deben estar siendo accedidas por ning\u00fan proceso en el sistema.</p> <p>Intenta insertar registros en la tabla existente. </p> <pre><code>SQL&gt; INSERT INTO tabla2 (id, descripcion, valor) VALUES (2, 'Registro 2', 143.45);\nERROR en linea 1:\nORA-00372: el archivo 14 no se puede modificar en este momento\nORA-01110: archivo de datos 14: '/opt/oracle/product/19c/dbhome_1/dbs/TS1.dbf'\n</code></pre> <p>\u00bfQu\u00e9 ocurre?</p> <p>Si intentamos insertar un registro en una tabla que se encuentra en un tablespace que se ha convertido en s\u00f3lo lectura, recibir\u00e1s un error indicando que el tablespace es de s\u00f3lo lectura y no se pueden realizar operaciones de escritura en el mismo. </p> <p>Esto significa que los datos en el tablespace no se pueden modificar o insertar nuevos datos.</p> <p>Intenta ahora borrar la tabla:</p> <pre><code>SQL&gt; drop table tabla2;\nTabla borrada.\n</code></pre> <p>\u00bfQu\u00e9 ocurre?</p> <p>Que he eliminado la tabla 'tabla2'.</p> <p>\u00bfPorqu\u00e9 crees que pasa eso?</p> <p>Puede ser debido a que estamos utilizando una versi\u00f3n m\u00e1s reciente de Oracle que permite esta acci\u00f3n. </p> <p>En versiones anteriores de Oracle, los tablespaces de s\u00f3lo lectura no permit\u00edan realizar operaciones de escritura, incluyendo la eliminaci\u00f3n de tablas. Sin embargo, en versiones m\u00e1s recientes, Oracle ha mejorado la gesti\u00f3n de los tablespaces de s\u00f3lo lectura y es posible que permitan realizar ciertas operaciones de escritura, como la eliminaci\u00f3n de tablas.</p> <p>4- Crea un espacio de tablas TS2 con dos ficheros en rutas diferentes de 1M cada uno no autoextensibles. </p> <pre><code>SQL&gt; CREATE TABLESPACE TS2\nDATAFILE '/home/oracle/ts21/ts2_1.dbf' SIZE 1M,\n'/home/oracle/ts22/ts2_2.dbf' SIZE 1M\nEXTENT MANAGEMENT LOCAL\nSEGMENT SPACE MANAGEMENT AUTO;\nTablespace creado.\n</code></pre> <p>Crea en el citado tablespace una tabla con la clausula de almacenamiento que quieras.</p> <pre><code>SQL&gt; CREATE TABLE employees (\nid NUMBER(10),\nname VARCHAR2(50),\ndepartment VARCHAR2(30),\nsalary NUMBER(10,2)\n)\nSTORAGE (\nINITIAL 10K\nNEXT 10K\nMINEXTENTS 2\nMAXEXTENTS UNLIMITED\nPCTINCREASE 0\n)\nTABLESPACE ts2;\nTabla creada.\n</code></pre> <p>Inserta registros hasta que se llene el tablespace. </p> <pre><code>SQL&gt; DECLARE\nv_count NUMBER := 0;\nBEGIN\nLOOP\nv_count := v_count + 1;\nINSERT INTO employees (id, name, department, salary)\nVALUES (v_count, 'Employee ' || v_count, 'Department ' || v_count, 1000 * v_count);\nEXIT WHEN v_count = 1000;\nEND LOOP;\nCOMMIT;\nEXCEPTION\nWHEN OTHERS THEN\nDBMS_OUTPUT.PUT_LINE('Error: ' || SQLERRM);\nEND;\n/ Procedimiento PL/SQL terminado correctamente.\n</code></pre> <p>\u00bfQu\u00e9 ocurre?</p> <p>Lo que ocurre depende de varios factores, como la configuraci\u00f3n y el tama\u00f1o de su base de datos, la cantidad de espacio disponible en el disco duro y la configuraci\u00f3n del espacio de tablas.</p> <p>Si el espacio de tablas no est\u00e1 lleno, el bucle seguir\u00e1 insertando registros hasta que se alcance el n\u00famero especificado de registros o hasta que se produzca un error.</p> <p>Si el espacio de tablas est\u00e1 lleno, se producir\u00e1 un error y el bucle se detendr\u00e1. En el ejemplo proporcionado, el error se maneja en el bloque EXCEPTION y se imprime en la salida.</p> <p>Es importante monitorear regularmente el uso de espacio de tablas para evitar problemas de rendimiento y errores debido a la falta de espacio. </p> <p>Tambi\u00e9n es recomendable tener una pol\u00edtica de gesti\u00f3n de espacio de tablas para prevenir la falta de espacio y garantizar la integridad de los datos.</p> <p>El bucle LOOP se ejecutar\u00e1 hasta que se hayan insertado 1000 registros o hasta que se produzca un error. Cada registro se inserta en la tabla \"EMPLOYEES\" con un ID incremental, un nombre generado, un departamento generado y un salario generado. </p> <p>El bloque EXCEPTION maneja cualquier error que pueda ocurrir durante la ejecuci\u00f3n del bucle.</p> <p>5- Hacer un procedimiento llamado MostrarUsuariosporTablespace que muestre por pantalla un listado de los tablespaces existentes con la lista de usuarios que tienen asignado cada uno de ellos por defecto y el n\u00famero de los mismos, as\u00ed:</p> <pre><code>Tablespace xxxx:\n\n    Usr1\n    Usr2\n    ...\n\nTotal Usuarios Tablespace xxxx: n1\n\nTablespace yyyy:\n\n    Usr1\n    Usr2\n    ...\n\nTotal Usuarios Tablespace yyyy: n2\n....\nTotal Usuarios BD: nn\n</code></pre> <p>No olvides incluir los tablespaces temporales y de undo.</p> <p>Primero, he dividido el codigo en tres procedimientos, el primero que debemos ejecutar, es el que nos muestra \"Total Usuarios BD\":</p> <pre><code>SQL&gt; CREATE OR REPLACE PROCEDURE MostrarUsuariosporBD AS\n2    CURSOR c_us IS SELECT username FROM dba_users;\n3    v_cont NUMBER := 0;\n4  BEGIN\n5    FOR r_us IN c_us LOOP\n6      v_cont := v_cont + 1;\n7    END LOOP;\n8    DBMS_OUTPUT.PUT_LINE('Total Usuarios BD: ' || v_cont);\n9  END MostrarUsuariosporBD;\n10  /\nPROCEDURE created.\nCommit complete.\n</code></pre> <p>El segundo, nos muestra \"Total Usuarios Tablespace\":</p> <pre><code>SQL&gt; CREATE OR REPLACE PROCEDURE MostrarUsuariosporTablespaceTS (v_ts_name VARCHAR2) AS\n2    CURSOR c_us IS\n3      SELECT username FROM dba_ts_quotas WHERE tablespace_name = v_ts_name\n4        UNION\n5      SELECT username FROM dba_users WHERE default_tablespace = v_ts_name ORDER BY username;\n6    v_cont NUMBER := 0;\n7  BEGIN\n8    DBMS_OUTPUT.PUT_LINE('Tablespace ' || v_ts_name || ':');\n9    FOR r_us IN c_us LOOP\n10      DBMS_OUTPUT.PUT_LINE('    ' || r_us.username);\n11      v_cont := v_cont + 1;\n12    END LOOP;\n13    DBMS_OUTPUT.PUT_LINE('Total Usuarios Tablespace ' || v_ts_name || ': ' || v_cont);\n14  END MostrarUsuariosporTablespaceTS;\n15  /\nPROCEDURE created.\nCommit complete.\n</code></pre> <p>Y el \u00faltimo procedimiento es el final, el cual nos ense\u00f1ar\u00e1 el informe al completo:</p> <pre><code>SQL&gt; CREATE OR REPLACE PROCEDURE MostrarUsuariosporTablespace AS\n2    CURSOR c_ts IS\n3      SELECT DISTINCT tablespace_name FROM (SELECT tablespace_name FROM dba_ts_quotas UNION SELECT default_tablespace AS tablespace_name FROM dba_users);\n4    v_ts_name VARCHAR2(30);\n5    v_undo VARCHAR2(30);\n6  BEGIN\n7    SELECT value into v_undo FROM v$parameter WHERE name = 'undo_tablespace';\n8    FOR r_ts IN c_ts LOOP\n9      v_ts_name := r_ts.tablespace_name;\n10      MostrarUsuariosporTablespaceTS(v_ts_name);\n11    END LOOP;\n12    MostrarUsuariosporTablespaceTS('TEMP');\n13    MostrarUsuariosporTablespaceTS(v_undo);\n14    MostrarUsuariosporBD;\n15  END MostrarUsuariosporTablespace;\n16  /\nPROCEDURE created.\nCommit complete.\n</code></pre> <p>Posteriormente, lo ejecutamos y comprobamos que funciona:</p> <pre><code>SQL&gt; exec MostrarUsuariosporTablespace;\nTablespace SYSAUX:\nAPPQOSSYS\nAUDSYS\nDBSFWUSER\nGGSYS\nGSMADMIN_INTERNAL\nMDSYS\nOLAPSYS\nTotal Usuarios Tablespace SYSAUX: 7\nTablespace SYSTEM:\nLBACSYS\nMDSYS\nOUTLN\nSYSTEM\nXS$NULL\nTotal Usuarios Tablespace SYSTEM: 5\nTablespace TS2:\nANONYMOUS\nAPPQOSSYS\nAUDSYS\nC###JOSEJU10\nCTXSYS\nDBSFWUSER\nDBSNMP\nDIP\nDVF\nDVSYS\nEXAMENPLSQL\nGGSYS\nGSMADMIN_INTERNAL\nGSMCATUSER\nGSMROOTUSER\nGSMUSER\nHIPODROMO\nJOSEJU\nJUVENIL\nLBACSYS\nMDDATA\nMDSYS\nOJVMSYS\nOLAPSYS\nORACLE_OCM\nORDDATA\nORDPLUGINS\nORDSYS\nOUTLN\nREMOTE_SCHEDULER_AGENT\nSI_INFORMTN_SCHEMA\nSYS\nSYS$UMF\nSYSBACKUP\nSYSDG\nSYSKM\nSYSRAC\nWMSYS\nXDB\nTotal Usuarios Tablespace TS2: 39\nTablespace USERS:\nSCOTT\nTotal Usuarios Tablespace USERS: 1\nTablespace TEMP:\nTotal Usuarios Tablespace TEMP: 0\nTablespace UNDOTBS1:\nTotal Usuarios Tablespace UNDOTBS1: 0\nTotal Usuarios BD: 52\nPL/SQL procedure successfully completed.\nCommit complete.\n</code></pre> <p>6-  Realiza un procedimiento llamado MostrarDetallesIndices que reciba el nombre de una tabla y muestre los detalles sobre los \u00edndices que hay definidos sobre las columnas de la misma.</p> <p>Primero, creamos y compilamos el c\u00f3digo:</p> <pre><code>SQL&gt; CREATE OR REPLACE PROCEDURE MostrarDetallesIndices (p_table_name IN VARCHAR2)\n2  AS\n3    l_nombre_indice   VARCHAR2(30);\n4    l_nombre_columna  VARCHAR2(30);\n5    cursor c_datos is SELECT index_name, column_name FROM user_ind_columns WHERE table_name = p_table_name;\n6  BEGIN\n7    FOR i IN c_datos LOOP\n8      l_nombre_indice := i.index_name;\n9      l_nombre_columna := i.column_name;\n10      DBMS_OUTPUT.PUT_LINE('Nombre \u00cdndice: ' || RPAD(l_nombre_indice, 20) || 'Nombre columna: ' || RPAD(l_nombre_columna, 20));\n11    END LOOP;\n12  END MostrarDetallesIndices;\n13  /\nPROCEDURE created.\nCommit complete.\n</code></pre> <p>Posteriormente, lo ejecutamos y comprobamos que funciona:</p> <pre><code>SQL&gt; exec MostrarDetallesIndices('C_RG#');\nNombre \u00cdndice: I_RG#               Nombre columna: REFGROUP\nPL/SQL procedure successfully completed.\nCommit complete.\n</code></pre>"},{"location":"p6-almacenamiento/ri/alumno2/#postgres","title":"Postgres:","text":"<p>7-  Averigua si existe el concepto de segmento y el de extensi\u00f3n en Postgres, en qu\u00e9 consiste y las diferencias con los conceptos correspondientes de ORACLE.</p> <p>En PostgreSQL, el concepto de segmento se refiere a una porci\u00f3n de una tabla o \u00edndice que es almacenada en un archivo espec\u00edfico en el sistema de archivos. Los segmentos son utilizados para dividir una tabla o \u00edndice en varios archivos, lo que permite un mejor manejo de la memoria y mejora el rendimiento al realizar operaciones de lectura y escritura.</p> <p>La extensi\u00f3n en PostgreSQL es un concepto relacionado con el manejo de espacio en disco. Una extensi\u00f3n es un conjunto de objetos de base de datos, como tablas o vistas, que son agrupados juntos para facilitar su manejo y administraci\u00f3n.</p> <p>En Oracle, el concepto de segmento se refiere a una porci\u00f3n de una tabla, \u00edndice o cl\u00faster que es almacenada en una extensi\u00f3n de una tabla. Los segmentos son utilizados para dividir una tabla en varios archivos, lo que permite un mejor manejo de la memoria y mejora el rendimiento al realizar operaciones de lectura y escritura.</p> <p>En resumen, el concepto de segmento en PostgreSQL se refiere a una divisi\u00f3n de una tabla o \u00edndice en varios archivos, mientras que en Oracle se refiere a una divisi\u00f3n de una tabla, \u00edndice o cl\u00faster en varios archivos. </p> <p>En cuanto a la extensi\u00f3n, en PostgreSQL es utilizado para agrupar objetos de base de datos para facilitar su manejo y administraci\u00f3n, mientras que en Oracle se refiere a una extensi\u00f3n de una tabla.</p>"},{"location":"p6-almacenamiento/ri/alumno2/#mysql","title":"MySQL:","text":"<p>8- Averigua si existe el concepto de espacio de tablas en MySQL y las diferencias con los tablespaces de ORACLE.</p> <p>S\u00ed, existe el concepto de espacio de tablas en MySQL. Un espacio de tablas es un conjunto de archivos de tablas que se almacenan en el sistema de archivos del servidor. </p> <p>Los esquemas de base de datos en MySQL se dividen en espacios de tablas. Cada espacio de tablas contiene un conjunto de tablas.</p> <p>En Oracle, un tablespace es una estructura l\u00f3gica que se utiliza para agrupar objetos relacionales de la base de datos, como tablas y \u00edndices. Los tablespaces se crean y administran utilizando el comando \"CREATE TABLESPACE\" en SQL.</p> <p>En resumen, ambos conceptos permiten agrupar objetos relacionales de la base de datos, pero en MySQL se llama espacio de tablas y en ORACLE se llama tablespaces.</p>"},{"location":"p6-almacenamiento/ri/alumno2/#mongodb","title":"MongoDB:","text":"<p>9- Averigua si existe la posibilidad en MongoDB de decidir en qu\u00e9 archivo se almacena una colecci\u00f3n.</p> <p>S\u00ed, en MongoDB existe la posibilidad de decidir en qu\u00e9 archivo se almacena una colecci\u00f3n mediante el uso de shard keys y shard collections.</p> <p>La caracter\u00edstica de sharding de MongoDB permite dividir una colecci\u00f3n en varios fragmentos llamados shards, y distribuirlos en diferentes servidores o instancias. Cada shard es una instancia independiente de MongoDB que contiene un subconjunto de los datos de la colecci\u00f3n original.</p> <p>Un shard key es un \u00edndice que se utiliza para determinar en qu\u00e9 shard se almacenar\u00e1n los documentos de una colecci\u00f3n. </p> <p>Por ejemplo, si se elige un shard key basado en el campo \"pa\u00eds\", los documentos con \"pa\u00eds\" = \"Espa\u00f1a\" se almacenar\u00e1n en un shard y los documentos con \"pa\u00eds\" = \"Francia\" se almacenar\u00e1n en otro shard.</p> <p>En resumen, en MongoDB, a trav\u00e9s del uso de shard keys y shard collections se puede decidir en qu\u00e9 archivo se almacena una colecci\u00f3n, permitiendo una mejor distribuci\u00f3n de los datos y un mejor rendimiento en grandes vol\u00famenes de datos.</p>"},{"location":"p6-almacenamiento/ri/alumno3/","title":"Alumno 3","text":""},{"location":"p6-almacenamiento/ri/alumno3/#oracle","title":"ORACLE:","text":""},{"location":"p6-almacenamiento/ri/alumno3/#1-muestra-los-objetos-a-los-que-pertenecen-las-extensiones-del-tablespace-ts2-creado-por-alumno-2-y-el-tamano-de-cada-una-de-ellas","title":"1. Muestra los objetos a los que pertenecen las extensiones del tablespace TS2 (creado por Alumno 2) y el tama\u00f1o de cada una de ellas.","text":"<pre><code>SELECT segment_name, segment_type, extent_id, bytes\nFROM dba_extents\nWHERE tablespace_name = 'TS2';\n</code></pre>"},{"location":"p6-almacenamiento/ri/alumno3/#2-borra-la-tabla-que-esta-llenando-ts2-consiguiendo-que-vuelvan-a-existir-extensiones-libres-anade-despues-otro-fichero-de-datos-a-ts2","title":"2. Borra la tabla que est\u00e1 llenando TS2 consiguiendo que vuelvan a existir extensiones libres. A\u00f1ade despu\u00e9s otro fichero de datos a TS2.","text":"<p>Utilizamos TRUNCATE para borrar los datos de la tabla employee pero mantener su estructura.</p> <pre><code>truncate table employees;\n</code></pre> <p>A\u00f1adimos otro dichero de datos a TS2.</p> <pre><code>alter tablespace ts2 add datafile '/home/usuario/ts23/ts2_3.dbf' size 1M;\n</code></pre> <p></p>"},{"location":"p6-almacenamiento/ri/alumno3/#3-crea-el-tablespace-ts3-gestionado-localmente-con-un-tamano-de-extension-uniforme-de-128k-y-un-fichero-de-datos-asociado-cambia-la-ubicacion-del-fichero-de-datos-y-modifica-la-base-de-datos-para-que-pueda-acceder-al-mismo-crea-en-ts3-dos-tablas-e-inserta-registros-en-las-mismas-comprueba-que-segmentos-tiene-ts3-que-extensiones-tiene-cada-uno-de-ellos-y-en-que-ficheros-se-encuentran","title":"3. Crea el tablespace TS3 gestionado localmente con un tama\u00f1o de extension uniforme de 128K y un fichero de datos asociado. Cambia la ubicaci\u00f3n del fichero de datos y modifica la base de datos para que pueda acceder al mismo. Crea en TS3 dos tablas e inserta registros en las mismas. Comprueba que segmentos tiene TS3, qu\u00e9 extensiones tiene cada uno de ellos y en qu\u00e9 ficheros se encuentran.","text":"<p>En el home de mi usuario:</p> <pre><code>mkdir ts23\nsudo chown oracle: ts23/\n</code></pre> <p>Creamos el tablespace TS3.</p> <pre><code>create tablespace ts3 datafile '/home/usuario/ts23/ts3.dbf' size 1M extent management local uniform size 128K;\n</code></pre> <p>Ponemos el tablespaces offline:</p> <pre><code>ALTER TABLESPACE ts3 OFFLINE NORMAL;\n</code></pre> <p>Cambiamos la ubicaci\u00f3n del fichero de datos desde la terminal a la carpeta ts21.</p> <pre><code>sudo mv ts23/ts3.dbf ts22/\n</code></pre> <p>Usamos ALTER TABLESPACE con RENAME DATAFILE para cambiar la ubicaci\u00f3n en la que se encuentra el fichero de datos.</p> <pre><code>alter tablespace ts3\nrename datafile '/home/usuario/ts23/ts3.dbf'\nto '/home/usuario/ts22/ts3.dbf';\n</code></pre> <p>Activamos el tablespace.</p> <pre><code>ALTER TABLESPACE ts3 ONLINE;\n</code></pre> <p>Creamos dos tablas e insertamos registros.</p> <pre><code>create table tabla1\n(codigo varchar2(15),\nnombre varchar2(15))\ntablespace ts3;\ncreate table tabla2\n(codigo varchar2(15),\nnombre varchar2(15))\ntablespace ts3;\ninsert into tabla1 values ('A1234', 'Pepito');\ninsert into tabla2 values ('B5678', 'Camionero');\n</code></pre> <p>Comprobamos los segmentos que tiene TS3 y las extensiones que tiene cada uno de ellos y en qu\u00e9 ficheros se encuentran.</p> <pre><code>--Comprobar segmentos\nselect owner, segment_name, segment_type, bytes from dba_segments\nwhere tablespace_name = 'TS3';\n</code></pre> <p></p> <pre><code>--Comprobar extensiones de esos segmentos\nselect segment_name, extent_id, bytes, file_id from dba_extents\nwhere segment_name = 'TABLA1' or segment_name = 'TABLA2';\n</code></pre> <p></p> <pre><code>--Comprobar fichero donde se encuentra \nselect file_name from dba_data_files where file_id=19;\n</code></pre> <p></p>"},{"location":"p6-almacenamiento/ri/alumno3/#4-redimensiona-los-ficheros-asociados-a-los-tres-tablespaces-que-has-creado-de-forma-que-ocupen-el-minimo-espacio-posible-para-alojar-sus-objetos","title":"4. Redimensiona los ficheros asociados a los tres tablespaces que has creado de forma que ocupen el m\u00ednimo espacio posible para alojar sus objetos.","text":"<p>Comprobar el espacio utilizado por los datafile de los tablespace.</p> <pre><code>--TS1\nselect segment_name, bytes from dba_segments\nwhere tablespace_name = 'TS1';\nSEGMENT_NAME\n--------------------------------------------------------------------------------\nBYTES\n----------\nLIBROS\n65536\nselect segment_name, extent_id, bytes/1024 as tamano_K, file_id from dba_extents\nwhere segment_name = 'LIBROS';\nSEGMENT_NAME\n--------------------------------------------------------------------------------\nEXTENT_ID   TAMANO_K    FILE_ID\n---------- ---------- ----------\nLIBROS\n0     64         20\nselect file_name from dba_data_files where file_id=20;\nFILE_NAME\n--------------------------------------------------------------------------------\n/home/usuario/ts11/ts1.dbf\n</code></pre> <p>Podemos comprobar que TS1 est\u00e1 utilizando el fichero ts1.dbf (con id 20) y que su tama\u00f1o en K es de 64. Vamos ahora con TS2.</p> <pre><code>--TS2\nselect segment_name, bytes from dba_segments\nwhere tablespace_name = 'TS2';\nSEGMENT_NAME\n--------------------------------------------------------------------------------\nBYTES\n----------\nEMPLOYEES\n65536\nselect segment_name, extent_id, bytes/1024 as tamano_K, file_id from dba_extents\nwhere segment_name = 'EMPLOYEES';\nSEGMENT_NAME\n--------------------------------------------------------------------------------\nEXTENT_ID  TAMANO_K     FILE_ID\n---------- ---------- ----------\nEMPLOYEES\n0          64        16\nselect file_name from dba_data_files where file_id=16;\nFILE_NAME\n--------------------------------------------------------------------------------\n/home/usuario/ts21/ts2_1.dbf\n</code></pre> <p>Podemos comprobar que en TS2 el datafile utilizado para la tabla employees es ts2_1.dbf y su tama\u00f1o de 64K. Por \u00faltimo, vemos TS3.</p> <pre><code>--TS3\n--En el ejercicio anterior pudimos comprobar que el datafile es ts3.dbf y que tiene un tama\u00f1o de 128K cada segmento\nselect segment_name, bytes from dba_segments\nwhere tablespace_name = 'TS3';\nSEGMENT_NAME\n--------------------------------------------------------------------------------\nBYTES\n----------\nTABLA1\n131072\nTABLA2\n131072\nselect segment_name, extent_id, bytes/1024 as tamano_K, file_id from dba_extents\nwhere segment_name = 'TABLA1' or segment_name = 'TABLA2';\nSEGMENT_NAME\n--------------------------------------------------------------------------------\nEXTENT_ID   TAMANO_K    FILE_ID\n---------- ---------- ----------\nTABLA1\n0    128         19\nTABLA2\n0    128         19\nselect file_name from dba_data_files where file_id=19;\nFILE_NAME\n--------------------------------------------------------------------------------\n/home/usuario/ts22/ts3.dbf\n</code></pre> <p>Otra forma de calcularlo m\u00e1s r\u00e1pidamente es como se muestra a continuaci\u00f3n:</p> <pre><code>SELECT tablespace_name, SUM(bytes)/1024 AS size_mb\nFROM dba_segments where tablespace_name='TS1' or tablespace_name='TS2' or tablespace_name='TS3'\nGROUP BY tablespace_name;\nTABLESPACE_NAME           SIZE_MB\n----------------------- ----------\nTS1                          64\nTS3                         256\nTS2                          64\n</code></pre> <p>Por tanto el resultado ser\u00eda:</p> <ul> <li> <p>TS1 (/home/usuario/ts11/ts1.dbf): 64K</p> </li> <li> <p>TS2 (/home/usuario/ts21/ts2_1.dbf): 64K</p> </li> <li> <p>TS3 (/home/usuario/ts22/ts3.dbf): 256K</p> </li> </ul> <p>As\u00ed pues redimensionamos los datafile a esos tama\u00f1os para tener el m\u00ednimo espacio posible para alojar sus objetos.</p> <pre><code>--Quitar solo lectura del fichero de TS1\nALTER TABLESPACE TS1 READ WRITE;\n--Redimensionar fichero de TS1\nalter database datafile '/home/usuario/ts11/ts1.dbf' resize 64K;\n--Redimensionar fichero de TS2\nalter database datafile '/home/usuario/ts21/ts2_1.dbf' resize 64K;\n--Redimensionar fichero de TS3\nalter database datafile '/home/usuario/ts22/ts3.dbf' resize 256K;\n</code></pre>"},{"location":"p6-almacenamiento/ri/alumno3/#5-realiza-un-procedimiento-llamado-informerestricciones-que-reciba-el-nombre-de-una-tabla-y-muestre-los-nombres-de-las-restricciones-que-tiene-a-que-columna-o-columnas-afectan-y-en-que-consisten-exactamente","title":"5. Realiza un procedimiento llamado InformeRestricciones que reciba el nombre de una tabla y muestre los nombres de las restricciones que tiene, a qu\u00e9 columna o columnas afectan y en qu\u00e9 consisten exactamente.","text":"<pre><code>CREATE OR REPLACE PROCEDURE InformeRestricciones (p_tabla user_constraints.table_name%TYPE) IS\nBEGIN\nFOR i IN (SELECT c.constraint_name, c.constraint_type, c.table_name, cc.column_name\nFROM user_constraints c, user_cons_columns cc\nWHERE c.constraint_name = cc.constraint_name\nAND c.table_name = p_tabla)\nLOOP\nDBMS_OUTPUT.PUT_LINE('------------------------------------------------------------');\nDBMS_OUTPUT.PUT_LINE('RESTRICCION: ' || i.constraint_name||CHR(10)||'El tipo de restriccion es \"' || i.constraint_type||'\".'||CHR(10)||'- Pertenece a la tabla \"'|| i.table_name||'\" y afecta a la columna \"' || i.column_name||'\".');\nEND LOOP;\nDBMS_OUTPUT.PUT_LINE('------------------------------------------------------------');\nDBMS_OUTPUT.PUT_LINE('Los tipos de restricciones son los siguientes:'||CHR(10)||CHR(9)||'C: Check constraint'||CHR(10)||CHR(9)||'F: Foreign key constraint'||CHR(10)||CHR(9)||'P: Primary key constraint'||CHR(10)||CHR(9)||'R: Referential integrity constraint (equivalente a una restriccion foreign_key)'||CHR(10)||CHR(9)||'U: Unique key constraint');\nEND;\n/\n</code></pre> <p>Comprobaci\u00f3n:</p> <pre><code>exec InformeRestricciones('EMP');\n------------------------------------------------------------\nRESTRICCION: FK_CLUSTER_DEPTNO\nEl tipo de restriccion es \"R\".\n- Pertenece a la tabla \"EMP\" y afecta a la columna \"DEPTNO\".\n------------------------------------------------------------\nRESTRICCION: PK_CLUSTER_EMP\nEl tipo de restriccion es \"P\".\n- Pertenece a la tabla \"EMP\" y afecta a la columna \"EMPNO\".\n------------------------------------------------------------\nLos tipos de restricciones son los siguientes:\nC: Check constraint\nF: Foreign key constraint\nP: Primary key constraint\nR: Referential integrity constraint (equivalente a una restriccion foreign_key)\nU: Unique key constraint\nProcedimiento PL/SQL terminado correctamente.\n</code></pre>"},{"location":"p6-almacenamiento/ri/alumno3/#6-realiza-un-procedimiento-llamado-mostraralmacenamientousuario-que-reciba-el-nombre-de-un-usuario-y-devuelva-el-espacio-que-ocupan-sus-objetos-agrupando-por-dispositivos-y-archivos","title":"6. Realiza un procedimiento llamado MostrarAlmacenamientoUsuario que reciba el nombre de un usuario y devuelva el espacio que ocupan sus objetos agrupando por dispositivos y archivos:","text":"<pre><code>                Usuario: NombreUsuario\n\n                    Dispositivo:xxxx\n\n                        Archivo: xxxxxxx.xxx\n\n                                Tabla1......nnn K\n                                \u2026\n                                TablaN......nnn K\n                                Indice1.....nnn K\n                                \u2026\n                                IndiceN.....nnn K\n\n                        Total Espacio en Archivo xxxxxxx.xxx: nnnnn K\n\n                        Archivo:...\n                        \u2026\n\n                    Total Espacio en Dispositivo xxxx: nnnnnn K\n\n                    Dispositivo: yyyy\n                    \u2026\n\n                Total Espacio Usuario en la BD: nnnnnnn K\n</code></pre>"},{"location":"p6-almacenamiento/ri/alumno3/#postgres","title":"Postgres:","text":""},{"location":"p6-almacenamiento/ri/alumno3/#7-averigua-si-es-posible-establecer-cuotas-de-uso-sobre-los-tablespaces-en-postgres","title":"7. Averigua si es posible establecer cuotas de uso sobre los tablespaces en Postgres.","text":"<p>PostgreSQL permite crear tablespaces pero de una forma m\u00e1s sencilla que en Oracle o MySQL. Muchas de las opciones que encontramos en Oracle a la hora de crear los tablespaces no existen en PostgreSQL. Por ejemplo en PostgreSQL no podemos establecer un tama\u00f1o m\u00e1ximo al datafile. No tendremos ninguna opci\u00f3n para asignar cuotas de almacenamiento. La \u00fanica forma de controlar el espacio es utilizando algunas funciones de PostgreSQL para comprobar el tama\u00f1o ocupado por objetos de la base de datos. Por ejemplo, la funci\u00f3n pg_total_relation_size() nos dir\u00e1 el tama\u00f1o que ocupa una tabla de la base de datos.</p> <pre><code>--Ver el tama\u00f1o de la tabla pel\u00edcula con la funci\u00f3n pg_total_relation_size() y con la funci\u00f3n pg_size_pretty() para que se vea el resultado mejorado en KB\nmaravilla=# SELECT pg_size_pretty(pg_total_relation_size('pelicula'));\npg_size_pretty ----------------\n24 kB\n(1 fila)\n</code></pre>"},{"location":"p6-almacenamiento/ri/alumno3/#mysql","title":"MySQL:","text":""},{"location":"p6-almacenamiento/ri/alumno3/#8-averigua-si-existe-el-concepto-de-extension-en-mysql-y-si-coincide-con-el-existente-en-oracle","title":"8. Averigua si existe el concepto de extensi\u00f3n en MySQL y si coincide con el existente en ORACLE.","text":"<p>S\u00ed existe el concepto de extensi\u00f3n en MySQL. En MySQL el t\u00e9rmino \"extent\" se utiliza en el contexto de InnoDB para referirse a un grupo de p\u00e1ginas dentro de un tablespace. Cada extent en InnoDB tiene un tama\u00f1o fijo y contiene un n\u00famero fijo de p\u00e1ginas, seg\u00fan la configuraci\u00f3n de tama\u00f1o de p\u00e1gina de InnoDB y el tama\u00f1o de la extensi\u00f3n.</p> <p>En InnoDB, el tama\u00f1o de la extensi\u00f3n se define como 1 MB para los tama\u00f1os de p\u00e1gina de 4 KB, 8 KB y 16 KB, y aumenta a medida que aumenta el tama\u00f1o de la p\u00e1gina. Por ejemplo, para un tama\u00f1o de p\u00e1gina de 32 KB, el tama\u00f1o de la extensi\u00f3n es de 2 MB, y para un tama\u00f1o de p\u00e1gina de 64 KB, el tama\u00f1o de la extensi\u00f3n es de 4 MB.</p> <p>Las operaciones de E/S en InnoDB est\u00e1n dise\u00f1adas para trabajar con extensiones, lo que significa que se leen, escriben, asignan o liberan datos una extensi\u00f3n a la vez. Esto mejora la eficiencia de E/S y reduce la fragmentaci\u00f3n del tablespace.</p> <p>MySQL no utiliza el t\u00e9rmino \"extent\" en el mismo contexto que Oracle. En Oracle, el t\u00e9rmino \"extent\" se refiere a una porci\u00f3n de un tablespace que se utiliza para almacenar segmentos de la base de datos, como tablas, \u00edndices y otros objetos. En Oracle, cada extent tiene un tama\u00f1o fijo y se utiliza para almacenar un segmento espec\u00edfico. Cuando un segmento de la base de datos crece y no hay m\u00e1s espacio disponible en su extent actual, se asigna un nuevo extent para el segmento.</p> <p>Por tanto, aunque ambos conceptos se refieren a porciones de almacenamiento utilizadas para almacenar objetos de la base de datos, la implementaci\u00f3n de los t\u00e9rminos \"extent\" en MySQL y Oracle son diferentes.</p>"},{"location":"p6-almacenamiento/ri/alumno3/#mongodb","title":"MongoDB:","text":""},{"location":"p6-almacenamiento/ri/alumno3/#9-averigua-si-en-mongodb-puede-saberse-el-espacio-disponible-para-almacenar-nuevos-documentos","title":"9. Averigua si en MongoDB puede saberse el espacio disponible para almacenar nuevos documentos.","text":"<p>Para obtener informaci\u00f3n sobre el espacio disponible en un servidor MongoDB podemos utilizar el comando db.stats(). Este comando devuelve una serie de estad\u00edsticas sobre una base de datos, incluyendo el tama\u00f1o total de la base de datos, el espacio utilizado por la base de datos, y el espacio disponible para la base de datos.</p> <p>Se pueden utilizar los par\u00e1metros scale y freeStorage para ver, respectivamente, los resultados en KB (poniendo el valor en 1024) y el espacio libre para las colecciones de la base de datos (poniendo el valor en 1).</p> <pre><code>maravilla&gt; db.stats( { freeStorage: 1, scale: 1024 } )\n{\ndb: 'maravilla',\ncollections: 5,\nviews: 0,\nobjects: 19,\navgObjSize: 73.21052631578948,\ndataSize: 1.3583984375,\nstorageSize: 68,\nfreeStorageSize: 0,\nindexes: 5,\nindexSize: 68,\nindexFreeStorageSize: 0,\ntotalSize: 136,\ntotalFreeStorageSize: 0,\nscaleFactor: 1024,\nfsUsedSize: 34825072,\nfsTotalSize: 39987708,\nok: 1\n}\n</code></pre>"},{"location":"p6-almacenamiento/ri/alumno4/","title":"Alumno 4","text":""},{"location":"p6-almacenamiento/ri/alumno4/#oracle","title":"Oracle","text":""},{"location":"p6-almacenamiento/ri/alumno4/#ejercicio-1","title":"Ejercicio 1","text":"<p>Crear un tablespace de <code>UNDO</code></p> <pre><code>CREATE UNDO TABLESPACE UNDO\nDATAFILE 'undo.dbf' SIZE 500M\nAUTOEXTEND ON;\nTablespace created.\n</code></pre> <p>Intentar crear una tabla en \u00e9l</p> <pre><code>CREATE TABLE undo_table_test(\nid NUMBER GENERATED BY DEFAULT AS IDENTITY,\nfirst_name VARCHAR2(50) NOT NULL,\nPRIMARY KEY(id)\n)\nTABLESPACE UNDO;\nCREATE TABLE undo_table_test(\n*\nERROR at line 1:\nORA-30022: Cannot create segments in undo tablespace\n</code></pre> <p>No se pueden crear tablas manualmente en tablespaces de UNDO, ya que se usan exclusivamente para rollback, y esto es algo que maneja autom\u00e1ticamente Oracle.</p>"},{"location":"p6-almacenamiento/ri/alumno4/#ejercicio-2","title":"Ejercicio 2","text":"<p>Crear un tablespace temporal llamado <code>TEMP2</code></p> <pre><code>CREATE TEMPORARY TABLESPACE TEMP2 TEMPFILE 'temporary2.dbf' SIZE 5M;\nTablespace created.\n</code></pre> <p>Escribir un <code>SELECT</code> que genere un script que haga usar <code>TEMP2</code> a todos los usuarios que tienen <code>USERS</code> como tablespace por defecto</p> <pre><code>SELECT 'ALTER USER ' || USERNAME || ' TEMPORARY TABLESPACE TEMP2;' AS Script\nFROM DBA_USERS\nWHERE DEFAULT_TABLESPACE = 'USERS';\n</code></pre> <pre><code>SCRIPT\n-----------------------------------------------------------------------------------------------------------------------------------------------------------------------\nALTER USER GSMCATUSER TEMPORARY TABLESPACE TEMP2;\nALTER USER MDDATA TEMPORARY TABLESPACE TEMP2;\nALTER USER BECARIO TEMPORARY TABLESPACE TEMP2;\nALTER USER SYSBACKUP TEMPORARY TABLESPACE TEMP2;\nALTER USER REMOTE_SCHEDULER_AGENT TEMPORARY TABLESPACE TEMP2;\nALTER USER USRPRACTICA1 TEMPORARY TABLESPACE TEMP2;\nALTER USER GSMUSER TEMPORARY TABLESPACE TEMP2;\nALTER USER SYSRAC TEMPORARY TABLESPACE TEMP2;\nALTER USER GSMROOTUSER TEMPORARY TABLESPACE TEMP2;\nALTER USER SI_INFORMTN_SCHEMA TEMPORARY TABLESPACE TEMP2;\nALTER USER AUDSYS TEMPORARY TABLESPACE TEMP2;\nALTER USER EXAMENBD34 TEMPORARY TABLESPACE TEMP2;\nALTER USER DIP TEMPORARY TABLESPACE TEMP2;\nALTER USER ORDPLUGINS TEMPORARY TABLESPACE TEMP2;\nALTER USER TESTING TEMPORARY TABLESPACE TEMP2;\nALTER USER SYSKM TEMPORARY TABLESPACE TEMP2;\nALTER USER ORDDATA TEMPORARY TABLESPACE TEMP2;\nALTER USER ORACLE_OCM TEMPORARY TABLESPACE TEMP2;\nALTER USER SCOTT TEMPORARY TABLESPACE TEMP2;\nALTER USER HIPODROMO TEMPORARY TABLESPACE TEMP2;\nALTER USER SYSDG TEMPORARY TABLESPACE TEMP2;\nALTER USER ORDSYS TEMPORARY TABLESPACE TEMP2;\n</code></pre>"},{"location":"p6-almacenamiento/ri/alumno4/#ejercicio-3","title":"Ejercicio 3","text":"<p>Borrar todos los tablespaces creados sin que quede rastro de ellos. Realizar las acciones previas que sean necesarias</p> <pre><code>DROP TABLESPACE UNDO INCLUDING CONTENTS AND DATAFILES;\nTablespace dropped.\nDROP TABLESPACE TEMP2 INCLUDING CONTENTS AND DATAFILES;\nTablespace dropped.\n</code></pre>"},{"location":"p6-almacenamiento/ri/alumno4/#ejercicio-4","title":"Ejercicio 4","text":"<p>Averiguar los segmentos existentes para realizar un ROLLBACK y el tama\u00f1o de sus extents</p> <pre><code>SELECT r.segment_name,r.tablespace_name,r.status,e.extent_id,e.bytes\nFROM DBA_ROLLBACK_SEGS r\nINNER JOIN DBA_EXTENTS e\nON r.segment_name = e.segment_name;\n</code></pre> <p>El output es largo, as\u00ed que s\u00f3lo muestro un fragmento:</p> <p></p> <p>En el recuadro marco un segmento de ejemplo, con todos sus extents y respectivos tama\u00f1os.</p> <p>Cada registro es un extent dentro de dicho segmento, y esto queda claro al ver la numeraci\u00f3n de los extents consecutivos.</p>"},{"location":"p6-almacenamiento/ri/alumno4/#ejercicio-5","title":"Ejercicio 5","text":""},{"location":"p6-almacenamiento/ri/alumno4/#51-enunciado","title":"5.1 Enunciado","text":"<p>Hacer un procedimiento llamado <code>MostrarUsuariosAccesoTS</code> que liste usuarios que tienen permisos de lectura (select) o escritura (insert,update,delete) a cualquiera de los objetos almacenados en el tablespace indicado</p>"},{"location":"p6-almacenamiento/ri/alumno4/#52-codigo","title":"5.2 C\u00f3digo","text":"<pre><code>CREATE OR REPLACE PROCEDURE comprobar_privilegios(\np_usuario IN DBA_USERS.username%TYPE,\np_tablespace IN DBA_TABLES.tablespace_name%TYPE,\np_control OUT BOOLEAN\n) AS\nCURSOR c_lista_privilegios IS\nSELECT *\nFROM DBA_TAB_PRIVS\nWHERE grantee = p_usuario\nOR grantee IN (\nSELECT granted_role\nFROM DBA_ROLE_PRIVS\nCONNECT BY PRIOR granted_role = grantee START WITH grantee = p_usuario\n)\nORDER BY 1,2,3,4;\nvn_contador NUMBER := 0;\nvn_objeto_en_tablespace NUMBER;\nBEGIN\nFOR i IN c_lista_privilegios LOOP\nIF i.privilege IN ('SELECT','INSERT','UPDATE','DELETE') THEN\nSELECT COUNT(*) INTO vn_objeto_en_tablespace\nFROM DBA_TABLES\nWHERE owner = i.owner\nAND table_name = i.table_name\nAND tablespace_name = p_tablespace;\nIF vn_objeto_en_tablespace = 1 THEN\nvn_contador := vn_contador + 1;\nvn_objeto_en_tablespace := 0;\nEND IF;\nEND IF;\nEND LOOP;\nIF vn_contador &gt; 0 THEN\np_control := TRUE;\nELSE\np_control := FALSE;\nEND IF;\nEND;\n/\n-- (1)!\n</code></pre> <ol> <li>Este es el procedimiento hijo, aqu\u00ed se comprueban los privilegios del usuario, y se comprueba si los objetos sobre los que tiene privilegios est\u00e1n en el tablespace que se busca</li> </ol> <pre><code>CREATE OR REPLACE PROCEDURE MostrarUsuariosAccesoTS(\np_nombre_tablespace IN VARCHAR2\n) AS\nCURSOR c_usuarios IS\nSELECT username\nFROM DBA_USERS;\nvb_control BOOLEAN;\nBEGIN\nFOR i IN c_usuarios LOOP\ncomprobar_privilegios(i.username,p_nombre_tablespace,vb_control);\nIF vb_control THEN\nDBMS_OUTPUT.PUT_LINE('El usuario ' || i.username || ' tiene acceso en el tablespace ' || p_nombre_tablespace);\nEND IF;\nEND LOOP;\nEND;\n/\n-- (1)!\n</code></pre> <ol> <li>Este es el procedimmiento padre, y aqu\u00ed es donde sucede el loop de usuarios. Se mandan ciertos par\u00e1metros al hijo para comprobar si tiene alguno de los privilegios que se buscan sobre objetos en el tablespace indicado.</li> </ol>"},{"location":"p6-almacenamiento/ri/alumno4/#53-comprobaciones","title":"5.3 Comprobaciones","text":"<p>Muestro la ejecuci\u00f3n y el resultado:</p> <pre><code>EXEC MostrarUsuariosAccesoTS('USERS');\nEl usuario SYS tiene acceso en el tablespace USERS\nEl usuario EXAMENBD34 tiene acceso en el tablespace USERS\nEl usuario HIPODROMO tiene acceso en el tablespace USERS\nEl usuario ORDSYS tiene acceso en el tablespace USERS\nEl usuario USRPRACTICA1 tiene acceso en el tablespace USERS\nPL/SQL procedure successfully completed.\n</code></pre> <p>Para comprobar que los resultados son correctos, puedo tomar de prueba al usuario <code>HIPODROMO</code>.</p> <p>Siguiendo la l\u00f3gica de estos procedimientos, puedo por ejemplo primero mostrar el listado completo de privilegios que tiene <code>HIPODROMO</code>:</p> <pre><code>SELECT grantee,owner,table_name,privilege\nFROM DBA_TAB_PRIVS\nWHERE grantee = 'HIPODROMO'\nOR grantee IN (\nSELECT granted_role\nFROM DBA_ROLE_PRIVS\nCONNECT BY PRIOR granted_role = grantee START WITH grantee = 'HIPODROMO'\n)\nORDER BY 1,2,3,4;\n</code></pre> <pre><code>GRANTEE                                                                                                                                                  OWNER    TABLE_NAME                                                                                                                                                   PRIVILEGE\n-------------------------------------------------------------------------------------------------------------------------------- -------------------------------------------------------------------------------------------------------------------------------- -------------------------------------------------------------------------------------------------------------------------------- ----------------------------------------\nHIPODROMO                                                                                                                                                SCOTT    DEPT                                                                                                                                                         DELETE\nHIPODROMO                                                                                                                                                SCOTT    DEPT                                                                                                                                                         SELECT\n</code></pre> <p>Vemos que sobre la tabla <code>DEPT</code> de <code>SCOTT</code> tiene permisos que buscamos.</p> <p>Ahora s\u00f3lo quedar\u00eda comprobar si efectivamente esa tabla est\u00e1 en el tablespace <code>USERS</code>:</p> <pre><code>SELECT owner,table_name,tablespace_name\nFROM DBA_TABLES\nWHERE owner = 'SCOTT'\nAND table_name = 'DEPT'\nAND tablespace_name = 'USERS';\n</code></pre> <pre><code>OWNER                                                                                                                                                        TABLE_NAME                                                                                                                                               TABLESPACE_NAME\n-------------------------------------------------------------------------------------------------------------------------------- -------------------------------------------------------------------------------------------------------------------------------- ------------------------------\nSCOTT                                                                                                                                                        DEPT     USERS\n</code></pre> <p>Vemos que s\u00ed.</p> <p>Ese usuario por lo tanto queda marcado como que tiene acceso al tablespace <code>USERS</code> y se muestra. El mismo proceso de comprobaciones se repite para todos los usuarios.</p>"},{"location":"p6-almacenamiento/ri/alumno4/#ejercicio-6","title":"Ejercicio 6","text":""},{"location":"p6-almacenamiento/ri/alumno4/#61-enunciado","title":"6.1 Enunciado","text":"<p>Realizar un procedimiento llamado <code>MostrarInfoTabla</code> que reciba el nombre de una tabla y muestre la siguiente informaci\u00f3n sobre la misma:</p> <ul> <li>Propietario</li> <li>Usuarios que pueden leer sus datos (select)</li> <li>Usuarios que pueden cambiar (insert, update o delete) sus datos</li> <li>Usuarios que pueden modificar su estructura</li> <li>Usuarios que pueden eliminarla</li> <li>Lista de extensiones</li> <li>En qu\u00e9 fichero de datos se encuentran</li> </ul>"},{"location":"p6-almacenamiento/ri/alumno4/#62-codigo","title":"6.2 C\u00f3digo","text":"<pre><code>CREATE OR REPLACE PROCEDURE comprobar_privilegios_eliminadores(\np_usuario IN DBA_USERS.username%TYPE,\np_owner IN DBA_TABLES.owner%TYPE,\np_tabla IN DBA_TABLES.table_name%TYPE,\np_control OUT BOOLEAN\n) AS\nCURSOR c_lista_privilegios IS\nSELECT *\nFROM DBA_SYS_PRIVS\nWHERE grantee = p_usuario\nOR grantee IN (\nSELECT granted_role\nFROM DBA_ROLE_PRIVS\nCONNECT BY PRIOR granted_role = grantee START WITH grantee = p_usuario\n)\nORDER BY 1,2,3;\nvn_contador NUMBER := 0;\nBEGIN\nFOR i IN c_lista_privilegios LOOP\nIF i.privilege = 'DROP ANY TABLE' THEN\nvn_contador := vn_contador + 1;\nEND IF;\nEND LOOP;\nIF vn_contador &gt; 0 THEN\np_control := TRUE;\nELSE\np_control := FALSE;\nEND IF;\nEND;\n/\n</code></pre> <pre><code>CREATE OR REPLACE PROCEDURE comprobar_eliminadores(\np_owner IN DBA_TABLES.owner%TYPE,\np_tabla IN DBA_TABLES.table_name%TYPE,\np_eliminadores OUT VARCHAR2\n) AS\nCURSOR c_usuarios IS\nSELECT username\nFROM DBA_USERS;\nvb_control BOOLEAN;\nBEGIN\nFOR i IN c_usuarios LOOP\ncomprobar_privilegios_eliminadores(i.username,p_owner,p_tabla,vb_control);\nIF i.username = p_owner THEN\np_eliminadores := p_eliminadores || i.username || ' (propietario), ';\nEND IF;\nIF vb_control THEN\np_eliminadores := p_eliminadores || i.username || ', ';\nEND IF;\nEND LOOP;\np_eliminadores := RTRIM(p_eliminadores, ', ');\nEND;\n/\n</code></pre> <pre><code>CREATE OR REPLACE PROCEDURE comprobar_privilegios_alteradores(\np_usuario IN DBA_USERS.username%TYPE,\np_owner IN DBA_TABLES.owner%TYPE,\np_tabla IN DBA_TABLES.table_name%TYPE,\np_control OUT BOOLEAN\n) AS\nCURSOR c_lista_privilegios IS\nSELECT *\nFROM DBA_TAB_PRIVS\nWHERE grantee = p_usuario\nOR grantee IN (\nSELECT granted_role\nFROM DBA_ROLE_PRIVS\nCONNECT BY PRIOR granted_role = grantee START WITH grantee = p_usuario\n)\nORDER BY 1,2,3,4;\nvn_contador NUMBER := 0;\nBEGIN\nFOR i IN c_lista_privilegios LOOP\nIF i.privilege = 'ALTER' AND i.owner = p_owner AND i.table_name = p_tabla THEN\nvn_contador := vn_contador + 1;\nEND IF;\nEND LOOP;\nIF vn_contador &gt; 0 THEN\np_control := TRUE;\nELSE\np_control := FALSE;\nEND IF;\nEND;\n/\n</code></pre> <pre><code>CREATE OR REPLACE PROCEDURE comprobar_alteradores(\np_owner IN DBA_TABLES.owner%TYPE,\np_tabla IN DBA_TABLES.table_name%TYPE,\np_alteradores OUT VARCHAR2\n) AS\nCURSOR c_usuarios IS\nSELECT username\nFROM DBA_USERS;\nvb_control BOOLEAN;\nBEGIN\nFOR i IN c_usuarios LOOP\ncomprobar_privilegios_alteradores(i.username,p_owner,p_tabla,vb_control);\nIF vb_control THEN\np_alteradores := p_alteradores || i.username || ', ';\nEND IF;\nEND LOOP;\np_alteradores := RTRIM(p_alteradores, ', ');\nEND;\n/\n</code></pre> <pre><code>CREATE OR REPLACE PROCEDURE comprobar_privilegios_modificadores(\np_usuario IN DBA_USERS.username%TYPE,\np_owner IN DBA_TABLES.owner%TYPE,\np_tabla IN DBA_TABLES.table_name%TYPE,\np_control OUT BOOLEAN\n) AS\nCURSOR c_lista_privilegios IS\nSELECT *\nFROM DBA_TAB_PRIVS\nWHERE grantee = p_usuario\nOR grantee IN (\nSELECT granted_role\nFROM DBA_ROLE_PRIVS\nCONNECT BY PRIOR granted_role = grantee START WITH grantee = p_usuario\n)\nORDER BY 1,2,3,4;\nvn_contador NUMBER := 0;\nBEGIN\nFOR i IN c_lista_privilegios LOOP\nIF i.privilege IN ('INSERT','UPDATE','DELETE') AND i.owner = p_owner AND i.table_name = p_tabla THEN\nvn_contador := vn_contador + 1;\nEND IF;\nEND LOOP;\nIF vn_contador &gt; 0 THEN\np_control := TRUE;\nELSE\np_control := FALSE;\nEND IF;\nEND;\n/\n</code></pre> <pre><code>CREATE OR REPLACE PROCEDURE comprobar_modificadores(\np_owner IN DBA_TABLES.owner%TYPE,\np_tabla IN DBA_TABLES.table_name%TYPE,\np_modificadores OUT VARCHAR2\n) AS\nCURSOR c_usuarios IS\nSELECT username\nFROM DBA_USERS;\nvb_control BOOLEAN;\nBEGIN\nFOR i IN c_usuarios LOOP\ncomprobar_privilegios_modificadores(i.username,p_owner,p_tabla,vb_control);\nIF vb_control THEN\np_modificadores := p_modificadores || i.username || ', ';\nEND IF;\nEND LOOP;\np_modificadores := RTRIM(p_modificadores, ', ');\nEND;\n/\n</code></pre> <pre><code>CREATE OR REPLACE PROCEDURE comprobar_privilegios_lectores(\np_usuario IN DBA_USERS.username%TYPE,\np_owner IN DBA_TABLES.owner%TYPE,\np_tabla IN DBA_TABLES.table_name%TYPE,\np_control OUT BOOLEAN\n) AS\nCURSOR c_lista_privilegios IS\nSELECT *\nFROM DBA_TAB_PRIVS\nWHERE grantee = p_usuario\nOR grantee IN (\nSELECT granted_role\nFROM DBA_ROLE_PRIVS\nCONNECT BY PRIOR granted_role = grantee START WITH grantee = p_usuario\n)\nORDER BY 1,2,3,4;\nvn_contador NUMBER := 0;\nBEGIN\nFOR i IN c_lista_privilegios LOOP\nIF i.privilege = 'SELECT' AND i.owner = p_owner AND i.table_name = p_tabla THEN\nvn_contador := vn_contador + 1;\nEND IF;\nEND LOOP;\nIF vn_contador &gt; 0 THEN\np_control := TRUE;\nELSE\np_control := FALSE;\nEND IF;\nEND;\n/\n</code></pre> <pre><code>CREATE OR REPLACE PROCEDURE comprobar_lectores(\np_owner IN DBA_TABLES.owner%TYPE,\np_tabla IN DBA_TABLES.table_name%TYPE,\np_lectores OUT VARCHAR2\n) AS\nCURSOR c_usuarios IS\nSELECT username\nFROM DBA_USERS;\nvb_control BOOLEAN;\nBEGIN\nFOR i IN c_usuarios LOOP\ncomprobar_privilegios_lectores(i.username,p_owner,p_tabla,vb_control);\nIF vb_control THEN\np_lectores := p_lectores || i.username || ', ';\nEND IF;\nEND LOOP;\np_lectores := RTRIM(p_lectores, ', ');\nEND;\n/\n</code></pre> <pre><code>CREATE OR REPLACE PROCEDURE MostrarInfoTabla (\np_owner IN VARCHAR2,\np_tabla IN VARCHAR2\n) AS\nvv_propietario VARCHAR2(30);\nvv_lectores VARCHAR2(4000);\nvv_modificadores VARCHAR2(4000);\nvv_alteradores VARCHAR2(4000);\nvv_eliminadores VARCHAR2(4000);\nvv_extensiones VARCHAR2(4000);\nvv_datafile VARCHAR2(4000);\nBEGIN\n-- Propietario\nSELECT owner INTO vv_propietario\nFROM DBA_TABLES\nWHERE table_name = p_tabla\nAND owner = p_owner;\n-- Lectores\ncomprobar_lectores(p_owner,p_tabla,vv_lectores);\n-- Modificadores\ncomprobar_modificadores(p_owner,p_tabla,vv_modificadores);\n-- Alteradores\ncomprobar_alteradores(p_owner,p_tabla,vv_alteradores);\n-- Eliminadores\ncomprobar_eliminadores(p_owner,p_tabla,vv_eliminadores);\n-- Extensiones\nSELECT extent_id INTO vv_extensiones\nFROM DBA_EXTENTS\nWHERE owner = p_owner\nAND segment_name = p_tabla;\n-- Datafile\nSELECT file_name INTO vv_datafile\nFROM DBA_DATA_FILES\nWHERE file_id = (\nSELECT file_id\nFROM DBA_EXTENTS\nWHERE owner = p_owner\nAND segment_name = p_tabla\n);\n-- Informe\nDBMS_OUTPUT.PUT_LINE('Propietario: ' || vv_propietario);\nDBMS_OUTPUT.PUT_LINE('Usuarios que pueden leer los datos: ' || vv_lectores);\nDBMS_OUTPUT.PUT_LINE('Usuarios que pueden cambiar los datos: ' || vv_modificadores);\nDBMS_OUTPUT.PUT_LINE('Usuarios que pueden modificar la estructura: ' || vv_alteradores);\nDBMS_OUTPUT.PUT_LINE('Usuarios que pueden eliminar la tabla: ' || vv_eliminadores);\nDBMS_OUTPUT.PUT_LINE('Lista de extensiones (IDs): ' || vv_extensiones);\nDBMS_OUTPUT.PUT_LINE('Datafile: ' || vv_datafile);\nEND;\n/\n</code></pre>"},{"location":"p6-almacenamiento/ri/alumno4/#63-comprobaciones","title":"6.3 Comprobaciones","text":"<p>Muestro la ejecuci\u00f3n y el resultado:</p> <pre><code>EXEC MostrarInfoTabla('SCOTT','DEPT');\nPropietario: SCOTT\nUsuarios que pueden leer los datos: HIPODROMO\nUsuarios que pueden cambiar los datos: EXAMENBD34, HIPODROMO\nUsuarios que pueden modificar la estructura: HIPODROMO\nUsuarios que pueden eliminar la tabla: SYS, SYSTEM, GSMADMIN_INTERNAL, WMSYS, EXAMENBD34, SCOTT (propietario), HIPODROMO\nLista de extensiones (IDs): 0\nDatafile: /opt/oracle/oradata/ORCLCDB/users01.dbf\nPL/SQL procedure successfully completed.\n</code></pre> <p>Aparece mucho <code>HIPODROMO</code> porque es un usuario que he estado reutilizando para pruebas.</p>"},{"location":"p6-almacenamiento/ri/alumno4/#postgresql","title":"PostgreSQL","text":"<p>Averiguar si pueden establecerse cla\u00fasulas de almacenamiento para las tablas o los espacios de tablas en Postgres.</p>"},{"location":"p6-almacenamiento/ri/alumno4/#mariadb","title":"MariaDB","text":"<p>Averigua si existe el concepto de \u00edndice en MySQL y si coincide con el existente en ORACLE. Explica los distintos tipos de \u00edndices existentes.</p>"},{"location":"p6-almacenamiento/ri/alumno4/#mongodb","title":"MongoDB","text":"<p>Explicar los distintos motores de almacenamiento que ofrece MongoDB, sus caracter\u00edsticas principales y en qu\u00e9 casos es m\u00e1s recomendable utilizar cada uno de ellos.</p> <p>Este apartado ya lo he explicado en mi v\u00eddeo de la grupal. El enlace aqu\u00ed abajo se reproduce a partir del momento donde empiezo a hablar de ello:</p>"}]}